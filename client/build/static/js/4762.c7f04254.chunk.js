"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[4762,2381],{64762:(e,o,y)=>{y.d(o,{applyEdits:()=>E,r3:()=>v,uploadAssets:()=>W,zp:()=>$});var _=y(13812),C=y(39652),Z=y(4180),H=y(66004),N=y(89412),J=y(81618),K=y(4270),P=y(51523),X=y(30172),Q=y(78395),Y=y(19459),ee=y(57022),te=y(35999),ae=y(74629);function F(e){return null!=(null===e||void 0===e?void 0:e.applyEdits)}function A(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function v(e){return e.every(A)}function I(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function $(e){return e.every(I)}async function E(e,o,y){var _;let K,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const Q="gdbVersion"in e?e.gdbVersion:null,ee=null!==(_=X.gdbVersion)&&void 0!==_?_:Q;if((0,Y.Mk)(e)&&e.url)K=(0,Y.Zk)(e.url,e.layerId,ee,"original-and-current-features"===X.returnServiceEditsOption);else{K=(0,J.Tw)(),K.promise.then((o=>{(o.addedFeatures.length||o.updatedFeatures.length||o.deletedFeatures.length||o.addedAttachments.length||o.updatedAttachments.length||o.deletedAttachments.length)&&e.emit("edits",o)}));const o={result:K.promise};e.emit("apply-edits",o)}try{var re;const{results:_,edits:J}=await async function S(e,o,y,_){var H,J,K,X,Q,Y;if(await e.load(),!F(o))throw new Z.A("".concat(e.type,"-layer:no-editing-support"),"Layer source does not support applyEdits capability",{layer:e});if(!(0,ae.tk)(e))throw new Z.A("".concat(e.type,"-layer:editing-disabled"),"Editing is disabled for layer",{layer:e});const{edits:ee,options:re}=await async function R(e,o,y){const _=(0,ae.BR)(e),H=o&&(o.addFeatures||o.updateFeatures||o.deleteFeatures),J=o&&(o.addAttachments||o.updateAttachments||o.deleteAttachments),K=null!=e.infoFor3D;if(function M(e,o,y,_,C,H){if(!e||!_&&!C)throw new Z.A("".concat(H,":missing-parameters"),"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!o.editing.supportsGlobalId&&null!==y&&void 0!==y&&y.globalIdUsed)throw new Z.A("".concat(H,":invalid-parameter"),"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!o.editing.supportsGlobalId&&C)throw new Z.A("".concat(H,":invalid-parameter"),"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((null===y||void 0===y||!y.globalIdUsed)&&C)throw new Z.A("".concat(H,":invalid-parameter"),"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}(o,_,y,!!H,!!J,"".concat(e.type,"-layer")),!_.data.isVersioned&&null!==y&&void 0!==y&&y.gdbVersion)throw new Z.A("".concat(e.type,"-layer:invalid-parameter"),"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!_.editing.supportsRollbackOnFailure&&null!==y&&void 0!==y&&y.rollbackOnFailureEnabled)throw new Z.A("".concat(e.type,"-layer:invalid-parameter"),"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const X={...y};if(null!=X.rollbackOnFailureEnabled||_.editing.supportsRollbackOnFailure||(X.rollbackOnFailureEnabled=!0),X.rollbackOnFailureEnabled||"original-and-current-features"!==X.returnServiceEditsOption||(!1===X.rollbackOnFailureEnabled&&N.A.getLogger("esri.layers.graphics.editingSupport").warn("".concat(e.type,"-layer:invalid-parameter"),"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),X.rollbackOnFailureEnabled=!0),!_.editing.supportsReturnServiceEditsInSourceSpatialReference&&X.returnServiceEditsInSourceSR)throw new Z.A("".concat(e.type,"-layer:invalid-parameter"),"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(X.returnServiceEditsInSourceSR&&"original-and-current-features"!==X.returnServiceEditsOption)throw new Z.A("".concat(e.type,"-layer:invalid-parameter"),"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const Q=function V(e,o,y){var _,H,N;const J=function G(e){var o,y;return{addFeatures:Array.from(null!==(o=null===e||void 0===e?void 0:e.addFeatures)&&void 0!==o?o:[]),updateFeatures:Array.from(null!==(y=null===e||void 0===e?void 0:e.updateFeatures)&&void 0!==y?y:[]),deleteFeatures:e&&C.A.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}(e);if(null!==(_=J.addFeatures)&&void 0!==_&&_.length&&!o.operations.supportsAdd)throw new Z.A("".concat(y,":unsupported-operation"),"Layer does not support adding features.");if(null!==(H=J.updateFeatures)&&void 0!==H&&H.length&&!o.operations.supportsUpdate)throw new Z.A("".concat(y,":unsupported-operation"),"Layer does not support updating features.");if(null!==(N=J.deleteFeatures)&&void 0!==N&&N.length&&!o.operations.supportsDelete)throw new Z.A("".concat(y,":unsupported-operation"),"Layer does not support deleting features.");return J.addFeatures=J.addFeatures.map(x),J.updateFeatures=J.updateFeatures.map(x),J.addAssetFeatures=[],J}(o,_,"".concat(e.type,"-layer")),Y=(null===y||void 0===y?void 0:y.globalIdUsed)||K,ee=e.fields.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(Y){const{globalIdField:o}=e;if(null==o)throw new Z.A("".concat(e.type,"-layer:invalid-parameter"),"Layer does not specify a global id field.");Q.addFeatures.forEach((e=>function T(e,o){const{attributes:y}=e;null==y[o]&&(y[o]=(0,P.yS)())}(e,o)))}return Q.addFeatures.forEach((o=>function U(e,o,y,_){j(e,o,y,_),O(e,o)}(o,e,Y,ee))),Q.updateFeatures.forEach((o=>function L(e,o,y,_){j(e,o,y,_),O(e,o);const C=(0,ae.BR)(o);if("geometry"in e&&null!=e.geometry&&(null===C||void 0===C||!C.editing.supportsGeometryUpdate))throw new Z.A("".concat(o.type,"-layer:unsupported-operation"),"Layer does not support geometry updates.")}(o,e,Y,ee))),Q.deleteFeatures.forEach((o=>function k(e,o,y,_){j(e,o,y,_)}(o,e,Y,ee))),Q.addAttachments.forEach((o=>B(o,e))),Q.updateAttachments.forEach((o=>B(o,e))),K&&await async function z(e,o){var y,_;if(null==o.infoFor3D)return;const{infoFor3D:C}=o,H=null!==(y=(0,te.R_)("model/gltf-binary",C.supportedFormats))&&void 0!==y?y:(0,te.E1)("glb",C.supportedFormats);if(!H||!C.editFormats.includes(H))throw new Z.A("".concat(o.type,"-layer:binary-gltf-asset-not-supported"),"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");null!==(_=e.addAssetFeatures)&&void 0!==_||(e.addAssetFeatures=[]);const{addAssetFeatures:N}=e;for(const Z of null!==(J=e.addFeatures)&&void 0!==J?J:[]){var J;q(Z)&&N.push(Z)}for(const Z of null!==(K=e.updateFeatures)&&void 0!==K?K:[]){var K;q(Z)&&N.push(Z)}}(Q,e),{edits:await D(Q),options:X}}(e,y,_);return null!==(H=ee.addFeatures)&&void 0!==H&&H.length||null!==(J=ee.updateFeatures)&&void 0!==J&&J.length||null!==(K=ee.deleteFeatures)&&void 0!==K&&K.length||null!==(X=ee.addAttachments)&&void 0!==X&&X.length||null!==(Q=ee.updateAttachments)&&void 0!==Q&&Q.length||null!==(Y=ee.deleteAttachments)&&void 0!==Y&&Y.length?{edits:ee,results:await o.applyEdits(ee,re)}:{edits:ee,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}(e,o,y,X),l=e=>e.filter((e=>!e.error)).map(H.o8),Q={edits:J,addedFeatures:l(_.addFeatureResults),updatedFeatures:l(_.updateFeatureResults),deletedFeatures:l(_.deleteFeatureResults),addedAttachments:l(_.addAttachmentResults),updatedAttachments:l(_.updateAttachmentResults),deletedAttachments:l(_.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:_.editMoment?new Date(_.editMoment):null,globalIdToObjectId:X.globalIdToObjectId};return null!==(re=_.editedFeatureResults)&&void 0!==re&&re.length&&(Q.editedFeatures=_.editedFeatureResults),K.resolve(Q),_}catch(ne){throw K.reject(ne),ne}}function j(e,o,y,_){if(y){if("attributes"in e&&!e.attributes[o.globalIdField])throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Feature should have '".concat(o.globalIdField,"' when 'globalIdUsed' is true"));if(!("attributes"in e)&&!e.globalId)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(_.length&&"attributes"in e)for(const N of _){const y=e.attributes[N.name];if(void 0!==y&&!(0,ee.OG)(N,y))throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Big-integer field '".concat(N.name,"' of the feature must be less than ").concat(Number.MAX_SAFE_INTEGER),{feature:e})}if("geometry"in e&&null!=e.geometry){var C,H;if(e.geometry.hasZ&&!1===(null===(C=o.capabilities)||void 0===C?void 0:C.data.supportsZ))throw new Z.A("".concat(o.type,"-layer:z-unsupported"),"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===(null===(H=o.capabilities)||void 0===H?void 0:H.data.supportsM))throw new Z.A("".concat(o.type,"-layer:m-unsupported"),"Layer does not support m values while feature has m values.")}}function O(e,o){var y;if("geometry"in e&&"mesh"===(null===(y=e.geometry)||void 0===y?void 0:y.type)&&null!=o.infoFor3D&&null!=o.spatialReference){const{geometry:y}=e,{spatialReference:_,vertexSpace:C}=y,H=o.spatialReference,N="local"===C.type,J=(0,Q.EA)(H),K=(0,Q.aI)(H,_),P=K||(0,Q.oT)(H)&&((0,Q.oT)(_)||(0,Q.K8)(_));if(!(N&&J&&P||!N&&!J&&K))throw new Z.A("".concat(o.type,"-layer:mesh-unsupported"),"Uploading a mesh with a ".concat(C.type," vertex space and a spatial reference wkid:").concat(_.wkid," to a layer with a spatial reference wkid:").concat(H.wkid," is not supported."))}}function B(e,o){var y;const{feature:_,attachment:C}=e;if(!_||"attributes"in _&&!_.attributes[o.globalIdField])throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in _)&&!_.globalId)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Attachment should have reference to 'globalId' of the parent feature");if(!C.globalId)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Attachment should have 'globalId'");if(!C.data&&!C.uploadId)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Attachment should have 'data' or 'uploadId'");if(!(C.data instanceof File&&C.data.name)&&!C.name)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"'name' is required when attachment is specified as Base64 encoded string using 'data'");if((null===(y=o.capabilities)||void 0===y||!y.editing.supportsUploadWithItemId)&&C.uploadId)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof C.data){const e=(0,K.r$)(C.data);if(e&&!e.isBase64)throw new Z.A("".concat(o.type,"-layer:invalid-parameter"),"Attachment 'data' should be a Blob, File or Base64 encoded string")}}async function D(e){var o,y;const _=null!==(o=e.addFeatures)&&void 0!==o?o:[],C=null!==(y=e.updateFeatures)&&void 0!==y?y:[],Z=_.concat(C).map((e=>e.geometry)),H=await(0,X.el)(Z),N=_.length,J=C.length;return H.slice(0,N).forEach(((e,o)=>_[o].geometry=e)),H.slice(N,N+J).forEach(((e,o)=>C[o].geometry=e)),e}function x(e){const o=new _.A;return e.attributes||(e.attributes={}),o.geometry=e.geometry,o.attributes=e.attributes,o}function q(e){var o;return"mesh"===(null===e||void 0===e||null===(o=e.geometry)||void 0===o?void 0:o.type)}function W(e,o,y,_){if(!F(o))throw new Z.A("".concat(e.type,"-layer:no-editing-support"),"Layer source does not support applyEdits capability",{layer:e});if(!o.uploadAssets)throw new Z.A("".concat(e.type,"-layer:no-asset-upload-support"),"Layer source does not support uploadAssets capability",{layer:e});return o.uploadAssets(y,_)}},19459:(e,o,y)=>{y.d(o,{Mk:()=>p,Zk:()=>h,w6:()=>F});var _=y(80671),C=y(73067),Z=y(66004),H=y(81618),N=(y(89412),y(50886),y(4180),y(68682)),J=y(14010);const K=new C.A.EventEmitter;function h(e,o){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,_=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=(0,H.Tw)();return _=null==o||_,K.emit("apply-edits",{serviceUrl:e,layerId:o,gdbVersion:y,mayReceiveServiceEdits:_,result:C.promise}),C}const P="esri.layers.mixins.EditBusLayer",X=Symbol(P);function p(e){return null!=e&&"object"==typeof e&&X in e}function b(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function g(e,o,y){const _=new URL(e).host,C=J.Z3.get(_),n=e=>!e||e===C;return n(o)&&n(y)||o===y}const F=e=>{var o;let y=class extends e{constructor(){super(...arguments),this[o]=!0,this._applyEditsHandler=e=>{const{serviceUrl:o,layerId:y,gdbVersion:_,mayReceiveServiceEdits:C,result:H}=e,N=o===this.url,K=null!=y&&null!=this.layerId&&y===this.layerId,P=b(this),X=b(this)&&g(o,_,this.gdbVersion);if(!N||P&&!X||!K&&!C)return;const Q=H.then((e=>{var o;if(K&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,Z.o8)(e)),e;const y=null===(o=e.editedFeatures)||void 0===o?void 0:o.find((e=>{let{layerId:o}=e;return o===this.layerId}));if(y){const{adds:o,updates:_,deletes:C}=y.editedFeatures,H={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:o?o.map((e=>{let{attributes:o}=e;return{objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]}})):[],deletedFeatures:C?C.map((e=>{let{attributes:o}=e;return{objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]}})):[],updatedFeatures:_?_.map((e=>{let{current:{attributes:o}}=e;return{objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]}})):[],editedFeatures:(0,Z.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,Z.o8)(e.historicMoment)};return this.emit("edits",H),H}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,Z.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,Z.o8)(e.historicMoment)}})).then((e=>("historicMoment"in this&&this.historicMoment!==e.historicMoment&&(0,J.w5)(o,_)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:Q})},this._updateMomentHandler=e=>{const{serviceUrl:o,gdbVersion:y,moment:_}=e,C=o===this.url,Z=b(this),H=b(this)&&g(o,y,this.gdbVersion),N=b(this)&&!g(o,this.gdbVersion,null);C&&Z&&H&&N&&"historicMoment"in this&&this.historicMoment!==_&&(this.historicMoment=_)},this.when().then((()=>{this.addHandles(function l(e){return K.on("apply-edits",new WeakRef(e))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function a(e){return K.on("update-moment",new WeakRef(e))}(this._updateMomentHandler))}),(()=>{}))}};return o=X,y=(0,_._)([(0,N.$)(P)],y),y}},35999:(e,o,y)=>{y.d(o,{E1:()=>i,Fm:()=>s,JZ:()=>F,R_:()=>u,fu:()=>t,oF:()=>r,rq:()=>c});const _=[["binary","application/octet-stream","bin",""]];function t(e,o){var y;return null!=d(o.name,null!==(y=null===e||void 0===e?void 0:e.supportedFormats)&&void 0!==y?y:[])}function r(e,o){var y;if(!e)return!1;const _=c(o,null!==(y=e.supportedFormats)&&void 0!==y?y:[]);return null!=_&&e.editFormats.includes(_)}function u(e,o){return m(function p(e,o){const y=e.toLowerCase();return a(o).find((e=>l(e)===y))}(e,o))}function i(e,o){return m(d(e,o))}function s(e,o){return l(function f(e,o){return a(o).find((o=>m(o)===e))}(e,o))}function c(e,o){var y;return null!==(y=i(e.name,o))&&void 0!==y?y:u(e.type,o)}function a(e){return[..._,...e]}function d(e,o){const y=e.toLowerCase();return a(o).find((e=>w(e).some((e=>y.endsWith(e)))))}function m(e){return null===e||void 0===e?void 0:e[0]}function l(e){return null===e||void 0===e?void 0:e[1].toLowerCase()}function w(e){var o;return null!==(o=null===e||void 0===e?void 0:e[2].split(",").map((e=>e.toLowerCase())))&&void 0!==o?o:[]}function F(e){var o;return null===(o=e.tables)||void 0===o?void 0:o.find((e=>"assetMaps"===e.role))}},14010:(e,o,y)=>{y.d(o,{TA:()=>C,We:()=>a,Z3:()=>Z,ZJ:()=>i,w5:()=>c});var _=y(53705);const C=(0,y(51523).vD)(),Z=new Map,H=new Map;new Map;async function a(e,o,y){if(!e||!y)return!1;if(!o)return!0;const C=new URL(e).host;let H=Z.get(C);if(!H){const o=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");H=(await(0,_.A)(o,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return H===o}async function i(e,o){var _;let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!o)return!0;const N=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),J=null===(_=H.get(N))||void 0===_?void 0:_.entries();if(J)for(const[H,P]of J)if(P.name===o){var K;const e=!(null!==(K=P.stack)&&void 0!==K&&K.hasForwardEdits());if(!e&&Z){const[{deleteForwardEdits:e},{default:o}]=await Promise.all([y.e(2508).then(y.bind(y,42508)),y.e(5676).then(y.bind(y,75676))]);return e(N,H,new o({sessionId:C,moment:P.moment}))}return e}return!0}function c(e,o){var y;if(!e)return!1;const _=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),C=null===(y=H.get(_))||void 0===y?void 0:y.entries();if(C)for(const[Z,H]of C)if(H.name===o)return"edit"===H.lockType;return!1}}}]);
//# sourceMappingURL=4762.c7f04254.chunk.js.map