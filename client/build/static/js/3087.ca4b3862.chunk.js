"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[3087],{22507:(o,m,p)=>{p.d(m,{v:()=>e});var b=p(59741);class e{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(o,m){const p=this._serviceMetadatas.get(o);if(p)return p;const g=await(0,b.V)(o,m);return this._serviceMetadatas.set(o,g),g}async fetchItemData(o){const{id:m}=o;if(!m)return null;const{_itemDatas:p}=this;if(p.has(m))return p.get(m);const b=await o.fetchData();return p.set(m,b),b}async fetchCustomParameters(o,m){const p=await this.fetchItemData(o);return p&&"object"==typeof p&&(m?m(p):p.customParameters)||null}}},75427:(o,m,p)=>{p.d(m,{L:()=>s});var b=p(50075),g=p(53705),P=p(4180),T=p(81618),C=p(26128),O=p(91710),U=p(35799);async function s(o,m){var p,G;const A=(0,C.qg)(o);if(!A)throw new P.A("invalid-url","Invalid scene service url");const j={...m,sceneServerUrl:A.url.path,layerId:null!==(p=A.sublayer)&&void 0!==p?p:void 0};if(null!==(G=j.sceneLayerItem)&&void 0!==G||(j.sceneLayerItem=await async function l(o){const m=(await c(o)).serviceItemId;if(!m)return null;const p=new U.default({id:m,apiKey:o.apiKey}),P=await async function u(o){const m=null===b.id||void 0===b.id?void 0:b.id.findServerInfo(o.sceneServerUrl);if(null!==m&&void 0!==m&&m.owningSystemUrl)return m.owningSystemUrl;const p=o.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const m=(await(0,g.A)(p,{query:{f:"json"},responseType:"json",signal:o.signal})).data.owningSystemUrl;if(m)return m}catch(F){(0,T.QP)(F)}return null}(o);null!=P&&(p.portal=new O.A({url:P}));try{return p.load({signal:o.signal})}catch(k){return(0,T.QP)(k),null}}(j)),null==j.sceneLayerItem)return f(j.sceneServerUrl.replace("/SceneServer","/FeatureServer"),j);const F=await async function y(o){let{sceneLayerItem:m,signal:p}=o;if(!m)return null;try{const o=(await m.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:p})).find((o=>"Feature Service"===o.type))||null;if(!o)return null;const b=new U.default({portal:o.portal,id:o.id});return await b.load(),b}catch(b){return(0,T.QP)(b),null}}(j);if(null===F||void 0===F||!F.url)throw new P.A("related-service-not-found","Could not find feature service through portal item relationship");j.featureServiceItem=F;const k=await f(F.url,j);return k.portalItem=F,k}async function c(o){if(o.rootDocument)return o.rootDocument;const m={query:{f:"json",...o.customParameters,token:o.apiKey},responseType:"json",signal:o.signal};try{const p=await(0,g.A)(o.sceneServerUrl,m);o.rootDocument=p.data}catch{o.rootDocument={}}return o.rootDocument}async function f(o,m){var p,b,T;const O=(0,C.qg)(o);if(!O)throw new P.A("invalid-feature-service-url","Invalid feature service url");const U=O.url.path,G=m.layerId;if(null==G)return{serverUrl:U};const A=c(m),j=m.featureServiceItem?await m.featureServiceItem.fetchData("json"):null,F=null===(p=(null===j||void 0===j||null===(b=j.layers)||void 0===b?void 0:b[0])||(null===j||void 0===j||null===(T=j.tables)||void 0===T?void 0:T[0]))||void 0===p?void 0:p.customParameters,y=o=>{const p={query:{f:"json",...F},responseType:"json",authMode:o,signal:m.signal};return(0,g.A)(U,p)},k=y("anonymous").catch((()=>y("no-prompt"))),[W,_]=await Promise.all([k,A]),V=null===_||void 0===_?void 0:_.layers,X=W.data&&W.data.layers;if(!Array.isArray(X))throw new Error("expected layers array");if(Array.isArray(V)){for(let g=0;g<Math.min(V.length,X.length);g++)if(V[g].id===G)return{serverUrl:U,layerId:X[g].id}}else if(null!=G&&G<X.length)return{serverUrl:U,layerId:X[G].id};throw new Error("could not find matching associated sublayer")}},77247:(o,m,p)=>{p.d(m,{S:()=>b});const b={BingMapsLayer:async()=>(await p.e(4502).then(p.bind(p,34502))).default,BuildingSceneLayer:async()=>(await Promise.all([p.e(5658),p.e(6572),p.e(9370),p.e(8910),p.e(1138),p.e(854),p.e(2015),p.e(8769),p.e(5209)]).then(p.bind(p,3005))).default,CatalogLayer:async()=>(await Promise.all([p.e(2050),p.e(4714),p.e(5658),p.e(6523),p.e(4963),p.e(6542),p.e(7373)]).then(p.bind(p,58059))).default,CSVLayer:async()=>(await Promise.all([p.e(5658),p.e(6572),p.e(9370),p.e(8600)]).then(p.bind(p,34239))).default,DimensionLayer:async()=>(await p.e(363).then(p.bind(p,90363))).default,ElevationLayer:async()=>(await p.e(7156).then(p.bind(p,77156))).default,FeatureLayer:async()=>(await Promise.all([p.e(5658),p.e(6572),p.e(9370),p.e(1230)]).then(p.bind(p,9370))).default,GeoJSONLayer:async()=>(await Promise.resolve().then(p.bind(p,23147))).default,GeoRSSLayer:async()=>(await p.e(6735).then(p.bind(p,6735))).default,GroupLayer:async()=>(await p.e(8908).then(p.bind(p,48908))).default,ImageryLayer:async()=>(await Promise.all([p.e(4714),p.e(398),p.e(47),p.e(7758),p.e(1241),p.e(1752)]).then(p.bind(p,19901))).default,ImageryTileLayer:async()=>(await Promise.all([p.e(398),p.e(3804),p.e(47),p.e(7758),p.e(1226),p.e(1241),p.e(3293)]).then(p.bind(p,73293))).default,IntegratedMeshLayer:async()=>(await Promise.all([p.e(854),p.e(9879)]).then(p.bind(p,99879))).default,KMLLayer:async()=>(await p.e(7917).then(p.bind(p,97917))).default,LineOfSightLayer:async()=>(await p.e(5216).then(p.bind(p,95216))).default,LinkChartLayer:async()=>(await Promise.all([p.e(2050),p.e(5004),p.e(2541),p.e(6523),p.e(2214),p.e(9422),p.e(7522)]).then(p.bind(p,49898))).default,MapImageLayer:async()=>(await Promise.all([p.e(2050),p.e(4714),p.e(4963),p.e(2035),p.e(6607)]).then(p.bind(p,66607))).default,MapNotesLayer:async()=>(await Promise.all([p.e(5658),p.e(6572),p.e(9370),p.e(2112)]).then(p.bind(p,77143))).default,MediaLayer:async()=>(await p.e(2662).then(p.bind(p,22662))).default,OGCFeatureLayer:async()=>(await Promise.all([p.e(2050),p.e(5543),p.e(1028)]).then(p.bind(p,91028))).default,OpenStreetMapLayer:async()=>(await p.e(1131).then(p.bind(p,61131))).default,OrientedImageryLayer:async()=>(await Promise.all([p.e(5658),p.e(6572),p.e(9370),p.e(4885)]).then(p.bind(p,1570))).default,PointCloudLayer:async()=>(await Promise.all([p.e(854),p.e(8289)]).then(p.bind(p,58289))).default,RouteLayer:async()=>(await Promise.all([p.e(727),p.e(2088)]).then(p.bind(p,62088))).default,SceneLayer:async()=>(await Promise.all([p.e(9278),p.e(8910),p.e(1138),p.e(854),p.e(148),p.e(2015),p.e(5017),p.e(2664),p.e(8769),p.e(2620)]).then(p.bind(p,82620))).default,StreamLayer:async()=>(await p.e(7619).then(p.bind(p,17619))).default,SubtypeGroupLayer:async()=>(await Promise.all([p.e(5658),p.e(6572),p.e(7036)]).then(p.bind(p,34009))).default,TileLayer:async()=>(await Promise.all([p.e(2050),p.e(4714),p.e(4963),p.e(2035),p.e(590)]).then(p.bind(p,30590))).default,IntegratedMesh3DTilesLayer:async()=>(await p.e(5534).then(p.bind(p,45534))).default,UnknownLayer:async()=>(await p.e(7240).then(p.bind(p,17240))).default,UnsupportedLayer:async()=>(await p.e(9683).then(p.bind(p,69683))).default,VectorTileLayer:async()=>(await Promise.all([p.e(6313),p.e(3299),p.e(358)]).then(p.bind(p,11018))).default,VoxelLayer:async()=>(await Promise.all([p.e(854),p.e(439)]).then(p.bind(p,30439))).default,WFSLayer:async()=>(await Promise.all([p.e(4860),p.e(2777)]).then(p.bind(p,32123))).default,WMSLayer:async()=>(await p.e(5471).then(p.bind(p,95471))).default,WMTSLayer:async()=>(await p.e(402).then(p.bind(p,90402))).default,WebTileLayer:async()=>(await p.e(6464).then(p.bind(p,56464))).default}},2522:(o,m,p)=>{p.d(m,{PC:()=>i,WZ:()=>r,XH:()=>s,_r:()=>t,ay:()=>u,bO:()=>a,nu:()=>c,pJ:()=>l,z8:()=>n});var b=p(75427);function t(o){const m={id:o.id,name:o.name};return"Oriented Imagery Layer"===o.type&&(m.layerType="OrientedImageryLayer"),m}async function a(o,m,p){var b,g;if(null==(null===(b=o)||void 0===b?void 0:b.layers)||null==(null===(g=o)||void 0===g?void 0:g.tables)){var P,T,C;const b=await p.fetchServiceMetadata(m,{customParameters:null===(P=l(o))||void 0===P?void 0:P.customParameters});(o=o||{}).layers=o.layers||(null===b||void 0===b||null===(T=b.layers)||void 0===T?void 0:T.map(t)),o.tables=o.tables||(null===b||void 0===b||null===(C=b.tables)||void 0===C?void 0:C.map(t))}return o}function r(o){const{layers:m,tables:p}=o;return null!==m&&void 0!==m&&m.length?m[0].id:null!==p&&void 0!==p&&p.length?p[0].id:null}function l(o){if(!o)return null;const{layers:m,tables:p}=o;return null!==m&&void 0!==m&&m.length?m[0]:null!==p&&void 0!==p&&p.length?p[0]:null}function s(o){var m,p,b,g;return(null!==(m=null===o||void 0===o||null===(p=o.layers)||void 0===p?void 0:p.length)&&void 0!==m?m:0)+(null!==(b=null===o||void 0===o||null===(g=o.tables)||void 0===g?void 0:g.length)&&void 0!==b?b:0)}function n(o){var m;const p=[];return null!==o&&void 0!==o&&null!==(m=o.layers)&&void 0!==m&&m.forEach((o=>{"SubtypeGroupLayer"===o.layerType&&p.push(o.id)})),p}function u(o){var m;return null===o||void 0===o||null===(m=o.layers)||void 0===m?void 0:m.filter((o=>{let{layerType:m}=o;return"OrientedImageryLayer"===m})).map((o=>{let{id:m}=o;return m}))}function i(o){var m;return null===o||void 0===o||null===(m=o.layers)||void 0===m?void 0:m.filter((o=>{let{layerType:m}=o;return"CatalogLayer"===m})).map((o=>{let{id:m}=o;return m}))}async function c(o,m,p){var g,P,T;if(null===o||void 0===o||!o.url)return null!==(g=m)&&void 0!==g?g:{};if(null!==(P=m)&&void 0!==P||(m={}),!m.layers){var C;const b=await p.fetchServiceMetadata(o.url);m.layers=null===(C=b.layers)||void 0===C?void 0:C.map(t)}const{serverUrl:O,portalItem:U}=await(0,b.L)(o.url,{sceneLayerItem:o,customParameters:null===(T=l(m))||void 0===T?void 0:T.customParameters}).catch((()=>({serverUrl:null,portalItem:null})));if(null==O)return m.tables=[],m;if(!m.tables&&U){const o=await U.fetchData();if(null!==o&&void 0!==o&&o.tables)m.tables=o.tables.map(t);else{var G,A;const b=await p.fetchServiceMetadata(O,{customParameters:null===(G=l(o))||void 0===G?void 0:G.customParameters});m.tables=null===b||void 0===b||null===(A=b.tables)||void 0===A?void 0:A.map(t)}}if(m.tables)for(const b of m.tables)b.url="".concat(O,"/").concat(b.id);return m}},53087:(o,m,p)=>{p.d(m,{fromItem:()=>d,n:()=>w});var b=p(4180),g=p(75427),P=p(22507),T=p(74629),C=p(77247),O=p(35799),U=p(2522),G=p(67177);async function d(o){!o.portalItem||o.portalItem instanceof O.default||(o={...o,portalItem:new O.default(o.portalItem)});const m=await async function L(o){await o.load();const m=new P.v;return async function N(o){const m=o.className,p=C.S[m];return{constructor:await p(),properties:o.properties}}(await w(o,m))}(o.portalItem);return new(0,m.constructor)({portalItem:o.portalItem,...m.properties})}async function w(o,m){switch(o.type){case"3DTiles Service":return{className:"IntegratedMesh3DTilesLayer"};case"CSV":return{className:"CSVLayer"};case"Feature Collection":return async function M(o){await o.load();const m=(0,G.Y)(o,"Map Notes"),p=(0,G.Y)(o,"Markup");if(m||p)return{className:"MapNotesLayer"};if((0,G.Y)(o,"Route Layer"))return{className:"RouteLayer"};const b=await o.fetchData();return 1===(0,U.XH)(b)?{className:"FeatureLayer"}:{className:"GroupLayer"}}(o);case"Feature Service":return async function I(o,m){const p=await J(o,m);if("object"==typeof p){const{sourceJSON:o,className:m}=p,b={sourceJSON:o};return null!=p.id&&(b.layerId=p.id),{className:m||"FeatureLayer",properties:b}}return{className:"GroupLayer"}}(o,m);case"Feed":case"Stream Service":return{className:"StreamLayer"};case"GeoJson":return{className:"GeoJSONLayer"};case"Group Layer":return{className:"GroupLayer"};case"Image Service":return async function h(o,m){var p,b,g,P;await o.load();const T=null!==(p=null===(b=o.typeKeywords)||void 0===b?void 0:b.map((o=>o.toLowerCase())))&&void 0!==p?p:[];if(T.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(T.includes("tiled imagery"))return{className:"ImageryTileLayer"};const C=await m.fetchItemData(o),O=null===C||void 0===C?void 0:C.layerType;if("ArcGISTiledImageServiceLayer"===O)return{className:"ImageryTileLayer"};if("ArcGISImageServiceLayer"===O)return{className:"ImageryLayer"};const U=await m.fetchServiceMetadata(o.url,{customParameters:await m.fetchCustomParameters(o)}),G=null===(g=U.cacheType)||void 0===g?void 0:g.toLowerCase(),A=null===(P=U.capabilities)||void 0===P?void 0:P.toLowerCase().includes("tilesonly");return"map"===G||A?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}(o,m);case"KML":return{className:"KMLLayer"};case"Map Service":return async function S(o,m){return await async function D(o,m){const{tileInfo:p}=await m.fetchServiceMetadata(o.url,{customParameters:await m.fetchCustomParameters(o)});return p}(o,m)?{className:"TileLayer"}:{className:"MapImageLayer"}}(o,m);case"Media Layer":return{className:"MediaLayer"};case"Scene Service":return async function v(o,m){const p=await J(o,m,(async()=>{try{var p;if(!o.url)return[];const{serverUrl:b}=await(0,g.L)(o.url,{sceneLayerItem:o}),P=await m.fetchServiceMetadata(b);return null!==(p=null===P||void 0===P?void 0:P.tables)&&void 0!==p?p:[]}catch{return[]}}));if("object"==typeof p){var b;const g={};let P;if(null!=p.id?(g.layerId=p.id,P="".concat(o.url,"/layers/").concat(p.id)):P=o.url,null!==(b=o.typeKeywords)&&void 0!==b&&b.length)for(const m of Object.keys(T.XX))if(o.typeKeywords.includes(m))return{className:T.XX[m]};const C=await m.fetchServiceMetadata(P,{customParameters:await m.fetchCustomParameters(o,(o=>{var m;return null===(m=(0,U.pJ)(o))||void 0===m?void 0:m.customParameters}))});return{className:T.XX[null===C||void 0===C?void 0:C.layerType]||"SceneLayer",properties:g}}if(!1===p){const p=await m.fetchServiceMetadata(o.url);if("Voxel"===(null===p||void 0===p?void 0:p.layerType))return{className:"VoxelLayer"}}return{className:"GroupLayer"}}(o,m);case"Vector Tile Service":return{className:"VectorTileLayer"};case"WFS":return{className:"WFSLayer"};case"WMS":return{className:"WMSLayer"};case"WMTS":return{className:"WMTSLayer"};default:throw new b.A("portal:unknown-item-type","Unknown item type '${type}'",{type:o.type})}}async function J(o,m,p){const{url:b,type:g}=o,P="Feature Service"===g;if(!b)return{};if(/\/\d+$/.test(b)){if(P){const p=await m.fetchServiceMetadata(b,{customParameters:await m.fetchCustomParameters(o,(o=>{var m;return null===(m=(0,U.pJ)(o))||void 0===m?void 0:m.customParameters}))});if("Oriented Imagery Layer"===p.type)return{id:p.id,className:"OrientedImageryLayer",sourceJSON:p}}return{}}await o.load();let T=await m.fetchItemData(o);if(P){const o=await(0,U.bO)(T,b,m),p=K(o);if("object"==typeof p){const m=(0,U.z8)(o),b=(0,U.ay)(o),g=(0,U.PC)(o);p.className=null!=p.id&&m.includes(p.id)?"SubtypeGroupLayer":null!=p.id&&null!==b&&void 0!==b&&b.includes(p.id)?"OrientedImageryLayer":null!=p.id&&null!==g&&void 0!==g&&g.includes(p.id)?"CatalogLayer":"FeatureLayer"}return p}if("Scene Service"===g&&(T=await(0,U.nu)(o,T,m)),(0,U.XH)(T)>0)return K(T);const C=await m.fetchServiceMetadata(b);return p&&(C.tables=await p()),K(C)}function K(o){return 1===(0,U.XH)(o)&&{id:(0,U.WZ)(o)}}},59741:(o,m,p)=>{p.d(m,{V:()=>t});var b=p(53705);async function t(o,m){const{data:p}=await(0,b.A)(o,{responseType:"json",query:{f:"json",...null===m||void 0===m?void 0:m.customParameters,token:null===m||void 0===m?void 0:m.apiKey}});return p}}}]);
//# sourceMappingURL=3087.ca4b3862.chunk.js.map