"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[2255],{94101:(e,t,s)=>{s.d(t,{l:()=>a});var r=s(82262),h=s(21847),d=s(231);class a extends d.A{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[r.d.bitmap],target:()=>this.children,drawPhase:h.S5.MAP});return[...super.prepareRenderPasses(e),t]}_manageFade(){this.children.reduce(((e,t)=>e+(t.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},2255:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var r=s(80671),h=s(89412),d=s(81618),p=s(57453),l=(s(50886),s(76761),s(68682)),c=s(94101),u=s(86083),m=s(75811),g=s(27012),_=s(59995);let f=class extends((0,_.A)((0,u.e)(g.A))){update(e){this._strategy.update(e).catch((e=>{(0,d.zf)(e)||h.A.getLogger(this).error(e)})),this.notifyChange("updating")}attach(){this._bitmapContainer=new c.l,this.container.addChild(this._bitmapContainer),this._strategy=new m.A({container:this._bitmapContainer,fetchSource:this.fetchBitmapData.bind(this),requestUpdate:this.requestUpdate.bind(this)})}detach(){this._strategy.destroy(),this._strategy=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}fetchBitmapData(e,t,s){return this.layer.fetchImageBitmap(e,t,s)}async doRefresh(){this.requestUpdate()}isUpdating(){return this._strategy.updating||this.updateRequested}};(0,r._)([(0,p.MZ)()],f.prototype,"_strategy",void 0),(0,r._)([(0,p.MZ)()],f.prototype,"updating",void 0),f=(0,r._)([(0,l.$)("esri.views.2d.layers.BaseDynamicLayerView2D")],f);const y=f},75811:(e,t,s)=>{s.d(t,{A:()=>A});var r=s(80671),h=s(18763),d=(s(50886),s(81618)),p=s(57453),l=(s(89412),s(76761),s(68682)),c=s(88965),u=s(78395),m=s(22179);const g=Math.PI/180;function n(e){return e*g}function o(e,t){const s=n(t.rotation),r=Math.abs(Math.cos(s)),h=Math.abs(Math.sin(s)),[d,p]=t.size;return e[0]=Math.round(p*h+d*r),e[1]=Math.round(p*r+d*h),e}var _=s(82804),f=s(63801),y=s(67685);const v=(0,c.vt)(),x=[0,0],M=new y.A(0,0,0,0),w=2048,b=2048,R=!1,S=!1,C=!1;let P=class extends h.A{constructor(e){super(e),this._imagePromise=null,this.bitmaps=[],this.hidpi=C,this.imageMaxWidth=w,this.imageMaxHeight=b,this.imageRotationSupported=R,this.imageNormalizationSupported=S,this.update=(0,d.sg)((async(e,t)=>{var s,r;if((0,d.Te)(t),!e.stationary||this.destroyed)return;const h=e.state,p=(0,u.Vp)(h.spatialReference),l=this.hidpi?e.pixelRatio:1,c=this.imageNormalizationSupported&&h.worldScreenWidth&&h.worldScreenWidth<h.size[0],m=null!==(s=this.imageMaxWidth)&&void 0!==s?s:0,g=null!==(r=this.imageMaxHeight)&&void 0!==r?r:0;c?(x[0]=h.worldScreenWidth,x[1]=h.size[1]):this.imageRotationSupported?(x[0]=h.size[0],x[1]=h.size[1]):o(x,h);const _=Math.floor(x[0]*l)>m||Math.floor(x[1]*l)>g,f=p&&(h.extent.xmin<p.valid[0]||h.extent.xmax>p.valid[1]),y=!this.imageNormalizationSupported&&f,v=!_&&!y,w=this.imageRotationSupported?h.rotation:0,b=this.container.children.slice();if(v){const e=c?h.paddedViewState.center:h.center;this._imagePromise&&console.error("Image promise was not defined!"),this._imagePromise=this._singleExport(h,x,e,h.resolution,w,l,t)}else{let e=Math.min(m,g);y&&(e=Math.min(h.worldScreenWidth,e)),this._imagePromise=this._tiledExport(h,e,l,t)}try{var R;const e=null!==(R=await this._imagePromise)&&void 0!==R?R:[];(0,d.Te)(t);const s=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=e;for(const t of b)e.includes(t)||s.push(t.fadeOut().then((()=>{t.remove(),t.destroy()})));for(const t of e)s.push(t.fadeIn());await Promise.all(s)}catch(M){this._imagePromise=null,(0,d.QP)(M)}}),5e3),this.updateExports=(0,d.sg)((async e=>{const t=[];for(const s of this.container.children){if(!s.visible||!s.stage)return;t.push(e(s).then((()=>{s.invalidateTexture(),s.requestRender()})))}this._imagePromise=(0,d.Lx)(t).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((e=>e.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(e,t,s,r,h,p){const l=await this.fetchSource(e,Math.floor(t*h),Math.floor(s*h),{rotation:r,pixelRatio:h,signal:p});(0,d.Te)(p);const c=new _.mb(null,!0);return c.x=e.xmin,c.y=e.ymax,c.resolution=e.width/t,c.rotation=r,c.pixelRatio=h,c.opacity=0,this.container.addChild(c),await c.setSourceAsync(l,p),(0,d.Te)(p),c}async _singleExport(e,t,s,r,h,d,p){!function viewStateUtils_a(e,t,s,r){const[h,d]=t,[p,l]=r,c=.5*s;return e[0]=h-c*p,e[1]=d-c*l,e[2]=h+c*p,e[3]=d+c*l,e}(v,s,r,t);const l=(0,c.w1)(v,e.spatialReference);return[await this._export(l,t[0],t[1],h,d,p)]}_tiledExport(e,t,s,r){const h=m.A.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),d=new f.A(h),p=d.getTileCoverage(e);if(!p)return null;const l=[];return p.forEach(((h,p,u,m)=>{M.set(h,p,u,0),d.getTileBounds(v,M);const g=(0,c.w1)(v,e.spatialReference);l.push(this._export(g,t,t,0,s,r).then((e=>(0!==m&&(M.set(h,p,u,m),d.getTileBounds(v,M),e.x=v[0],e.y=v[3]),e))))})),Promise.all(l)}};(0,r._)([(0,p.MZ)()],P.prototype,"_imagePromise",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"bitmaps",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"container",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"fetchSource",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"hidpi",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"imageMaxWidth",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"imageMaxHeight",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"imageRotationSupported",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"imageNormalizationSupported",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"requestUpdate",void 0),(0,r._)([(0,p.MZ)()],P.prototype,"updating",null),P=(0,r._)([(0,l.$)("esri.views.2d.layers.support.ExportStrategy")],P);const A=P},59995:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(80671),h=s(89412),d=s(81618),p=s(63390),l=(s(50886),s(76761),s(4180),s(68682));const i=e=>{let t=class extends e{initialize(){this.addHandles((0,p.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,d.zf)(e)||h.A.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return t=(0,r._)([(0,l.$)("esri.layers.mixins.RefreshableLayerView")],t),t}}}]);
//# sourceMappingURL=2255.2de91de9.chunk.js.map