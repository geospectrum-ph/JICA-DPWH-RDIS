"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[1565],{14324:(e,i,s)=>{s.d(i,{g:()=>_});var r=s(80671),h=s(18763),l=s(25986),d=s(57453),u=(s(50886),s(89412),s(76761),s(68682)),c=s(16906),y=s(32277),m=s(84058),g=s(60003);const f={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let _=class extends h.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const i=(0,m.f)(this.floors,e);return e.toExportImageJSON(i)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,g.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(f[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){var e;const i=!(null===(e=this.floors)||void 0===e||!e.length),s=this.visibleSublayers.filter((e=>null!=e.definitionExpression||i&&null!=e.floorInfo));return s.length?JSON.stringify(s.reduce(((e,i)=>{const s=(0,m.f)(this.floors,i),r=(0,l.m)(s,i.definitionExpression);return null!=r&&(e[i.id]=r),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const i=this.layer.sublayers,s=this.scale,t=i=>{i.visible&&(0===s||(0,c.zx)(s,i.minScale,i.maxScale))&&(i.sublayers?i.sublayers.forEach(t):e.unshift(i))};i&&i.forEach(t);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some(((i,s)=>e[s]!==i))?e:r}toJSON(){const e=this.layer;let i={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?i.dynamicLayers=this.dynamicLayers:i={...i,layers:this.layers,layerDefs:this.layerDefs},i}};(0,r._)([(0,d.MZ)({readOnly:!0})],_.prototype,"dynamicLayers",null),(0,r._)([(0,d.MZ)()],_.prototype,"floors",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],_.prototype,"hasDynamicLayers",null),(0,r._)([(0,d.MZ)()],_.prototype,"layer",null),(0,r._)([(0,d.MZ)({readOnly:!0})],_.prototype,"layers",null),(0,r._)([(0,d.MZ)({readOnly:!0})],_.prototype,"layerDefs",null),(0,r._)([(0,d.MZ)({type:Number})],_.prototype,"scale",void 0),(0,r._)([(0,d.MZ)(y.ui)],_.prototype,"timeExtent",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],_.prototype,"version",null),(0,r._)([(0,d.MZ)({readOnly:!0})],_.prototype,"visibleSublayers",null),_=(0,r._)([(0,u.$)("esri.layers.mixins.ExportImageParameters")],_)},94101:(e,i,s)=>{s.d(i,{l:()=>a});var r=s(82262),h=s(21847),l=s(231);class a extends l.A{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(e){const i=e.registerRenderPass({name:"bitmap",brushes:[r.d.bitmap],target:()=>this.children,drawPhase:h.S5.MAP});return[...super.prepareRenderPasses(e),i]}_manageFade(){this.children.reduce(((e,i)=>e+(i.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},41565:(e,i,s)=>{s.r(i),s.d(i,{default:()=>Z});var r=s(80671),h=s(89412),l=s(81618),d=s(63390),u=s(57453),c=(s(50886),s(76761),s(68682)),y=s(52015),m=s(94101),g=s(86083),f=s(41096),_=s(42238),v=s(75811),x=s(27012),b=s(32277),M=s(14324);const p=e=>{let i=class extends e{initialize(){this.exportImageParameters=new M.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){var e,i;return null!==(e=null===(i=this.view)||void 0===i?void 0:i.floors)&&void 0!==e?e:null}get exportImageVersion(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){var e;return!!super.canResume()&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}};return(0,r._)([(0,u.MZ)()],i.prototype,"exportImageParameters",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],i.prototype,"floors",null),(0,r._)([(0,u.MZ)({readOnly:!0})],i.prototype,"exportImageVersion",null),(0,r._)([(0,u.MZ)()],i.prototype,"layer",void 0),(0,r._)([(0,u.MZ)()],i.prototype,"suspended",void 0),(0,r._)([(0,u.MZ)(b.ui)],i.prototype,"timeExtent",void 0),i=(0,r._)([(0,c.$)("esri.views.layers.MapImageLayerView")],i),i};var S=s(59995),w=s(60773),P=s(5058);let E=class extends(p((0,S.A)((0,g.e)(x.A)))){constructor(){super(...arguments),this._highlightGraphics=new y.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(e,i){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,i)}update(e){const i="".concat(this.exportImageVersion,"/").concat(e.state.id,"/").concat(e.pixelRatio,"/").concat(e.stationary);this._updateHash!==i&&(this._updateHash=i,this.strategy.update(e).catch((e=>{(0,l.zf)(e)||h.A.getLogger(this).error(e)})),e.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(e.state.resolution)),this._highlightView.processUpdate(e)}attach(){const{imageMaxWidth:e,imageMaxHeight:i,version:s}=this.layer,r=s>=10.3,h=s>=10;this._bitmapContainer=new m.l,this.container.addChild(this._bitmapContainer),this._highlightView=new f.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new w.Uh({createFetchPopupFeaturesQueryGeometry:(e,i)=>(0,P.V)(e,i,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(e,i)=>{this._highlightView.graphicUpdateHandler({graphic:e,property:i})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new v.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:i,imageRotationSupported:r,imageNormalizationSupported:h,hidpi:!0}),this.addAttachHandles((0,d.wB)((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.serviceSupportsSpatialReference(e)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,i,s,r){return this.layer.fetchImage(e,i,s,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(e,i,s,r){return this.layer.fetchImageBitmap(e,i,s,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(e){return this._popupHighlightHelper.highlight(e)}};(0,r._)([(0,u.MZ)()],E.prototype,"strategy",void 0),(0,r._)([(0,u.MZ)()],E.prototype,"updating",void 0),E=(0,r._)([(0,c.$)("esri.views.2d.layers.MapImageLayerView2D")],E);const Z=E},75811:(e,i,s)=>{s.d(i,{A:()=>R});var r=s(80671),h=s(18763),l=(s(50886),s(81618)),d=s(57453),u=(s(89412),s(76761),s(68682)),c=s(88965),y=s(78395),m=s(22179);const g=Math.PI/180;function n(e){return e*g}function o(e,i){const s=n(i.rotation),r=Math.abs(Math.cos(s)),h=Math.abs(Math.sin(s)),[l,d]=i.size;return e[0]=Math.round(d*h+l*r),e[1]=Math.round(d*r+l*h),e}var f=s(82804),_=s(63801),v=s(67685);const x=(0,c.vt)(),b=[0,0],M=new v.A(0,0,0,0),S=2048,w=2048,P=!1,E=!1,Z=!1;let H=class extends h.A{constructor(e){super(e),this._imagePromise=null,this.bitmaps=[],this.hidpi=Z,this.imageMaxWidth=S,this.imageMaxHeight=w,this.imageRotationSupported=P,this.imageNormalizationSupported=E,this.update=(0,l.sg)((async(e,i)=>{var s,r;if((0,l.Te)(i),!e.stationary||this.destroyed)return;const h=e.state,d=(0,y.Vp)(h.spatialReference),u=this.hidpi?e.pixelRatio:1,c=this.imageNormalizationSupported&&h.worldScreenWidth&&h.worldScreenWidth<h.size[0],m=null!==(s=this.imageMaxWidth)&&void 0!==s?s:0,g=null!==(r=this.imageMaxHeight)&&void 0!==r?r:0;c?(b[0]=h.worldScreenWidth,b[1]=h.size[1]):this.imageRotationSupported?(b[0]=h.size[0],b[1]=h.size[1]):o(b,h);const f=Math.floor(b[0]*u)>m||Math.floor(b[1]*u)>g,_=d&&(h.extent.xmin<d.valid[0]||h.extent.xmax>d.valid[1]),v=!this.imageNormalizationSupported&&_,x=!f&&!v,S=this.imageRotationSupported?h.rotation:0,w=this.container.children.slice();if(x){const e=c?h.paddedViewState.center:h.center;this._imagePromise&&console.error("Image promise was not defined!"),this._imagePromise=this._singleExport(h,b,e,h.resolution,S,u,i)}else{let e=Math.min(m,g);v&&(e=Math.min(h.worldScreenWidth,e)),this._imagePromise=this._tiledExport(h,e,u,i)}try{var P;const e=null!==(P=await this._imagePromise)&&void 0!==P?P:[];(0,l.Te)(i);const s=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=e;for(const i of w)e.includes(i)||s.push(i.fadeOut().then((()=>{i.remove(),i.destroy()})));for(const i of e)s.push(i.fadeIn());await Promise.all(s)}catch(M){this._imagePromise=null,(0,l.QP)(M)}}),5e3),this.updateExports=(0,l.sg)((async e=>{const i=[];for(const s of this.container.children){if(!s.visible||!s.stage)return;i.push(e(s).then((()=>{s.invalidateTexture(),s.requestRender()})))}this._imagePromise=(0,l.Lx)(i).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((e=>e.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(e,i,s,r,h,d){const u=await this.fetchSource(e,Math.floor(i*h),Math.floor(s*h),{rotation:r,pixelRatio:h,signal:d});(0,l.Te)(d);const c=new f.mb(null,!0);return c.x=e.xmin,c.y=e.ymax,c.resolution=e.width/i,c.rotation=r,c.pixelRatio=h,c.opacity=0,this.container.addChild(c),await c.setSourceAsync(u,d),(0,l.Te)(d),c}async _singleExport(e,i,s,r,h,l,d){!function viewStateUtils_a(e,i,s,r){const[h,l]=i,[d,u]=r,c=.5*s;return e[0]=h-c*d,e[1]=l-c*u,e[2]=h+c*d,e[3]=l+c*u,e}(x,s,r,i);const u=(0,c.w1)(x,e.spatialReference);return[await this._export(u,i[0],i[1],h,l,d)]}_tiledExport(e,i,s,r){const h=m.A.create({size:i,spatialReference:e.spatialReference,scales:[e.scale]}),l=new _.A(h),d=l.getTileCoverage(e);if(!d)return null;const u=[];return d.forEach(((h,d,y,m)=>{M.set(h,d,y,0),l.getTileBounds(x,M);const g=(0,c.w1)(x,e.spatialReference);u.push(this._export(g,i,i,0,s,r).then((e=>(0!==m&&(M.set(h,d,y,m),l.getTileBounds(x,M),e.x=x[0],e.y=x[3]),e))))})),Promise.all(u)}};(0,r._)([(0,d.MZ)()],H.prototype,"_imagePromise",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"bitmaps",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"container",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"fetchSource",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"hidpi",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"imageMaxWidth",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"imageMaxHeight",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"imageRotationSupported",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"imageNormalizationSupported",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"requestUpdate",void 0),(0,r._)([(0,d.MZ)()],H.prototype,"updating",null),H=(0,r._)([(0,u.$)("esri.views.2d.layers.support.ExportStrategy")],H);const R=H}}]);
//# sourceMappingURL=1565.246b05bf.chunk.js.map