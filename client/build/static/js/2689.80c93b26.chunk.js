"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[2689],{9480:(t,e,o)=>{o.d(e,{j:()=>r});var l=o(4180),h=o(50886),u=o(89412),d=o(81618),c=o(80271),_=o(60950),p=o(82380),g=o(60985),f=o(50707),x=o(83663),v=o(83881);class m{constructor(t,e,o){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:l,pixelType:h,textureOnly:u}=t,d=(0,p.Qz)(h);this.blockIndex=o,this.pixelType=h,this.size=e,this.textureOnly=u,u||(this.data=new d(l)),this._resetRange()}destroy(){var t;null===(t=this._texture)||void 0===t||t.dispose();for(const e in this._fbos){const t=this._fbos[e];t&&("0"===e&&t.detachColorTexture(),t.dispose()),this._fbos[e]=null}this._texture=null}get _textureDesc(){const t=new v.R;return t.wrapMode=g.pF.CLAMP_TO_EDGE,t.samplingMode=g.Cj.NEAREST,t.dataType=this.pixelType,t.width=this.size,t.height=this.size,t}setData(t,e,o){const l=(0,_.Q4)(t),h=this.data,u=l*this.texelSize+e;!h||u>=h.length||(h[u]=o,this.dirtyStart=Math.min(this.dirtyStart,l),this.dirtyEnd=Math.max(this.dirtyEnd,l))}getData(t,e){if(null==this.data)return null;const o=(0,_.Q4)(t)*this.texelSize+e;return!this.data||o>=this.data.length?null:this.data[o]}getTexture(t){var e;return null!==(e=this._texture)&&void 0!==e?e:this._initTexture(t)}getFBO(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this._fbos[e]){const o=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new f.H(t,o)}return this._fbos[e]}get hasDirty(){const t=this.dirtyStart;return this.dirtyEnd>=t}updateTexture(t,e){try{const o=this.dirtyStart,d=this.dirtyEnd;if(!this.hasDirty)return;(0,h.A)("esri-2d-update-debug")&&console.debug("Version[".concat(e,"] AttributeStoreView.updateTexture"),{start:o,end:d,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const c=this.data.buffer,_=this.getTexture(t),g=4,f=(o-o%this.size)/this.size,x=(d-d%this.size)/this.size,v=f,S=this.size,w=x,T=f*this.size*g,A=(S+w*this.size)*g-T,D=(0,p.Qz)(this.pixelType),z=new D(c,T*D.BYTES_PER_ELEMENT,A),V=this.size,R=w-v+1;if(R>this.size)return void u.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new l.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));_.updateData(0,0,v,V,R,z)}catch(o){}}update(t){const{data:e,start:o,end:l}=t;if(null!=e&&null!=this.data){const l=this.data,h=o*this.texelSize;for(let o=0;o<e.length;o++){const u=1<<o%this.texelSize;t.layout&u&&(l[h+o]=e[o])}}this.dirtyStart=Math.min(this.dirtyStart,o),this.dirtyEnd=Math.max(this.dirtyEnd,l)}resize(t,e){const o=this.size;if(this.size=e,this.textureOnly)return void(o!==this.size&&(this._lastTexture=this._texture,this._texture=null));const l=(0,p.Qz)(this.pixelType);this.destroy(),this.data=new l(t.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){var e;const o=new x.g(t,this._textureDesc,null!==(e=this.data)&&void 0!==e?e:void 0);if(null!=this._lastTexture&&this._fbos[0]){const e=this._lastTexture.descriptor.width,l=this._lastTexture.descriptor.height,h=this._lastTexture.descriptor.dataType,u=this._lastTexture.descriptor.pixelFormat,d=this.getFBO(t),c=(0,p.AV)(h),_=new((0,p.Qz)(h))(new ArrayBuffer(e*l*c*this.texelSize)),g=t.getBoundFramebufferObject(),{x:f,y:x,width:v,height:S}=t.getViewport();t.bindFramebuffer(d),d.readPixels(0,0,e,l,u,h,_),o.updateData(0,0,0,2*e,l/2,_),t.setViewport(f,x,v,S),t.bindFramebuffer(g)}return this.destroy(),this._texture=o,this._texture}}class y{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(t){if(!t)throw new Error("InternalError: initArgs must be defined");const e=t.blockDescriptors;if(this.size=t.blockSize,(0,h.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:t}),null==this._data)this._data=e.map(((t,e)=>null!=t?new m(t,this.size,e):null));else for(let o=0;o<this._data.length;o++){const t=this._data[o],l=e[o];null!=l&&(null==t?this._data[o]=new m(l,this.size,o):t.resize(l,this.size))}}destroy(){var t;for(const o of null!==(e=this._data)&&void 0!==e?e:[]){var e;null===o||void 0===o||o.destroy()}null===(t=this._defaultTexture)||void 0===t||t.dispose();for(const{resolver:o}of this._pendingAttributeUpdates)o.reject("AttributeStore destroyed");this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(t){return null==this._data?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,0,1,e)}getLabelMinZoom(t){return this.getData(t,0,1,255)}getFilterFlags(t){return this.getData(t,0,0,0)}getVVSize(t){return this.getData(t,c.dV.VV,0,0)}getData(t,e,o,l){if(!this._data)return 0;const h=this._data[e];if(null==h)return 0;const u=h.getData(t,o);return null!=u?u:l}setData(t,e,o,l){this._data[e].setData(t,o,l)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}async requestUpdate(t){const e=(0,d.Tw)();this._version=t.version,this._pendingAttributeUpdates.push({inner:t,resolver:e}),(0,h.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] AttributeStoreView.requestUpdate"),{message:t})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const t=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const{inner:e,resolver:o}of t){const{blockData:t,initArgs:l,sendUpdateEpoch:u,version:d}=e;(0,h.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] Epoch[").concat(u,"] AttributeStoreView.applyUpdate")),this._version=d,this._epoch=u,null!=l&&this._initialize(l);const c=this._data;for(let e=0;e<t.length;e++){const o=t[e],l=c[e];null!=l&&null!=o&&((0,h.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] CpuBlock[").concat(e,"] AttributeStoreView.update"),{block:o}),l.update(o))}o.resolve()}}getUniforms(t){return{filterFlags:{texture:this._getTexture(t,c.dV.FilterFlags),unit:c.uM},animation:{texture:this._getTexture(t,c.dV.Animation),unit:c.z2},gpgpu:{texture:this._getTexture(t,c.dV.GPGPU),unit:c.Sr},visualVariableData:{texture:this._getTexture(t,c.dV.VV),unit:c.nM},dataDriven0:{texture:this._getTexture(t,c.dV.DD0),unit:c.lL},dataDriven1:{texture:this._getTexture(t,c.dV.DD1),unit:c.sn},dataDriven2:{texture:this._getTexture(t,c.dV.DD2),unit:c.n9},size:this.size}}_getTexture(t,e){var o;const l=null===(o=this._data)||void 0===o?void 0:o[e];return l?(l.updateTexture(t,this._version),l.getTexture(t)):this._getDefaultTexture(t)}_getDefaultTexture(t){if(null==this._defaultTexture){const e=new v.R;e.wrapMode=g.pF.CLAMP_TO_EDGE,e.samplingMode=g.Cj.NEAREST,e.width=1,e.height=1,this._defaultTexture=new x.g(t,e,new Uint8Array(4))}return this._defaultTexture}}var S=o(49214);class r extends S.A{constructor(t){super(t),this._statisticsByLevel=new Map,this.attributeView=new y}destroy(){this.children.forEach((t=>t.destroy())),this.removeAllChildren(),this.attributeView.destroy()}doRender(t){t.context.capabilities.enable("textureFloat"),super.doRender(t)}createRenderParams(t){const e=super.createRenderParams(t);return e.attributeView=this.attributeView,e.instanceStore=this._instanceStore,e.statisticsByLevel=this._statisticsByLevel,e}}},49214:(t,e,o)=>{o.d(e,{A:()=>i});var l=o(50886),h=o(21847),u=o(231),d=o(72492),c=o(78443);const n=(t,e)=>t.key.level-e.key.level!=0?t.key.level-e.key.level:t.key.row-e.key.row!=0?t.key.row-e.key.row:t.key.col-e.key.col;class i extends u.A{constructor(t){super(),this._tileInfoView=t}renderChildren(t){this.sortChildren(n),this.setStencilReference(t),super.renderChildren(t)}createRenderParams(t){const{state:e}=t,o=super.createRenderParams(t);return o.requiredLevel=this._tileInfoView.getClosestInfoForScale(e.scale).level,o.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(e.scale),o}prepareRenderPasses(t){const e=super.prepareRenderPasses(t);return e.push(t.registerRenderPass({name:"stencil",brushes:[d.A],drawPhase:h.S5.DEBUG|h.S5.MAP|h.S5.HIGHLIGHT|h.S5.LABEL,target:()=>this.getStencilTarget()})),(0,l.A)("esri-tiles-debug")&&e.push(t.registerRenderPass({name:"tileInfo",brushes:[c.A],drawPhase:h.S5.DEBUG,target:()=>this.children})),e}getStencilTarget(){return this.children}setStencilReference(t){let e=1;for(const o of this.children)o.stencilRef=e++}}},35608:(t,e,o)=>{o.d(e,{O:()=>i});var l=o(84792);class i{constructor(t,e,o,l,h){this._instanceId=t,this.techniqueRef=e,this._meshWriterName=o,this._input=l,this.optionalAttributes=h}get instanceId(){return(0,l.P)(this._instanceId)}createMeshInfo(t){return{id:this._instanceId,meshWriterName:this._meshWriterName,options:t,optionalAttributes:this.optionalAttributes}}getInput(){return this._input}setInput(t){this._input=t}}},2689:(t,e,o)=>{o.d(e,{f:()=>i});var l=o(35598),h=o(9480),u=o(21847),d=o(35608),c=o(53944),_=o(84792);let p=0;function a(t,e,o){return new d.O((0,_.U)(p++),t,t.meshWriter.name,e,o)}const g={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class s{constructor(){this.instances={fill:a(c.YS.fill,g,{zoomRange:!0}),marker:a(c.YS.marker,g,{zoomRange:!0}),line:a(c.YS.line,g,{zoomRange:!0}),text:a(c.YS.text,g,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:a(c.YS.complexFill,g,{zoomRange:!0}),texturedLine:a(c.YS.texturedLine,g,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce(((t,e)=>(t.set(e.instanceId,e),t)),new Map)}getInstance(t){return this._instancesById.get(t)}}var f=o(68052),x=o(46427),v=o(40102),S=o(53395),w=o(30172),T=o(93170),A=o(82380),D=o(25078),z=o(60985),V=o(77127);const R=Math.PI/180;class b extends T.q{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,x.vt)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,l.WD)(this._program)}doRender(t){const{context:e}=t,o=this._getBounds();if(o.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,o),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const l=this._program;e.bindVAO(this._vao),e.useProgram(l),l.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(z.WR.LINES,8*o.length,z.pe.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,x.vt)()}}_createShaderProgram(t){if(this._program)return;this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",y().attributes)}_updateMatricesAndLocalOrigin(t){const{state:e}=t,{displayMat3:o,size:l,resolution:h,pixelRatio:u,rotation:d,viewpoint:c}=e,_=R*d,{x:p,y:g}=c.targetGeometry,x=(0,w.mT)(p,e.spatialReference);this._localOrigin.x=x,this._localOrigin.y=g;const T=u*l[0],A=u*l[1],D=h*T,z=h*A,V=(0,f.D_)(this._dvsMat3);(0,f.lw)(V,V,o),(0,f.Tl)(V,V,(0,v.fA)(T/2,A/2)),(0,f.hs)(V,V,(0,S.fA)(l[0]/D,-A/z,1)),(0,f.e$)(V,V,-_)}_updateBufferData(t,e){const{x:o,y:l}=this._localOrigin,h=8*e.length,u=new Float32Array(h),d=new Uint32Array(8*e.length);let c=0,_=0;for(const p of e)p&&(u[2*c]=p[0]-o,u[2*c+1]=p[1]-l,u[2*c+2]=p[0]-o,u[2*c+3]=p[3]-l,u[2*c+4]=p[2]-o,u[2*c+5]=p[3]-l,u[2*c+6]=p[2]-o,u[2*c+7]=p[1]-l,d[_]=c+0,d[_+1]=c+3,d[_+2]=c+3,d[_+3]=c+2,d[_+4]=c+2,d[_+5]=c+1,d[_+6]=c+1,d[_+7]=c+0,c+=4,_+=8);if(this._vertexBuffer?this._vertexBuffer.setData(u.buffer):this._vertexBuffer=D.g.createVertex(t,z._U.DYNAMIC_DRAW,u.buffer),this._indexBuffer?this._indexBuffer.setData(d):this._indexBuffer=D.g.createIndex(t,z._U.DYNAMIC_DRAW,d),!this._vao){const e=y();this._vao=new V.Z(t,e.attributes,e.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const y=()=>(0,A.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:z.pe.FLOAT}]});class i extends h.j{constructor(t){super(t),this._instanceStore=new s,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,l.pR)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(t){this._boundsRenderer=new b(t),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(t,e){t.onMessage(e),this.contains(t)||this.addChild(t),this.requestRender()}_renderChildren(t,e){t.selection=e;for(const o of this.children){if(!o.visible)continue;const e=o.getDisplayList(t.drawPhase,this._instanceStore,u.ch.STRICT_ORDER);null===e||void 0===e||e.render(t)}}}}}]);
//# sourceMappingURL=2689.80c93b26.chunk.js.map