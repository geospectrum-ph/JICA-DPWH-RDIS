"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[4197],{20155:(c,p,h)=>{function e(c,p){const h=c.count;p||(p=new c.TypedArrayConstructor(h));for(let y=0;y<h;y++)p[y]=c.get(y);return p}h.d(p,{m:()=>e});Object.freeze(Object.defineProperty({__proto__:null,makeDense:e},Symbol.toStringTag,{value:"Module"}))},9823:(c,p,h)=>{h.d(p,{a:()=>o,f:()=>l,n:()=>n});var y=h(49905);function o(c,p){n(c.typedBuffer,p.typedBuffer,c.typedBufferStride,p.typedBufferStride)}function n(c,p){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h;const T=p.length/2;let g=0,_=0;if((0,y.cy)(p)||(0,y.dk)(p)){for(let y=0;y<T;++y)c[g]=p[_],c[g+1]=p[_+1],g+=h,_+=w;return}const b=(0,y.a3)(p);if((0,y.JI)(p))for(let y=0;y<T;++y)c[g]=Math.max(p[_]/b,-1),c[g+1]=Math.max(p[_+1]/b,-1),g+=h,_+=w;else for(let y=0;y<T;++y)c[g]=p[_]/b,c[g+1]=p[_+1]/b,g+=h,_+=w}function l(c,p,h,y){var w,T;const g=c.typedBuffer,_=c.typedBufferStride,b=null!==(w=null===y||void 0===y?void 0:y.count)&&void 0!==w?w:c.count;let x=(null!==(T=null===y||void 0===y?void 0:y.dstIndex)&&void 0!==T?T:0)*_;for(let v=0;v<b;++v)g[x]=p,g[x+1]=h,x+=_}Object.freeze(Object.defineProperty({__proto__:null,fill:l,normalizeIntegerBuffer:n,normalizeIntegerBufferView:o},Symbol.toStringTag,{value:"Module"}))},44599:(c,p,h)=>{function e(c,p){t(c.typedBuffer,p.typedBuffer,c.typedBufferStride,p.typedBufferStride)}function t(c,p){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h;const w=p.length/y;let T=0,g=0;for(let _=0;_<w;++_)c[T]=p[g],c[T+1]=p[g+1],c[T+2]=p[g+2],T+=h,g+=y}function f(c,p,h,y,w){var T,g;const _=c.typedBuffer,b=c.typedBufferStride,x=null!==(T=null===w||void 0===w?void 0:w.count)&&void 0!==T?T:c.count;let v=(null!==(g=null===w||void 0===w?void 0:w.dstIndex)&&void 0!==g?g:0)*b;for(let A=0;A<x;++A)_[v]=p,_[v+1]=h,_[v+2]=y,v+=b}h.d(p,{a:()=>e,c:()=>t,f:()=>f});Object.freeze(Object.defineProperty({__proto__:null,copy:t,copyView:e,fill:f},Symbol.toStringTag,{value:"Module"}))},29245:(c,p,h)=>{h.d(p,{a:()=>r,b:()=>o,n:()=>n,s:()=>u,t:()=>f});var y=h(52618);function r(c,p,h){f(c.typedBuffer,p.typedBuffer,h,c.typedBufferStride,p.typedBufferStride)}function f(c,p,h){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:w;if(c.length/w!=p.length/T)return void(0,y.j)().error("source and destination buffers need to have the same number of elements");const g=c.length/w,_=h[0],b=h[1],x=h[2],v=h[3],A=h[4],S=h[5],R=h[6],E=h[7],O=h[8];let N=0,C=0;for(let y=0;y<g;y++){const h=p[N],y=p[N+1],g=p[N+2],I=p[N+3];c[C]=_*h+v*y+R*g,c[C+1]=b*h+A*y+E*g,c[C+2]=x*h+S*y+O*g,c[C+3]=I,N+=T,C+=w}}function n(c,p){const h=Math.min(c.count,p.count),y=c.typedBuffer,w=c.typedBufferStride,T=p.typedBuffer,g=p.typedBufferStride;for(let _=0;_<h;_++){const c=_*w,p=_*g,h=T[p],b=T[p+1],x=T[p+2],v=h*h+b*b+x*x;if(v>0){const p=1/Math.sqrt(v);y[c]=p*h,y[c+1]=p*b,y[c+2]=p*x}}}function o(c,p,h){u(c.typedBuffer,p,h,c.typedBufferStride)}function u(c,p,h){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;const w=Math.min(c.length/y,p.count),T=p.typedBuffer,g=p.typedBufferStride;let _=0,b=0;for(let x=0;x<w;x++)c[b]=h*T[_],c[b+1]=h*T[_+1],c[b+2]=h*T[_+2],c[b+3]=h*T[_+3],_+=g,b+=y}Object.freeze(Object.defineProperty({__proto__:null,normalize:n,scale:u,scaleView:o,transformMat3:f,transformMat3View:r,transformMat4:function t(c,p,h){if(c.count!==p.count)return void(0,y.j)().error("source and destination buffers need to have the same number of elements");const w=c.count,T=h[0],g=h[1],_=h[2],b=h[3],x=h[4],v=h[5],A=h[6],S=h[7],R=h[8],E=h[9],O=h[10],N=h[11],C=h[12],I=h[13],M=h[14],B=h[15],L=c.typedBuffer,F=c.typedBufferStride,U=p.typedBuffer,D=p.typedBufferStride;for(let y=0;y<w;y++){const c=y*F,p=y*D,h=U[p],w=U[p+1],P=U[p+2],j=U[p+3];L[c]=T*h+x*w+R*P+C*j,L[c+1]=g*h+v*w+E*P+I*j,L[c+2]=_*h+A*w+O*P+M*j,L[c+3]=b*h+S*w+N*P+B*j}}},Symbol.toStringTag,{value:"Module"}))},70296:(c,p,h)=>{function e(c,p){t(c.typedBuffer,p,c.typedBufferStride)}function t(c,p){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;const y=p.typedBuffer,w=p.typedBufferStride,T=p.count;let g=0,_=0;for(let b=0;b<T;++b)c[g]=y[_],c[g+1]=y[_+1],c[g+2]=y[_+2],c[g+3]=y[_+3],g+=h,_+=w}function f(c,p,h,y,w,T){var g,_;const b=c.typedBuffer,x=c.typedBufferStride,v=null!==(g=null===T||void 0===T?void 0:T.count)&&void 0!==g?g:c.count;let A=(null!==(_=null===T||void 0===T?void 0:T.dstIndex)&&void 0!==_?_:0)*x;for(let S=0;S<v;++S)b[A]=p,b[A+1]=h,b[A+2]=y,b[A+3]=w,A+=x}h.d(p,{a:()=>e,c:()=>t,f:()=>f});Object.freeze(Object.defineProperty({__proto__:null,copy:t,copyView:e,fill:f},Symbol.toStringTag,{value:"Module"}))},6309:(c,p,h)=>{function e(c){switch(c){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}h.d(p,{GJ:()=>e})},59533:(c,p,h)=>{h.d(p,{R:()=>n});var y=h(53705),w=h(87149),T=h(4180),g=h(81618),_=h(4270);class n{constructor(c){this._streamDataRequester=c}async loadJSON(c,p){return this._load("json",c,p)}async loadBinary(c,p){return(0,_.DB)(c)?((0,g.Te)(p),(0,_.lJ)(c)):this._load("binary",c,p)}async loadImage(c,p){return this._load("image",c,p)}async _load(c,p,h){if(null==this._streamDataRequester)return(await(0,y.A)(p,{responseType:b[c]})).data;const _=await(0,w.Ke)(this._streamDataRequester.request(p,c,h));if(!0===_.ok)return _.value;throw(0,g.QP)(_.error),new T.A("","Request for resource failed: ".concat(_.error))}}const b={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},64268:(c,p,h)=>{h.d(p,{x:()=>o});var y=h(49905),w=h(2360),T=h(60985);function o(c,p){switch(p){case T.WR.TRIANGLES:return function f(c){return"number"==typeof c?(0,w.tM)(c):(0,y.mg)(c)?new Uint16Array(c):c}(c);case T.WR.TRIANGLE_STRIP:return function u(c){const p="number"==typeof c?c:c.length;if(p<3)return[];const h=p-2,y=(0,w.my)(3*h);if("number"==typeof c){let c=0;for(let p=0;p<h;p+=1)p%2==0?(y[c++]=p,y[c++]=p+1,y[c++]=p+2):(y[c++]=p+1,y[c++]=p,y[c++]=p+2)}else{let p=0;for(let w=0;w<h;w+=1)w%2==0?(y[p++]=c[w],y[p++]=c[w+1],y[p++]=c[w+2]):(y[p++]=c[w+1],y[p++]=c[w],y[p++]=c[w+2])}return y}(c);case T.WR.TRIANGLE_FAN:return function i(c){const p="number"==typeof c?c:c.length;if(p<3)return new Uint16Array(0);const h=p-2,y=h<=65536?new Uint16Array(3*h):new Uint32Array(3*h);if("number"==typeof c){let c=0;for(let p=0;p<h;++p)y[c++]=0,y[c++]=p+1,y[c++]=p+2;return y}const w=c[0];let T=c[1],g=0;for(let _=0;_<h;++_){const p=c[_+2];y[g++]=w,y[g++]=T,y[g++]=p,T=p}return y}(c)}}},62216:(c,p,h)=>{h.d(p,{KB:()=>n,Xi:()=>t,pn:()=>o,x3:()=>r});var y=h(50886),w=h(42954);class t{constructor(c){this.data=c,this.type="encoded-mesh-texture",this.encoding=w.JS.KTX2_ENCODING}}function r(c){return"encoded-mesh-texture"===(null===c||void 0===c?void 0:c.type)}async function n(c){const p=new Blob([c]),h=await p.text();return JSON.parse(h)}async function o(c,p){if(p===w.JS.KTX2_ENCODING)return new t(c);const h=new Blob([c],{type:p}),T=URL.createObjectURL(h),g=new Image;if((0,y.A)("esri-iPhone"))return new Promise(((c,p)=>{const r=()=>{o(),c(g)},n=c=>{o(),p(c)},o=()=>{URL.revokeObjectURL(T),g.removeEventListener("load",r),g.removeEventListener("error",n)};g.addEventListener("load",r),g.addEventListener("error",n),g.src=T}));try{g.src=T,await g.decode()}catch(_){console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(T),g}},7353:(c,p,h)=>{h.d(p,{y:()=>loader_l});var y=h(89412),w=h(70655),T=h(60985);var g,_,b=h(4180),x=h(69719),v=h(81618),A=h(4270),S=h(72722),R=h(39393),E=h(46064),O=h(77912),N=h(59278),C=h(20155);h(50886);class BinaryStreamReader_t{constructor(c){this._data=c,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const c=this._offset4;return this._offset4+=1,this._dataUint32[c]}readUint8Array(c){const p=4*this._offset4;return this._offset4+=c/4,new Uint8Array(this._data,p,c)}remainingBytes(){return this._data.byteLength-4*this._offset4}}!function(c){c.SCALAR="SCALAR",c.VEC2="VEC2",c.VEC3="VEC3",c.VEC4="VEC4",c.MAT2="MAT2",c.MAT3="MAT3",c.MAT4="MAT4"}(g||(g={})),function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER",c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(_||(_={}));var I=h(188);const M={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},B={pbrMetallicRoughness:M,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},L={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},fillDefaults_i=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const p={...M,...c.pbrMetallicRoughness},h=function s(c){switch(c.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,I.Xb)(c.ESRI_externalColorMixMode),c.ESRI_externalColorMixMode="tint"}return c}({...L,...c.extras});return{...B,...c,pbrMetallicRoughness:p,extras:h}};const F={magFilter:T.Cj.LINEAR,minFilter:T.Cj.LINEAR_MIPMAP_LINEAR,wrapS:T.pF.REPEAT,wrapT:T.pF.REPEAT};var U=h(62216);const D=1179937895,P=1313821514,j=5130562;class Y{constructor(c,p,h,y){if(this._context=c,this.uri=p,this.json=h,this._glbBuffer=y,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=function pathUtils_r(c){let p,h;return c.replace(/^(.*\/)?([^/]*)$/,((c,y,w)=>(p=y||"",h=w||"",""))),{dirPart:p,filePart:h}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==h.scenes)throw new b.A("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==h.meshes)throw new b.A("gltf-loader-unsupported-feature","Meshes must be defined");if(null==h.nodes)throw new b.A("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(c,p,h){if((0,A.DB)(p)){const h=(0,A.r$)(p);if(h&&"model/gltf-binary"!==h.mediaType)try{const y=JSON.parse(h.isBase64?atob(h.data):h.data);return new Y(c,p,y)}catch{}const y=(0,A.lJ)(p);if(Y._isGLBData(y))return this._fromGLBData(c,p,y)}if(J.test(p)||"gltf"===(null===h||void 0===h?void 0:h.expectedType)){const y=await c.loadJSON(p,h);return new Y(c,p,y)}const y=await c.loadBinary(p,h);if(Y._isGLBData(y))return this._fromGLBData(c,p,y);if(K.test(p)||"glb"===(null===h||void 0===h?void 0:h.expectedType))throw new b.A("gltf-loader-invalid-glb","This is not a valid glb file.");const w=await c.loadJSON(p,h);return new Y(c,p,w)}static _isGLBData(c){if(null==c)return!1;const p=new BinaryStreamReader_t(c);return p.remainingBytes()>=4&&p.readUint32()===D}static async _fromGLBData(c,p,h){const y=await Y._parseGLBData(h);return new Y(c,p,y.json,y.binaryData)}static async _parseGLBData(c){const p=new BinaryStreamReader_t(c);if(p.remainingBytes()<12)throw new b.A("gltf-loader-error","glb binary data is insufficiently large.");const h=p.readUint32(),w=p.readUint32(),T=p.readUint32();if(h!==D)throw new b.A("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(c.byteLength<T)throw new b.A("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==w)throw new b.A("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let g,_,x=0;for(;p.remainingBytes()>=8;){const c=p.readUint32(),h=p.readUint32();if(0===x){if(h!==P)throw new b.A("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new b.A("gltf-loader-error","No JSON data found.");g=await(0,U.KB)(p.readUint8Array(c))}else if(1===x){if(h!==j)throw new b.A("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");_=p.readUint8Array(c)}else y.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");x+=1}if(!g)throw new b.A("gltf-loader-error","No glb JSON chunk detected.");return{json:g,binaryData:_}}async getBuffer(c,p){const h=this.json.buffers[c];if(null==h.uri){if(null==this._glbBuffer)throw new b.A("gltf-loader-error","glb buffer not present");return this._glbBuffer}const y=await this._getBufferLoader(c,p);if(y.byteLength!==h.byteLength)throw new b.A("gltf-loader-error","Buffer byte lengths should match.");return y}async _getBufferLoader(c,p){const h=this._bufferLoaders.get(c);if(h)return h;const y=this.json.buffers[c].uri,w=this._context.loadBinary(this._resolveUri(y),p).then((c=>new Uint8Array(c)));return this._bufferLoaders.set(c,w),w}async getAccessor(c,p){if(!this.json.accessors)throw new b.A("gltf-loader-unsupported-feature","Accessors missing.");const h=this.json.accessors[c];if(null==(null===h||void 0===h?void 0:h.bufferView))throw new b.A("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(h.type in[g.MAT2,g.MAT3,g.MAT4])throw new b.A("gltf-loader-unsupported-feature","AttributeType ".concat(h.type," is not supported"));const y=this.json.bufferViews[h.bufferView],w=await this.getBuffer(y.buffer,p),T=H[h.type],_=z[h.componentType],x=T*_,v=y.byteStride||x;return{raw:w.buffer,byteStride:v,byteOffset:w.byteOffset+(y.byteOffset||0)+(h.byteOffset||0),entryCount:h.count,isDenselyPacked:v===x,componentCount:T,componentByteSize:_,componentType:h.componentType,min:h.min,max:h.max,normalized:!!h.normalized}}async getIndexData(c,p){if(null==c.indices)return;const h=await this.getAccessor(c.indices,p);if(h.isDenselyPacked)switch(h.componentType){case T.pe.UNSIGNED_BYTE:return new Uint8Array(h.raw,h.byteOffset,h.entryCount);case T.pe.UNSIGNED_SHORT:return new Uint16Array(h.raw,h.byteOffset,h.entryCount);case T.pe.UNSIGNED_INT:return new Uint32Array(h.raw,h.byteOffset,h.entryCount)}else switch(h.componentType){case T.pe.UNSIGNED_BYTE:return(0,C.m)(this._wrapAccessor(N.SL,h));case T.pe.UNSIGNED_SHORT:return(0,C.m)(this._wrapAccessor(N.h,h));case T.pe.UNSIGNED_INT:return(0,C.m)(this._wrapAccessor(N.P,h))}}async getPositionData(c,p){if(null==c.attributes.POSITION)throw new b.A("gltf-loader-unsupported-feature","No POSITION vertex data found.");const h=await this.getAccessor(c.attributes.POSITION,p);if(h.componentType!==T.pe.FLOAT)throw new b.A("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+T.pe[h.componentType]);if(3!==h.componentCount)throw new b.A("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+h.componentCount.toFixed());return this._wrapAccessor(N.xs,h)}async getNormalData(c,p){if(null==c.attributes.NORMAL)throw new b.A("gltf-loader-error","No NORMAL vertex data found.");const h=await this.getAccessor(c.attributes.NORMAL,p);if(h.componentType!==T.pe.FLOAT)throw new b.A("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+T.pe[h.componentType]);if(3!==h.componentCount)throw new b.A("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+h.componentCount.toFixed());return this._wrapAccessor(N.xs,h)}async getTangentData(c,p){if(null==c.attributes.TANGENT)throw new b.A("gltf-loader-error","No TANGENT vertex data found.");const h=await this.getAccessor(c.attributes.TANGENT,p);if(h.componentType!==T.pe.FLOAT)throw new b.A("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+T.pe[h.componentType]);if(4!==h.componentCount)throw new b.A("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+h.componentCount.toFixed());return new N.Eq(h.raw,h.byteOffset,h.byteStride,h.byteOffset+h.byteStride*h.entryCount)}async getTextureCoordinates(c,p){if(null==c.attributes.TEXCOORD_0)throw new b.A("gltf-loader-error","No TEXCOORD_0 vertex data found.");const h=await this.getAccessor(c.attributes.TEXCOORD_0,p);if(2!==h.componentCount)throw new b.A("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+h.componentCount.toFixed());if(h.componentType===T.pe.FLOAT)return this._wrapAccessor(N.gH,h);if(!h.normalized)throw new b.A("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function W(c){switch(c.componentType){case T.pe.BYTE:return new N.D6(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount);case T.pe.UNSIGNED_BYTE:return new N.LC(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount);case T.pe.SHORT:return new N.mJ(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount);case T.pe.UNSIGNED_SHORT:return new N.Yi(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount);case T.pe.UNSIGNED_INT:return new N.An(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount);case T.pe.FLOAT:return new N.gH(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)}}(h)}async getVertexColors(c,p){if(null==c.attributes.COLOR_0)throw new b.A("gltf-loader-error","No COLOR_0 vertex data found.");const h=await this.getAccessor(c.attributes.COLOR_0,p);if(4!==h.componentCount&&3!==h.componentCount)throw new b.A("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+h.componentCount.toFixed());if(4===h.componentCount){if(h.componentType===T.pe.FLOAT)return this._wrapAccessor(N.Eq,h);if(h.componentType===T.pe.UNSIGNED_BYTE)return this._wrapAccessor(N.XP,h);if(h.componentType===T.pe.UNSIGNED_SHORT)return this._wrapAccessor(N.Uz,h)}else if(3===h.componentCount){if(h.componentType===T.pe.FLOAT)return this._wrapAccessor(N.xs,h);if(h.componentType===T.pe.UNSIGNED_BYTE)return this._wrapAccessor(N.eI,h);if(h.componentType===T.pe.UNSIGNED_SHORT)return this._wrapAccessor(N.nS,h)}throw new b.A("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+T.pe[h.componentType])}hasPositions(c){return void 0!==c.attributes.POSITION}hasNormals(c){return void 0!==c.attributes.NORMAL}hasVertexColors(c){return void 0!==c.attributes.COLOR_0}hasTextureCoordinates(c){return void 0!==c.attributes.TEXCOORD_0}hasTangents(c){return void 0!==c.attributes.TANGENT}async getMaterial(c,p,h){let y=c.material?this._materialCache.get(c.material):void 0;if(!y){var w,T,g,_,b;const x=null!=c.material?fillDefaults_i(this.json.materials[c.material]):fillDefaults_i(),v=x.pbrMetallicRoughness,A=this.hasVertexColors(c),S=this.getTexture(v.baseColorTexture,p),R=this.getTexture(x.normalTexture,p),E=h?this.getTexture(x.occlusionTexture,p):void 0,O=h?this.getTexture(x.emissiveTexture,p):void 0,N=h?this.getTexture(v.metallicRoughnessTexture,p):void 0,C=null!=c.material?c.material:-1;y={alphaMode:x.alphaMode,alphaCutoff:x.alphaCutoff,color:v.baseColorFactor,doubleSided:!!x.doubleSided,colorTexture:await S,normalTexture:await R,name:x.name,id:C,occlusionTexture:await E,emissiveTexture:await O,emissiveFactor:x.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await N,hasVertexColors:A,ESRI_externalColorMixMode:x.extras.ESRI_externalColorMixMode,colorTextureTransform:null===v||void 0===v||null===(w=v.baseColorTexture)||void 0===w||null===(w=w.extensions)||void 0===w?void 0:w.KHR_texture_transform,normalTextureTransform:null===(T=x.normalTexture)||void 0===T||null===(T=T.extensions)||void 0===T?void 0:T.KHR_texture_transform,occlusionTextureTransform:null===(g=x.occlusionTexture)||void 0===g||null===(g=g.extensions)||void 0===g?void 0:g.KHR_texture_transform,emissiveTextureTransform:null===(_=x.emissiveTexture)||void 0===_||null===(_=_.extensions)||void 0===_?void 0:_.KHR_texture_transform,metallicRoughnessTextureTransform:null===v||void 0===v||null===(b=v.metallicRoughnessTexture)||void 0===b||null===(b=b.extensions)||void 0===b?void 0:b.KHR_texture_transform,receiveAmbientOcclusion:x.extras.ESRI_receiveAmbientOcclusion,receiveShadows:x.extras.ESRI_receiveShadows}}return y}async getTexture(c,p){if(!c)return;if(0!==(c.texCoord||0))throw new b.A("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const h=c.index,y=this.json.textures[h],w=(v=null!=y.sampler?this.json.samplers[y.sampler]:{},{...F,...v}),T=this._getTextureSourceId(y),g=this.json.images[T],_=await this._loadTextureImageData(h,y,p);var v;return(0,x.tE)(this._textureCache,h,(()=>{const t=c=>33071===c||33648===c||10497===c,r=c=>{throw new b.A("gltf-loader-error","Unexpected TextureSampler WrapMode: ".concat(c))};return{data:_,wrapS:t(w.wrapS)?w.wrapS:r(w.wrapS),wrapT:t(w.wrapT)?w.wrapT:r(w.wrapT),minFilter:w.minFilter,name:g.name,id:h}}))}getNodeTransform(c){if(void 0===c)return G;let p=this._nodeTransformCache.get(c);if(!p){const h=this.getNodeTransform(this._getNodeParent(c)),y=this.json.nodes[c];y.matrix?p=(0,R.lw)((0,w.vt)(),h,y.matrix):y.translation||y.rotation||y.scale?(p=(0,w.o8)(h),y.translation&&(0,R.Tl)(p,p,y.translation),y.rotation&&(k[3]=(0,E.Xd)(k,y.rotation),(0,R.e$)(p,p,k[3],k)),y.scale&&(0,R.hs)(p,p,y.scale)):p=(0,w.o8)(h),this._nodeTransformCache.set(c,p)}return p}_wrapAccessor(c,p){return new c(p.raw,p.byteOffset,p.byteStride,p.byteOffset+p.byteStride*(p.entryCount-1)+p.componentByteSize*p.componentCount)}_resolveUri(c){return(0,A.s2)(c,this._baseUri)}_getNodeParent(c){return this._nodeParentMap.get(c)}_checkVersionSupported(){const c=S.R.parse(this.json.asset.version,"glTF");V.validate(c)}_checkRequiredExtensionsSupported(){const c=this.json;if(c.extensionsRequired&&!c.extensionsRequired.every((c=>this._supportedExtensions.includes(c))))throw new b.A("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+c.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach(((c,p)=>{c.children&&c.children.forEach((c=>{this._nodeParentMap.set(c,p)}))}))}async _loadTextureImageData(c,p,h){const y=this._textureLoaders.get(c);if(y)return y;const w=this._createTextureLoader(p,h);return this._textureLoaders.set(c,w),w}_getTextureSourceId(c){if(void 0!==c.extensions&&null!==c.extensions.KHR_texture_basisu)return c.extensions.KHR_texture_basisu.source;if(null!==c.source)return c.source;throw new b.A("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(c,p){const h=this._getTextureSourceId(c),y=this.json.images[h];if(y.uri){if(y.uri.endsWith(".ktx2")){const c=await this._context.loadBinary(this._resolveUri(y.uri),p);return new U.Xi(new Uint8Array(c))}return this._context.loadImage(this._resolveUri(y.uri),p)}if(null==y.bufferView)throw new b.A("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==y.mimeType)throw new b.A("gltf-loader-unsupported-feature","Image mimeType must be defined.");const w=this.json.bufferViews[y.bufferView],T=await this.getBuffer(w.buffer,p);if(null!=w.byteStride)throw new b.A("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const g=T.byteOffset+(w.byteOffset||0);return(0,U.pn)(new Uint8Array(T.buffer,g,w.byteLength),y.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const c=await(0,v.nA)(Array.from(this._bufferLoaders.values())),p=await(0,v.nA)(Array.from(this._textureLoaders.values()));return c.reduce(((c,p)=>{var h;return c+(null!==(h=null===p||void 0===p?void 0:p.byteLength)&&void 0!==h?h:0)}),0)+p.reduce(((c,p)=>c+(p?(0,U.x3)(p)?p.data.byteLength:p.width*p.height*4:0)),0)}}const G=(0,R.hM)((0,w.vt)(),Math.PI/2),V=new S.R(2,0,"glTF"),k=(0,O.vt)(),H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},z={[T.pe.BYTE]:1,[T.pe.UNSIGNED_BYTE]:1,[T.pe.SHORT]:2,[T.pe.UNSIGNED_SHORT]:2,[T.pe.FLOAT]:4,[T.pe.INT]:4,[T.pe.UNSIGNED_INT]:4};const J=/\.gltf$/i,K=/\.glb$/i;let q=0;async function loader_l(c,p){var h;let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},_=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=await Y.load(c,p,g),x="gltf_"+q++,v={lods:[],materials:new Map,textures:new Map,meta:u(b)},A=!(!b.json.asset.extras||"symbolResource"!==b.json.asset.extras.ESRI_type),S=null===(h=b.json.asset.extras)||void 0===h||null===(h=h.ESRI_webstyleSymbol)||void 0===h?void 0:h.webstyle,R=new Map;await loader_c(b,(async(c,p,h,A)=>{var S,E;const O=null!==(S=R.get(h))&&void 0!==S?S:0;R.set(h,O+1);const N=void 0!==c.mode?c.mode:T.WR.TRIANGLES,C=N===T.WR.TRIANGLES||N===T.WR.TRIANGLE_STRIP||N===T.WR.TRIANGLE_FAN?N:null;if(null==C)return void y.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+T.WR[N]+"). Skipping primitive.");if(!b.hasPositions(c))return void y.A.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const I=b.getPositionData(c,g),M=b.getMaterial(c,g,_),B=b.hasNormals(c)?b.getNormalData(c,g):null,L=b.hasTangents(c)?b.getTangentData(c,g):null,F=b.hasTextureCoordinates(c)?b.getTextureCoordinates(c,g):null,U=b.hasVertexColors(c)?b.getVertexColors(c,g):null,D=b.getIndexData(c,g),P={name:A,transform:(0,w.o8)(p),attributes:{position:await I,normal:B?await B:null,texCoord0:F?await F:null,color:U?await U:null,tangent:L?await L:null},indices:await D,primitiveType:C,material:d(v,await M,x)};let j=null;null!=(null===(E=v.meta)||void 0===E?void 0:E.ESRI_lod)&&"screenSpaceRadius"===v.meta.ESRI_lod.metric&&(j=v.meta.ESRI_lod.thresholds[h]),v.lods[h]=v.lods[h]||{parts:[],name:A,lodThreshold:j},v.lods[h].parts[O]=P}));for(const y of v.lods)y.parts=y.parts.filter((c=>!!c));const E=await b.getLoadedBuffersSize();return{model:v,meta:{isEsriSymbolResource:A,uri:b.uri,ESRI_webstyle:S},customMeta:{},size:E}}function u(c){const p=c.json;let h=null;return p.nodes.forEach((c=>{const p=c.extras;null!=p&&(p.ESRI_proxyEllipsoid||p.ESRI_lod)&&(h=p)})),h}async function loader_c(c,p){const h=c.json,w=h.scenes[h.scene||0].nodes,T=w.length>1,g=[];for(const y of w){const c=h.nodes[y];g.push(n(y,0)),m(c)&&!T&&c.extensions.MSFT_lod.ids.forEach(((c,p)=>n(c,p+1)))}async function n(w,T){const _=h.nodes[w],b=c.getNodeTransform(w);if(null!=_.weights&&y.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=_.mesh){const c=h.meshes[_.mesh];for(const h of c.primitives)g.push(p(h,b,T,c.name))}for(const c of _.children||[])g.push(n(c,T))}await Promise.all(g)}function m(c){var p;return(null===(p=c.extensions)||void 0===p?void 0:p.MSFT_lod)&&Array.isArray(c.extensions.MSFT_lod.ids)}function d(c,p,h){const a=p=>{const y="".concat(h,"_tex_").concat(p&&p.id).concat(null!==p&&void 0!==p&&p.name?"_"+p.name:"");if(p&&!c.textures.has(y)){const h=function l(c){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{data:c,parameters:{wrap:{s:T.pF.REPEAT,t:T.pF.REPEAT,...p.wrap},noUnpackFlip:!0,mipmap:!1,...p}}}(p.data,{wrap:{s:p.wrapS,t:p.wrapT},mipmap:X.has(p.minFilter),noUnpackFlip:!0});c.textures.set(y,h)}return y},y="".concat(h,"_mat_").concat(p.id,"_").concat(p.name);if(!c.materials.has(y)){const h=function LoaderResult_r(){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}({color:[p.color[0],p.color[1],p.color[2]],opacity:p.color[3],alphaMode:p.alphaMode,alphaCutoff:p.alphaCutoff,doubleSided:p.doubleSided,colorMixMode:p.ESRI_externalColorMixMode,textureColor:p.colorTexture?a(p.colorTexture):void 0,textureNormal:p.normalTexture?a(p.normalTexture):void 0,textureOcclusion:p.occlusionTexture?a(p.occlusionTexture):void 0,textureEmissive:p.emissiveTexture?a(p.emissiveTexture):void 0,textureMetallicRoughness:p.metallicRoughnessTexture?a(p.metallicRoughnessTexture):void 0,emissiveFactor:[p.emissiveFactor[0],p.emissiveFactor[1],p.emissiveFactor[2]],colorTextureTransform:p.colorTextureTransform,normalTextureTransform:p.normalTextureTransform,occlusionTextureTransform:p.occlusionTextureTransform,emissiveTextureTransform:p.emissiveTextureTransform,metallicRoughnessTextureTransform:p.metallicRoughnessTextureTransform,metallicFactor:p.metallicFactor,roughnessFactor:p.roughnessFactor,receiveShadows:p.receiveShadows,receiveAmbientOcclustion:p.receiveAmbientOcclusion});c.materials.set(y,h)}return y}const X=new Set([T.Cj.LINEAR_MIPMAP_LINEAR,T.Cj.LINEAR_MIPMAP_NEAREST])},7199:(c,p,h)=>{h.d(p,{T:()=>y});const y=2.1}}]);
//# sourceMappingURL=4197.f64d186a.chunk.js.map