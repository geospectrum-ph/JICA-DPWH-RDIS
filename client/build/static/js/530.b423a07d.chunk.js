"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[530],{53944:(T,P,A)=>{A.d(P,{YS:()=>He,n_:()=>TechniqueRegistry_T,Wn:()=>TechniqueRegistry_F});var I=A(80271),E=A(34328),D=A(21847);class e{constructor(T){this.registryName=T,this.postProcessingEnabled=!1,this.overrideStencilRef=null,this.drawPhase=D.S5.MAP|D.S5.HITTEST|D.S5.HIGHLIGHT|D.S5.DEBUG,this.symbologyPlane=D.uC.FILL}startup(){}shutdown(){}postProcess(T,P){}}var O=A(80671),L=A(52988),k=A(42656),H=A(80804),U=A(85439);class z extends L.ZA{}(0,O._)([(0,L.C5)(0,k.ZY)],z.prototype,"pos",void 0);class F extends H.DM{}class R extends L.k2{}(0,O._)([(0,L.Pi)(k.nt)],R.prototype,"dotSize",void 0);class b extends L.k2{}(0,O._)([(0,L.Pi)(k.z7)],b.prototype,"locations",void 0),(0,O._)([(0,L.Pi)(k.nt)],b.prototype,"pixelRatio",void 0),(0,O._)([(0,L.Pi)(k.nt)],b.prototype,"tileZoomFactor",void 0);class C extends L.A{vertex(T){const P=new k.U(1,0,0,0,-1,0,0,1,1).multiply(new k.eB(T.pos.xy.divide(I.CQ),1)),A=(0,k.US)(this.draw.locations,P.xy),E=(0,k.T9)(this.instance.dotSize.divide(2),new k.nt(1));let D=new k.nt(0);D=D.add((0,k.PM)(A.a,new k.nt(1e-6)).multiply(2));let O=E.add(this.instance.dotSize);const L=this.view.displayViewScreenMat3.multiply(new k.eB(T.pos.add(.5),1)),H=new k.Zb(L.xy,D,1),U=this.instance.dotSize.divide(O),q=new k.nt(-1).divide(E.divide(O));return O=O.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:H,glPointSize:O,color:A,ratio:U,invEdgeRatio:q}}fragment(T){const P=(0,k.Bw)(T.glPointCoord.subtract(.5)).multiply(2),A=(0,k.TF)(new k.nt(0),new k.nt(1),T.invEdgeRatio.multiply(P.subtract(T.ratio)).add(1)),I=new L.mm;return I.glFragColor=T.color.multiply(A),I}}(0,O._)([(0,L.Pi)(R)],C.prototype,"instance",void 0),(0,O._)([(0,L.Pi)(b)],C.prototype,"draw",void 0),(0,O._)([(0,L.Pi)(U.o)],C.prototype,"view",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(z))],C.prototype,"vertex",null),(0,O._)([(0,O.a)(0,(0,L.hF)(F))],C.prototype,"fragment",null);var q=A(91352),N=A(58909);class DotDensityPolygonShader_D extends H.rz{}(0,O._)([(0,L.C5)(3,k.nt)],DotDensityPolygonShader_D.prototype,"inverseArea",void 0);class V extends L.k2{}(0,O._)([(0,L.Pi)(k.My.ofType(k.Zb,2))],V.prototype,"isActive",void 0),(0,O._)([(0,L.Pi)(k.My.ofType(k.Zb,8))],V.prototype,"colors",void 0),(0,O._)([(0,L.Pi)(k.nt)],V.prototype,"dotValue",void 0);class DotDensityPolygonShader_F extends L.k2{}(0,O._)([(0,L.Pi)(k.z7)],DotDensityPolygonShader_F.prototype,"dotTexture0",void 0),(0,O._)([(0,L.Pi)(k.z7)],DotDensityPolygonShader_F.prototype,"dotTexture1",void 0),(0,O._)([(0,L.Pi)(k.nt)],DotDensityPolygonShader_F.prototype,"tileZoomFactor",void 0),(0,O._)([(0,L.Pi)(k.nt)],DotDensityPolygonShader_F.prototype,"pixelRatio",void 0),(0,O._)([(0,L.Pi)(k.nt)],DotDensityPolygonShader_F.prototype,"tileDotsOverArea",void 0);class _ extends H.f_{_dotThreshold(T,P,A){return T.divide(P).divide(A)}vertex(T){const P=new k.U(2/I.CQ,0,0,0,-2/I.CQ,0,-1,1,1).multiply(new k.eB(T.pos,1)),A=this.clip(T.id),E=new k.Zb(P.xy,A,1),D=this.storage.getVVData(T.id).multiply(this.instance.isActive.get(0)).multiply(T.inverseArea),O=this.storage.getDataDrivenData0(T.id).multiply(this.instance.isActive.get(1)).multiply(T.inverseArea),L=this.draw.tileZoomFactor.multiply(I.CQ).divide(this.draw.pixelRatio),H=this._dotThreshold(D,this.instance.dotValue,this.draw.tileDotsOverArea),U=this._dotThreshold(O,this.instance.dotValue,this.draw.tileDotsOverArea),q=T.pos.add(.5).divide(L);return{glPosition:E,color:new k.Zb(0,0,0,0),textureCoords:q,thresholds0:H,thresholds1:U}}fragment(T){const P=new L.mm,A=(0,k.US)(this.draw.dotTexture0,T.textureCoords),I=(0,k.US)(this.draw.dotTexture1,T.textureCoords),E=T.thresholds0.subtract(A),D=T.thresholds1.subtract(I);let O;const H=k.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),U=k.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const T=(0,k.PM)(new k.nt(0),E),P=(0,k.PM)(new k.nt(0),D),A=(0,k.Om)(T,E).add((0,k.Om)(P,D)),I=(0,k.PM)(A,new k.nt(0)),L=new k.nt(1).subtract(I),q=A.add(I),N=E.multiply(T).divide(q),G=D.multiply(P).divide(q),j=H.multiply(N).add(U.multiply(G));O=L.multiply(j)}else{const T=(0,k.T9)((0,N.xf)(E),(0,N.xf)(D)),P=(0,k.PM)(T,new k.nt(0)),A=new k.nt(1).subtract(P),I=(0,k.PM)(T,E),L=(0,k.PM)(T,D),q=H.multiply(I).add(U.multiply(L));O=A.multiply(q)}return P.glFragColor=O,P}hittest(T){return(0,q.My)(this.hittestRequest)}}(0,O._)([L.E8],_.prototype,"blending",void 0),(0,O._)([(0,L.Pi)(V)],_.prototype,"instance",void 0),(0,O._)([(0,L.Pi)(DotDensityPolygonShader_F)],_.prototype,"draw",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(DotDensityPolygonShader_D))],_.prototype,"vertex",null),(0,O._)([(0,O.a)(0,(0,L.hF)(H.DM))],_.prototype,"fragment",null);var G=A(76761),j=A(60985);const ee={[j.pe.BYTE]:1,[j.pe.UNSIGNED_BYTE]:1,[j.pe.SHORT]:2,[j.pe.UNSIGNED_SHORT]:2,[j.pe.INT]:4,[j.pe.UNSIGNED_INT]:4,[j.pe.FLOAT]:4};var te=A(25078),ie=A(77127),se=A(40332);class i{constructor(T,P){this._boundPart=null;const A=[];for(const E of P.vertex){const P=te.g.createVertex(T,j._U.STATIC_DRAW,E);A.push(P)}const I=[];for(const E of P.index||[]){const P=te.g.createIndex(T,j._U.STATIC_DRAW,E);I.push(P)}this.groups=[];for(const E of P.groups){let D;if(null!=E.index){if(!P.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:T}=P.index[E.index];2===T?D=j.pe.UNSIGNED_SHORT:4===T&&(D=j.pe.UNSIGNED_INT)}const O=null!=E.index?I[E.index]:null,L=new Map,k={},H={};for(const T of E.attributes){const{name:P,count:I,type:E,offset:D,normalized:O,divisor:U,stride:q,vertex:N,location:G}=T,j="vertex-buffer-".concat(N);let ee=k[j];ee||(ee=k[j]=[]);const te=new se._(P,I,E,D,q,O,U);ee.push(te),L.set(P,G),H[j]=A[N]}const U=new ie.Z(T,L,k,H,O);this.groups.push({...E,vertexArray:U,locations:L,layout:k,indexing:D})}this.parts=P.parts}bind(T,P){this._boundPart=P;const{group:A}=this.parts[this._boundPart],{vertexArray:I}=this.groups[A];T.bindVAO(I)}draw(T){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:P,count:A}=this.parts[this._boundPart],{group:I}=this.parts[this._boundPart],{indexing:E,primitive:D}=this.groups[I];E?T.drawElements(D,A,E,P*ee[E]):T.drawArrays(D,P,A)}unbind(T){this._boundPart=null,T.bindVAO(null)}destroy(){for(const{vertexArray:T}of this.groups)T.dispose()}}var re=A(26838);class SimpleMesh_r extends i{static create(T,P){const A=[];let{stride:I,hash:E}=P.layout;if(null==I){I=0;for(const{count:T,type:A,offset:E}of P.layout.attributes){if(null!=E)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");I+=T*ee[A]}}let D=0,O=0;for(const{count:q,name:N,offset:G,type:j,normalized:te}of P.layout.attributes){null!=G&&(O=G);const T={name:N,location:D,vertex:0,count:q,type:j,offset:O,stride:I,divisor:0,normalized:null!=te&&te};A.push(T),D++,O+=q*ee[j]}const L={attributes:A,primitive:P.primitive};null!=P.index&&(L.index=0);let{count:k}=P;if(null==k&&(k=P.index?P.index.length:P.vertex.byteLength/I,Math.floor(k)!==k))throw new Error("The byte length of vertex data must be an exact multiple of the stride, which is ".concat(I,"."));const H={start:0,count:k,group:0,primitive:P.primitive},U={vertex:[P.vertex],parts:[H],groups:[L]};return null!=P.index&&(U.index=[P.index]),null==E&&(E=(0,re.h)(A)),new SimpleMesh_r(T,U,{hash:E,attributes:A,stride:I})}constructor(T,P,A){super(T,P),this.layout=A}bind(T){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super.bind(T,P)}}var oe=A(50707),ae=A(11897),ne=A(79448),le=A(83663),ue=A(83881);class DotDensityResources_p{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(T){if(null==this._dotFBO){const P=I.CQ,A=I.CQ,E=new ue.R(P,A);E.samplingMode=j.Cj.NEAREST,E.wrapMode=j.pF.CLAMP_TO_EDGE;const D=new ae.l(T,new ne.q(j.yQ.DEPTH_STENCIL,P,A));this._dotFBO=new oe.H(T,E,D)}return this._dotFBO}getDotDensityMesh(T){if(null==this._dotMesh){const P=I.CQ,A=P*P,E=2,D=new Int16Array(A*E);for(let T=0;T<P;T++)for(let A=0;A<P;A++)D[E*(A+T*P)]=A,D[E*(A+T*P)+1]=T;const O=[{count:2,type:j.pe.UNSIGNED_SHORT,name:"a_position",offset:0}],L={hash:(0,re.h)(O),attributes:O,stride:4};this._dotMesh=SimpleMesh_r.create(T,{primitive:j.WR.POINTS,vertex:D,count:A,layout:L})}return this._dotMesh}getDotDensityTextures(T,P,A){if(this._dotTextureSize===P&&this._seed===A||(this._disposeTextures(),this._dotTextureSize=P,this._seed=A),null===this._dotTextures){const I=new G.A(A);this._dotTextures=[this._allocDotDensityTexture(T,P,I),this._allocDotDensityTexture(T,P,I)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let T=0;T<this._dotTextures.length;T++)this._dotTextures[T].dispose();this._dotTextures=null}}_allocDotDensityTexture(T,P,A){const I=new Float32Array(P*P*4);for(let D=0;D<I.length;D++)I[D]=A.getFloat();const E=new ue.R;return E.dataType=j.ld.FLOAT,E.samplingMode=j.Cj.NEAREST,E.width=P,E.height=P,new le.g(T,E,I)}}var ce=A(14149),de=A(66374);var pe=A(30824);function utils_n(T){const P=1/T;return{antialiasing:P,blur:0+P}}var he=A(61332);var fe=A(56398);var me=A(8570);var ye=A(81834);var ve=A(89412),be=A(35598);function heatmapUtils_n(T){return T?.25:1}class v extends H.rz{}(0,O._)([(0,L.C5)(5,k.ZY)],v.prototype,"offset",void 0);class x extends H.DM{}class g extends L.k2{}(0,O._)([(0,L.Pi)(k.nt)],g.prototype,"radius",void 0),(0,O._)([(0,L.Pi)(k.nt)],g.prototype,"isFieldActive",void 0);class HeatmapAccumulateShader_F extends H.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(T){const{radius:P,isFieldActive:A}=this.kernelControls,I=T.offset,E=A.multiply(this.storage.getVVData(T.id).x).add(new k.nt(1).subtract(A)),D=this.view.displayViewScreenMat3.multiply(new k.eB(T.pos,1)).add(this.view.displayViewMat3.multiply(new k.eB(I,0)).multiply(P)),O=this.clip(T.id);return{glPosition:new k.Zb(D.xy,O,1),offset:I,fieldValue:E,color:new k.Zb(0),...this.maybeRunHittest(T,{},null)}}fragment(T){const{offset:P,fieldValue:A}=T,I=(0,k.Bw)(P),E=(0,k.PM)(I,new k.nt(1)),D=new k.nt(1).subtract(I.multiply(I)),O=D.multiply(D),L=E.multiply(O).multiply(A).multiply(new k.nt(heatmapUtils_n(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new k.Zb(L),T)}hittest(T){const{viewMat3:P,tileMat3:A}=this.view,I=P.multiply(A).multiply(new k.eB(T.pos,1));return(0,q.g$)(I.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,O._)([L.E8],HeatmapAccumulateShader_F.prototype,"usesHalfFloatPrecision",void 0),(0,O._)([(0,L.Pi)(g)],HeatmapAccumulateShader_F.prototype,"kernelControls",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(v))],HeatmapAccumulateShader_F.prototype,"vertex",null),(0,O._)([(0,O.a)(0,(0,L.hF)(x))],HeatmapAccumulateShader_F.prototype,"fragment",null);class HeatmapResolveShader_x extends L.ZA{}(0,O._)([(0,L.C5)(0,k.ZY)],HeatmapResolveShader_x.prototype,"pos",void 0);class f extends L.HS{}class HeatmapResolveShader_h extends L.k2{}(0,O._)([(0,L.Pi)(k.z7)],HeatmapResolveShader_h.prototype,"texture",void 0),(0,O._)([(0,L.Pi)(k.ZY)],HeatmapResolveShader_h.prototype,"minAndInvRange",void 0),(0,O._)([(0,L.Pi)(k.nt)],HeatmapResolveShader_h.prototype,"normalization",void 0);class HeatmapResolveShader_w extends L.k2{}(0,O._)([(0,L.Pi)(k.z7)],HeatmapResolveShader_w.prototype,"texture",void 0);class HeatmapResolveShader_b extends L.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(T){return{glPosition:new k.Zb(T.pos.multiply(2).subtract(1),1,1),uv:T.pos}}fragment(T){const{accumulatedDensity:P,gradient:A}=this;let I=(0,k.US)(P.texture,T.uv).r.multiply(new k.nt(heatmapUtils_n(this.usesHalfFloatPrecision)));I=I.multiply(P.normalization),I=I.subtract(P.minAndInvRange.x).multiply(P.minAndInvRange.y);const E=(0,k.US)(A.texture,new k.ZY(I,.5)),D=new L.mm;return D.glFragColor=new k.Zb(E.rgb.multiply(E.a),E.a),D}}(0,O._)([L.E8],HeatmapResolveShader_b.prototype,"usesHalfFloatPrecision",void 0),(0,O._)([(0,L.Pi)(HeatmapResolveShader_h)],HeatmapResolveShader_b.prototype,"accumulatedDensity",void 0),(0,O._)([(0,L.Pi)(HeatmapResolveShader_w)],HeatmapResolveShader_b.prototype,"gradient",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(HeatmapResolveShader_x))],HeatmapResolveShader_b.prototype,"vertex",null),(0,O._)([(0,O.a)(0,(0,L.hF)(f))],HeatmapResolveShader_b.prototype,"fragment",null);var _e=A(74011);function B(T,P){const A=P>1.5?.25:.5;return T<1/(2*A)?1:A}function HeatmapTechnique_P(T){return T.key.level+1}const xe={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:HeatmapTechnique_P,compare:j.MT.GEQUAL,mask:255,op:{fail:j.eA.KEEP,zFail:j.eA.KEEP,zPass:j.eA.REPLACE}}}},ge={...xe,stencil:!1},Se={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function HeatmapTechnique_R(T,P){const{referenceScale:A,radius:I}=T;return I*(0!==A?A/P.scale:1)}var we=A(11865),Ve=A(37006),ze=A(51679),Te=A(66865);class d extends L.k2{getVVRotationMat4(T){return(0,k.Tk)((0,N.M8)(T),k.$I.identity(),(()=>{const P=this._getNormalizedAngle(T).multiply(we.os),A=(0,k.F8)(P),I=(0,k.gn)(P);return new k.$I(I,A,0,0,A.multiply(new k.nt(-1)),I,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(T){return(0,k.Tk)((0,N.M8)(T),k.U.identity(),(()=>{const P=this._getNormalizedAngle(T).multiply(we.os),A=(0,k.F8)(P),I=(0,k.gn)(P);return new k.U(I,A,0,A.multiply(new k.nt(-1)),I,0,0,0,1)}))}_getNormalizedAngle(T){const P=(0,k.LC)(this.rotationType,new k.nt(we.H_.Arithmatic));return(0,k.Tk)(P,new k.nt(90).subtract(T),T)}}(0,O._)([(0,L.Pi)(k.nt)],d.prototype,"rotationType",void 0);var Me=A(81580),Pe=A(94692),Ce=A(21326),Fe=A(11088),Ae=A(6901);class TextShader_G extends H.rz{}(0,O._)([(0,L.C5)(3,k.Zb)],TextShader_G.prototype,"color",void 0),(0,O._)([(0,L.C5)(4,k.ZY)],TextShader_G.prototype,"offset",void 0),(0,O._)([(0,L.C5)(5,k.ZY)],TextShader_G.prototype,"textureUV",void 0),(0,O._)([(0,L.C5)(6,k.nt)],TextShader_G.prototype,"fontSize",void 0),(0,O._)([(0,L.C5)(7,k.nt)],TextShader_G.prototype,"referenceSize",void 0),(0,O._)([(0,L.C5)(8,k.nt)],TextShader_G.prototype,"haloFontSize",void 0),(0,O._)([(0,L.C5)(9,k.Zb)],TextShader_G.prototype,"haloColor",void 0),(0,O._)([(0,L.C5)(10,k.ZY)],TextShader_G.prototype,"zoomRange",void 0),(0,O._)([(0,L.C5)(11,k.nt)],TextShader_G.prototype,"clipAngle",void 0),(0,O._)([(0,L.C5)(12,k.Zb)],TextShader_G.prototype,"referenceSymbol",void 0);class Z extends L.Y7{}(0,O._)([(0,L.C5)(13,k.ZY)],Z.prototype,"offsetNextVertex1",void 0),(0,O._)([(0,L.C5)(14,k.ZY)],Z.prototype,"offsetNextVertex2",void 0);class J extends H.DM{}class K extends H.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(T,P,A){const E=P.multiply(1.4173228346456692),D=(0,k.tn)(this.view.rotation.subtract(E)),O=(0,k.jk)(new k.nt(360).subtract(D),D);let L=new k.nt(0);const H=(0,k.RI)(this.view.currentZoom.multiply(I.fq)).divide(I.fq),U=T.x,q=T.y,N=new k.nt(1).subtract((0,k.PM)(U,H)).multiply(2),G=(0,k.PM)(new k.nt(90),O).multiply(2),j=new k.nt(2).multiply(new k.nt(1).subtract((0,k.PM)(H,q)));return L=L.add(A.multiply(N)),L=L.add(A.multiply(G)),L=L.add(j),L}vertex(T,P){const A=(0,N.mh)(T.bitset,we.bg),E=new k.nt(1).subtract(A);let D=T.fontSize,O=D.divide(we.au);const L=this.isHaloPass?T.haloColor:this._getVertexColor(T),H=this.isLabel?L.multiply(this.storage.getAnimationValue(T.id)):L,U=this.view.displayViewScreenMat3.multiply(new k.eB(T.pos,1));let q=T.offset,G=new k.nt(1),j=k.U.identity();if(this.isLabel){if(!T.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const P=T.referenceSymbol,A=P.xy,E=P.z,D=this._unpackDirection(P.w),O=(0,Ae.Mg)(this,T.id,E).divide(2),L=D.multiply(O.add(I.C2));q=q.add(A).add(L)}else G=(0,Ae.Mg)(this,T.id,T.referenceSize).divide(T.referenceSize),D=D.multiply(G),O=O.multiply(G),q=q.multiply(G),j=(0,Ae.TL)(this,T.id),q=j.multiply(new k.eB(q,0)).xy;const ee=(0,N.mh)(T.bitset,we.ti),te=this._getViewRotationMatrix(ee).multiply(new k.eB(q,0));let ie=this.isLabel?this.clipLabel(T.zoomRange,T.clipAngle,ee):this.clip(T.id,T.zoomRange);ie=this.isBackgroundPass?ie.add(E.multiply(2)):ie.add(A.multiply(2));const se=new k.Zb(U.xy.add(te.xy),ie,1),re=T.textureUV.divide(this.mosaicInfo.size);let oe=new k.nt(0);return this.isHaloPass&&(oe=T.haloFontSize.divide(O).divide(we.$w)),{glPosition:se,color:H,size:O,textureUV:re,antialiasingWidth:new k.nt(.105*we.au).divide(D).divide(this.view.pixelRatio),haloDistanceOffset:oe,...this.maybeRunHittest(T,P,{vvSizeAdjustment:G,vvRotation:j})}}_getViewRotationMatrix(T){const P=this.view.displayViewMat3,A=this.view.displayMat3,I=new k.nt(1).subtract(T);return P.multiply(T).add(A.multiply(I))}fragment(T){const P=new k.nt(2/8),A=new k.nt(1).subtract(P),I=(0,k.US)(this.mosaicInfo.texture,T.textureUV).a;let E=A.subtract(T.haloDistanceOffset);this.highlight&&(E=E.divide(2));const D=T.antialiasingWidth,O=(0,k.TF)(E.subtract(D),E.add(D),I);return this.getFragmentOutput(T.color.multiply(O),T)}hittest(T,P,A){let{vvSizeAdjustment:I,vvRotation:E}=A;const D=E.multiply(new k.eB(T.offset.multiply(I),0)),O=E.multiply(new k.eB(P.offsetNextVertex1.multiply(I),0)),L=E.multiply(new k.eB(P.offsetNextVertex2.multiply(I),0)),{viewMat3:H,tileMat3:U}=this.view,N=H.multiply(U).multiply(new k.eB(T.pos,1)),G=N.add(U.multiply(D)).xy,j=N.add(U.multiply(O)).xy,ee=N.add(U.multiply(L)).xy;return(0,q.Bo)(this.hittestRequest.position,G.xy,j.xy,ee.xy)}_unpackDirection(T){const P=new k.Ai(T),A=(0,k.Sj)(P,new k.Ai(2)),I=(0,k.nf)(P,new k.Ai(3));return new k.ZY(new k.nt(A).subtract(1),new k.nt(I).subtract(1))}_getVertexColor(T){let P=T.color;if(this.visualVariableColor){const A=this.storage.getColorValue(T.id);P=this.visualVariableColor.getColor(A,T.color,new k.x(!1))}if(this.visualVariableOpacity){const A=this.storage.getOpacityValue(T.id),I=this.visualVariableOpacity.getOpacity(A);P=P.multiply(I)}return P}}(0,O._)([(0,L.uK)(ze._)],K.prototype,"visualVariableColor",void 0),(0,O._)([(0,L.uK)(Te.i)],K.prototype,"visualVariableOpacity",void 0),(0,O._)([(0,L.uK)(d)],K.prototype,"visualVariableRotation",void 0),(0,O._)([(0,L.uK)(Me.n)],K.prototype,"visualVariableSizeMinMaxValue",void 0),(0,O._)([(0,L.uK)(Pe.F)],K.prototype,"visualVariableSizeScaleStops",void 0),(0,O._)([(0,L.uK)(Ce.N)],K.prototype,"visualVariableSizeStops",void 0),(0,O._)([(0,L.uK)(Fe.d)],K.prototype,"visualVariableSizeUnitValue",void 0),(0,O._)([(0,L.Pi)(Ve.b)],K.prototype,"mosaicInfo",void 0),(0,O._)([L.E8],K.prototype,"isHaloPass",void 0),(0,O._)([L.E8],K.prototype,"isBackgroundPass",void 0),(0,O._)([L.E8],K.prototype,"isLabel",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(TextShader_G)),(0,O.a)(1,(0,L.hF)(Z))],K.prototype,"vertex",null),(0,O._)([(0,O.a)(0,(0,L.hF)(J))],K.prototype,"fragment",null);var Re=A(98345);var Ie=A(28155);class TexturedLineShader_A extends Re.Xc{}(0,O._)([(0,L.C5)(9,k.nt)],TexturedLineShader_A.prototype,"accumulatedDistance",void 0),(0,O._)([(0,L.C5)(10,k.ZY)],TexturedLineShader_A.prototype,"segmentDirection",void 0),(0,O._)([(0,L.C5)(11,k.Zb)],TexturedLineShader_A.prototype,"tlbr",void 0);class TexturedLineShader_R extends Re.cM{_getLineWidthRatio(T,P){const A=new k.nt(Ie.$),I=(0,N.mh)(T.bitset,we.kx);return I.multiply((0,k.T9)(P,new k.nt(.25))).add(new k.nt(1).subtract(I)).divide(A)}_getSDFAlpha(T){const{halfWidth:P,normal:A,tlbr:I,patternSize:E,accumulatedDistance:D,lineWidthRatio:O}=T,L=E.x.multiply(new k.nt(2)).multiply(O),H=(0,k.jc)(D.divide(L)),U=new k.nt(.25).multiply(A.y).add(new k.nt(.5)),q=(0,k.jh)(I.xy,I.zw,new k.ZY(H,U)),G=(0,N.Rj)((0,k.US)(this.mosaicInfo.texture,q)).subtract(new k.nt(.5)).multiply(P),j=(0,k.qE)(new k.nt(.5).subtract(G),new k.nt(0),new k.nt(1));return new k.Zb(j)}_getPatternColor(T){const{halfWidth:P,normal:A,color:I,accumulatedDistance:E,patternSize:D,sampleAlphaOnly:O,tlbr:L}=T,H=D.y.multiply(new k.nt(2).multiply(P).divide(D.x)),U=(0,k.jc)(E.divide(H)),q=new k.nt(.5).multiply(A.y).add(new k.nt(.5)),N=(0,k.jh)(L.xy,L.zw,new k.ZY(q,U));let G=(0,k.US)(this.mosaicInfo.texture,N);return null!=this.visualVariableColor&&(G=(0,k.Tk)((0,k.MM)(O,new k.nt(.5)),new k.Zb(I.a),I)),G}vertex(T,P){const{segmentDirection:A,tlbr:I,bitset:E}=T,D=(0,Re.$0)(this,T),O=T.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,k.Om)(A,D.scaledOffset)),L=new k.ZY(I.z.subtract(I.x),I.w.subtract(I.y)),H=I.divide(this.mosaicInfo.size.xyxy),U=(0,N.mh)(E,we.b5),q=(0,N.mh)(E,we.cn),G=(0,k.Tk)((0,k.MM)(U,new k.nt(.5)),this._getLineWidthRatio(T,D.scaledHalfWidth),new k.nt(1));return{...D,tlbr:H,patternSize:L,accumulatedDistance:O,isSDF:U,sampleAlphaOnly:q,lineWidthRatio:G,...this.maybeRunHittest(T,P,D.halfWidth)}}fragment(T){const{color:P,opacity:A,isSDF:I}=T,E=(0,Re.xw)(T,this.antialiasingControls.blur),D=(0,k.Tk)((0,k.MM)(I,new k.nt(.5)),this._getSDFAlpha(T),this._getPatternColor(T)),O=P.multiply(A).multiply(E).multiply(D);return this.getFragmentOutput(O,T)}}(0,O._)([(0,L.Pi)(Ve.b)],TexturedLineShader_R.prototype,"mosaicInfo",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(TexturedLineShader_A)),(0,O.a)(1,(0,L.hF)(H.$Z))],TexturedLineShader_R.prototype,"vertex",null);var Ee=A(19578);class Q extends H.rz{}(0,O._)([(0,L.C5)(3,k.Zb)],Q.prototype,"color",void 0),(0,O._)([(0,L.C5)(4,k.Zb)],Q.prototype,"outlineColor",void 0),(0,O._)([(0,L.C5)(5,k.ZY)],Q.prototype,"offset",void 0),(0,O._)([(0,L.C5)(6,k.ZY)],Q.prototype,"textureUV",void 0),(0,O._)([(0,L.C5)(7,k.Zb)],Q.prototype,"sizing",void 0),(0,O._)([(0,L.C5)(8,k.nt)],Q.prototype,"placementAngle",void 0),(0,O._)([(0,L.C5)(9,k.nt)],Q.prototype,"sizeRatio",void 0),(0,O._)([(0,L.C5)(10,k.ZY)],Q.prototype,"zoomRange",void 0);class W extends L.Y7{}(0,O._)([(0,L.C5)(12,k.ZY)],W.prototype,"offsetNextVertex1",void 0),(0,O._)([(0,L.C5)(13,k.ZY)],W.prototype,"offsetNextVertex2",void 0),(0,O._)([(0,L.C5)(14,k.ZY)],W.prototype,"textureUVNextVertex1",void 0),(0,O._)([(0,L.C5)(15,k.ZY)],W.prototype,"textureUVNextVertex2",void 0);class X extends H.DM{}function Y(T,P,A,I){return P.multiply(T.x).add(A.multiply(T.y)).add(I.multiply(T.z))}function MarkerShader_Z(T){return T.multiply(T).divide(128)}class $ extends H.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(T,P){const A=MarkerShader_Z(T.sizing.x),I=MarkerShader_Z(T.sizing.y),E=MarkerShader_Z(T.sizing.z),D=T.placementAngle,O=(0,N.mh)(T.bitset,Ee.c.bitset.isSDF),L=(0,N.mh)(T.bitset,Ee.c.bitset.isMapAligned),H=(0,N.mh)(T.bitset,Ee.c.bitset.scaleSymbolsProportionally),U=(0,N.K5)(T.bitset,Ee.c.bitset.colorLocked),q=(0,Ae.cF)(this,T.id),G=(0,Ae.G7)(this,T.id,T.color,U).multiply(q),j=this.view.displayViewScreenMat3.multiply(new k.eB(T.pos.xy,1)),ee=(0,Ae.Mg)(this,T.id,E).divide(E),te=A.multiply(ee),ie=T.offset.xy.multiply(ee);let se=I.multiply(H.multiply(ee.subtract(1)).add(1));se=(0,k.jk)(se,(0,k.T9)(te.subtract(.99),new k.nt(0)));const re=(0,k.T9)(se,new k.nt(1)),oe=(0,k.jk)(se,new k.nt(1)),ae=k.U.fromRotation(D.multiply(we.rp)),ne=(0,Ae.TL)(this,T.id),le=this._getViewRotationMatrix(L).multiply(ne).multiply(ae).multiply(new k.eB(ie.xy,0)),ue=this.clip(T.id,T.zoomRange),ce=new k.Zb(j.xy.add(le.xy),ue,1),de=T.textureUV.divide(this.mosaicInfo.size),pe=T.outlineColor.multiply(oe),he=(0,N.mh)(T.bitset,Ee.c.bitset.overrideOutlineColor),fe=T.sizeRatio.multiply(te).multiply(.5);return{glPosition:ce,color:G,textureUV:de,outlineColor:pe,outlineSize:re,distanceToPx:fe,isSDF:O,overrideOutlineColor:he,...this.maybeRunHittest(T,P,{pos:T.pos,size:te,sizeCorrection:ee,isMapAligned:L,outlineSize:re,distanceToPx:fe,isSDF:O})}}fragment(T){const P=this._getColor(T.textureUV,T);return this.getFragmentOutput(P,T)}hittest(T,P,A){return(0,k.Tk)((0,k.Xe)(A.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(T,P,A),this._hittestMarker(T,P,A))}_getViewRotationMatrix(T){const P=this.view.displayViewMat3,A=this.view.displayMat3,I=new k.nt(1).subtract(T);return P.multiply(T).add(A.multiply(I))}_getViewScreenMatrix(T){const P=this.view.viewMat3.multiply(this.view.tileMat3),A=this.view.tileMat3,I=new k.nt(1).subtract(T);return P.multiply(T).add(A.multiply(I))}_getColor(T,P){return(0,k.Tk)((0,k.LC)(P.isSDF,new k.nt(1)),this._getSDFColor(T,P),this._getSpriteColor(T,P))}_getSpriteColor(T,P){return(0,k.US)(this.mosaicInfo.texture,T).multiply(P.color)}_getSDFColor(T,P){const A=(0,k.US)(this.mosaicInfo.texture,T),I=new k.nt(.5).subtract((0,N.Rj)(A)).multiply(P.distanceToPx).multiply(we.V5),E=(0,k.qE)(new k.nt(.5).subtract(I),new k.nt(0),new k.nt(1)),D=P.color.multiply(E);let O=P.outlineSize;this.highlight&&(O=(0,k.T9)(O,P.overrideOutlineColor.multiply(4)));const L=O.multiply(.5),H=(0,k.tn)(I).subtract(L),U=(0,k.qE)(new k.nt(.5).subtract(H),new k.nt(0),new k.nt(1)),q=(0,k.jh)(P.outlineColor,P.color,P.overrideOutlineColor).multiply(U);return new k.nt(1).subtract(q.a).multiply(D).add(q)}_hittestSmallMarker(T,P,A){const{position:I,distance:E,smallSymbolDistance:D}=this.hittestRequest,O=E.subtract(D),{viewMat3:L,tileMat3:H}=this.view,U=L.multiply(H).multiply(new k.eB(A.pos,1)).xy,q=A.size.multiply(.5);return(0,k.Io)(U,I).subtract(q).add(O)}_hittestMarker(T,P,A){const{pos:I,size:E,sizeCorrection:D,isMapAligned:O,outlineSize:L,isSDF:H,distanceToPx:U}=A,N=new k.eB(T.offset.multiply(D),0),G=new k.eB(P.offsetNextVertex1.multiply(D),0),j=new k.eB(P.offsetNextVertex2.multiply(D),0),{viewMat3:ee,tileMat3:te}=this.view,ie=ee.multiply(te).multiply(new k.eB(I,1)),se=this._getViewScreenMatrix(O),re=ie.add(se.multiply(N)).xy,oe=ie.add(se.multiply(G)).xy,ae=ie.add(se.multiply(j)).xy,ne=this.hittestRequest.position,le=this.hittestRequest.distance,ue=(0,q.Bs)(ne.add(new k.ZY((0,k.ze)(le),(0,k.ze)(le))),re,oe,ae),ce=(0,q.Bs)(ne.add(new k.ZY(0,(0,k.ze)(le))),re,oe,ae),de=(0,q.Bs)(ne.add(new k.ZY(le,(0,k.ze)(le))),re,oe,ae),pe=(0,q.Bs)(ne.add(new k.ZY((0,k.ze)(le),0)),re,oe,ae),he=(0,q.Bs)(ne,re,oe,ae),fe=(0,q.Bs)(ne.add(new k.ZY(le,0)),re,oe,ae),me=(0,q.Bs)(ne.add(new k.ZY((0,k.ze)(le),le)),re,oe,ae),ye=(0,q.Bs)(ne.add(new k.ZY(0,le)),re,oe,ae),ve=(0,q.Bs)(ne.add(new k.ZY(le,le)),re,oe,ae),be=T.textureUV.divide(this.mosaicInfo.size),_e=P.textureUVNextVertex1.divide(this.mosaicInfo.size),xe=P.textureUVNextVertex2.divide(this.mosaicInfo.size),ge={color:new k.Zb(1),outlineColor:new k.Zb(1),overrideOutlineColor:new k.nt(1),outlineSize:L,distanceToPx:U,isSDF:H};let Se=new k.nt(0);return Se=Se.add((0,q.kW)(ue).multiply(this._getColor(Y(ue,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(ce).multiply(this._getColor(Y(ce,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(de).multiply(this._getColor(Y(de,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(pe).multiply(this._getColor(Y(pe,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(he).multiply(this._getColor(Y(he,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(fe).multiply(this._getColor(Y(fe,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(me).multiply(this._getColor(Y(me,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(ye).multiply(this._getColor(Y(ye,be,_e,xe),ge).a)),Se=Se.add((0,q.kW)(ve).multiply(this._getColor(Y(ve,be,_e,xe),ge).a)),(0,k.PM)(Se,new k.nt(.05)).multiply((0,q.My)(this.hittestRequest))}}(0,O._)([(0,L.uK)(ze._)],$.prototype,"visualVariableColor",void 0),(0,O._)([(0,L.uK)(Te.i)],$.prototype,"visualVariableOpacity",void 0),(0,O._)([(0,L.uK)(d)],$.prototype,"visualVariableRotation",void 0),(0,O._)([(0,L.uK)(Me.n)],$.prototype,"visualVariableSizeMinMaxValue",void 0),(0,O._)([(0,L.uK)(Pe.F)],$.prototype,"visualVariableSizeScaleStops",void 0),(0,O._)([(0,L.uK)(Ce.N)],$.prototype,"visualVariableSizeStops",void 0),(0,O._)([(0,L.uK)(Fe.d)],$.prototype,"visualVariableSizeUnitValue",void 0),(0,O._)([(0,L.Pi)(Ve.b)],$.prototype,"mosaicInfo",void 0),(0,O._)([(0,O.a)(0,(0,L.hF)(Q)),(0,O.a)(1,(0,L.hF)(W))],$.prototype,"vertex",null),(0,O._)([(0,O.a)(0,(0,L.hF)(X))],$.prototype,"fragment",null);var De=A(4389),Oe=A(65135);class GLSLShaderModule_e{constructor(){this.computeAttributes={}}get locationsMap(){const T=new Map;for(const P in this.locations)T.set(P,this.locations[P].index);return T}get optionPropertyKeys(){if(!this._optionPropertyKeys){const T=new Set(Object.keys(this.options));this._optionPropertyKeys=T}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const T=this.locationsMap,P=Array.from(T.entries()).map((T=>{let[P,A]=T;return"".concat(P,".").concat(A)})).join("."),A=(0,De.Wm)(P);this._locationInfo={hash:A,locations:T}}return this._locationInfo}get renamedLocationsMap(){const T=new Map;for(const[P,A]of this.locationsMap.entries())T.set("a_"+P,A);return T}getShaderKey(T,P,A){const I=Object.keys(A).filter((T=>A[T])).map((T=>"".concat(T,"_").concat(A[T].toString()))).join("."),E=Object.keys(P).filter((T=>this.optionPropertyKeys.has(T))).join(".");return"".concat(T.hash,".").concat(I,".").concat(E)}getProgram(T,P,A,I){let E="",D="";for(const O in A)if(A[O]){const T="boolean"==typeof A[O]?"#define ".concat(O,"\n"):"#define ".concat(O," ").concat(A[O],"\n");E+=T,D+=T}return E+=this.vertexShader,D+=this.fragmentShader,new Oe.K(E,D,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(P),this._transformFeedbackBindings)}_getUniformBindings(T){const P=[];for(const A in this.required){const T=this.required[A];P.push({uniformHydrated:null,shaderModulePath:A,uniformName:A,uniformType:T.type,uniformArrayElementType:n(T),uniformArrayLength:r(T)})}for(const A in T){const I=this.options[A];if(T[A])for(const T in I){const E=I[T];P.push({uniformHydrated:null,shaderModulePath:"".concat(A,".").concat(T),uniformName:T,uniformType:E.type,uniformArrayElementType:n(E),uniformArrayLength:r(E)})}}return P}}const n=T=>{var P;return"array"===T.type?null===(P=T.elementType)||void 0===P?void 0:P.type:void 0},r=T=>"array"===T.type?T.size:void 0;var Be=A(85402);const Le={hittestDist:k.nt,hittestPos:k.ZY},ke={filterFlags:k.z7,animation:k.z7,visualVariableData:k.z7,dataDriven0:k.z7,dataDriven1:k.z7,dataDriven2:k.z7,gpgpu:k.z7,size:k.nt},Ze={displayViewScreenMat3:k.U,displayViewMat3:k.U,displayMat3:k.U,viewMat3:k.U,tileMat3:k.U,displayZoomFactor:k.nt,requiredZoomFactor:k.nt,tileOffset:k.ZY,currentScale:k.nt,currentZoom:k.nt,metersPerSRUnit:k.nt};class PieChartShader_u extends GLSLShaderModule_e{constructor(){super(...arguments),this.vertexShader=(0,Be.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,Be.Q)("materials/pie/pie.frag"),this.required={...ke,...Ze,outlineWidth:k.nt,colors:k.My,defaultColor:k.Zb,othersColor:k.Zb,outlineColor:k.Zb,donutRatio:k.nt,sectorThreshold:k.nt},this.options={hittestUniforms:Le,visualVariableSizeMinMaxValue:{minMaxValueAndSize:k.Zb},visualVariableSizeScaleStops:{sizes:{...k.My.ofType(k.nt,8),type:"array",elementType:k.nt,size:8},values:{...k.My.ofType(k.nt,8),type:"array",elementType:k.nt,size:8}},visualVariableSizeStops:{sizes:{...k.My.ofType(k.nt,8),type:"array",elementType:k.nt,size:8},values:{...k.My.ofType(k.nt,8),type:"array",elementType:k.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:k.nt},visualVariableOpacity:{opacities:{...k.My.ofType(k.nt,8),type:"array",elementType:k.nt,size:8},opacityValues:{...k.My.ofType(k.nt,8),type:"array",elementType:k.nt,size:8}}},this.locations={pos:{index:0,type:k.ZY},id:{index:1,type:k.eB},bitset:{index:2,type:k.nt},offset:{index:3,type:k.ZY},texCoords:{index:4,type:k.ZY},size:{index:5,type:k.ZY},referenceSize:{index:6,type:k.nt},zoomRange:{index:7,type:k.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(T){this.required.colors={...k.My.ofType(k.Zb,T),type:"array",elementType:k.Zb,size:T}}}const He={fill:new class m extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.FillMeshWriter,this.shaders={geometry:new de.z}}render(T,P){const{context:A,painter:I}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target)},defines:(0,E.vT)(T),optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("fill"),patternFill:new class PatternFillTechnique_h extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.PatternFillMeshWriter,this.shaders={geometry:new me.vx}}render(T,P){const{context:A,painter:I}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey),localTileOffset:(0,E.Pr)(P.target)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("patternFill"),complexFill:new class h extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.ComplexFillMeshWriter,this.shaders={geometry:new pe.Ps}}render(T,P){const{context:A,painter:I}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey),localTileOffset:(0,E.Pr)(P.target)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("complexFill"),outlineFill:new class l extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.OutlineFillMeshWriter,this.shaders={geometry:new fe.nj}}render(T,P){const{context:A,painter:I,pixelRatio:D}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),antialiasingControls:utils_n(D)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("outlineFill"),patternOutlineFill:new class PatternOutlineFillTechnique_u extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.PatternOutlineFillMeshWriter,this.shaders={geometry:new ye.tA}}render(T,P){const{context:A,painter:I,pixelRatio:D}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),antialiasingControls:utils_n(D),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey),localTileOffset:(0,E.Pr)(P.target)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("patternOutlineFill"),complexOutlineFill:new class u extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.ComplexOutlineFillMeshWriter,this.shaders={geometry:new he.RH}}render(T,P){const{context:A,painter:I,pixelRatio:D}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),antialiasingControls:utils_n(D),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey),localTileOffset:(0,E.Pr)(P.target)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("complexOutlineFill"),marker:new class MarkerTechnique_u extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.MarkerMeshWriter,this.shaders={geometry:new $},this.symbologyPlane=D.uC.MARKER}render(T,P){const{context:A,painter:I}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey,!0)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("marker"),pieChart:new class PieChartTechnique_u extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.PieChartMeshWriter,this.shaders={geometry:new PieChartShader_u},this.symbologyPlane=D.uC.MARKER}render(T,P){var A,I;const{context:D,painter:O}=T,{instance:L,target:k}=P,H=this.shaders.geometry,U=L.getInput(),q=U.numberOfFields,N=(0,E.Eq)(T),G=(0,E.QA)(T,k),j=(0,E.vT)(T);H.setNumberOfFields(q),O.setShader({shader:H,uniforms:{...(0,E.r3)(T,P.target,U.geometry),...G.storage,...G.view,hittestUniforms:G.hittestRequest?{hittestDist:null===(A=G.hittestRequest)||void 0===A?void 0:A.distance,hittestPos:null===(I=G.hittestRequest)||void 0===I?void 0:I.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!U.geometry.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!U.geometry.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!U.geometry.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!U.geometry.visualVariableSizeUnitValue,VV_OPACITY:!!U.geometry.visualVariableOpacity,HITTEST:N,highlight:G.highlight?1:0,...j,numberOfFields:q},optionalAttributes:{},useComputeBuffer:N}),O.setPipelineState((0,E.Qu)(T)),O.submitDraw(D,P)}}("pieChart"),line:new class p extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.LineMeshWriter,this.shaders={geometry:new Re.cM},this.symbologyPlane=D.uC.LINE}render(T,P){const{context:A,painter:I,pixelRatio:D}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),antialiasingControls:utils_n(D)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("line"),texturedLine:new class TexturedLineTechnique_h extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.TexturedLineMeshWriter,this.shaders={geometry:new TexturedLineShader_R},this.symbologyPlane=D.uC.LINE}render(T,P){const{context:A,painter:I,pixelRatio:D}=T;I.setShader({shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),antialiasingControls:utils_n(D),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey)},defines:{...(0,E.vT)(T)},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}}("texturedLine"),text:new class TextTechnique_u extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.TextMeshWriter,this.shaders={geometry:new K},this.symbologyPlane=D.uC.TEXT}render(T,P){const{context:A,painter:I}=T,D=(0,E.vT)(T),O={shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey)},defines:{...D,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)};I.setShader(O),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P),I.setShader({...O,defines:{...D,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),I.submitDraw(A,P),I.setShader({...O,defines:{...D,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),I.submitDraw(A,P)}}("text"),label:new class LabelTechnique_u extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.LabelMeshWriter,this.shaders={geometry:new K},this.drawPhase=D.S5.LABEL|D.S5.LABEL_ALPHA,this.symbologyPlane=D.uC.TEXT}render(T,P){const{context:A,painter:I}=T,D=(0,E.vT)(T),O={...(0,E.Qu)(T)},L={shader:this.shaders.geometry,uniforms:{...(0,E.r3)(T,P.target,P.instance.getInput().geometry),...(0,E.QA)(T,P.target),mosaicInfo:I.textureManager.getMosaicInfo(A,P.textureKey)},defines:{...D,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:!1};I.setShader(L),I.setPipelineState(O),I.submitDraw(A,P),I.setShader({...L,defines:{...D,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),I.setPipelineState(O),I.submitDraw(A,P),I.setShader({...L,defines:{...D,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),I.setPipelineState(O),I.submitDraw(A,P)}}("label"),heatmap:new class HeatmapTechnique_T extends e{constructor(){super(...arguments),this.meshWriter=ce.Y.HeatmapMeshWriter,this.shaders={accumulate:new HeatmapAccumulateShader_F,resolve:new HeatmapResolveShader_b},this.postProcessingEnabled=!0,this._isBound=!1,this.overrideStencilRef=HeatmapTechnique_P}shutdown(){super.shutdown(),this._prevFBO=null,this._accumulateFramebuffer=(0,be.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,be.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null,this._unbind()}render(T,P){const{context:A,painter:I,state:D}=T,O=P.instance.getInput(),{isFieldActive:L}=O,k=this._loadQualityProfile(A);if((0,E.dJ)(T))return;(0,E.Eq)(T)||this._ensureBound(T,O),I.setShader({shader:this.shaders.accumulate,uniforms:{...(0,E.QA)(T,P.target),kernelControls:{radius:HeatmapTechnique_R(O,D),isFieldActive:L?1:0}},defines:{...(0,E.vT)(T),...k.defines},optionalAttributes:P.instance.optionalAttributes,useComputeBuffer:(0,E.Eq)(T)});const H=(0,E.Eq)(T)?ge:xe;I.setPipelineState(H),I.submitDraw(A,P)}postProcess(T,P){if((0,E.Eq)(T)||(0,E.dJ)(T))return;if(null==this._prevFBO||null==this._prevViewport||null==this._accumulateFramebuffer||null==this._resolveGradientTexture)return;const{context:A,painter:I}=T,{defines:D}=this._loadQualityProfile(A),{minDensity:O,maxDensity:L,radius:k}=P.getInput();I.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:this._accumulateFramebuffer.colorTexture},minAndInvRange:[O,1/(L-O)],normalization:3/(k*k*Math.PI)},gradient:{texture:{unit:9,texture:this._resolveGradientTexture}}},defines:D,optionalAttributes:{},useComputeBuffer:!1}),A.bindFramebuffer(this._prevFBO),A.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),A.bindTexture(this._accumulateFramebuffer.colorTexture,8),A.bindTexture(this._resolveGradientTexture,9),I.setPipelineState(Se),I.submitDrawQuad(A),this._unbind()}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_ensureBound(T,P){if(this._isBound)return;const{context:A}=T;this._prevFBO=A.getBoundFramebufferObject(),this._prevViewport=A.getViewport(),this._ensureResources(T,P),this._updateResources(T,P),A.bindFramebuffer(this._accumulateFramebuffer),A.setViewport(0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height),A.setColorMask(!0,!0,!0,!0),A.setClearColor(0,0,0,0),A.clear(j.hn.COLOR_BUFFER_BIT),this._isBound=!0}_ensureResources(T,P){let{context:A,state:I,pixelRatio:E}=T;if(null==this._accumulateFramebuffer){const{dataType:T,samplingMode:D,pixelFormat:O,internalFormat:L}=this._loadQualityProfile(A),{width:k,height:H}=this._prevViewport,U=B(HeatmapTechnique_R(P,I),E),q=k*U,N=H*U,G=new ue.R(q,N);G.pixelFormat=O,G.internalFormat=L,G.dataType=T,G.samplingMode=D,G.wrapMode=j.pF.CLAMP_TO_EDGE;const ee=new ne.q(j.yQ.DEPTH_STENCIL,q,N);this._accumulateFramebuffer=new oe.H(A,G,ee)}if(null==this._resolveGradientTexture){const T=new ue.R;T.wrapMode=j.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new le.g(A,T)}}_updateResources(T,P){let{context:A,state:I,pixelRatio:E}=T;const{gradient:D,gradientHash:O}=P;this._prevGradientHash!==O&&(this._resolveGradientTexture.resize(D.length/4,1),this._resolveGradientTexture.setData(D),this._prevGradientHash=O);const L=B(HeatmapTechnique_R(P,I),E),{width:k,height:H}=this._prevViewport,U=k*L,q=H*L,{width:N,height:G}=this._accumulateFramebuffer;N===U&&G===q||this._accumulateFramebuffer.resize(U,q),A.blitFramebuffer(this._prevFBO,this._accumulateFramebuffer,0,0,this._prevFBO.width,this._prevFBO.height,0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height,j.hn.STENCIL_BUFFER_BIT,j.Cj.NEAREST)}_loadQualityProfile(T){if(null==this._qualityProfile){const P=(0,_e.S)(T,ve.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapTechnique"));this._qualityProfile={...P,defines:{usesHalfFloatPrecision:P.dataType!==j.ld.FLOAT}}}return this._qualityProfile}}("heatmap"),dotDensity:new class w extends e{constructor(){super(...arguments),this.shaders={polygon:new _,point:new C,fill:new de.z},this.meshWriter=ce.Y.DotDensityMeshWriter}render(T,P){(0,E.dJ)(T)||(0,E.Eq)(T)?this._renderPolygons(T,P):this._renderDotDensity(T,P)}_renderPolygons(T,P){const{context:A,painter:I}=T;I.setShader({shader:this.shaders.fill,uniforms:{...(0,E.QA)(T,P.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,E.vT)(T)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,E.Eq)(T)}),I.setPipelineState((0,E.Qu)(T)),I.submitDraw(A,P)}_renderDotDensity(T,P){const{context:A,painter:D,requiredLevel:O}=T,L=P.instance.getInput();this._resources||(this._resources=new DotDensityResources_p);const k=this._resources.getDotDensityTextures(A,I.CQ,L.seed),H=1/2**(O-P.target.key.level),U=I.CQ,q=U*window.devicePixelRatio*U*window.devicePixelRatio,N=1/H*(1/H),G=L.dotScale?T.state.scale/L.dotScale:1,ee=L.dotValue*G*N;D.setShader({shader:this.shaders.polygon,uniforms:{...(0,E.QA)(T,P.target),instance:{isActive:L.isActive,colors:L.colors,dotValue:Math.max(1,ee)},draw:{dotTexture0:{unit:I.Cp,texture:k[0]},dotTexture1:{unit:I.vN,texture:k[1]},tileZoomFactor:H,pixelRatio:window.devicePixelRatio,tileDotsOverArea:q/(I.CQ*window.devicePixelRatio*I.CQ*window.devicePixelRatio)}},defines:{...(0,E.vT)(T),blending:L.blending},optionalAttributes:{},useComputeBuffer:!1}),D.setPipelineState((0,E.Qu)(T));const te=A.getViewport();A.setViewport(0,0,I.CQ,I.CQ);const ie=A.getBoundFramebufferObject(),se=this._resources.getFBO(A);A.bindFramebuffer(se),A.setClearColor(0,0,0,0),D.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),D.updatePipelineState(A),A.clear(j.hn.COLOR_BUFFER_BIT),D.submitDraw(A,P),A.bindFramebuffer(ie),A.setViewport(te.x,te.y,te.width,te.height);const re=this._resources.getFBO(A).colorTexture;D.setShader({shader:this.shaders.point,uniforms:{view:(0,E.L4)(T,P.target),instance:{dotSize:L.dotSize},draw:{locations:{unit:I.Cp,texture:re},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,E.vT)(T)},optionalAttributes:{},useComputeBuffer:!1}),D.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),D.submitDrawMesh(A,this._resources.getDotDensityMesh(A))}shutdown(){super.shutdown(),this._resources&&this._resources.destroy(),this._resources=null}}("dotDensity")};function TechniqueRegistry_F(){for(const T in He)He[T].startup()}function TechniqueRegistry_T(){for(const T in He)He[T].shutdown()}},97930:(T,P,A)=>{A.d(P,{Jz:()=>c,T9:()=>t});var I=A(16842),E=A(21847),D=A(60679),O=A(35965);function t(T,P){return{type:"simple",filters:P,capabilities:{maxTextureSize:(0,O.C)().maxTextureSize},bindings:a(T)}}function s(T){switch(T){case"opacity":return E.Gn.OPACITY;case"color":return E.Gn.COLOR;case"rotation":return E.Gn.ROTATION;case"size":return E.Gn.SIZE;default:return null}}function a(T){if(!T)return[];switch(T.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(T);case"dot-density":return function o(T){const P=[];for(const A of T.attributes)P.push({binding:P.length,expression:A.valueExpression,field:A.field});return P}(T);case"pie-chart":return function l(T){const P=c(T);let A=4;for(const I of T.attributes)P.push({binding:A++,expression:I.valueExpression,field:I.field});return P}(T);case"heatmap":return function u(T){let{valueExpression:P,field:A}=T;return P||A?[{binding:0,expression:P,field:A}]:[]}(T)}}function c(T){var P;return"visualVariables"in T&&null!==(P=T.visualVariables)&&void 0!==P&&P.length?(0,D.R)(T.visualVariables).map((T=>function x(T){switch(T.type){case"size":return function p(T){return"$view.scale"===T.valueExpression?null:{binding:s(T.type),field:T.field,normalizationField:T.normalizationField,expression:T.valueExpression,valueRepresentation:T.valueRepresentation}}(T);case"color":return function f(T){return{binding:s(T.type),field:T.field,normalizationField:T.normalizationField,expression:T.valueExpression}}(T);case"opacity":return function d(T){return{binding:s(T.type),field:T.field,normalizationField:T.normalizationField,expression:T.valueExpression}}(T);case"rotation":return function m(T){return{binding:s(T.type),expression:T.valueExpression,field:T.field}}(T)}}(T))).filter(I.Ru):[]}},79866:(T,P,A)=>{A.d(P,{Dk:()=>G,K4:()=>y,j0:()=>h});var I=A(62555),E=A(49049),D=A(24806),O=A(80271),L=A(11865),k=A(93200),H=A(60679);const U=1.25,q=128,N=128;function c(T){var P;if(null===(P=T.stops)||void 0===P||!P.length)return null;const A=T.stops.sort(((T,P)=>T.value-P.value)),I=(0,k.r)(A,8),E=I.map((T=>{let{value:P}=T;return P})),D=I.map((T=>{let{color:P}=T;return(0,k.p)(P)}));return{values:E,colors:D}}function v(T){var P;if(null===(P=T.stops)||void 0===P||!P.length)return null;const A=T.stops.sort(((T,P)=>T.value-P.value)),I=(0,k.r)(A,8);return{opacityValues:I.map((T=>{let{value:P}=T;return P})),opacities:I.map((T=>{let{opacity:P}=T;return P}))}}function V(T){return{rotationType:"geographic"===T.rotationType?L.H_.Geographic:L.H_.Arithmatic}}function f(T){var P;if(null===(P=T.stops)||void 0===P||!P.length)return null;if(T.stops.some((T=>T.useMaxValue||T.useMinValue)))return(P,A)=>{const E=P.statisticsByLevel.get(A.key.level),D=T.stops.map((P=>{var A,D,L,k;return{value:P.useMaxValue?null!==(A=null===E||void 0===E||null===(D=E.get(T.field))||void 0===D?void 0:D.maxValue)&&void 0!==A?A:0:P.useMinValue?null!==(L=null===E||void 0===E||null===(k=E.get(T.field))||void 0===k?void 0:k.minValue)&&void 0!==L?L:0:P.value,size:P.size?(0,I.Lz)(P.size):O.qM}})).sort(((T,P)=>T.value-P.value)),L=(0,k.r)(D,8);return{values:L.map((T=>{let{value:P}=T;return P})),sizes:L.map((T=>{let{size:P}=T;return P}))}};const A=T.stops.sort(((T,P)=>T.value-P.value)),E=(0,k.r)(A,8);return{values:E.map((T=>{let{value:P}=T;return P})),sizes:E.map((T=>{let{size:P}=T;return(0,I.Lz)(P)}))}}function S(T){return P=>{const{state:A}=P;return{unitValueToPixelsRatio:(0,E.GA)(A.spatialReference)/D.j[T.valueUnit]/A.resolution}}}function b(T,P){const A=P.length;if(T<P[0].value||1===A)return P[0].size;for(let I=1;I<A;I++)if(T<P[I].value){const A=(T-P[I-1].value)/(P[I].value-P[I-1].value);return P[I-1].size+A*(P[I].size-P[I-1].size)}return P[A-1].size}function z(T){const{minDataValue:P,maxDataValue:A,minSize:E,maxSize:D}=T;if("object"==typeof E&&"object"==typeof D)return(T,O)=>{const L=T.state.scale,k=(0,I.Lz)(b(L,E.stops)),H=(0,I.Lz)(b(L,D.stops));return{minMaxValueAndSize:[P,A,k,H]}};if("object"==typeof E||"object"==typeof D)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[P,A,(0,I.Lz)(E),(0,I.Lz)(D)]}}const G={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function h(T){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U;if(T.visualVariableSizeMinMaxValue)return T.visualVariableSizeMinMaxValue instanceof Function?q:Math.max(T.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*A,P);if(T.visualVariableSizeScaleStops){if(T.visualVariableSizeScaleStops instanceof Function)return q;const I=T.visualVariableSizeScaleStops.sizes;return Math.max(I[I.length-1]*A,P)}if(T.visualVariableSizeStops){if(T.visualVariableSizeStops instanceof Function)return q;const I=T.visualVariableSizeStops.sizes;return Math.max(I[I.length-1]*A,P)}return T.visualVariableSizeUnitValue?2*q:0}function y(T){const P={...G};if(!T||!("visualVariables"in T)||!T.visualVariables)return P;for(const A of(0,H.R)(T.visualVariables))switch(A.type){case"color":P.visualVariableColor=c(A);break;case"opacity":P.visualVariableOpacity=v(A);break;case"rotation":P.visualVariableRotation=V(A);break;case"size":switch(M(A)){case"field-stops":P.visualVariableSizeStops=f(A);break;case"scale-stops":"outline"===A.target?P.visualVariableSizeOutlineScaleStops=f(A):P.visualVariableSizeScaleStops=f(A);break;case"min-max":P.visualVariableSizeMinMaxValue=z(A);break;case"unit-value":P.visualVariableSizeUnitValue=S(A)}break;default:console.error("Unable to handle VV type")}return P}function M(T){if("number"==typeof T.minDataValue&&"number"==typeof T.maxDataValue&&null!=T.minSize&&null!=T.maxSize)return"min-max";if((T.expression&&"view.scale"===T.expression||T.valueExpression&&"$view.scale"===T.valueExpression)&&Array.isArray(T.stops))return"scale-stops";if((null!=T.field||T.expression&&"view.scale"!==T.expression||T.valueExpression&&"$view.scale"!==T.valueExpression)&&(Array.isArray(T.stops)||"levels"in T&&T.levels))return"field-stops";if((null!=T.field||T.expression&&"view.scale"!==T.expression||T.valueExpression&&"$view.scale"!==T.valueExpression)&&null!=T.valueUnit)return"unit-value";throw new Error("InternalError: Found unknown sizeVV type")}},93200:(T,P,A)=>{function n(T,P){const A=T.slice(0,P),I=P-A.length;for(let E=0;E<I;E++){const T=A[A.length-1];A.push(T)}return A}function t(T){if(!T)return[0,0,0,0];const{r:P,g:A,b:I,a:E}=T;return[P*(E/255),A*(E/255),I*(E/255),E]}A.d(P,{p:()=>t,r:()=>n})},53809:(T,P,A)=>{A.d(P,{EM:()=>h,Gn:()=>p,IQ:()=>y,IY:()=>t,Jk:()=>n,NZ:()=>z,TY:()=>r,Zi:()=>u,oF:()=>S});var I=A(8809),E=A(29354),D=A(53944),O=A(79866);function r(T){var P,A;return T.minScale||T.maxScale?{minScale:null!==(P=T.minScale)&&void 0!==P?P:0,maxScale:null!==(A=T.maxScale)&&void 0!==A?A:0}:null}function s(T){if(null==T)return null;if(Array.isArray(T)){const[P,A,I,E]=T;return[P,A,I,255*E]}return"string"==typeof T?T:{...T,defaultValue:s(null===T||void 0===T?void 0:T.defaultValue)}}function t(T){return!!(T.visualVariableSizeMinMaxValue||T.visualVariableSizeScaleStops||T.visualVariableSizeStops||T.visualVariableSizeUnitValue||T.visualVariableSizeOutlineScaleStops)}async function n(T,P){const{cimResourceManager:A,cimAnalyzer:E,scaleExpression:D}=P.schemaOptions;await Promise.all(I.wp.fetchResources(T.symbol,A,[]));const O=E.analyzeSymbolReference(T,!1),L={scaleInfo:r(T),scaleExpression:D},k=[];for(const I of O)switch(I.type){case"marker":k.push(...c(I,P,L));break;case"fill":k.push(...m(I,P,L));break;case"line":k.push(...b(I,P,L));break;case"text":k.push(...v(I,P,L))}return k}function c(T,P,A){const{uniforms:I,schemaOptions:E}=P,{store:L}=E,k=T.isOutline?{...O.Dk,visualVariableSizeScaleStops:I.visualVariableSizeOutlineScaleStops}:{visualVariableColor:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity,visualVariableSizeMinMaxValue:I.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:I.visualVariableSizeScaleStops,visualVariableSizeStops:I.visualVariableSizeStops,visualVariableSizeUnitValue:I.visualVariableSizeUnitValue,visualVariableRotation:I.visualVariableRotation};return u(L.ensureInstance(D.YS.marker,{geometry:k},{zoomRange:!!A.scaleInfo}),T,I,A)}function u(T,P,A,I){var D,L;let{scaleInfo:k,scaleExpression:H}=I;const U=t(A);return[T.createMeshInfo({params:{size:P.size,scaleX:P.scaleX,anchorX:P.anchorPoint.x,anchorY:P.anchorPoint.y,angle:P.rotation,color:null!==(D=s(P.color))&&void 0!==D?D:[0,0,0,0],colorLocked:P.colorLocked,frameHeight:P.frameHeight,widthRatio:P.widthRatio,scaleInfo:k,offsetX:P.offsetX,offsetY:P.offsetY,outlineColor:null!==(L=s(P.outlineColor))&&void 0!==L?L:[0,0,0,0],outlineSize:P.outlineWidth,referenceSize:P.referenceSize||E.D.CIMVectorMarker.size,rotateClockwise:P.rotateClockwise,scaleFactor:null!==H&&void 0!==H?H:1,sizeRatio:P.sizeRatio,alignment:P.alignment,isAbsoluteAnchorPoint:P.isAbsoluteAnchorPoint,scaleSymbolsProportionally:P.scaleSymbolsProportionally,sprite:P.spriteRasterizationParam,hasSizeVV:U,placement:P.markerPlacement,effects:P.effects?{type:"cim-effect-infos",effectInfos:P.effects}:null,transforms:P.transform,minPixelBuffer:(0,O.j0)(A)}})]}function p(T,P,A){var I;let{scaleInfo:E}=A;return[T.createMeshInfo({params:{color:null!==(I=s(P.color))&&void 0!==I?I:[0,0,0,0],scaleInfo:E,effects:P.effects?{type:"cim-effect-infos",effectInfos:P.effects}:null}})]}function m(T,P,A){if(!T.spriteRasterizationParam)return function f(T,P,A){const{uniforms:I,schemaOptions:E}=P,{store:O}=E;return p(O.ensureInstance(D.YS.fill,{geometry:{visualVariableColor:T.colorLocked?null:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity}},{zoomRange:!!A.scaleInfo}),T,A)}(T,P,A);const{uniforms:I,schemaOptions:E}=P,{store:O}=E;return S(O.ensureInstance(D.YS.complexFill,{geometry:{visualVariableColor:T.colorLocked?null:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity}},{zoomRange:!!A.scaleInfo}),T,null!=I.visualVariableColor,A)}function S(T,P,A,I){var E;let{scaleInfo:D}=I;if(!P.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const O=!!P.hasUnresolvedReplacementColor&&(!A||P.colorLocked),L=P.sampleAlphaOnly&&!O,k=P.spriteRasterizationParam;return[T.createMeshInfo({params:{color:null!==(E=s(P.color))&&void 0!==E?E:[0,0,0,0],height:P.height,aspectRatio:P.scaleX,offsetX:P.offsetX,offsetY:P.offsetY,scaleX:1,scaleY:1,angle:P.angle,applyRandomOffset:P.applyRandomOffset,sampleAlphaOnly:L,scaleProportionally:"CIMHatchFill"===k.resource.type,sprite:k,scaleInfo:D,effects:P.effects?{type:"cim-effect-infos",effectInfos:P.effects}:null}})]}function b(T,P,A){const{uniforms:I,schemaOptions:E}=P,{store:L}=E,k=T.isOutline?{...O.Dk,visualVariableSizeScaleStops:I.visualVariableSizeOutlineScaleStops}:{visualVariableColor:T.colorLocked?null:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity,visualVariableSizeMinMaxValue:I.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:I.visualVariableSizeScaleStops,visualVariableSizeStops:I.visualVariableSizeStops,visualVariableSizeUnitValue:I.visualVariableSizeUnitValue},H={geometry:k},U=!!(k.visualVariableSizeMinMaxValue||k.visualVariableSizeScaleStops||k.visualVariableSizeStops||k.visualVariableSizeUnitValue);return T.spriteRasterizationParam?h(L.ensureInstance(D.YS.texturedLine,H,{zoomRange:!!A.scaleInfo}),T,U,A):z(L.ensureInstance(D.YS.line,H,{zoomRange:!!A.scaleInfo}),T,U,A)}function V(T,P,A){var I;let{scaleInfo:E}=A;return{params:{color:null!==(I=s(T.color))&&void 0!==I?I:[0,0,0,0],width:T.width,referenceWidth:T.referenceWidth,capType:T.cap,joinType:T.join,miterLimit:T.miterLimit,scaleInfo:E,hasSizeVV:P,effects:T.effects?{type:"cim-effect-infos",effectInfos:T.effects}:null}}}function z(T,P,A,I){if(P.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");return[T.createMeshInfo({params:V(P,A,I).params})]}function h(T,P,A,I){const{spriteRasterizationParam:E,scaleDash:D,sampleAlphaOnly:O}=P;if(!E)throw new Error("InternalError: Sprite should be defined");return[T.createMeshInfo({params:{...V(P,A,I).params,shouldScaleDash:null!==D&&void 0!==D&&D,shouldSampleAlphaOnly:O,isSDF:"CIMPictureStroke"!==E.resource.type,sprite:E}})]}function v(T,P,A){const{uniforms:I,schemaOptions:E}=P,{store:O}=E;return y(O.ensureInstance(D.YS.text,{geometry:{visualVariableColor:T.colorLocked?null:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity,visualVariableRotation:I.visualVariableRotation,visualVariableSizeMinMaxValue:I.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:I.visualVariableSizeScaleStops,visualVariableSizeStops:I.visualVariableSizeStops,visualVariableSizeUnitValue:I.visualVariableSizeUnitValue}},{zoomRange:!!A.scaleInfo,referenceSymbol:!1,clipAngle:!1}),T,I,A)}function y(T,P,A,I){var E,D,L,k,H;let{scaleInfo:U,scaleExpression:q}=I;return[T.createMeshInfo({params:{boxBackgroundColor:s(P.backgroundColor),boxBorderLineColor:s(P.borderLineColor),boxBorderLineSize:null!==(E=P.borderLineWidth)&&void 0!==E?E:0,color:null!==(D=s(P.color))&&void 0!==D?D:[0,0,0,0],offsetX:P.offsetX,offsetY:P.offsetY,postAngle:P.angle,fontSize:P.size,referenceSize:P.referenceSize,decoration:P.decoration,haloColor:null!==(L=s(P.outlineColor))&&void 0!==L?L:[0,0,0,0],haloFontSize:P.outlineSize,lineWidth:P.lineWidth||512,lineHeightRatio:1,horizontalAlignment:null!==(k=P.horizontalAlignment)&&void 0!==k?k:"center",verticalAlignment:null!==(H=P.verticalAlignment)&&void 0!==H?H:"baseline",useCIMAngleBehavior:!1,glyphs:P.textRasterizationParam,scaleInfo:U,effects:P.effects?{type:"cim-effect-infos",effectInfos:P.effects}:null,placement:P.markerPlacement,transforms:P.transform,scaleFactor:null!==q&&void 0!==q?q:1,minPixelBuffer:(0,O.j0)(A),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}},60679:(T,P,A)=>{A.d(P,{R:()=>u,e:()=>m});var I=A(4180),E=A(89412),D=A(62555),O=A(35965);const L=8,k=L-2,n=()=>E.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function u(T){return T.map((T=>function a(T){return("size"===T.type||"color"===T.type||"opacity"===T.type)&&null!=T.stops}(T)?function i(T){var P;return T.stops=function b(T,P){return P.length<=L?P:(n().warn("Found ".concat(P.length," Visual Variable stops, but MapView only supports ").concat(L,". Displayed stops will be simplified.")),P.length>2*L?function c(T,P){const[A,...I]=P,E=I.pop(),O=I[0].value,L=I[I.length-1].value,H=(L-O)/k,U=[];for(let k=O;k<L;k+=H){let A=0;for(;k>=I[A].value;)A++;const E=I[A],O=P[A-1],L=k-O.value,H=E.value===O.value?1:L/(E.value-O.value);if("color"===T){const T=I[A],E=P[A-1],D=T.color.clone();D.r=p(E.color.r,D.r,H),D.g=p(E.color.g,D.g,H),D.b=p(E.color.b,D.b,H),D.a=p(E.color.a,D.a,H),U.push({value:k,color:D,label:T.label})}else if("size"===T){const T=I[A],E=P[A-1],O=(0,D.cr)(T.size),L=p((0,D.cr)(E.size),O,H);U.push({value:k,size:L,label:T.label})}else{const T=I[A],E=p(P[A-1].opacity,T.opacity,H);U.push({value:k,opacity:E,label:T.label})}}return[A,...U,E]}(T,P):function f(T){const[P,...A]=T,I=A.pop();for(;A.length>k;){let T=0,P=0;for(let I=1;I<A.length;I++){const E=A[I-1],D=A[I],O=Math.abs(D.value-E.value);O>P&&(P=O,T=I)}A.splice(T,1)}return[P,...A,I]}(P))}(T.type,null!==(P=T.stops)&&void 0!==P?P:[]),T}(T.clone()):T))}function p(T,P,A){return(1-A)*T+A*P}function m(T){if(!T)return!0;switch(T.type){case"dot-density":break;case"heatmap":if(!function g(){const{supportsColorBufferFloat:T,supportsColorBufferFloatBlend:P,supportsColorBufferHalfFloat:A}=(0,O.C)();return T&&P||A}()){const T=(0,O.C)(),P=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((P=>!T[P])).join(", ");return n().errorOnce(new I.A("webgl-missing-extension","Missing WebGL2 requirements for Heatmap: ".concat(P))),!1}}return!0}},5993:(T,P,A)=>{A.d(P,{A:()=>a});var I=A(72593),E=A(73896);function t(T){return T.some((T=>T.globalId))}function r(T){return T.filter((T=>!T.error)).map((T=>{var P;return null!==(P=T.objectId)&&void 0!==P?P:T.globalId})).filter((T=>null!=T))}function o(T,P){const A=new Set(T);for(const I of P.values())A.add(I);return A}function d(T,P){const A=new Set(T);for(const I of P.values())A.delete(I);return A}class a{constructor(T){this.updateTracking=new I.F({debugName:"FeatureCommandQueue"}),this._hasGlobalIds=!1,this._queueProcessor=new E.e({concurrency:1,process:T.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(T){return this.updateTracking.addPromise(this._doPush(T))}async _doPush(T){const P=this._queueProcessor,A=P.last(),I=[];switch(T.type){case"update":if((null===A||void 0===A?void 0:A.type)===T.type)return;I.push(P.push(T));break;case"edit":{const E="processed-edit"===(null===A||void 0===A?void 0:A.type)?A:null;E&&P.popLast();const D=this._mergeEdits(E,T);for(const T of D)T&&I.push(P.push(T));break}}await Promise.all(I)}_mergeEdits(T,P){var A,I;const{addedFeatures:E,deletedFeatures:D,updatedFeatures:O}=P.edits;if(this._hasGlobalIds=this._hasGlobalIds||t(E)||t(O)||t(D),this._hasGlobalIds)return[T,{type:"processed-edit",edits:{addOrModified:[...E,...O],removed:D}}];const L=new Set(r(null!==(A=null===T||void 0===T?void 0:T.edits.addOrModified)&&void 0!==A?A:[])),k=new Set(r(null!==(I=null===T||void 0===T?void 0:T.edits.removed)&&void 0!==I?I:[])),H=new Set([...r(E),...r(O)]),U=new Set(r(D));return[{type:"processed-edit",edits:{addOrModified:Array.from(o(d(L,U),H)).map((T=>({objectId:T}))),removed:Array.from(o(d(k,H),U)).map((T=>({objectId:T})))}}]}}},74011:(T,P,A)=>{A.d(P,{S:()=>n});var I=A(4180),E=A(60985);class l{constructor(T,P,A,I){this.dataType=T,this.samplingMode=P,this.pixelFormat=A,this.internalFormat=I}}function n(T,P){const{textureFloat:A,colorBufferFloat:D}=T.capabilities,O=null===A||void 0===A?void 0:A.textureFloatLinear,L=null===D||void 0===D?void 0:D.textureFloat,k=null===D||void 0===D?void 0:D.textureHalfFloat,H=null===D||void 0===D?void 0:D.floatBlend,U=T.driverTest.floatBufferBlend.result;if(!L&&!k)throw new I.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(H&&U||k))throw new I.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(U?"":" This device claims support for EXT_float_blend, but does not actually support it."));const q=L&&H&&U,N=k,G=O,j=!(null===D||void 0===D||!D.R32F),ee=!(null===D||void 0===D||!D.R16F);if(q&&G)return G||P.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new l(E.ld.FLOAT,G?E.Cj.LINEAR:E.Cj.NEAREST,j?E.Ab.RED:E.Ab.RGBA,j?E.H0.R32F:E.Ab.RGBA);if(N)return new l(E.ld.HALF_FLOAT,E.Cj.LINEAR,ee?E.Ab.RED:E.Ab.RGBA,ee?E.H0.R16F:E.Ab.RGBA);throw new I.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}}}]);
//# sourceMappingURL=530.b423a07d.chunk.js.map