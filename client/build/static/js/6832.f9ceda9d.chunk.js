"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[6832,9946],{2744:(t,r,s)=>{s.d(r,{v:()=>i});var A=s(37531);function i(t){(null===t||void 0===t?void 0:t.writtenProperties)&&t.writtenProperties.forEach((t=>{let{target:r,propName:s,newOrigin:b}=t;(0,A.H)(r)&&b&&r.originOf(s)!==b&&r.updateOrigin(s,b)}))}},37531:(t,r,s)=>{function i(t){return t&&"getAtOrigin"in t&&"originOf"in t}s.d(r,{H:()=>i})},66832:(t,r,s)=>{s.d(r,{save:()=>I,saveAs:()=>g});var A=s(58716),b=s(67390),O=s(67177),R=s(17280);const S="Group Layer",U="group-layer-save",x="group-layer-save-as",N=O.mm.GROUP_LAYER_MAP;function m(t){return{isValid:"group"===t.type,errorMessage:"Layer.type should be 'group'"}}function y(t){return{isValid:(0,O.Y)(t,N),errorMessage:"Layer.portalItem.typeKeywords should have '".concat(N,"'")}}function f(t,r){return{...(0,b.m)(t,"web-map",!0),initiator:r}}function v(t){const r=t.layerJSON;return Promise.resolve(r&&Object.keys(r).length?r:null)}async function d(t,r){r.title||(r.title=t.title),(0,O.OM)(r,O.mm.METADATA),(0,O.LG)(r,N)}async function I(t,r){return(0,A.UN)({layer:t,itemType:S,validateLayer:m,validateItem:y,createJSONContext:r=>f(r,t),createItemData:v,errorNamePrefix:U,saveResources:async(r,s)=>(t.sourceIsPortalItem||await r.removeAllResources().catch((()=>{})),(0,R.r)(t.resourceReferences,s))},r)}async function g(t,r,s){return(0,A.Uh)({layer:t,itemType:S,validateLayer:m,createJSONContext:r=>f(r,t),createItemData:v,errorNamePrefix:x,newItem:r,setItemProperties:d,saveResources:(r,s)=>(0,R.r)(t.resourceReferences,s)},s)}},58716:(t,r,s)=>{s.d(r,{UN:()=>$,Uh:()=>j});var A=s(4180),b=s(2744),O=s(91710),R=s(35799),S=s(67390),U=s(67177),x=s(79566),N=s(63539);async function m(t){const{layer:r,errorNamePrefix:s,validateLayer:b}=t;await r.load(),function l(t,r,s){const b=s(t);if(!b.isValid)throw new A.A("".concat(r,":invalid-parameters"),b.errorMessage,{layer:t})}(r,s,b)}function c(t,r){return"Layer (title: ".concat(t.title,", id: ").concat(t.id,") of type '").concat(t.declaredClass,"' ").concat(r)}function u(t){const{item:r,errorNamePrefix:s,layer:b,validateItem:O}=t;if((0,x.X)(r),function f(t){const{item:r,itemType:s,additionalItemType:b,errorNamePrefix:O,layer:R}=t,S=[s];if(b&&S.push(b),!S.includes(r.type)){const t=S.map((t=>"'".concat(t,"'"))).join(", ");throw new A.A("".concat(O,":portal-item-wrong-type"),'Portal item type should be one of: "'.concat(t,'"'),{item:r,layer:R})}}(t),O){const t=O(r);if(!t.isValid)throw new A.A("".concat(s,":invalid-parameters"),t.errorMessage,{layer:b})}}function d(t){const{layer:r,errorNamePrefix:s}=t,{portalItem:b}=r;if(!b)throw new A.A("".concat(s,":portal-item-not-set"),c(r,"requires the portalItem property to be set"));if(!b.loaded)throw new A.A("".concat(s,":portal-item-not-loaded"),c(r,"cannot be saved to a portal item that does not exist or is inaccessible"));u({...t,item:b})}function y(t){var r,s,A,b;const{newItem:S,itemType:U}=t;let x=R.default.from(S);return x.id&&(x=x.clone(),x.id=null),null!==(s=(r=x).type)&&void 0!==s||(r.type=U),null!==(b=(A=x).portal)&&void 0!==b||(A.portal=O.A.getDefault()),u({...t,item:x}),x}function w(t){return(0,S.m)(t,"portal-item")}async function I(t,r,s){var A,b;"beforeSave"in t&&"function"==typeof t.beforeSave&&await t.beforeSave();const O=t.write({},r);return await Promise.all(null!==(A=null===(b=r.resources)||void 0===b?void 0:b.pendingOperations)&&void 0!==A?A:[]),(0,N.c)(r,{errorName:"layer-write:unsupported"},s),O}function v(t){(0,U.LG)(t,U.mm.JSAPI),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((t,r,s)=>s.indexOf(t)===r)))}async function $(t,r){const{layer:s,createItemData:A,createJSONContext:O,saveResources:R,supplementalUnsupportedErrors:S}=t;await m(t),d(t);const U=s.portalItem,x=O?O(U):w(U),N=await I(s,x,{...r,supplementalUnsupportedErrors:S}),L=await A({layer:s,layerJSON:N},U);return v(U),await U.update({data:L}),(0,b.v)(x),await(null===R||void 0===R?void 0:R(U,x)),U}async function j(t,r){const{layer:s,createItemData:A,createJSONContext:O,setItemProperties:R,saveResources:S,supplementalUnsupportedErrors:U}=t;await m(t);const x=y(t),N=O?O(x):w(x),L=await I(s,N,{...r,supplementalUnsupportedErrors:U}),E=await A({layer:s,layerJSON:L},x);return await R(s,x),v(x),await async function P(t,r,s){var A;const b=t.portal;await b.signIn(),await(null===(A=b.user)||void 0===A?void 0:A.addItem({item:t,data:r,folder:null===s||void 0===s?void 0:s.folder}))}(x,E,r),s.portalItem=x,(0,b.v)(N),await(null===S||void 0===S?void 0:S(x,N)),x}},67390:(t,r,s)=>{s.d(r,{m:()=>o,v:()=>e});var A=s(4270),b=s(91710);function e(t,r){return{...l(t,r),readResourcePaths:[]}}function o(t,r,s){const b=(0,A.An)(t.itemUrl);return{...l(t,r),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:b?{rootPath:b.path,writtenUrls:[]}:null,resources:s?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function l(t,r){return{origin:r,url:(0,A.An)(t.itemUrl),portal:t.portal||b.A.getDefault(),portalItem:t}}},49946:(t,r,s)=>{s.d(r,{addOrUpdateResources:()=>a,bg:()=>m,cL:()=>p,fetchResources:()=>o,removeAllResources:()=>c,removeResource:()=>n});var A=s(53705),b=s(4180),O=s(4270);async function o(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;await t.load(s);const A=(0,O.fj)(t.itemUrl,"resources"),{start:b=1,num:R=10,sortOrder:S="asc",sortField:U="resource"}=r,x={query:{start:b,num:R,sortOrder:S,sortField:U,token:t.apiKey},signal:null===s||void 0===s?void 0:s.signal},N=await t.portal.request(A,x);return{total:N.total,nextStart:N.nextStart,resources:N.resources.map((r=>{let{created:s,size:A,resource:b}=r;return{created:new Date(s),size:A,resource:t.resourceFromPath(b)}}))}}async function a(t,r,s,A){const R=new Map;for(const{resource:O,content:U,compress:x,access:N}of r){if(!O.hasPath())throw new b.A("portal-item-resource-".concat(s,":invalid-path"),"Resource does not have a valid path");const[t,r]=l(O.path),A="".concat(t,"/").concat(null!==x&&void 0!==x?x:"","/").concat(null!==N&&void 0!==N?N:"");R.has(A)||R.set(A,{prefix:t,compress:x,access:N,files:[]}),R.get(A).files.push({fileName:r,content:U})}await t.load(A);const S=(0,O.fj)(t.userItemUrl,"add"===s?"addResources":"updateResources");for(const{prefix:b,compress:O,access:U,files:x}of R.values()){const r=25;for(let s=0;s<x.length;s+=r){const R=x.slice(s,s+r),N=new FormData;b&&"."!==b&&N.append("resourcesPrefix",b),O&&N.append("compress","true"),U&&N.append("access",U);let L=0;for(const{fileName:t,content:r}of R)N.append("file"+ ++L,r,t);N.append("f","json"),await t.portal.request(S,{method:"post",body:N,signal:null===A||void 0===A?void 0:A.signal})}}}async function n(t,r,s){if(!r.hasPath())throw new b.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(s);const A=(0,O.fj)(t.userItemUrl,"removeResources");await t.portal.request(A,{method:"post",query:{resource:r.path},signal:null===s||void 0===s?void 0:s.signal}),r.portalItem=null}async function c(t,r){await t.load(r);const s=(0,O.fj)(t.userItemUrl,"removeResources");return t.portal.request(s,{method:"post",query:{deleteAll:!0},signal:null===r||void 0===r?void 0:r.signal})}function l(t){const r=t.lastIndexOf("/");return-1===r?[".",t]:[t.slice(0,r),t.slice(r+1)]}function i(t){const[r,s]=function u(t){const r=(0,O.Zo)(t);return null==r?[t,""]:[t.slice(0,t.length-r.length-1),".".concat(r)]}(t),[A,b]=l(r);return[A,b,s]}async function p(t){return"blob"===t.type?t.blob:"json"===t.type?new Blob([t.jsonString],{type:"application/json"}):(await(0,A.A)(t.url,{responseType:"blob"})).data}function m(t,r){if(!t.hasPath())return null;const[s,,A]=i(t.path);return t.portalItem.resourceFromPath((0,O.fj)(s,r+A))}},17280:(t,r,s)=>{s.d(r,{S:()=>n,r:()=>p});var A=s(4180),b=s(81618),O=s(51523),R=s(49946);async function p(t,r,s){const A=await u(t,r,s);await h(A,r,s)}async function n(t,r,s,A,b){const O=await u(s,A,b);await t.update({data:r}),await h(O,A,b)}async function u(t,r,S){if(null===r||void 0===r||!r.resources)return;const U=r.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=r.portalItem;const x=new Set(r.resources.toKeep.map((t=>t.resource.path))),N=new Set,L=[];x.forEach((r=>{U.delete(r),t.paths.push(r)}));const E=[],k=[],D=[];for(const s of r.resources.toUpdate)if(U.delete(s.resource.path),x.has(s.resource.path)||N.has(s.resource.path)){const{resource:r,content:A,finish:b}=s,S=(0,R.bg)(r,(0,O.lk)());t.paths.push(S.path),E.push({resource:S,content:await(0,R.cL)(A),compress:s.compress}),b&&D.push((()=>b(S)))}else{t.paths.push(s.resource.path),k.push({resource:s.resource,content:await(0,R.cL)(s.content),compress:s.compress});const r=s.finish;r&&D.push((()=>r(s.resource))),N.add(s.resource.path)}for(const s of r.resources.toAdd)if(t.paths.push(s.resource.path),U.has(s.resource.path))U.delete(s.resource.path);else{E.push({resource:s.resource,content:await(0,R.cL)(s.content),compress:s.compress});const t=s.finish;t&&D.push((()=>t(s.resource)))}if(E.length||k.length){const{addOrUpdateResources:t}=await Promise.resolve().then(s.bind(s,49946));await t(r.portalItem,E,"add",S),await t(r.portalItem,k,"update",S)}if(D.forEach((t=>t())),0===L.length)return U;const C=await(0,b.Ol)(L);if((0,b.Te)(S),C.length>0)throw new A.A("save:resources","Failed to save one or more resources",{errors:C});return U}async function h(t,r,s){if(!t||!r.portalItem)return;const A=[];for(const b of t){const t=r.portalItem.resourceFromPath(b);A.push(t.portalItem.removeResource(t,s))}await(0,b.Lx)(A)}},79566:(t,r,s)=>{s.d(r,{X:()=>i});var A=s(61272),b=s(4180),O=s(56276);function i(t){if(A.A.apiKey&&(0,O.Q)(t.portal.url))throw new b.A("save-api-key-utils:api-key-not-supported","Saving is not supported on ".concat(t.portal.url," when using an api key"))}}}]);
//# sourceMappingURL=6832.f9ceda9d.chunk.js.map