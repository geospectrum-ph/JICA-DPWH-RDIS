"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[854,9946],{2744:(d,y,v)=>{v.d(y,{v:()=>i});var f=v(37531);function i(d){(null===d||void 0===d?void 0:d.writtenProperties)&&d.writtenProperties.forEach((d=>{let{target:y,propName:v,newOrigin:g}=d;(0,f.H)(y)&&g&&y.originOf(v)!==g&&y.updateOrigin(v,g)}))}},37531:(d,y,v)=>{function i(d){return d&&"getAtOrigin"in d&&"originOf"in d}v.d(y,{H:()=>i})},98878:(d,y,v)=>{v.d(y,{p:()=>i});var f=v(80671),g=v(57453),w=(v(50886),v(89412),v(76761),v(68682));const i=d=>{let y=class extends d{get apiKey(){var d;return this._isOverridden("apiKey")?this._get("apiKey"):function s(d){return"portalItem"in d}(this)?null===(d=this.portalItem)||void 0===d?void 0:d.apiKey:null}set apiKey(d){null!=d?this._override("apiKey",d):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,f._)([(0,g.MZ)({type:String})],y.prototype,"apiKey",null),y=(0,f._)([(0,w.$)("esri.layers.mixins.APIKeyMixin")],y),y}},47478:(d,y,v)=>{v.d(y,{b:()=>l});var f=v(80671),g=v(89412),w=v(57453),S=(v(50886),v(76761),v(68682)),_=v(26128);const l=d=>{let y=class extends d{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const d=(0,_.qg)(this.url);if(null!=d&&d.title)return d.title}return this._get("title")||""}set title(d){this._set("title",d)}set url(d){this._set("url",(0,_.Jf)(d,g.A.getLogger(this)))}};return(0,f._)([(0,w.MZ)()],y.prototype,"title",null),(0,f._)([(0,w.MZ)({type:String})],y.prototype,"url",null),y=(0,f._)([(0,S.$)("esri.layers.mixins.ArcGISService")],y),y}},96712:(d,y,v)=>{v.d(y,{Xh:()=>H,w6:()=>L});var f=v(80671),g=v(53705),w=v(4180),S=v(89412),_=v(81618),I=v(4270),x=v(57453),A=(v(50886),v(76761),v(59299)),b=v(68682),R=v(51715),P=v(2744),E=v(84661),O=v(43853),K=v(98664),M=v(26128),N=v(32277),U=v(37652);let j=null;function u(){return j}var T=v(91710),Z=v(35799),k=v(67390),q=v(17280),F=v(79566),C=v(63539);const L=d=>{let y=class extends d{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,_.sg)((async(d,y,v)=>{switch(d){case H.SAVE:return this._save(y);case H.SAVE_AS:return this._saveAs(v,y)}}))}readSpatialReference(d,y){return this._readSpatialReference(y)}_readSpatialReference(d){if(null!=d.spatialReference)return K.A.fromJSON(d.spatialReference);const y=d.store,v=y.indexCRS||y.geographicCRS,f=v&&parseInt(v.substring(v.lastIndexOf("/")+1,v.length),10);return null!=f?new K.A(f):null}readFullExtent(d,y,v){if(null!=d&&"object"==typeof d){const f=null==d.spatialReference?{...d,spatialReference:this._readSpatialReference(y)}:d;return E.A.fromJSON(f,v)}const f=y.store,g=this._readSpatialReference(y);return null==g||null==(null===f||void 0===f?void 0:f.extent)||!Array.isArray(f.extent)||f.extent.some((d=>d<V))?null:new E.A({xmin:f.extent[0],ymin:f.extent[1],xmax:f.extent[2],ymax:f.extent[3],spatialReference:g})}parseVersionString(d){const y={major:Number.NaN,minor:Number.NaN,versionString:d},v=d.split(".");return v.length>=2&&(y.major=parseInt(v[0],10),y.minor=parseInt(v[1],10)),y}readVersion(d,y){const v=y.store,f=null!=v.version?v.version.toString():"";return this.parseVersionString(f)}readTitlePortalItem(d){return"item-title"!==this.sublayerTitleMode?void 0:d}readTitleService(d,y){var v;const f=null===(v=this.portalItem)||void 0===v?void 0:v.title;if("item-title"===this.sublayerTitleMode)return(0,M.yG)(this.url,y.name);let g=y.name;if(!g&&this.url){const d=(0,M.qg)(this.url);null!=d&&(g=d.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&f&&(g=f+" - "+g),(0,M.cr)(g)}set url(d){const y=(0,M.HZ)({layer:this,url:d,nonStandardUrlAllowed:!1,logger:S.A.getLogger(this)});this._set("url",y.url),null!=y.layerId&&this._set("layerId",y.layerId)}writeUrl(d,y,v,f){(0,M.LS)(this,d,"layers",y,f)}get parsedUrl(){const d=this._get("url"),y=(0,I.An)(d);return null!=this.layerId&&(y.path="".concat(y.path,"/layers/").concat(this.layerId)),y}async _fetchIndexAndUpdateExtent(d,y){this.indexInfo=(0,U.F)(this.parsedUrl.path,this.rootNode,d,this.customParameters,this.apiKey,S.A.getLogger(this),y),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(d){if("page"===(null===d||void 0===d?void 0:d.type)){var y,v;const f=d.rootIndex%d.pageSize,g=null===(y=d.rootPage)||void 0===y||null===(y=y.nodes)||void 0===y?void 0:y[f];if(null==(null===g||void 0===g||null===(v=g.obb)||void 0===v?void 0:v.center)||null==g.obb.halfSize)throw new w.A("sceneservice:invalid-node-page","Invalid node page.");if(g.obb.center[0]<V||null==this.fullExtent||this.fullExtent.hasZ)return;const S=g.obb.halfSize,_=g.obb.center[2],I=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]);this.fullExtent.zmin=_-I,this.fullExtent.zmax=_+I}else if("node"===(null===d||void 0===d?void 0:d.type)){var f;const y=null===(f=d.rootNode)||void 0===f?void 0:f.mbs;if(!Array.isArray(y)||4!==y.length||y[0]<V)return;const v=y[2],g=y[3],{fullExtent:w}=this;w&&(w.zmin=v-g,w.zmax=v+g)}}async _fetchService(d){if(null==this.url)throw new w.A("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const y=await this._fetchFirstLayerId(d);null!=y&&(this.layerId=y)}return this._fetchServiceLayer(d)}async _fetchFirstLayerId(d){const y=await(0,g.A)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:d});if(y.data&&Array.isArray(y.data.layers)&&y.data.layers.length>0)return y.data.layers[0].id}async _fetchServiceLayer(d){var y,v;const f=await(0,g.A)(null!==(y=null===(v=this.parsedUrl)||void 0===v?void 0:v.path)&&void 0!==y?y:"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:d});f.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let w=!1;if(f.data.layerType&&"Voxel"===f.data.layerType&&(w=!0),w)return this._fetchVoxelServiceLayer();const S=f.data;this.read(S,this._getServiceContext()),this.validateLayer(S)}async _fetchVoxelServiceLayer(d){var y;const v=(await(0,g.A)((null===(y=this.parsedUrl)||void 0===y?void 0:y.path)+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:d})).data;this.read(v,this._getServiceContext()),this.validateLayer(v)}_getServiceContext(){var d;return{origin:"service",portalItem:this.portalItem,portal:null===(d=this.portalItem)||void 0===d?void 0:d.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&"function"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(d){}_updateTypeKeywords(d,y,v){d.typeKeywords||(d.typeKeywords=[]);const f=y.getTypeKeywords();for(const g of f)d.typeKeywords.push(g);d.typeKeywords&&(d.typeKeywords=d.typeKeywords.filter(((d,y,v)=>v.indexOf(d)===y)),v===z.newItem&&(d.typeKeywords=d.typeKeywords.filter((d=>"Hosted Service"!==d))))}async _saveAs(d,y){var v,f;const g={...B,...y};let S=Z.default.from(d);if(!S)throw new w.A("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");(0,F.X)(S),S.id&&(S=S.clone(),S.id=null);const _=S.portal||T.A.getDefault();await this._ensureLoadBeforeSave(),S.type=J,S.portal=_;const I=(0,k.m)(S,"portal-item",!0),x={layers:[this.write({},I)]};return await Promise.all(null!==(v=I.resources.pendingOperations)&&void 0!==v?v:[]),await this._validateAgainstJSONSchema(x,I,g),S.url=this.url,S.title||(S.title=this.title),this._updateTypeKeywords(S,g,z.newItem),await _.signIn(),await(null===(f=_.user)||void 0===f?void 0:f.addItem({item:S,folder:null===g||void 0===g?void 0:g.folder,data:x})),await(0,q.r)(this.resourceReferences,I),this.portalItem=S,(0,P.v)(I),I.portalItem=S,S}async _save(d){var y;const v={...B,...d};if(!this.portalItem)throw new w.A("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if((0,F.X)(this.portalItem),this.portalItem.type!==J)throw new w.A("sceneservice:portal-item-wrong-type",'Portal item needs to have type "'.concat(J,'"'));await this._ensureLoadBeforeSave();const f=(0,k.m)(this.portalItem,"portal-item",!0),g={layers:[this.write({},f)]};return await Promise.all(null!==(y=f.resources.pendingOperations)&&void 0!==y?y:[]),await this._validateAgainstJSONSchema(g,f,v),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,v,z.existingItem),await(0,q.S)(this.portalItem,g,this.resourceReferences,f),(0,P.v)(f),this.portalItem}async _validateAgainstJSONSchema(d,y,v){const f=null===v||void 0===v?void 0:v.validationOptions;(0,C.c)(y,{errorName:"sceneservice:save"},{ignoreUnsupported:null===f||void 0===f?void 0:f.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const g=null===f||void 0===f?void 0:f.enabled,_=u();if(g&&_){const y=(await _()).validate(d,v.portalItemLayerType);if(!y.length)return;const g="Layer item did not validate:\n".concat(y.join("\n"));if(S.A.getLogger(this).error("_validateAgainstJSONSchema(): ".concat(g)),"throw"===f.failPolicy){const d=y.map((d=>new w.A("sceneservice:schema-validation",d)));throw new w.A("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:d})}}}};return(0,f._)([(0,x.MZ)(N.id)],y.prototype,"id",void 0),(0,f._)([(0,x.MZ)({type:K.A})],y.prototype,"spatialReference",void 0),(0,f._)([(0,A.w)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],y.prototype,"readSpatialReference",null),(0,f._)([(0,x.MZ)({type:E.A})],y.prototype,"fullExtent",void 0),(0,f._)([(0,A.w)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],y.prototype,"readFullExtent",null),(0,f._)([(0,x.MZ)({readOnly:!0,type:O.A})],y.prototype,"heightModelInfo",void 0),(0,f._)([(0,x.MZ)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],y.prototype,"minScale",void 0),(0,f._)([(0,x.MZ)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],y.prototype,"maxScale",void 0),(0,f._)([(0,x.MZ)({readOnly:!0})],y.prototype,"version",void 0),(0,f._)([(0,A.w)("version",["store.version"])],y.prototype,"readVersion",null),(0,f._)([(0,x.MZ)({type:String,json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0),(0,f._)([(0,x.MZ)({type:String,json:{read:!1}})],y.prototype,"sublayerTitleMode",void 0),(0,f._)([(0,x.MZ)({type:String})],y.prototype,"title",void 0),(0,f._)([(0,A.w)("portal-item","title")],y.prototype,"readTitlePortalItem",null),(0,f._)([(0,A.w)("service","title",["name"])],y.prototype,"readTitleService",null),(0,f._)([(0,x.MZ)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],y.prototype,"layerId",void 0),(0,f._)([(0,x.MZ)(N.OZ)],y.prototype,"url",null),(0,f._)([(0,R.K)("url")],y.prototype,"writeUrl",null),(0,f._)([(0,x.MZ)()],y.prototype,"parsedUrl",null),(0,f._)([(0,x.MZ)({readOnly:!0})],y.prototype,"store",void 0),(0,f._)([(0,x.MZ)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],y.prototype,"rootNode",void 0),y=(0,f._)([(0,b.$)("esri.layers.mixins.SceneService")],y),y},V=-1e38;var z,D;(D=z||(z={}))[D.existingItem=0]="existingItem",D[D.newItem=1]="newItem";const J="Scene Service",B={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var H;!function(d){d[d.SAVE=0]="SAVE",d[d.SAVE_AS=1]="SAVE_AS"}(H||(H={}))},37652:(d,y,v)=>{v.d(y,{F:()=>r});var f=v(53705),g=v(4180);async function r(d,y,v,w,S,_,I){let x=null;if(null!=v){const y="".concat(d,"/nodepages/"),g=y+Math.floor(v.rootIndex/v.nodesPerPage);try{return{type:"page",rootPage:(await(0,f.A)(g,{query:{f:"json",...w,token:S},responseType:"json",signal:I})).data,rootIndex:v.rootIndex,pageSize:v.nodesPerPage,lodMetric:v.lodSelectionMetricType,urlPrefix:y}}catch(P){null!=_&&_.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",g,P),x=P}}if(!y)return null;const A=null===y||void 0===y?void 0:y.split("/").pop(),b="".concat(d,"/nodes/"),R=b+A;try{return{type:"node",rootNode:(await(0,f.A)(R,{query:{f:"json",...w,token:S},responseType:"json",signal:I})).data,urlPrefix:b}}catch(P){throw new g.A("sceneservice:root-node-missing","Root node missing.",{pageError:x,nodeError:P,url:R})}}},67390:(d,y,v)=>{v.d(y,{m:()=>o,v:()=>e});var f=v(4270),g=v(91710);function e(d,y){return{...l(d,y),readResourcePaths:[]}}function o(d,y,v){const g=(0,f.An)(d.itemUrl);return{...l(d,y),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:g?{rootPath:g.path,writtenUrls:[]}:null,resources:v?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function l(d,y){return{origin:y,url:(0,f.An)(d.itemUrl),portal:d.portal||g.A.getDefault(),portalItem:d}}},49946:(d,y,v)=>{v.d(y,{addOrUpdateResources:()=>a,bg:()=>m,cL:()=>p,fetchResources:()=>o,removeAllResources:()=>c,removeResource:()=>n});var f=v(53705),g=v(4180),w=v(4270);async function o(d){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;await d.load(v);const f=(0,w.fj)(d.itemUrl,"resources"),{start:g=1,num:S=10,sortOrder:_="asc",sortField:I="resource"}=y,x={query:{start:g,num:S,sortOrder:_,sortField:I,token:d.apiKey},signal:null===v||void 0===v?void 0:v.signal},A=await d.portal.request(f,x);return{total:A.total,nextStart:A.nextStart,resources:A.resources.map((y=>{let{created:v,size:f,resource:g}=y;return{created:new Date(v),size:f,resource:d.resourceFromPath(g)}}))}}async function a(d,y,v,f){const S=new Map;for(const{resource:w,content:I,compress:x,access:A}of y){if(!w.hasPath())throw new g.A("portal-item-resource-".concat(v,":invalid-path"),"Resource does not have a valid path");const[d,y]=l(w.path),f="".concat(d,"/").concat(null!==x&&void 0!==x?x:"","/").concat(null!==A&&void 0!==A?A:"");S.has(f)||S.set(f,{prefix:d,compress:x,access:A,files:[]}),S.get(f).files.push({fileName:y,content:I})}await d.load(f);const _=(0,w.fj)(d.userItemUrl,"add"===v?"addResources":"updateResources");for(const{prefix:g,compress:w,access:I,files:x}of S.values()){const y=25;for(let v=0;v<x.length;v+=y){const S=x.slice(v,v+y),A=new FormData;g&&"."!==g&&A.append("resourcesPrefix",g),w&&A.append("compress","true"),I&&A.append("access",I);let b=0;for(const{fileName:d,content:y}of S)A.append("file"+ ++b,y,d);A.append("f","json"),await d.portal.request(_,{method:"post",body:A,signal:null===f||void 0===f?void 0:f.signal})}}}async function n(d,y,v){if(!y.hasPath())throw new g.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await d.load(v);const f=(0,w.fj)(d.userItemUrl,"removeResources");await d.portal.request(f,{method:"post",query:{resource:y.path},signal:null===v||void 0===v?void 0:v.signal}),y.portalItem=null}async function c(d,y){await d.load(y);const v=(0,w.fj)(d.userItemUrl,"removeResources");return d.portal.request(v,{method:"post",query:{deleteAll:!0},signal:null===y||void 0===y?void 0:y.signal})}function l(d){const y=d.lastIndexOf("/");return-1===y?[".",d]:[d.slice(0,y),d.slice(y+1)]}function i(d){const[y,v]=function u(d){const y=(0,w.Zo)(d);return null==y?[d,""]:[d.slice(0,d.length-y.length-1),".".concat(y)]}(d),[f,g]=l(y);return[f,g,v]}async function p(d){return"blob"===d.type?d.blob:"json"===d.type?new Blob([d.jsonString],{type:"application/json"}):(await(0,f.A)(d.url,{responseType:"blob"})).data}function m(d,y){if(!d.hasPath())return null;const[v,,f]=i(d.path);return d.portalItem.resourceFromPath((0,w.fj)(v,y+f))}},17280:(d,y,v)=>{v.d(y,{S:()=>n,r:()=>p});var f=v(4180),g=v(81618),w=v(51523),S=v(49946);async function p(d,y,v){const f=await u(d,y,v);await h(f,y,v)}async function n(d,y,v,f,g){const w=await u(v,f,g);await d.update({data:y}),await h(w,f,g)}async function u(d,y,_){if(null===y||void 0===y||!y.resources)return;const I=y.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0,d.portalItem=y.portalItem;const x=new Set(y.resources.toKeep.map((d=>d.resource.path))),A=new Set,b=[];x.forEach((y=>{I.delete(y),d.paths.push(y)}));const R=[],P=[],E=[];for(const v of y.resources.toUpdate)if(I.delete(v.resource.path),x.has(v.resource.path)||A.has(v.resource.path)){const{resource:y,content:f,finish:g}=v,_=(0,S.bg)(y,(0,w.lk)());d.paths.push(_.path),R.push({resource:_,content:await(0,S.cL)(f),compress:v.compress}),g&&E.push((()=>g(_)))}else{d.paths.push(v.resource.path),P.push({resource:v.resource,content:await(0,S.cL)(v.content),compress:v.compress});const y=v.finish;y&&E.push((()=>y(v.resource))),A.add(v.resource.path)}for(const v of y.resources.toAdd)if(d.paths.push(v.resource.path),I.has(v.resource.path))I.delete(v.resource.path);else{R.push({resource:v.resource,content:await(0,S.cL)(v.content),compress:v.compress});const d=v.finish;d&&E.push((()=>d(v.resource)))}if(R.length||P.length){const{addOrUpdateResources:d}=await Promise.resolve().then(v.bind(v,49946));await d(y.portalItem,R,"add",_),await d(y.portalItem,P,"update",_)}if(E.forEach((d=>d())),0===b.length)return I;const O=await(0,g.Ol)(b);if((0,g.Te)(_),O.length>0)throw new f.A("save:resources","Failed to save one or more resources",{errors:O});return I}async function h(d,y,v){if(!d||!y.portalItem)return;const f=[];for(const g of d){const d=y.portalItem.resourceFromPath(g);f.push(d.portalItem.removeResource(d,v))}await(0,g.Lx)(f)}},79566:(d,y,v)=>{v.d(y,{X:()=>i});var f=v(61272),g=v(4180),w=v(56276);function i(d){if(f.A.apiKey&&(0,w.Q)(d.portal.url))throw new g.A("save-api-key-utils:api-key-not-supported","Saving is not supported on ".concat(d.portal.url," when using an api key"))}},63539:(d,y,v)=>{v.d(y,{c:()=>t,d:()=>r});var f=v(4180);async function r(d){const y=[];for(const v of d.allLayers)if("beforeSave"in v&&"function"==typeof v.beforeSave){const d=v.beforeSave();d&&y.push(d)}await Promise.allSettled(y)}const g=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function t(d,y,v){var w;let S=(null!==(w=d.messages)&&void 0!==w?w:[]).filter((d=>{let{type:y}=d;return"error"===y})).map((d=>{let{name:y,message:v,details:g}=d;return new f.A(y,v,g)}));if(d.blockedRelativeUrls&&(S=S.concat(d.blockedRelativeUrls.map((d=>new f.A("url:unsupported","Relative url '".concat(d,"' is not supported")))))),v){const{ignoreUnsupported:d,supplementalUnsupportedErrors:y=[],requiredPropertyChecksDisabled:f}=v;d&&(S=S.filter((d=>{let{name:v}=d;return!(g.has(v)||y.includes(v))}))),f&&(S=S.filter((d=>"web-document-write:property-required"!==d.name)))}if(S.length>0)throw new f.A(y.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:S})}}}]);
//# sourceMappingURL=854.1cbbac5c.chunk.js.map