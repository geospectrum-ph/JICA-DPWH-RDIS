"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[8434],{49214:(s,a,l)=>{l.d(a,{A:()=>i});var h=l(50886),c=l(21847),d=l(231),u=l(72492),f=l(78443);const n=(s,a)=>s.key.level-a.key.level!=0?s.key.level-a.key.level:s.key.row-a.key.row!=0?s.key.row-a.key.row:s.key.col-a.key.col;class i extends d.A{constructor(s){super(),this._tileInfoView=s}renderChildren(s){this.sortChildren(n),this.setStencilReference(s),super.renderChildren(s)}createRenderParams(s){const{state:a}=s,l=super.createRenderParams(s);return l.requiredLevel=this._tileInfoView.getClosestInfoForScale(a.scale).level,l.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(a.scale),l}prepareRenderPasses(s){const a=super.prepareRenderPasses(s);return a.push(s.registerRenderPass({name:"stencil",brushes:[u.A],drawPhase:c.S5.DEBUG|c.S5.MAP|c.S5.HIGHLIGHT|c.S5.LABEL,target:()=>this.getStencilTarget()})),(0,h.A)("esri-tiles-debug")&&a.push(s.registerRenderPass({name:"tileInfo",brushes:[f.A],drawPhase:c.S5.DEBUG,target:()=>this.children})),a}getStencilTarget(){return this.children}setStencilReference(s){let a=1;for(const l of this.children)l.stencilRef=a++}}},64957:(s,a,l)=>{l.d(a,{Y:()=>r});var h=l(80671),c=(l(89412),l(50886),l(76761),l(4180),l(68682)),d=l(88965),u=l(46427),f=l(82804),p=l(84624);class BitmapTile_r extends p.Y{constructor(s,a,l,h,c,d){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(s,a,l,h,c,d),this.bitmap=new f.mb(u),this.bitmap.coordScale=[c,d],this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(s){this.bitmap.beforeRender(s),super.beforeRender(s)}afterRender(s){this.bitmap.afterRender(s),super.afterRender(s)}set stencilRef(s){this.bitmap.stencilRef=s}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,u.vt)(),tileMat3:(0,u.vt)()}}setTransform(s){super.setTransform(s),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var m=l(82262),w=l(21847),v=l(49214);class n extends v.A{get requiresDedicatedFBO(){return this.children.some((s=>"additive"===s.bitmap.blendFunction))}createTile(s){const a=this._tileInfoView.getTileBounds((0,d.vt)(),s),l=this._tileInfoView.getTileResolution(s.level),[h,c]=this._tileInfoView.tileInfo.size;return new BitmapTile_r(s,l,a[0],a[3],h,c)}prepareRenderPasses(s){const a=s.registerRenderPass({name:"bitmap (tile)",brushes:[m.d.bitmap],target:()=>this.children.map((s=>s.bitmap)),drawPhase:w.S5.MAP});return[...super.prepareRenderPasses(s),a]}doRender(s){this.visible&&s.drawPhase===w.S5.MAP&&super.doRender(s)}}const r=s=>{let a=class extends s{attach(){this.view.timeline.record("".concat(this.layer.title," (BitmapTileLayer) Attach")),this._bitmapView=new n(this._tileInfoView),this.container.addChild(this._bitmapView)}detach(){var s;this.container.removeChild(this._bitmapView),null!==(s=this._bitmapView)&&void 0!==s&&s.removeAllChildren(),this._bitmapView=null}};return a=(0,h._)([(0,c.$)("esri.views.2d.layers.BitmapTileLayerView2D")],a),a}},38434:(s,a,l)=>{l.r(a),l.d(a,{default:()=>M});var h=l(80671),c=l(89412),d=l(81618),u=l(57453),f=(l(50886),l(76761),l(68682)),p=l(78395),m=l(64957),w=l(86083),v=l(68369),y=l(63801),g=l(67685),_=l(54869),I=l(11808),b=l(27012),R=l(59995);const S=new Set([102113,102100,3857,3785,900913]),T=[0,0];let V=class extends((0,R.A)((0,m.Y)((0,w.e)(b.A)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const s=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return s?(s.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=s.id),s):null}update(s){this._fetchQueue.pause(),this._fetchQueue.state=s.state,this._tileStrategy.update(s),this._fetchQueue.resume()}attach(){var s;const a=null===(s=this.tileMatrixSet)||void 0===s?void 0:s.tileInfo;a&&(this._tileInfoView=new y.A(a),this._fetchQueue=new _.A({tileInfoView:this._tileInfoView,concurrency:16,process:(s,a)=>this.fetchTile(s,a)}),this._tileStrategy=new I.A({cachePolicy:"keep",resampling:!0,acquireTile:s=>this.acquireTile(s),releaseTile:s=>this.releaseTile(s),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add((()=>{var s;return[null===(s=this.layer)||void 0===s||null===(s=s.activeLayer)||void 0===s?void 0:s.styleId,this.tileMatrixSet]}),(()=>this.doRefresh()))),super.attach())}detach(){var s,a;super.detach(),null!==(s=this._tileStrategy)&&void 0!==s&&s.destroy(),null!==(a=this._fetchQueue)&&void 0!==a&&a.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(s){var a,l;return null!==(a=null===(l=this.layer.activeLayer.tileMatrixSets)||void 0===l?void 0:l.some((a=>{var l;return(0,p.aI)(null===(l=a.tileInfo)||void 0===l?void 0:l.spatialReference,s)})))&&void 0!==a&&a}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((s=>this._updatingHandles.addPromise(this._enqueueTileFetch(s))))}}acquireTile(s){const a=this._bitmapView.createTile(s),l=a.bitmap;return[l.x,l.y]=this._tileInfoView.getTileCoords(T,a.key),l.resolution=this._tileInfoView.getTileResolution(a.key),[l.width,l.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(a)),this._bitmapView.addChild(a),this.requestUpdate(),a}releaseTile(s){this._fetchQueue.abort(s.key.id),this._bitmapView.removeChild(s),s.once("detach",(()=>s.destroy())),this.requestUpdate()}async fetchTile(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l="tilemapCache"in this.layer?this.layer.tilemapCache:null,{signal:h,resamplingLevel:c=0}=a;if(!l)return this._fetchImage(s,h);const u=new g.A(0,0,0,0);let f;try{await l.fetchAvailabilityUpsample(s.level,s.row,s.col,u,{signal:h}),f=await this._fetchImage(u,h)}catch(p){if((0,d.zf)(p))throw p;if(c<3){const l=this._tileInfoView.getTileParentId(s.id);if(l){const h=new g.A(l),d=await this.fetchTile(h,{...a,resamplingLevel:c+1});return(0,v.t)(this._tileInfoView,d,h,s)}}throw p}return(0,v.t)(this._tileInfoView,f,u,s)}canResume(){const s=super.canResume();return s?null!==this.tileMatrixSet:s}async _enqueueTileFetch(s){if(!this._fetchQueue.has(s.key.id)){try{const a=await this._fetchQueue.push(s.key);s.bitmap.source=a,s.bitmap.width=this._tileInfoView.tileInfo.size[0],s.bitmap.height=this._tileInfoView.tileInfo.size[1],s.once("attach",(()=>this.requestUpdate()))}catch(a){(0,d.zf)(a)||c.A.getLogger(this).error(a)}this.requestUpdate()}}async _fetchImage(s,a){return this.layer.fetchImageBitmapTile(s.level,s.row,s.col,{signal:a})}_getTileMatrixSetBySpatialReference(s){const a=this.view.spatialReference;if(!s.tileMatrixSets)return null;let l=s.tileMatrixSets.find((s=>{var l;return(0,p.aI)(null===(l=s.tileInfo)||void 0===l?void 0:l.spatialReference,a)}));return!l&&a.isWebMercator&&(l=s.tileMatrixSets.find((s=>{var a,l;return S.has(null!==(a=null===(l=s.tileInfo)||void 0===l?void 0:l.spatialReference.wkid)&&void 0!==a?a:-1)}))),l}};(0,h._)([(0,u.MZ)({readOnly:!0})],V.prototype,"tileMatrixSet",null),V=(0,h._)([(0,f.$)("esri.views.2d.layers.WMTSLayerView2D")],V);const M=V},68369:(s,a,l)=>{function n(s,a,l,h){if(l.level===h.level)return a;const c=s.tileInfo.size,d=s.getTileResolution(l.level),u=s.getTileResolution(h.level);let f=s.getLODInfoAt(h.level);const p=f.getXForColumn(h.col),m=f.getYForRow(h.row);f=s.getLODInfoAt(l.level);const w=f.getXForColumn(l.col),v=f.getYForRow(l.row),y=function e(s){return s instanceof HTMLImageElement?s.naturalWidth:s.width}(a)/c[0],g=function t(s){return s instanceof HTMLImageElement?s.naturalHeight:s.height}(a)/c[1],_=Math.round(y*((p-w)/d)),I=Math.round(g*(-(m-v)/d)),b=Math.round(y*c[0]*(u/d)),R=Math.round(g*c[1]*(u/d)),S=o(c);return S.getContext("2d").drawImage(a,_,I,b,R,0,0,c[0],c[1]),S}function o(s){const a=document.createElement("canvas");return[a.width,a.height]=s,a}l.d(a,{G:()=>o,t:()=>n})},59995:(s,a,l)=>{l.d(a,{A:()=>i});var h=l(80671),c=l(89412),d=l(81618),u=l(63390),f=(l(50886),l(76761),l(4180),l(68682));const i=s=>{let a=class extends s{initialize(){this.addHandles((0,u.on)((()=>this.layer),"refresh",(s=>{this.doRefresh(s.dataChanged).catch((s=>{(0,d.zf)(s)||c.A.getLogger(this).error(s)}))})),"RefreshableLayerView")}};return a=(0,h._)([(0,f.$)("esri.layers.mixins.RefreshableLayerView")],a),a}}}]);
//# sourceMappingURL=8434.932b5312.chunk.js.map