"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[9552],{14789:(p,b,_)=>{_.d(b,{Fj:()=>m,Z7:()=>f,ce:()=>a,eR:()=>e});var S=_(31714),V=_(31670),E=_(29470),F=_(80271);function e(p){switch(p.type){case"CIMPointSymbol":{const b=p.symbolLayers;if(!b||1!==b.length)return null;const _=b[0];return"CIMVectorMarker"!==_.type?null:e(_)}case"CIMVectorMarker":{var b;const _=p.markerGraphics;if(!_||1!==_.length)return null;const S=_[0];if(!S)return null;const V=S.geometry;if(!V)return null;const E=S.symbol;return!E||"CIMPolygonSymbol"!==E.type&&"CIMLineSymbol"!==E.type||null!==(b=E.symbolLayers)&&void 0!==b&&b.some((p=>!!p.effects))?null:{type:"sdf",geom:V,asFill:"CIMPolygonSymbol"===E.type}}}}function s(p){let b=1/0,_=-1/0,S=1/0,V=-1/0;for(const E of p)for(const p of E)p[0]<b&&(b=p[0]),p[0]>_&&(_=p[0]),p[1]<S&&(S=p[1]),p[1]>V&&(V=p[1]);return[b,S,_,V]}function f(p){return p?p.rings?s(p.rings):p.paths?s(p.paths):(0,V.ZC)(p)?[p.xmin,p.ymin,p.xmax,p.ymax]:null:null}function m(p,b,_,S,V){const[E,T,N,B]=p;if(N<E||B<T)return[0,0,0,1];const q=N-E,D=B-T,J=F.hM,j=Math.floor(.5*(64-J)),H=(128-2*(j+J))/Math.max(q,D),Q=Math.round(q*H)+2*j,G=Math.round(D*H)+2*j;let K=1;b&&(K=G/H/(b.ymax-b.ymin));let Y=0,$=0,X=1;S&&(V?b&&_&&b.ymax-b.ymin>0&&(X=(b.xmax-b.xmin)/(b.ymax-b.ymin),Y=S.x/(_*X),$=S.y/_):(Y=S.x,$=S.y)),b&&(Y=.5*(b.xmax+b.xmin)+Y*(b.xmax-b.xmin),$=.5*(b.ymax+b.ymin)+$*(b.ymax-b.ymin)),Y-=E,$-=T,Y*=H,$*=H,Y+=j,$+=j;let ee=Y/Q-.5,te=$/G-.5;return V&&_&&(ee*=_*X,te*=_),[K,ee,te,X]}function a(p){const b=function l(p){return p?p.rings?p.rings:p.paths?p.paths:void 0!==p.xmin&&void 0!==p.ymin&&void 0!==p.xmax&&void 0!==p.ymax?[[[p.xmin,p.ymin],[p.xmin,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[p.xmin,p.ymin]]]:null:null}(p.geom),_=function i(p){let b=1/0,_=-1/0,S=1/0,V=-1/0;for(const E of p)for(const p of E)p[0]<b&&(b=p[0]),p[0]>_&&(_=p[0]),p[1]<S&&(S=p[1]),p[1]>V&&(V=p[1]);return new E.A(b,S,_-b,V-S)}(b),S=F.hM,V=Math.floor(.5*(64-S)),T=(128-2*(V+S))/Math.max(_.width,_.height),N=Math.round(_.width*T)+2*V,B=Math.round(_.height*T)+2*V,q=[];for(const E of b)if(E&&E.length>1){const b=[];for(const S of E){let[E,F]=S;E-=_.x,F-=_.y,E*=T,F*=T,E+=V-.5,F+=V-.5,p.asFill?b.push([E,F]):b.push([Math.round(E),Math.round(F)])}if(p.asFill){const p=b.length-1;b[0][0]===b[p][0]&&b[0][1]===b[p][1]||b.push(b[0])}q.push(b)}const D=function c(p,b,_,S){const V=b*_,E=new Array(V),F=S*S+1;for(let T=0;T<V;++T)E[T]=F;for(const T of p){const p=T.length;for(let V=1;V<p;++V){const p=T[V-1],F=T[V];let N,B,q,D;p[0]<F[0]?(N=p[0],B=F[0]):(N=F[0],B=p[0]),p[1]<F[1]?(q=p[1],D=F[1]):(q=F[1],D=p[1]);let J=Math.floor(N)-S,j=Math.floor(B)+S,H=Math.floor(q)-S,Q=Math.floor(D)+S;J<0&&(J=0),j>b&&(j=b),H<0&&(H=0),Q>_&&(Q=_);const G=F[0]-p[0],K=F[1]-p[1],Y=G*G+K*K;for(let S=J;S<j;S++)for(let V=H;V<Q;V++){let T,N,B=(S-p[0])*G+(V-p[1])*K;B<0?(T=p[0],N=p[1]):B>Y?(T=F[0],N=F[1]):(B/=Y,T=p[0]+B*G,N=p[1]+B*K);const q=(S-T)*(S-T)+(V-N)*(V-N),D=(_-V-1)*b+S;q<E[D]&&(E[D]=q)}}}for(let T=0;T<V;++T)E[T]=Math.sqrt(E[T]);return E}(q,N,B,V);return p.asFill&&function u(p,b,_,S,V){for(const E of p){const p=E.length;for(let F=1;F<p;++F){const p=E[F-1],T=E[F];let N,B,q,D;p[0]<T[0]?(N=p[0],B=T[0]):(N=T[0],B=p[0]),p[1]<T[1]?(q=p[1],D=T[1]):(q=T[1],D=p[1]);let J=Math.floor(N),j=Math.floor(B)+1,H=Math.floor(q),Q=Math.floor(D)+1;J<S&&(J=S),j>b-S&&(j=b-S),H<S&&(H=S),Q>_-S&&(Q=_-S);for(let E=H;E<Q;++E){if(p[1]>E==T[1]>E)continue;const F=(_-E-1)*b;for(let b=J;b<j;++b)b<(T[0]-p[0])*(E-p[1])/(T[1]-p[1])+p[0]&&(V[F+b]=-V[F+b]);for(let p=S;p<J;++p)V[F+p]=-V[F+p]}}}}(q,N,B,V,D),[y(D,V),N,B]}function y(p,b){const _=2*b,V=p.length,E=new Uint8Array(4*V);for(let F=0;F<V;++F){const b=.5-p[F]/_;(0,S.U)(b,E,4*F)}return E}},9480:(p,b,_)=>{_.d(b,{j:()=>r});var S=_(4180),V=_(50886),E=_(89412),F=_(81618),T=_(80271),N=_(60950),B=_(82380),q=_(60985),D=_(50707),J=_(83663),j=_(83881);class m{constructor(p,b,_){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:S,pixelType:V,textureOnly:E}=p,F=(0,B.Qz)(V);this.blockIndex=_,this.pixelType=V,this.size=b,this.textureOnly=E,E||(this.data=new F(S)),this._resetRange()}destroy(){var p;null===(p=this._texture)||void 0===p||p.dispose();for(const b in this._fbos){const p=this._fbos[b];p&&("0"===b&&p.detachColorTexture(),p.dispose()),this._fbos[b]=null}this._texture=null}get _textureDesc(){const p=new j.R;return p.wrapMode=q.pF.CLAMP_TO_EDGE,p.samplingMode=q.Cj.NEAREST,p.dataType=this.pixelType,p.width=this.size,p.height=this.size,p}setData(p,b,_){const S=(0,N.Q4)(p),V=this.data,E=S*this.texelSize+b;!V||E>=V.length||(V[E]=_,this.dirtyStart=Math.min(this.dirtyStart,S),this.dirtyEnd=Math.max(this.dirtyEnd,S))}getData(p,b){if(null==this.data)return null;const _=(0,N.Q4)(p)*this.texelSize+b;return!this.data||_>=this.data.length?null:this.data[_]}getTexture(p){var b;return null!==(b=this._texture)&&void 0!==b?b:this._initTexture(p)}getFBO(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this._fbos[b]){const _=0===b?this.getTexture(p):this._textureDesc;this._fbos[b]=new D.H(p,_)}return this._fbos[b]}get hasDirty(){const p=this.dirtyStart;return this.dirtyEnd>=p}updateTexture(p,b){try{const _=this.dirtyStart,F=this.dirtyEnd;if(!this.hasDirty)return;(0,V.A)("esri-2d-update-debug")&&console.debug("Version[".concat(b,"] AttributeStoreView.updateTexture"),{start:_,end:F,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const T=this.data.buffer,N=this.getTexture(p),q=4,D=(_-_%this.size)/this.size,J=(F-F%this.size)/this.size,j=D,H=this.size,Q=J,G=D*this.size*q,K=(H+Q*this.size)*q-G,Y=(0,B.Qz)(this.pixelType),$=new Y(T,G*Y.BYTES_PER_ELEMENT,K),X=this.size,ee=Q-j+1;if(ee>this.size)return void E.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new S.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));N.updateData(0,0,j,X,ee,$)}catch(_){}}update(p){const{data:b,start:_,end:S}=p;if(null!=b&&null!=this.data){const S=this.data,V=_*this.texelSize;for(let _=0;_<b.length;_++){const E=1<<_%this.texelSize;p.layout&E&&(S[V+_]=b[_])}}this.dirtyStart=Math.min(this.dirtyStart,_),this.dirtyEnd=Math.max(this.dirtyEnd,S)}resize(p,b){const _=this.size;if(this.size=b,this.textureOnly)return void(_!==this.size&&(this._lastTexture=this._texture,this._texture=null));const S=(0,B.Qz)(this.pixelType);this.destroy(),this.data=new S(p.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(p){var b;const _=new J.g(p,this._textureDesc,null!==(b=this.data)&&void 0!==b?b:void 0);if(null!=this._lastTexture&&this._fbos[0]){const b=this._lastTexture.descriptor.width,S=this._lastTexture.descriptor.height,V=this._lastTexture.descriptor.dataType,E=this._lastTexture.descriptor.pixelFormat,F=this.getFBO(p),T=(0,B.AV)(V),N=new((0,B.Qz)(V))(new ArrayBuffer(b*S*T*this.texelSize)),q=p.getBoundFramebufferObject(),{x:D,y:J,width:j,height:H}=p.getViewport();p.bindFramebuffer(F),F.readPixels(0,0,b,S,E,V,N),_.updateData(0,0,0,2*b,S/2,N),p.setViewport(D,J,j,H),p.bindFramebuffer(q)}return this.destroy(),this._texture=_,this._texture}}class y{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(p){if(!p)throw new Error("InternalError: initArgs must be defined");const b=p.blockDescriptors;if(this.size=p.blockSize,(0,V.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:p}),null==this._data)this._data=b.map(((p,b)=>null!=p?new m(p,this.size,b):null));else for(let _=0;_<this._data.length;_++){const p=this._data[_],S=b[_];null!=S&&(null==p?this._data[_]=new m(S,this.size,_):p.resize(S,this.size))}}destroy(){var p;for(const _ of null!==(b=this._data)&&void 0!==b?b:[]){var b;null===_||void 0===_||_.destroy()}null===(p=this._defaultTexture)||void 0===p||p.dispose();for(const{resolver:_}of this._pendingAttributeUpdates)_.reject("AttributeStore destroyed");this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(p){return null==this._data?null:this._data[p]}setLabelMinZoom(p,b){this.setData(p,0,1,b)}getLabelMinZoom(p){return this.getData(p,0,1,255)}getFilterFlags(p){return this.getData(p,0,0,0)}getVVSize(p){return this.getData(p,T.dV.VV,0,0)}getData(p,b,_,S){if(!this._data)return 0;const V=this._data[b];if(null==V)return 0;const E=V.getData(p,_);return null!=E?E:S}setData(p,b,_,S){this._data[b].setData(p,_,S)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}async requestUpdate(p){const b=(0,F.Tw)();this._version=p.version,this._pendingAttributeUpdates.push({inner:p,resolver:b}),(0,V.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] AttributeStoreView.requestUpdate"),{message:p})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const p=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const{inner:b,resolver:_}of p){const{blockData:p,initArgs:S,sendUpdateEpoch:E,version:F}=b;(0,V.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] Epoch[").concat(E,"] AttributeStoreView.applyUpdate")),this._version=F,this._epoch=E,null!=S&&this._initialize(S);const T=this._data;for(let b=0;b<p.length;b++){const _=p[b],S=T[b];null!=S&&null!=_&&((0,V.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] CpuBlock[").concat(b,"] AttributeStoreView.update"),{block:_}),S.update(_))}_.resolve()}}getUniforms(p){return{filterFlags:{texture:this._getTexture(p,T.dV.FilterFlags),unit:T.uM},animation:{texture:this._getTexture(p,T.dV.Animation),unit:T.z2},gpgpu:{texture:this._getTexture(p,T.dV.GPGPU),unit:T.Sr},visualVariableData:{texture:this._getTexture(p,T.dV.VV),unit:T.nM},dataDriven0:{texture:this._getTexture(p,T.dV.DD0),unit:T.lL},dataDriven1:{texture:this._getTexture(p,T.dV.DD1),unit:T.sn},dataDriven2:{texture:this._getTexture(p,T.dV.DD2),unit:T.n9},size:this.size}}_getTexture(p,b){var _;const S=null===(_=this._data)||void 0===_?void 0:_[b];return S?(S.updateTexture(p,this._version),S.getTexture(p)):this._getDefaultTexture(p)}_getDefaultTexture(p){if(null==this._defaultTexture){const b=new j.R;b.wrapMode=q.pF.CLAMP_TO_EDGE,b.samplingMode=q.Cj.NEAREST,b.width=1,b.height=1,this._defaultTexture=new J.g(p,b,new Uint8Array(4))}return this._defaultTexture}}var H=_(49214);class r extends H.A{constructor(p){super(p),this._statisticsByLevel=new Map,this.attributeView=new y}destroy(){this.children.forEach((p=>p.destroy())),this.removeAllChildren(),this.attributeView.destroy()}doRender(p){p.context.capabilities.enable("textureFloat"),super.doRender(p)}createRenderParams(p){const b=super.createRenderParams(p);return b.attributeView=this.attributeView,b.instanceStore=this._instanceStore,b.statisticsByLevel=this._statisticsByLevel,b}}},49214:(p,b,_)=>{_.d(b,{A:()=>i});var S=_(50886),V=_(21847),E=_(231),F=_(72492),T=_(78443);const n=(p,b)=>p.key.level-b.key.level!=0?p.key.level-b.key.level:p.key.row-b.key.row!=0?p.key.row-b.key.row:p.key.col-b.key.col;class i extends E.A{constructor(p){super(),this._tileInfoView=p}renderChildren(p){this.sortChildren(n),this.setStencilReference(p),super.renderChildren(p)}createRenderParams(p){const{state:b}=p,_=super.createRenderParams(p);return _.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level,_.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(b.scale),_}prepareRenderPasses(p){const b=super.prepareRenderPasses(p);return b.push(p.registerRenderPass({name:"stencil",brushes:[F.A],drawPhase:V.S5.DEBUG|V.S5.MAP|V.S5.HIGHLIGHT|V.S5.LABEL,target:()=>this.getStencilTarget()})),(0,S.A)("esri-tiles-debug")&&b.push(p.registerRenderPass({name:"tileInfo",brushes:[T.A],drawPhase:V.S5.DEBUG,target:()=>this.children})),b}getStencilTarget(){return this.children}setStencilReference(p){let b=1;for(const _ of this.children)_.stencilRef=b++}}},35608:(p,b,_)=>{_.d(b,{O:()=>i});var S=_(84792);class i{constructor(p,b,_,S,V){this._instanceId=p,this.techniqueRef=b,this._meshWriterName=_,this._input=S,this.optionalAttributes=V}get instanceId(){return(0,S.P)(this._instanceId)}createMeshInfo(p){return{id:this._instanceId,meshWriterName:this._meshWriterName,options:p,optionalAttributes:this.optionalAttributes}}getInput(){return this._input}setInput(p){this._input=p}}},99552:(p,b,_)=>{_.r(b),_.d(b,{default:()=>lt});var S=_(80671),V=_(13812),E=_(57453),F=_(50886),T=_(89412),N=(_(76761),_(68682));let B=class extends V.A{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(){var p;if(this.popupTemplate)return this.popupTemplate;const b=null===(p=this.sourceLayer)||void 0===p?void 0:p.featureReduction;return b&&"popupTemplate"in b&&b.popupEnabled?b.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};(0,S._)([(0,E.MZ)({type:Boolean})],B.prototype,"isAggregate",void 0),B=(0,S._)([(0,N.$)("esri.AggregateGraphic")],B);const q=B;_(30174);var D=_(16842),J=_(39652),j=_(188),H=_(4180),Q=_(58285),G=_(35598),K=_(81618),Y=_(63390),$=_(61163),X=_(18763),ee=_(21664);let te=class extends X.A{constructor(p){super(p),this._filter=null,this.duration=(0,F.A)("mapview-transitions-duration"),this._excludedEffectView=new ee.$B(p),this._includedEffectView=new ee.$B(p)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(p){this._get("featureEffect")!==p&&this._transitionTo(p)}get filter(){var p;return this._filter||(null===(p=this.featureEffect)||void 0===p?void 0:p.filter)||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(p){this._set("scale",p),this._excludedEffectView.scale=p,this._includedEffectView.scale=p}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(p,b){this._set("scale",b),this.transitioning?(this._includedEffectView.transitionStep(p,b),this._excludedEffectView.transitionStep(p,b),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=b,this._includedEffectView.scale=b)}endTransitions(){this._includedEffectView.endTransitions(),this._excludedEffectView.endTransitions(),this._filter=null}_transitionTo(p){const b=this._get("featureEffect"),_=p,S=null===_||void 0===_?void 0:_.includedEffect,V=null===_||void 0===_?void 0:_.excludedEffect,E=this._includedEffectView.canTransitionTo(S)&&this._excludedEffectView.canTransitionTo(V);this._includedEffectView.effect=S,this._excludedEffectView.effect=V,this._set("featureEffect",_),this._filter=(null===_||void 0===_?void 0:_.filter)||(null===b||void 0===b?void 0:b.filter)||null,E||this.endTransitions()}};(0,S._)([(0,E.MZ)()],te.prototype,"_filter",void 0),(0,S._)([(0,E.MZ)()],te.prototype,"_excludedEffectView",void 0),(0,S._)([(0,E.MZ)()],te.prototype,"_includedEffectView",void 0),(0,S._)([(0,E.MZ)()],te.prototype,"duration",void 0),(0,S._)([(0,E.MZ)()],te.prototype,"excludedEffects",null),(0,S._)([(0,E.MZ)()],te.prototype,"featureEffect",null),(0,S._)([(0,E.MZ)()],te.prototype,"filter",null),(0,S._)([(0,E.MZ)()],te.prototype,"hasEffects",null),(0,S._)([(0,E.MZ)()],te.prototype,"includedEffects",null),(0,S._)([(0,E.MZ)({value:0})],te.prototype,"scale",null),(0,S._)([(0,E.MZ)()],te.prototype,"transitioning",null),te=(0,S._)([(0,N.$)("esri.layers.effects.FeatureEffectView")],te);const ie=te;var re=_(71843),se=_(57022),ae=_(74629),ne=_(59299),le=_(94309),oe=_(98664);let ue=class extends le.A{constructor(){super(...arguments),this.features=[]}readFeatures(p,b){const _=oe.A.fromJSON(b.spatialReference),S=[];for(let E=0;E<p.length;E++){var V;const b=p[E],F=q.fromJSON(b),T=null===(V=b.geometry)||void 0===V?void 0:V.spatialReference;null==F.geometry||T||(F.geometry.spatialReference=_);const N=b.aggregateGeometries,B=F.aggregateGeometries;if(N&&null!=B)for(const p in B){const b=B[p],S=N[p],V=null===S||void 0===S?void 0:S.spatialReference;null==b||V||(b.spatialReference=_)}S.push(F)}return S}};(0,S._)([(0,E.MZ)({type:[q],json:{write:!0}})],ue.prototype,"features",void 0),(0,S._)([(0,ne.w)("features")],ue.prototype,"readFeatures",null),ue=(0,S._)([(0,N.$)("esri.rest.support.AggregateFeatureSet")],ue);const ce=ue;var de=_(49096),he=_(80050),pe=_(86083),fe=_(31059),ye=_(9480),ge=_(21847),ve=_(4389),me=_(35608),be=_(84792);class s{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const p of this._instanceById.keys())this._instanceByIdNext.has(p)||this._instanceById.delete(p);for(const[p,b]of this._instanceByIdNext.entries()){const _=this._instanceById.get(p);_?_.setInput(b.getInput()):this._instanceById.set(p,b)}this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(p,b,_){let S="".concat(p.registryName);for(const E in b){const p=b[E];if("object"==typeof p&&"geometry"===E)for(const b in p)S+=".".concat(E,".").concat(b,".").concat(null!=p[b]);else S+=".".concat(E,".").concat(null!=b[E])}if(null!=_)for(const E in _)_[E]&&(S+="-".concat(E));const V=(0,ve.Wm)(S);if(this._instanceByIdNext){const S=new me.O((0,be.U)(V),p,p.meshWriter.name,b,_);return this._instanceByIdNext.set(V,S),S}if(!this._instanceById.has(V)){const S=new me.O((0,be.U)(V),p,p.meshWriter.name,b,_);this._instanceById.set(V,S)}return this._instanceById.get(V)}getInstance(p){return this._instanceById.get(p)}}var _e=_(88965),Se=(_(63801),_(67685)),we=(_(54869),_(11808),_(99900)),Ve=_(4690);class o{constructor(p,b,_){this.stage=p,this.version=b,this._tileInfoView=_,this._tiles=new Map,this._pendingUpdates=[],this._locked=!1}destroy(){}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(p){this._tiles.clear();for(const b of p)this._tiles.set(b.key.id,b)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1;for(const p of this._pendingUpdates)this.updateTile(p);this._pendingUpdates=[]}updateTile(p){if(this._locked)return void this._pendingUpdates.push(p);if((0,F.A)("esri-2d-update-debug")){var b,_;const S=null!==(b=null===(_=p.debugInfo)||void 0===_?void 0:_.chunkId)&&void 0!==b?b:"<EnsureEnd>";console.debug("Version[".concat(p.version,"] Tile[").concat(p.id,"] Chunk[").concat(S,"] RenderState.updateTile [").concat(p.type,"]"),p)}const S=this._ensureTile(p.id);if("update"===p.type){const[b,..._]=p.modify;S.onMessage({type:"update",modify:b,remove:p.remove,end:p.end,attributeEpoch:p.attributeEpoch});for(const S of _){const b=this._tiles.get(S.tileId);b&&b.onMessage({type:"update",modify:S,remove:p.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null})}return}if(null==p.append)return void S.onMessage({type:"append",clear:p.clear,debugInfo:p.debugInfo,end:p.end,attributeEpoch:p.attributeEpoch});const[V,...E]=p.append;S.onMessage({type:"append",clear:p.clear,append:V,debugInfo:p.debugInfo,end:p.end,attributeEpoch:p.attributeEpoch});for(const F of E){const p=this._tiles.get(F.tileId);p&&p.onMessage({type:"update",modify:F,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}removeTile(p){const b=this._tiles.get(p);(0,F.A)("esri-2d-update-debug")&&console.debug("Tile[".concat(p,"] RenderState.removeTile")),null!==b&&void 0!==b&&b.destroy(),this._tiles.delete(p)}isTileDone(p){const b=this._tiles.get(p.id);return!!b&&b.isReady}_ensureTile(p){if(!this._tiles.has(p)){const b=this._createTile(p);this._copyPixelBufferedEntitiesInto(b),this._tiles.set(p,b)}return this._tiles.get(p)}_createTile(p){(0,F.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this.version,"] Tile[").concat(p,"] RenderState.createTile"));const b=new Se.A(p),_=this._tileInfoView.getTileBounds((0,_e.vt)(),b),S=this._tileInfoView.getTileResolution(b.level),V=new we.R(b,S,_[0],_[3]);return V.stage=this.stage,V}_copyPixelBufferedEntitiesInto(p){let b=7;for(let _=-1;_<=1;_++)for(let S=-1;S<=1;S++){if(0===_&&0===S)continue;const V=this._tileInfoView.tileInfo.isWrappable,E=(0,Ve.K)(p.key,S,_,V).id,F=this._tiles.get(E);if(null!=F){const V=1<<b;p.copyPixelBufferedEntitesFrom(F,V,S,_)}b--}}}var xe=_(23133);class l{constructor(p,b){this.id=p,this.version=b,this._resolver=(0,K.Tw)(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class u extends ye.j{constructor(p){super(p.view.featuresTilingScheme),this.updatingHandles=new fe.U,this._hitTestsRequests=[],this._store=new s,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._layerView=p}renderChildren(p){if(this.attributeView.update(),this._renderState)for(const b of this._renderState.tiles())b.tryReady(this.attributeView.currentEpoch)&&(this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender());for(const b of this.children)b.setTransform(p.state);switch(super.renderChildren(p),this.hasAnimation&&p.painter.effects.integrate.draw(p,p.attributeView),p.drawPhase){case ge.S5.MAP:return this._renderMapPhase(p);case ge.S5.HIGHLIGHT:return this._renderHighlightPhase(p);case ge.S5.LABEL:return this._renderLabelPhase(p)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getExclusivePostprocessingInstance(p){let{drawPhase:b}=p;if(null==this._instanceStore)return null;let _=0,S=null;for(const V of this._instanceStore.values())V.techniqueRef.drawPhase&b&&(_++,V.techniqueRef.postProcessingEnabled&&(S=V));return _>1?null:S}_getOverrideStencilRef(p){let{drawPhase:b}=p;if(null==this._instanceStore)return null;let _=null;for(const S of this._instanceStore.values()){if(!(S.techniqueRef.drawPhase&b))continue;const{overrideStencilRef:p}=S.techniqueRef;if(null==_)_=p;else if(_!==p){_=null;break}}return _}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter((p=>this._visibleTiles.has(p.key.id))):[]}async updateAttributeView(p){this.requestRender(),await this.updatingHandles.addPromise(this.attributeView.requestUpdate(p)),this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(p){for(const{tileId:b,version:_}of p.subscribe)if(this._subscriptions.has(b))this._subscriptions.get(b).version=_;else{const p=new l(b,_);this._subscriptions.set(b,p),this.updatingHandles.addPromise(p.promise)}for(const b of p.unsubscribe){const p=this._subscriptions.get(b);null!==p&&void 0!==p&&p.destroy(),this._subscriptions.delete(b),this.removeTile(b)}}isDone(p){return!!this._renderState&&this._renderState.isTileDone(p)}async updateRenderState(p){(0,F.A)("esri-2d-update-debug")&&console.debug("Version[".concat(p,"] FeatureContainer.updateRenderState")),this._renderStateNext=new o(this._stage,p,this._tileInfoView)}getDisplayStatistics(p,b){const _=this._statisticsByLevel.get(p);return _?_.get(b):null}updateStatistics(p,b){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:p,statistics:b});let _=this._statisticsByLevel.get(p);_||(_=new Map,this._statisticsByLevel.set(p,_));for(const S of b)_.set(S.fieldName,{minValue:S.minValue,maxValue:S.maxValue})}editStart(){var p;null!==(p=this._renderState)&&void 0!==p&&p.lockUploads(),this.attributeView.lockTextureUploads(),this._lockStatisticUpdates=!0}editEnd(){var p;null!==(p=this._renderState)&&void 0!==p&&p.unlockUploads(),this.attributeView.unlockTextureUploads(),this._lockStatisticUpdates=!1;for(const b of this._updateStatisticsRequests)this.updateStatistics(b.level,b.statistics);this._updateStatisticsRequests=[],this.requestRender()}swapRenderState(){var p;this._renderStateNext&&((0,F.A)("esri-2d-update-debug")&&console.debug("Version[".concat(this._renderStateNext.version,"] FeatureContainer.update.swapRenderState")),null!==(p=this._renderState)&&void 0!==p&&p.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null),this.requestRender()}setVisibleTiles(p){this._visibleTiles=p}async onMessage(p,b){var _;if((0,K.Te)(b),!this._subscriptions.has(p.id))return;const S=this._subscriptions.get(p.id);if(S.version!==p.subscriptionVesrion){if((0,F.A)("esri-2d-update-debug")){const b="".concat(p.subscriptionVesrion," != ").concat(S.version);console.debug("Version[".concat(b,"] Tile[").concat(p.id,"] FeatureContainer - Dropping message, outdated version]"),p)}return}const V=null!==(_=this._renderStateNext)&&void 0!==_?_:this._renderState;if(!V)throw new Error("InternalError: No renderState defined");V.version!==p.version&&console.error("InternalError: Version mismatch. [renderState: ".concat(V.version,", message: ").concat(p.version,"]")),V.updateTile(p),p.end&&this._subscriptions.get(p.id).end(),this.requestRender(),this._layerView.view.labelManager.requestUpdate(),this._layerView.requestUpdate()}removeTile(p){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(p),this._renderStateNext&&this._renderStateNext.removeTile(p))}hitTest(p){let b=this._hitTestsRequests.find((b=>{let{x:_,y:S}=b;return _===p.x&&S===p.y}));const _=(0,K.Tw)();return b?b.resolvers.push(_):(b={x:p.x,y:p.y,resolvers:[_]},this._hitTestsRequests.push(b)),this.requestRender(),_.promise}getSortKeys(p){const b=new Set(p),_=new Map;for(const S of this.children)if(S.getSortKeys(b).forEach(((p,b)=>_.set(b,p))),_.size===b.size)break;return _}get hasAnimation(){return this.hasLabels}updateTransitionProperties(p,b){super.updateTransitionProperties(p,b),this._layerView.featureEffectView.transitionStep(p,b),this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(p){const{minScale:b,maxScale:_}=this._layer.effectiveScaleRange,S=p.state.scale;S<=(b||1/0)&&S>=_&&super.doRender(p)}afterRender(p){super.afterRender(p),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(p){const b=this._getOverrideStencilRef(p);if(null==b)super.setStencilReference(p);else for(const _ of this.children)_.stencilRef=b(_)}_renderMapPhase(p){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(p),this._renderInsideEffect(p)):this._renderFeatures(p,ge.RI.All),this._hitTestsRequests.length>0&&this._renderHittest(p)}_renderHighlightPhase(p){this.hasHighlight&&(0,xe.lB)(p,!1,(p=>{this._renderFeatures(p,ge.RI.Highlight)}))}_renderLabelPhase(p){this._renderFeatures(p,ge.RI.All)}_renderInsideEffect(p){const b=p.painter.effects.insideEffect;b.bind(p),this._renderFeatures(p,ge.RI.InsideEffect),b.draw(p,this._layerView.featureEffectView.includedEffects),b.unbind()}_renderOutsideEffect(p){const b=p.painter.effects.outsideEffect;b.bind(p),this._renderFeatures(p,ge.RI.OutsideEffect),b.draw(p,this._layerView.featureEffectView.excludedEffects),b.unbind()}_renderHittest(p){const{context:b}=p,_=p.painter.effects.hittest,S=b.getBoundFramebufferObject(),V=b.getViewport(),E=p.passOptions;_.bind(p),p.passOptions=_.createOptions(p,this._hitTestsRequests),this._renderFeatures(p,ge.RI.All),_.draw(p),_.unbind(),b.bindFramebuffer(S),b.restoreViewport(V),p.passOptions=E}_renderFeatures(p,b){for(const S of this.children){if(!S.visible)continue;const _=(0,F.A)("featurelayer-force-marker-text-draw-order")?ge.ch.STRICT_MARKERS_AND_TEXT:ge.ch.BATCHING,V=S.getDisplayList(p.drawPhase,this._instanceStore,_);p.selection=b,null===V||void 0===V||V.render(p)}const _=this._getExclusivePostprocessingInstance(p);null!=_&&_.techniqueRef.postProcess(p,_)}}var Ie=_(80563);class FeaturePipelineWorkerProxy_n{constructor(p){this._connection=p,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}var Re=_(73067),Ee=_(76193);let Ae=class extends X.A{constructor(){super(...arguments),this.events=new Re.A,this._updatingStrategy=!0,this._tileToEvent=new Ee.A,this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){var p,b;return this._hasAllData()&&null!==(p=null===(b=this._strategyInfo)||void 0===b?void 0:b.willQueryAllFeatures)&&void 0!==p&&p}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){var p,b;return this._hasAllData()&&null!==(p=null===(b=this._strategyInfo)||void 0===b?void 0:b.willQueryFullResolutionGeometry)&&void 0!==p&&p}onEvent(p){switch(p.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(p);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=p.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",p);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),p.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const p of this._tileToEvent.values())if("loaded"!==p[p.length-1].type)return!1;return!0}_handleTileEvent(p){switch(p.type){case"subscribe":this._tileToEvent.set(p.tile,[p]);break;case"unsubscribe":this._tileToEvent.delete(p.tile);break;case"loaded":{const b=this._tileToEvent.get(p.tile);if(!b)return;b.push(p),this._tileToEvent.set(p.tile,b);break}case"error":{const b=this._tileToEvent.get(p.tile);if(!b)return;b.push(p),this._tileToEvent.set(p.tile,b),this.events.emit("error",p);break}}}};(0,S._)([(0,E.MZ)({readOnly:!0})],Ae.prototype,"hasAllFeatures",null),(0,S._)([(0,E.MZ)({readOnly:!0})],Ae.prototype,"hasAllFeaturesInView",null),(0,S._)([(0,E.MZ)({readOnly:!0})],Ae.prototype,"hasFullGeometries",null),(0,S._)([(0,E.MZ)()],Ae.prototype,"_updatingStrategy",void 0),(0,S._)([(0,E.MZ)()],Ae.prototype,"_strategyInfo",void 0),(0,S._)([(0,E.MZ)()],Ae.prototype,"_tileToEvent",void 0),Ae=(0,S._)([(0,N.$)("esri.views.2d.layers.features.FeatureSourceEventLog")],Ae);var Fe=_(66004),Me=_(26128);function geometryUtils_e(p){switch(p.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":case"multipatch":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";default:return null}}var Te=_(62555);function featureReductionUtils_e(p,b){const _=p.featureReduction;return _&&"selection"!==_.type&&(!("maxScale"in _)||!_.maxScale||_.maxScale<b.scale)?_:null}var ze=_(48237),Oe=_(24806),Ue=_(85911);const Ce=Math.PI;function visualVariableSimpleUtils_i(p,b){switch(b.transformationType){case Ue._w.Additive:return function visualVariableSimpleUtils_s(p,b){return p+(a(b.minSize,p)||b.minDataValue)}(p,b);case Ue._w.Constant:return function visualVariableSimpleUtils_o(p,b){const _=p.stops;let S=(null===_||void 0===_?void 0:_.length)&&_[0].size;return null==S&&(S=p.minSize),a(S,b)}(b,p);case Ue._w.ClampedLinear:return function visualVariableSimpleUtils_u(p,b){const _=b.minDataValue,S=b.maxDataValue,V=(p-_)/(S-_),E=a(b.minSize,p),F=a(b.maxSize,p);return p<=_?E:p>=S?F:E+V*(F-E)}(p,b);case Ue._w.Proportional:return function visualVariableSimpleUtils_l(p,b){const _=p/b.minDataValue,S=a(b.minSize,p),V=a(b.maxSize,p);let E=null;return E=_*S,(0,ze.qE)(E,S,V)}(p,b);case Ue._w.Stops:return function visualVariableSimpleUtils_c(p,b){const[_,S,V]=function visualVariableSimpleUtils_p(p,b){if(!b)return;let _=0,S=b.length-1;return b.some(((b,V)=>p<b?(S=V,!0):(_=V,!1))),[_,S,(p-b[_])/(b[S]-b[_])]}(p,b.cache.ipData);if(_===S)return a(b.stops[_].size,p);{const E=a(b.stops[_].size,p);return E+(a(b.stops[S].size,p)-E)*V}}(p,b);case Ue._w.RealWorldSize:return function visualVariableSimpleUtils_m(p,b){const _=Oe.j[b.valueUnit],S=a(b.minSize,p),V=a(b.maxSize,p),{valueRepresentation:E}=b;let F=null;return F="area"===E?2*Math.sqrt(p/Ce)/_:"radius"===E||"distance"===E?2*p/_:p/_,(0,ze.qE)(F,S,V)}(p,b);case Ue._w.Identity:return p;case Ue._w.Unknown:return null}}function a(p,b){return"number"==typeof p?p:visualVariableSimpleUtils_i(b,p)}function labelingUtils_l(p){var b,_;return null!==(b=p.labelsVisible&&(null===(_=p.labelingInfo)||void 0===_?void 0:_.every((p=>"none"!==p.deconflictionStrategy))))&&void 0!==b&&b}function labelingUtils_r(p,b){var _;const S=featureReductionUtils_e(p,b);if(null!==S&&void 0!==S&&S.labelsVisible&&null!==(_=S.labelingInfo)&&void 0!==_&&_.length)return S.labelingInfo.every((p=>"none"!==p.deconflictionStrategy))}function t(p){return b=>(0,Te.Lz)(visualVariableSimpleUtils_i(b,p))}function labelingUtils_o(p){const b=null!=p&&"visualVariables"in p&&p.visualVariables;if(!b)return null;for(const _ of b)if("size"===_.type)return t(_);return null}var Pe=_(25986);function SourceSchema_t(p,b,_,S,V){var E,F,T;const N=null!=b.subtypeCode?"".concat(b.subtypeField," = ").concat(b.subtypeCode):null,B=(0,Pe.m)(b.definitionExpression,N),q=null!==(E=b.customParameters)&&void 0!==E?E:{};return V&&(q.token=V),{type:"feature",mutable:{sourceRefreshVersion:S,availableFields:_.availableFields,dataFilter:{definitionExpression:B,gdbVersion:b.gdbVersion,historicMoment:null===(F=b.historicMoment)||void 0===F?void 0:F.getTime(),outSpatialReference:_.outSpatialReference.toJSON(),timeExtent:null===(T=b.timeExtent)||void 0===T?void 0:T.toJSON(),customParameters:q}},service:p,tileInfoJSON:_.tileInfoJSON}}var ke=_(90178),Le=_(97241),Ne=(_(21343),_(73126)),Be=_(8809),qe=_(64032),De=_(14789),Je=_(73855);_(78844);function color_u(p,b){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==b)return p[_]=0,p[_+1]=0,p[_+2]=0,void(p[_+3]=0);const{r:S,g:V,b:E,a:F}=b;p[_]=S*F/255,p[_+1]=V*F/255,p[_+2]=E*F/255,p[_+3]=F}var Ze=_(80271),je=_(53944),He=_(93200),Qe=_(79866),Ge=_(53809),Ke=_(6835);async function v(p,b){if(!p)return[];switch(p.type){case"simple-fill":return R(p,b);case"picture-fill":return function k(p,b){const{outline:_}=p,{uniforms:S,schemaOptions:V}=b,{store:E}=V,F=[],T=Be.wp.createPictureFillRasterizationParam(p);if(!T)return[];const{width:N,height:B,xoffset:q,yoffset:D,xscale:J,yscale:j}=p,H={color:[255,255,255,255],sprite:T,height:B,aspectRatio:N/B,offsetX:q,offsetY:D,scaleX:J,scaleY:j,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===(null===_||void 0===_?void 0:_.style))return[E.ensureInstance(je.YS.complexOutlineFill,{geometry:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity,visualVariableSizeScaleStops:S.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{...H,...w(_,!!S.visualVariableSizeOutlineScaleStops)}})];const Q=E.ensureInstance(je.YS.complexFill,{geometry:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity}},{zoomRange:!1});return F.push(Q.createMeshInfo({params:H})),_&&F.push(...U(_,b,!0)),F}(p,b);case"simple-marker":return async function x(p,b){var _,S,V,E,F,T;const{uniforms:N,schemaOptions:B}=b,{store:q}=B;if("path"===p.style||p.outline&&"solid"!==p.outline.style&&"none"!==p.outline.style){const _=Be.wp.fromSimpleMarker(p);if(!_||!_.symbolLayers)throw new Error("Error handling marker! ");if("path"!==p.style){const p=_.symbolLayers[0];if((0,Ge.IY)(b.uniforms)){const _=(0,Qe.j0)(b.uniforms,0,1);if(_>p.size){var D;const b=_/p.size;p.size=_;const S=null===(D=p.markerGraphics)||void 0===D?void 0:D[0].symbol;(S.symbolLayers&&S.symbolLayers[0]).width*=b}}}return(0,Ge.Jk)({type:"CIMSymbolReference",symbol:_},b)}const J=q.ensureInstance(je.YS.marker,{geometry:{visualVariableColor:N.visualVariableColor,visualVariableOpacity:N.visualVariableOpacity,visualVariableSizeMinMaxValue:N.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:N.visualVariableSizeScaleStops,visualVariableSizeStops:N.visualVariableSizeStops,visualVariableSizeUnitValue:N.visualVariableSizeUnitValue,visualVariableRotation:N.visualVariableRotation}},{zoomRange:!1}),j=g(p);let H=null!==(_=null===(S=p.color)||void 0===S?void 0:S.toArray())&&void 0!==_?_:[0,0,0,0];"CIMVectorMarker"===j.resource.type&&(H=[255,255,255,255]);const Q="triangle"===p.style?124/116:1,G=p.size,K=G*Q,Y=null!=N.visualVariableColor&&("cross"===p.style||"x"===p.style);return[J.createMeshInfo({params:{type:"simple",color:H,height:G,width:K,offsetX:p.xoffset,offsetY:p.yoffset,angle:p.angle,outlineColor:null!==(V=null===(E=p.outline)||void 0===E||null===(E=E.color)||void 0===E?void 0:E.toArray())&&void 0!==V?V:[0,0,0,0],outlineSize:null!==(F=null===(T=p.outline)||void 0===T?void 0:T.width)&&void 0!==F?F:1,referenceSize:G,sprite:j,overrideOutlineColor:Y,hasSizeVV:(0,Ge.IY)(N),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,Qe.j0)(N)}})]}(p,b);case"picture-marker":return function M(p,b){const{uniforms:_,schemaOptions:S}=b,{store:V}=S,E=V.ensureInstance(je.YS.marker,{geometry:{visualVariableColor:_.visualVariableColor,visualVariableOpacity:_.visualVariableOpacity,visualVariableSizeMinMaxValue:_.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:_.visualVariableSizeScaleStops,visualVariableSizeStops:_.visualVariableSizeStops,visualVariableSizeUnitValue:_.visualVariableSizeUnitValue,visualVariableRotation:_.visualVariableRotation}},{zoomRange:!1}),F=Be.wp.createPictureMarkerRasterizationParam(p);return F?[E.createMeshInfo({params:{type:"picture",color:[255,255,255,255],height:p.height,width:p.width,offsetX:p.xoffset,offsetY:p.yoffset,angle:p.angle,outlineColor:null,outlineSize:0,referenceSize:p.height,sprite:F,overrideOutlineColor:!1,hasSizeVV:(0,Ge.IY)(_),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,Qe.j0)(_)}})]:[]}(p,b);case"simple-line":return U(p,b,!1);case"text":return function I(p,b){var _,S,V,E,F,T,N,B;const{uniforms:q,schemaOptions:D}=b,{store:J}=D;return[J.ensureInstance(je.YS.text,{geometry:{visualVariableColor:q.visualVariableColor,visualVariableOpacity:q.visualVariableOpacity,visualVariableRotation:q.visualVariableRotation,visualVariableSizeMinMaxValue:q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:q.visualVariableSizeScaleStops,visualVariableSizeStops:q.visualVariableSizeStops,visualVariableSizeUnitValue:q.visualVariableSizeUnitValue}},{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}).createMeshInfo({params:{boxBackgroundColor:null===(_=p.backgroundColor)||void 0===_?void 0:_.toArray(),boxBorderLineColor:null===(S=p.borderLineColor)||void 0===S?void 0:S.toArray(),boxBorderLineSize:null!==(V=p.borderLineSize)&&void 0!==V?V:0,color:null!==(E=null===(F=p.color)||void 0===F?void 0:F.toArray())&&void 0!==E?E:[0,0,0,0],offsetX:p.xoffset,offsetY:p.yoffset,postAngle:p.angle,fontSize:p.font.size,decoration:p.font.decoration,haloColor:null!==(T=null===(N=p.haloColor)||void 0===N?void 0:N.toArray())&&void 0!==T?T:[0,0,0,0],haloFontSize:null!==(B=p.haloSize)&&void 0!==B?B:0,lineWidth:p.lineWidth,lineHeightRatio:p.lineHeight,horizontalAlignment:p.horizontalAlignment,verticalAlignment:p.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:p.font.toJSON(),textString:p.text,symbol:Be.wp.createCIMTextSymbolfromTextSymbol(p)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:(0,Qe.j0)(q),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}(p,b);case"label":return function O(p,b){var _,S,V,E,F,T,N,B,q,D,J,j,H;const{schemaOptions:Q,uniforms:G}=b,{store:K}=Q,Y=p.symbol,{allowOverrun:$,repeatLabel:X,repeatLabelDistance:ee}=p,te={maxScale:null!==(_=p.maxScale)&&void 0!==_?_:0,minScale:null!==(S=p.minScale)&&void 0!==S?S:0},ie=K.ensureInstance(je.YS.label,{geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:G.visualVariableRotation,visualVariableSizeMinMaxValue:G.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:G.visualVariableSizeScaleStops,visualVariableSizeStops:G.visualVariableSizeStops,visualVariableSizeUnitValue:G.visualVariableSizeUnitValue}},{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}),re=p.labelPlacement,[se,ae]=(0,Je.fO)(re);return[ie.createMeshInfo({params:{boxBackgroundColor:null===(V=Y.backgroundColor)||void 0===V?void 0:V.toArray(),boxBorderLineColor:null===(E=Y.borderLineColor)||void 0===E?void 0:E.toArray(),boxBorderLineSize:null!==(F=Y.borderLineSize)&&void 0!==F?F:0,color:null!==(T=null===(N=Y.color)||void 0===N?void 0:N.toArray())&&void 0!==T?T:[0,0,0,0],offsetX:Y.xoffset,offsetY:Y.yoffset,postAngle:Y.angle,fontSize:Y.font.size,decoration:Y.font.decoration,haloColor:null!==(B=null===(q=Y.haloColor)||void 0===q?void 0:q.toArray())&&void 0!==B?B:[0,0,0,0],haloFontSize:null!==(D=Y.haloSize)&&void 0!==D?D:0,lineWidth:Y.lineWidth,lineHeightRatio:Y.lineHeight,horizontalAlignment:se,verticalAlignment:ae,repeatLabel:X,repeatLabelDistance:(0,Te.Lz)(ee),allowOverrun:$,labelPosition:p.labelPosition,scaleInfo:te,minPixelBuffer:(0,Qe.j0)(G),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:Y.font.toJSON(),textString:Y.text,symbol:Be.wp.createCIMTextSymbolfromTextSymbol(Y),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==(null===(J=p.labelExpressionInfo)||void 0===J?void 0:J.expression),overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:null!==(j=null===(H=p.labelExpressionInfo)||void 0===H?void 0:H.expression)&&void 0!==j?j:p.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1,isLineLabel:!1}})]}(p,b);case"cim":return(0,Ge.Jk)(p.data,b);case"web-style":{const _=await p.fetchCIMSymbol();return(0,Ge.Jk)(_.data,b)}default:throw new Error("symbol not supported ".concat(p.type))}}async function h(p,b){const{schemaOptions:_}=b,{store:S}=_,V=new Array(Ze.ju),E=new Array(Ze.ju/4);for(let B=0;B<Ze.ju;B++){const b=B<p.attributes.length?p.attributes[B].color:null;V[B]=[0,0,0,0],color_u(V[B],b)}for(let B=0;B<Ze.ju/4;B++)E[B]=[0,0,0,0],E[B][0]=4*B<p.attributes.length?1:0,E[B][1]=4*B+1<p.attributes.length?1:0,E[B][2]=4*B+2<p.attributes.length?1:0,E[B][3]=4*B+3<p.attributes.length?1:0;const F={isActive:E,colors:V,dotValue:p.dotValue,dotScale:p.referenceScale,blending:p.dotBlendingEnabled,dotSize:p.dotSize,seed:p.seed},T=S.ensureInstance(je.YS.dotDensity,F,{}).createMeshInfo({params:{effects:null}}),N=[];if(p.backgroundColor){const _=new Ke.A({color:p.backgroundColor,outline:null}),S=await v(_,b);N.push(...S)}if(N.push(T),p.outline){const _=U(p.outline,b,!0);N.push(..._)}return N}async function z(p,b){const{store:_}=b,{radius:S,minDensity:V,maxDensity:E,referenceScale:F,field:T,valueExpression:N,colorStops:B}=p,q=(0,Ne.O3)(B);return[_.ensureInstance(je.YS.heatmap,{radius:(0,Te.Lz)(S),minDensity:V,maxDensity:E,referenceScale:F,isFieldActive:!(!T&&!N),gradient:q,gradientHash:q.join(",")},{}).createMeshInfo({params:{effects:null}})]}function d(p,b){var _,S,V,E;const{store:F}=b,T=(null===(_=p.outline)||void 0===_?void 0:_.width)||0,N=(0,Qe.K4)(p),B=F.ensureInstance(je.YS.pieChart,{geometry:{outlineWidth:Math.round((0,Te.Lz)(T)),defaultColor:(0,He.p)(p.defaultColor),outlineColor:(0,He.p)(null===(S=p.outline)||void 0===S?void 0:S.color),othersColor:(0,He.p)(null===(V=p.othersCategory)||void 0===V?void 0:V.color),donutRatio:p.holePercentage,sectorThreshold:(null===(E=p.othersCategory)||void 0===E?void 0:E.threshold)||0,colors:p.attributes.map((p=>(0,He.p)(p.color))),visualVariableOpacity:N.visualVariableOpacity,visualVariableSizeMinMaxValue:N.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:N.visualVariableSizeScaleStops,visualVariableSizeStops:N.visualVariableSizeStops,visualVariableSizeUnitValue:N.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:p.attributes.length},{}).createMeshInfo({params:{size:p.size,outlineWidth:T,effects:null,scaleInfo:null,minPixelBuffer:(0,Qe.j0)(N)}});return[...p.backgroundFillSymbol?R(p.backgroundFillSymbol,{schemaOptions:b,path:"",uniforms:Qe.Dk}):[],B]}function g(p){if("path"===p.style){if(null==p.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:p.path,asFill:!0}}}const b=Be.wp.fromSimpleMarker(p);if("outline"in p&&p.outline&&"none"!==p.outline.style&&"solid"!==p.outline.style){if(!b||!b.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:b.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:(0,De.eR)(b),overrides:[]}}function w(p,b){var _,S,V;const E=p.width;return{outlineColor:(null===(_=p.color)||void 0===_?void 0:_.toArray())||[0,0,0,1],width:E,referenceWidth:E,capType:null!==(S=p.cap)&&void 0!==S?S:"round",joinType:null!==(V=p.join)&&void 0!==V?V:"round",miterLimit:p.miterLimit,hasSizeVV:b}}function R(p,b){const{style:_}=p;return _&&"none"!==_&&"solid"!==_?function A(p,b){var _,S,V,E,F;const{uniforms:T,schemaOptions:N}=b,{store:B}=N,q=null!==(_=null===(S=p.color)||void 0===S?void 0:S.toArray())&&void 0!==_?_:[0,0,0,0],D={type:"sprite-rasterization-param",resource:{type:"fill-style",style:p.style},overrides:[]};if("solid"===(null===(V=p.outline)||void 0===V?void 0:V.style))return[B.ensureInstance(je.YS.patternOutlineFill,{geometry:{visualVariableColor:T.visualVariableColor,visualVariableOpacity:T.visualVariableOpacity,visualVariableSizeScaleStops:T.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:q,...w(p.outline,!!T.visualVariableSizeOutlineScaleStops),sprite:D,scaleInfo:null,effects:null}})];const J=[],j=B.ensureInstance(je.YS.patternFill,{geometry:{visualVariableColor:T.visualVariableColor,visualVariableOpacity:T.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:null!==(E=null===(F=p.color)||void 0===F?void 0:F.toArray())&&void 0!==E?E:[0,0,0,0],sprite:D,scaleInfo:null,effects:null}});return J.push(j),p.outline&&J.push(...U(p.outline,b,!0)),J}(p,b):function L(p,b){var _,S,V;const{uniforms:E,schemaOptions:F}=b,{store:T}=F,N=null!==(_=null===(S=p.color)||void 0===S?void 0:S.toArray())&&void 0!==_?_:[0,0,0,0];if("none"!==p.style&&"solid"===(null===(V=p.outline)||void 0===V?void 0:V.style))return[T.ensureInstance(je.YS.outlineFill,{geometry:{visualVariableColor:E.visualVariableColor,visualVariableOpacity:E.visualVariableOpacity,visualVariableSizeScaleStops:E.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:N,...w(p.outline,!!E.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null}})];const B=[];if("none"!==p.style){const p=T.ensureInstance(je.YS.fill,{geometry:{visualVariableColor:E.visualVariableColor,visualVariableOpacity:E.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:N,scaleInfo:null,effects:null}});B.push(p)}return p.outline&&B.push(...U(p.outline,b,!0)),B}(p,b)}function U(p,b,_){var S;const{color:V,style:E,width:F,cap:T,join:N}=p,{schemaOptions:B}=b,{store:q}=B,D=[],J=_?{...Qe.Dk,visualVariableSizeScaleStops:b.uniforms.visualVariableSizeOutlineScaleStops}:b.uniforms,j={geometry:{visualVariableColor:J.visualVariableColor,visualVariableOpacity:J.visualVariableOpacity,visualVariableSizeMinMaxValue:J.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:J.visualVariableSizeScaleStops,visualVariableSizeStops:J.visualVariableSizeStops,visualVariableSizeUnitValue:J.visualVariableSizeUnitValue}},H={color:null!==(S=null===V||void 0===V?void 0:V.toArray())&&void 0!==S?S:[0,0,0,0],width:F,referenceWidth:F,capType:T,joinType:N,miterLimit:p.miterLimit,hasSizeVV:(0,Ge.IY)(J),effects:null,scaleInfo:null};if(null==E||"solid"===E){const p=q.ensureInstance(je.YS.line,j,{zoomRange:!1}).createMeshInfo({params:H});D.push(p)}else if("none"!==E){const p=q.ensureInstance(je.YS.texturedLine,j,{zoomRange:!1}).createMeshInfo({params:{...H,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:(0,Be.BW)(E,T),capStyle:(0,Be.ni)(T)},overrides:[]}}});D.push(p)}return null!=p.marker&&D.push(...function C(p,b,_){var S,V,E,F;const{uniforms:T,schemaOptions:N}=_,{store:B}=N,q=B.ensureInstance(je.YS.marker,{geometry:{visualVariableColor:T.visualVariableColor,visualVariableOpacity:T.visualVariableOpacity,visualVariableSizeMinMaxValue:T.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:T.visualVariableSizeScaleStops,visualVariableSizeStops:T.visualVariableSizeStops,visualVariableSizeUnitValue:T.visualVariableSizeUnitValue,visualVariableRotation:T.visualVariableRotation}},{zoomRange:!1}),D=g(p),J=6*b.width,j=J,H=null!==(S=null!==(V=null===(E=p.color)||void 0===E?void 0:E.toArray())&&void 0!==V?V:null===(F=b.color)||void 0===F?void 0:F.toArray())&&void 0!==S?S:[0,0,0,0],Q="cross"===p.style||"x"===p.style;let G;switch(p.placement){case"begin-end":G=qe.$2.Both;break;case"begin":G=qe.$2.JustBegin;break;case"end":G=qe.$2.JustEnd;break;default:G=qe.$2.None}const K={type:"cim-marker-placement-info",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:G,offsetAlongLine:0},overrides:[]};return[q.createMeshInfo({params:{type:"simple",color:H,height:j,width:J,offsetX:0,offsetY:0,angle:0,outlineColor:H,outlineSize:Q?b.width:0,referenceSize:j/6,sprite:D,overrideOutlineColor:Q&&null!=T.visualVariableColor,hasSizeVV:(0,Ge.IY)(T),placement:K,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:(0,Qe.j0)(T)}})]}(p.marker,p,b)),D}async function LabelMatcherSchema_l(p,b,_){const S=b.labelsVisible&&b.labelingInfo||[],V=geometryUtils_e(b),E=(0,Le.z)(S,V);return{type:"label",classes:await Promise.all(E.map(((b,S)=>async function LabelMatcherSchema_o(p,b,_,S){var V,E;const F=await v(b,{path:"".concat(_),schemaOptions:p,uniforms:S});return{maxScale:b.maxScale,minScale:b.minScale,expression:null!==(V=null===(E=b.labelExpressionInfo)||void 0===E?void 0:E.expression)&&void 0!==V?V:b.labelExpression,where:b.where,meshes:F}}(p,b,S,_))))}}async function MatcherSchema_r(p,b){if(!b)return{type:"simple",meshes:[]};switch(b.type){case"simple":return async function MatcherSchema_o(p,b){const _=b.getSymbols(),S=_.length?_[0]:null,V=(0,Qe.K4)(b),E="renderer.symbol";return{type:"simple",meshes:await v(S,{schemaOptions:p,uniforms:V,path:E})}}(p,b);case"dot-density":return async function MatcherSchema_u(p,b){const _=(0,Qe.K4)(b),S="renderer.symbol";return{type:"dot-density",meshes:await h(b,{schemaOptions:p,uniforms:_,path:S})}}(p,b);case"class-breaks":return async function MatcherSchema_m(p,b){const _=(0,Qe.K4)(b),S=b.backgroundFillSymbol,V=b.normalizationType,E="log"===V?"esriNormalizeByLog":"percent-of-total"===V?"esriNormalizeByPercentOfTotal":"field"===V?"esriNormalizeByField":null,F=b.classBreakInfos.map((async b=>({meshes:await v(b.symbol,{path:"renderer-stop-".concat(b.minValue,"-").concat(b.maxValue),schemaOptions:p,uniforms:_}),min:b.minValue,max:b.maxValue}))),T=(await Promise.all(F)).sort(((p,b)=>p.min-b.min)),N=await v(S,{schemaOptions:p,path:"renderer.backgroundFill",uniforms:{...Qe.Dk,visualVariableSizeOutlineScaleStops:_.visualVariableSizeOutlineScaleStops}}),B=await v(b.defaultSymbol,{schemaOptions:p,path:"renderer.defaultSymbol",uniforms:_});return{type:"interval",field:b.field,expression:b.valueExpression,backgroundFill:N,defaultSymbol:B,intervals:T,normalizationField:b.normalizationField,normalizationTotal:b.normalizationTotal,normalizationType:E,isMaxInclusive:b.isMaxInclusive}}(p,b);case"unique-value":return async function MatcherSchema_c(p,b){const _=[],S=(0,Qe.K4)(b),V=await v(b.backgroundFillSymbol,{schemaOptions:p,path:"renderer.backgroundFill",uniforms:{...Qe.Dk,visualVariableSizeOutlineScaleStops:S.visualVariableSizeOutlineScaleStops}}),E=await v(b.defaultSymbol,{schemaOptions:p,path:"renderer.defaultSymbol",uniforms:S});for(const T of null!==(F=b.uniqueValueInfos)&&void 0!==F?F:[]){var F;const b=await v(T.symbol,{path:"renderer-unique-value-".concat(T.value),schemaOptions:p,uniforms:S});_.push({value:""+T.value,symbol:b})}return{type:"map",field:b.field,expression:b.valueExpression,field2:b.field2,field3:b.field3,fieldDelimiter:b.fieldDelimiter,backgroundFill:V,defaultSymbol:E,map:_}}(p,b);case"dictionary":return function MatcherSchema_p(p){const b=(0,Qe.K4)(p),_=p.scaleExpression,S=null!=_&&"1"!==_?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:p.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",fieldMap:p.fieldMap,scaleExpression:S,visualVariableUniforms:b}}(b);case"heatmap":return async function f(p,b){return{type:"heatmap",meshes:await z(b,p)}}(p,b);case"pie-chart":return async function y(p,b){return{type:"pie-chart",meshes:d(b,p)}}(p,b)}}var Ye=_(97930);async function SimpleProcessorSchema_l(p,b){const _=b.renderer,S=(0,Qe.K4)(_);return{symbology:await MatcherSchema_r(p,_),labels:await LabelMatcherSchema_l(p,b,S)}}async function SimpleProcessorSchema_a(p,b,_,S){const V=_.featureReduction;if(V)switch(V.type){case"binning":return async function SimpleProcessorSchema_u(p,b,_,S,V){const E=SimpleProcessorSchema_o(p,S.fields),F=p.renderer,T=await MatcherSchema_r(b,F),N=(0,Ye.T9)(F,[null,null]),B=(0,Qe.K4)(F),q=await LabelMatcherSchema_l(b,{geometryType:"polygon",labelingInfo:p.labelingInfo,labelsVisible:p.labelsVisible},B);return{storage:N,mesh:{displayRefreshVersion:V,strategy:{type:"binning",fields:E,fixedBinLevel:p.fixedBinLevel,featureFilter:_.filters[0]},factory:{labels:q,symbology:T},sortKey:null,timeZone:_.timeZone}}}(V,p,b,_,S);case"cluster":return async function SimpleProcessorSchema_f(p,b,_,S,V){const E=SimpleProcessorSchema_o(p,S.fields),F={type:"cluster",feature:await MatcherSchema_r(b,p.effectiveFeatureRenderer),cluster:await MatcherSchema_r(b,p.effectiveClusterRenderer)},T=(0,Qe.K4)(p.effectiveFeatureRenderer),N={type:"cluster",feature:await LabelMatcherSchema_l(b,S,T),cluster:await LabelMatcherSchema_l(b,{geometryType:"point",labelingInfo:p.labelingInfo,labelsVisible:p.labelsVisible},T)};return{storage:(0,Ye.T9)(p.effectiveFeatureRenderer,[null,null]),mesh:{displayRefreshVersion:V,strategy:{type:"cluster",fields:E,featureFilter:_.filters[0],clusterRadius:(0,Te.Lz)(p.clusterRadius/2)},factory:{labels:N,symbology:F},sortKey:null,timeZone:_.timeZone}}}(V,p,b,_,S)}const E=function SimpleProcessorSchema_d(p,b,_){const S=null!=b&&"unique-value"===b.type&&b.orderByClassesEnabled;if("default"!==p||S||(p=[new ke.A({field:_,order:"descending"})]),"default"!==p&&p.length){p.length;const b=p[0],_="ascending"===b.order?"asc":"desc";return b.field?{field:b.field,order:_}:b.valueExpression?{expression:b.valueExpression,order:_}:null}if(S)return{byRenderer:!0,order:"asc"};return null}(_.orderBy,_.renderer,_.objectIdField);return{storage:(0,Ye.T9)(_.renderer,b.filters),mesh:{displayRefreshVersion:S,strategy:{type:"feature"},factory:await SimpleProcessorSchema_l(p,_),sortKey:E,timeZone:b.timeZone}}}function SimpleProcessorSchema_o(p,b){return p.fields.map((p=>({...p.toJSON(),type:SimpleProcessorSchema_c(p,b)})))}function SimpleProcessorSchema_c(p,b){const{onStatisticExpression:_,onStatisticField:S,statisticType:V}=p;switch(V){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(_){const{returnType:p}=_;return p?"string"===p?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const p=b.find((p=>p.name===S));return p?p.type:"esriFieldTypeString"}}}var We=_(60679);class CatalogFootprintLayerAdapter_d{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){const b=this.layer,_=labelingUtils_l(b);return[{vvEvaluators:{0:labelingUtils_o(b.renderer)},deconflictionEnabled:_}]}async createServiceOptions(p){var b,_;const S=this.layer,V=S.parent,E=(0,ae.BR)(V),{capabilities:F,editingInfo:T,objectIdField:N,globalIdField:B,datesInUnknownTimezone:q,orderBy:D,subtypeField:J,parsedUrl:j}=V,H=V.fieldsIndex.toJSON(),Q=geometryUtils_e(S),G=null===(b=V.timeInfo)||void 0===b?void 0:b.toJSON(),K=S.spatialReference.toJSON(),Y=(0,Fe.o8)(j);let $=N;if(null!==D&&void 0!==D&&D.length){const p=!D[0].valueExpression&&D[0].field;p&&($=p)}return{type:"feature-service",source:Y,isSourceHosted:(0,Me.Wo)(Y.path),orderByFields:$,metadata:{timeReferenceUnknownClient:q,subtypeField:J,globalIdField:B,fieldsIndex:H,geometryType:Q,objectIdField:N,timeInfo:G,spatialReference:K,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:F,effectiveCapabilities:E,lastEditDate:null===T||void 0===T||null===(_=T.lastEditDate)||void 0===_?void 0:_.getTime(),snapshotInfo:null}}}createSourceSchema(p,b,_){const{definitionExpression:S,customParameters:V,timeExtent:E,apiKey:F}=this.layer.parent;return SourceSchema_t(p,{definitionExpression:S,customParameters:V,timeExtent:E},b,_,F)}createProcessorSchema(p,b,_){const{parent:{fields:S,geometryType:V,orderBy:E,objectIdField:F},renderer:T,labelingInfo:N,labelsVisible:B}=this.layer,q={featureReduction:null,fields:S.map((p=>p.toJSON())),geometryType:V,labelingInfo:N,labelsVisible:B,objectIdField:F,orderBy:null!==E&&void 0!==E?E:"default",renderer:null===T||void 0===T?void 0:T.clone()};return SimpleProcessorSchema_a(p,b,q,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}getUpdateHashProperties(p){const b=this.layer,{parent:_,parent:{definitionExpression:S,apiKey:V},renderer:E}=b,F=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:V,customParameters:JSON.stringify(_.customParameters),definitionExpression:S,labelingInfo:F,orderBy:JSON.stringify(_.orderBy),renderer:E}}setGraphicOrigin(p){p.origin={type:"catalog",layer:this.layer}}}function featureServiceUtils_t(p,b){const _=p.extent,S=null===b||void 0===b?void 0:b.clone().intersection(_),V=null!=S?S.width*S.height:0,E=b?b.width*b.height:0,T=0===E?0:V/E,N=(0,F.A)("featurelayer-snapshot-point-coverage");return!isNaN(T)&&T>=N}function floorFilterUtils_o(p,b){return null!=p.floorInfo&&(p.floorInfo.viewAllLevelIds.length>0||b.floors.length>0)}function floorFilterUtils_r(p,b,_){var S,V;const E=function floorFilterUtils_n(p,b,_){var S,V;if(null==p.floorInfo||null===(S=_.floors)||void 0===S||!S.length)return b;let E=_.floors;const{floorField:F,viewAllLevelIds:T}=p.floorInfo;T.length&&(E=T);const N=E.filter((p=>""!==p)).map((p=>"'"+p+"'"));if(N.push("''"),null!==(V=b)&&void 0!==V&&V.includes(F)){let p=new RegExp("AND \\("+F+".*NULL\\)","g");b=b.replace(p,""),p=new RegExp("\\("+F+".*NULL\\)","g"),b=(b=b.replace(p,"")).replaceAll(/\s+/g," ").trim()}let B="("+F+" IN ({ids}) OR "+F+" IS NULL)";return B=B.replace("{ids}",N.join(", ")),(0,Pe.m)(b,B)}(p,null===(S=b)||void 0===S?void 0:S.where,_);return E?(null!==(V=b)&&void 0!==V||(b=new re.A),b.where=E,b):b}class FeatureLayerAdapter_u{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){var b;const _=this.layer,S=null!==(b=labelingUtils_r(_,p))&&void 0!==b?b:labelingUtils_l(_);return[{vvEvaluators:{0:labelingUtils_o(_.renderer)},deconflictionEnabled:S}]}async createServiceOptions(p){var b,_,S,V;const E=this.layer,T=(0,ae.BR)(E),{capabilities:N,editingInfo:B,objectIdField:q,typeIdField:D,globalIdField:J,datesInUnknownTimezone:j,orderBy:H,subtypeField:Q,refreshInterval:G}=E,K=E.fieldsIndex.toJSON(),Y=K.fields,$=geometryUtils_e(E),X=null===(b=E.timeInfo)||void 0===b?void 0:b.toJSON(),ee=E.spatialReference.toJSON(),te=null===(_=E.types)||void 0===_?void 0:_.map((p=>p.toJSON())),ie=(0,Fe.o8)(this.layer.parsedUrl);this.layer.dynamicDataSource&&(ie.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let re=this.layer.objectIdField;if(null!==H&&void 0!==H&&H.length){const p=!H[0].valueExpression&&H[0].field;p&&(re=p)}const se=!(null!=(null===B||void 0===B?void 0:B.lastEditDate))&&G>0,ne=(0,F.A)("featurelayer-snapshot-enabled")&&"point"===E.geometryType&&(null===N||void 0===N?void 0:N.query.supportsPagination)&&!(null!==N&&void 0!==N&&N.operations.supportsEditing)&&!se,le=ne&&featureServiceUtils_t(p,E.fullExtent);return{type:"feature-service",source:ie,isSourceHosted:(0,Me.Wo)(ie.path),orderByFields:re,metadata:{typeIdField:null!==D&&void 0!==D?D:void 0,types:te,timeReferenceUnknownClient:j,subtypeField:Q,globalIdField:J,fields:Y,fieldsIndex:K,geometryType:$,objectIdField:q,timeInfo:X,spatialReference:ee,subtypes:null===(S=this.layer.subtypes)||void 0===S?void 0:S.map((p=>p.toJSON()))},queryMetadata:{capabilities:N,effectiveCapabilities:T,lastEditDate:null===B||void 0===B||null===(V=B.lastEditDate)||void 0===V?void 0:V.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:ne,supportsSnapshotMaxThreshold:le,snapshotCountThresholds:{min:(0,F.A)("featurelayer-snapshot-point-min-threshold"),max:(0,F.A)("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(p,b,_){const{definitionExpression:S,customParameters:V,gdbVersion:E,historicMoment:F,subtypeCode:T,subtypeField:N,timeExtent:B,apiKey:q}=this.layer;return SourceSchema_t(p,{definitionExpression:S,customParameters:V,gdbVersion:E,historicMoment:F,subtypeCode:T,subtypeField:N,timeExtent:B},b,_,q)}createProcessorSchema(p,b,_){const{fields:S,renderer:V,geometryType:E,labelingInfo:F,labelsVisible:T,orderBy:N,objectIdField:B}=this.layer,q={fields:S.map((p=>p.toJSON())),renderer:null===V||void 0===V?void 0:V.clone(),featureReduction:featureReductionUtils_e(this.layer,b),geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:B,orderBy:null!==N&&void 0!==N?N:"default"};return SimpleProcessorSchema_a(p,b,q,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}hasFilters(p){return floorFilterUtils_o(this.layer,p)}addFilters(p,b){return floorFilterUtils_r(this.layer,p,b)}getUpdateHashProperties(p){var b,_,S;const V=this.layer,{definitionExpression:E,renderer:F,gdbVersion:T,apiKey:N,subtypeCode:B}=V,q=this.layer.labelsVisible?this.layer.labelingInfo:null,D=null!==(b=null===(_=V.historicMoment)||void 0===_?void 0:_.getTime())&&void 0!==b?b:void 0,J=JSON.stringify(V.customParameters),j=null===(S=featureReductionUtils_e(V,p))||void 0===S?void 0:S.toJSON(),H=JSON.stringify(V.orderBy);return{apiKey:N,customParameters:J,definitionExpression:E,featureReduction:j,floors:floorFilterUtils_o(this.layer,p)?p.floors:null,gdbVersion:T,historicMoment:D,labelingInfo:q,orderBy:H,renderer:F,subtypeCode:B}}}class InMemoryLayerAdapter_p{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){var b;const _=this.layer,S=null!==(b=labelingUtils_r(_,p))&&void 0!==b?b:labelingUtils_l(_);return[{vvEvaluators:{0:labelingUtils_o(_.renderer)},deconflictionEnabled:S}]}async createServiceOptions(p){var b;const _=this.layer,S=(0,ae.BR)(_),{capabilities:V,objectIdField:E}=_,F=_.fieldsIndex.toJSON(),T=geometryUtils_e(_),N=null===(b=_.timeInfo)||void 0===b?void 0:b.toJSON(),B=_.spatialReference.toJSON();return function InMemoryLayerAdapter_d(p){if(!("openPorts"in p))throw new H.A("source-not-supported")}(_.source),{type:"memory",source:await _.source.openPorts(),orderByFields:E,metadata:{fieldsIndex:F,geometryType:T,objectIdField:E,timeInfo:N,spatialReference:B,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{capabilities:V,effectiveCapabilities:S,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(p,b,_){const{definitionExpression:S,timeExtent:V}=this.layer;return SourceSchema_t(p,{definitionExpression:S,timeExtent:V,customParameters:null},b,_,null)}createProcessorSchema(p,b,_){const{fields:S,renderer:V,geometryType:E,labelingInfo:F,labelsVisible:T,orderBy:N,objectIdField:B}=this.layer,q={fields:S.map((p=>p.toJSON())),renderer:null===V||void 0===V?void 0:V.clone(),featureReduction:featureReductionUtils_e(this.layer,b),geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:B,orderBy:null!==N&&void 0!==N?N:"default"};return SimpleProcessorSchema_a(p,b,q,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}getUpdateHashProperties(p){var b;const _=this.layer,{definitionExpression:S,renderer:V}=_,E=this.layer.labelsVisible?this.layer.labelingInfo:null,F=null===(b=featureReductionUtils_e(_,p))||void 0===b?void 0:b.toJSON();return{orderBy:JSON.stringify(_.orderBy),definitionExpression:S,renderer:V,labelingInfo:E,featureReduction:F}}}class KnowledgeGraphSublayerAdapter_c{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){var b;const _=this.layer,S=null!==(b=labelingUtils_r(_,p))&&void 0!==b?b:labelingUtils_l(_);return[{vvEvaluators:{0:labelingUtils_o(_.renderer)},deconflictionEnabled:S}]}async createServiceOptions(p){const b=this.layer,_=(0,ae.BR)(b),{capabilities:S,objectIdField:V}=b,E=b.fieldsIndex.toJSON(),F=geometryUtils_e(b),T=b.spatialReference.toJSON();return{type:"memory",source:await b.source.openPorts(),orderByFields:V,metadata:{fieldsIndex:E,geometryType:F,objectIdField:V,spatialReference:T,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:S,effectiveCapabilities:_,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(p,b,_){const{definitionExpression:S}=this.layer;return SourceSchema_t(p,{definitionExpression:S,customParameters:null},b,_,null)}createProcessorSchema(p,b,_){const{fields:S,renderer:V,geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:N}=this.layer,B={fields:S.map((p=>p.toJSON())),renderer:null===V||void 0===V?void 0:V.clone(),featureReduction:featureReductionUtils_e(this.layer,b),geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:N,orderBy:"default"};return SimpleProcessorSchema_a(p,b,B,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}getUpdateHashProperties(p){var b;const _=this.layer,{definitionExpression:S,renderer:V}=_;return{definitionExpression:S,renderer:V,labelingInfo:this.layer.labelsVisible?this.layer.labelingInfo:null,featureReduction:null===(b=featureReductionUtils_e(_,p))||void 0===b?void 0:b.toJSON()}}}class OGCFeatureLayerAdapter_d{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){var b;const _=this.layer,S=null!==(b=labelingUtils_r(_,p))&&void 0!==b?b:labelingUtils_l(_);return[{vvEvaluators:{0:labelingUtils_o(_.renderer)},deconflictionEnabled:S}]}async createServiceOptions(p){var b;const _=this.layer,S=(0,ae.BR)(_),{capabilities:V,objectIdField:E}=_,F=_.fieldsIndex.toJSON(),T=geometryUtils_e(_),N=null===(b=_.timeInfo)||void 0===b?void 0:b.toJSON(),B=_.spatialReference.toJSON(),q=_.source.getSource(),D=this.layer.objectIdField,J=(0,Fe.o8)(V);return J.query.maxRecordCount=q.maxRecordCount,{type:"ogc",source:q,orderByFields:D,metadata:{fieldsIndex:F,geometryType:T,objectIdField:E,timeInfo:N,spatialReference:B,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:J,effectiveCapabilities:S,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(p,b,_){const{customParameters:S,timeExtent:V,apiKey:E}=this.layer;return SourceSchema_t(p,{customParameters:S,timeExtent:V},b,_,E)}createProcessorSchema(p,b,_){const{fields:S,renderer:V,geometryType:E,labelingInfo:F,labelsVisible:T,orderBy:N,objectIdField:B}=this.layer,q={fields:S.map((p=>p.toJSON())),renderer:null===V||void 0===V?void 0:V.clone(),featureReduction:featureReductionUtils_e(this.layer,b),geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:B,orderBy:null!==N&&void 0!==N?N:"default"};return SimpleProcessorSchema_a(p,b,q,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}getUpdateHashProperties(p){var b;const _=this.layer,{renderer:S,apiKey:V}=_,E=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:V,customParameters:JSON.stringify(_.customParameters),featureReduction:null===(b=featureReductionUtils_e(_,p))||void 0===b?void 0:b.toJSON(),labelingInfo:E,orderBy:JSON.stringify(_.orderBy),renderer:S}}}class OrientedImageryLayerAdapter_u{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){var b;const _=this.layer,S=null!==(b=labelingUtils_r(_,p))&&void 0!==b?b:labelingUtils_l(_);return[{vvEvaluators:{0:labelingUtils_o(_.renderer)},deconflictionEnabled:S}]}async createServiceOptions(p){var b;const _=this.layer,S=(0,ae.BR)(_),{capabilities:V,objectIdField:E,globalIdField:T,orderBy:N,refreshInterval:B}=_,q=_.fieldsIndex.toJSON(),D=q.fields,J=geometryUtils_e(_),j=null===(b=_.timeInfo)||void 0===b?void 0:b.toJSON(),H=_.spatialReference.toJSON(),Q=(0,Fe.o8)(this.layer.parsedUrl);let G=this.layer.objectIdField;if(null!==N&&void 0!==N&&N.length){const p=!N[0].valueExpression&&N[0].field;p&&(G=p)}const K=B>0,Y=(0,F.A)("featurelayer-snapshot-enabled")&&"point"===_.geometryType&&(null===V||void 0===V?void 0:V.query.supportsPagination)&&!(null!==V&&void 0!==V&&V.operations.supportsEditing)&&!K,$=Y&&featureServiceUtils_t(p,_.fullExtent);return{type:"feature-service",source:Q,isSourceHosted:(0,Me.Wo)(Q.path),orderByFields:G,metadata:{globalIdField:T,fields:D,fieldsIndex:q,geometryType:J,objectIdField:E,timeInfo:j,spatialReference:H,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:V,effectiveCapabilities:S,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:Y,supportsSnapshotMaxThreshold:$,snapshotCountThresholds:{min:(0,F.A)("featurelayer-snapshot-point-min-threshold"),max:(0,F.A)("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(p,b,_){const{definitionExpression:S,customParameters:V,timeExtent:E}=this.layer;return SourceSchema_t(p,{definitionExpression:S,customParameters:V,timeExtent:E},b,_,null)}createProcessorSchema(p,b,_){const{fields:S,renderer:V,geometryType:E,labelingInfo:F,labelsVisible:T,orderBy:N,objectIdField:B}=this.layer,q={fields:S.map((p=>p.toJSON())),renderer:null===V||void 0===V?void 0:V.clone(),featureReduction:featureReductionUtils_e(this.layer,b),geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:B,orderBy:null!==N&&void 0!==N?N:"default"};return SimpleProcessorSchema_a(p,b,q,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}hasFilters(p){return floorFilterUtils_o(this.layer,p)}addFilters(p,b){return floorFilterUtils_r(this.layer,p,b)}getUpdateHashProperties(p){var b;const _=this.layer,{definitionExpression:S,renderer:V}=_,E=this.layer.labelsVisible?this.layer.labelingInfo:null,F=JSON.stringify(_.customParameters),T=null===(b=featureReductionUtils_e(_,p))||void 0===b?void 0:b.toJSON();return{orderBy:JSON.stringify(_.orderBy),definitionExpression:S,renderer:V,labelingInfo:E,featureReduction:T,customParameters:F,floors:floorFilterUtils_o(this.layer,p)?p.floors:null}}}class StreamLayerAdapter_s{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){var b;const _=this.layer,S=null!==(b=labelingUtils_r(_,p))&&void 0!==b?b:labelingUtils_l(_);return[{vvEvaluators:{0:labelingUtils_o(_.renderer)},deconflictionEnabled:S}]}async createServiceOptions(p){var b;const _=this.layer,{objectIdField:S}=_,V=geometryUtils_e(_),E=(null===(b=_.timeInfo)||void 0===b?void 0:b.toJSON())||null,F=_.spatialReference?_.spatialReference.toJSON():null;return{source:this.layer.parsedUrl,metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:V,objectIdField:S,timeInfo:E,timeReferenceUnknownClient:null,spatialReference:F,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(p,b,_){const{definitionExpression:S,geometryDefinition:V,customParameters:E}=this.layer;return{type:"stream",service:p,tileInfoJSON:b.tileInfoJSON,mutable:{sourceRefreshVersion:_,availableFields:b.availableFields,dataFilter:{geometryDefinition:null===V||void 0===V?void 0:V.toJSON(),definitionExpression:S,outSpatialReference:b.outSpatialReference.toJSON(),customParameters:null!==E&&void 0!==E?E:null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(p,b,_){const{fields:S,renderer:V,geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:N}=this.layer,B={fields:S.map((p=>p.toJSON())),renderer:null===V||void 0===V?void 0:V.clone(),featureReduction:featureReductionUtils_e(this.layer,b),geometryType:E,labelingInfo:F,labelsVisible:T,objectIdField:N,orderBy:"default"};return SimpleProcessorSchema_a(p,b,B,_)}get hasRequiredSupport(){return(0,We.e)(this.layer.renderer)}getUpdateHashProperties(p){var b;const _=this.layer,{definitionExpression:S,renderer:V}=_,E=this.layer.labelsVisible?this.layer.labelingInfo:null,F=JSON.stringify(_.customParameters);return{definitionExpression:S,renderer:V,labelingInfo:E,featureReduction:null===(b=featureReductionUtils_e(_,p))||void 0===b?void 0:b.toJSON(),customParameters:F,streamFilter:"".concat(JSON.stringify(_.geometryDefinition)).concat(_.definitionExpression)}}}var $e=_(35965);async function SubtypeProcessorSchema_i(p,b){let{subtypeField:_,sublayers:S}=b;const V=await Promise.all(S.map((b=>{let{renderer:_}=b;return MatcherSchema_r(p,_)})));return{type:"subtype",subtypeField:_,renderers:S.reduce(((p,b,_)=>{let{subtypeCode:S}=b;return{...p,[S]:V[_]}}),{})}}function SubtypeProcessorSchema_o(p,b){const _=(0,$e.C)();return{type:"subtype",filters:p.filters,capabilities:{maxTextureSize:_.maxTextureSize},subtypeField:b.subtypeField,target:"feature",bindings:b.sublayers.reduce(((p,b)=>{let{renderer:_,subtypeCode:S}=b;return{...p,[S]:(0,Ye.Jz)(_)}}),{})}}async function SubtypeProcessorSchema_u(p,b){let{subtypeField:_,sublayers:S}=b;const V=await Promise.all(S.map((b=>{var _;const S=(0,Qe.K4)(b.renderer),V={...b,geometryType:null!==(_=b.geometryType)&&void 0!==_?_:null};return LabelMatcherSchema_l(p,V,S)})));return{type:"subtype",subtypeField:_,renderers:S.reduce(((p,b,_)=>{let{subtypeCode:S}=b;return{...p,[S]:V[_]}}),{})}}class SubtypeGroupLayerAdapter_c{constructor(p){this.layer=p}getLabelingDeconflictionInfo(p){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every((p=>labelingUtils_l(p)))}]}async createServiceOptions(p){var b,_,S;const V=this.layer,E=(0,ae.BR)(V),{capabilities:T,datesInUnknownTimezone:N,editingInfo:B,globalIdField:q,objectIdField:D,refreshInterval:J,subtypeField:j}=V,H=V.fieldsIndex.toJSON(),Q=geometryUtils_e(V),G=null===(b=V.timeInfo)||void 0===b?void 0:b.toJSON(),K=V.spatialReference.toJSON(),Y=(0,Fe.o8)(this.layer.parsedUrl),$=D,X=!(null!=(null===B||void 0===B?void 0:B.lastEditDate))&&J>0,ee=(0,F.A)("featurelayer-snapshot-enabled")&&"point"===V.geometryType&&(null===T||void 0===T?void 0:T.query.supportsPagination)&&!(null!==T&&void 0!==T&&T.operations.supportsEditing)&&!X,te=ee&&featureServiceUtils_t(p,V.fullExtent);return{type:"feature-service",source:Y,isSourceHosted:(0,Me.Wo)(Y.path),orderByFields:$,metadata:{timeReferenceUnknownClient:N,subtypeField:j,globalIdField:q,fieldsIndex:H,geometryType:Q,objectIdField:D,timeInfo:G,spatialReference:K,subtypes:null===(_=this.layer.subtypes)||void 0===_?void 0:_.map((p=>p.toJSON())),typeIdField:null,types:null},queryMetadata:{capabilities:T,effectiveCapabilities:E,lastEditDate:null===B||void 0===B||null===(S=B.lastEditDate)||void 0===S?void 0:S.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:ee,supportsSnapshotMaxThreshold:te,snapshotCountThresholds:{min:(0,F.A)("featurelayer-snapshot-point-min-threshold"),max:(0,F.A)("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(p,b,_){const{definitionExpression:S,customParameters:V,gdbVersion:E,historicMoment:F,subtypeField:T,timeExtent:N,apiKey:B}=this.layer,q=this.layer.sublayers.map((p=>p.subtypeCode)).join(","),D=this.layer.sublayers.length?"".concat(this.layer.subtypeField," IN (").concat(q,")"):"1=2";return SourceSchema_t(p,{definitionExpression:(0,Pe.m)(S,D),customParameters:V,gdbVersion:E,historicMoment:F,subtypeField:T,timeExtent:N},b,_,B)}createProcessorSchema(p,b,_){const S={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,(p=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:p.labelingInfo,labelsVisible:p.labelsVisible,renderer:p.renderer,subtypeCode:p.subtypeCode,orderBy:null})))};return async function SubtypeProcessorSchema_n(p,b,_,S){return{storage:SubtypeProcessorSchema_o(b,_),mesh:{displayRefreshVersion:S,strategy:{type:"feature"},factory:{symbology:await SubtypeProcessorSchema_i(p,_),labels:await SubtypeProcessorSchema_u(p,_)},sortKey:null,timeZone:b.timeZone}}}(p,b,S,_)}hasFilters(p){return floorFilterUtils_o(this.layer,p)||function SubtypeGroupLayerAdapter_d(p,b){return p.sublayers.some((p=>!SubtypeGroupLayerAdapter_h(p,b)))}(this.layer,p)}addFilters(p,b){var _;p=floorFilterUtils_r(this.layer,p,b);const S=this.layer.sublayers.filter((p=>!SubtypeGroupLayerAdapter_h(p,b))).map((p=>p.subtypeCode));if(!S.length)return p;null!==(_=p)&&void 0!==_||(p=new re.A);const V="NOT ".concat(this.layer.subtypeField," IN (").concat(S.join(","),")");return p.where=(0,Pe.m)(p.where,V),p}get hasRequiredSupport(){return!0}getUpdateHashProperties(p){var b,_;const S=this.layer,{definitionExpression:V,gdbVersion:E,apiKey:F}=S,T=null!==(b=null===(_=S.historicMoment)||void 0===_?void 0:_.getTime())&&void 0!==b?b:void 0,N=JSON.stringify(S.customParameters),B=floorFilterUtils_o(this.layer,p)?p.floors:null;return{gdbVersion:E,definitionExpression:V,historicMoment:T,customParameters:N,apiKey:F,sublayerHash:"sublayers"in this.layer&&this.layer.sublayers.items.reduce(((p,b)=>p+"".concat(b.visible?1:0,".").concat(JSON.stringify(b.renderer),".").concat(b.labelsVisible,"\n.").concat(JSON.stringify(b.labelingInfo))),""),floors:B}}setGraphicOrigin(p){const b=this.layer.fieldsIndex.get(this.layer.subtypeField),_=p.attributes[b.name],S=this.layer.sublayers.find((p=>p.subtypeCode===_));p.layer=p.sourceLayer=S}}function SubtypeGroupLayerAdapter_h(p,b){return p.visible&&(0===p.minScale||(0,ze.Sp)(b.scale,p.minScale)||b.scale<p.minScale)&&(0===p.maxScale||(0,ze.Sp)(b.scale,p.maxScale)||b.scale>p.maxScale)}var Xe=_(5993),et=_(57283);function e(p,b){const _=new Set;for(const S of p instanceof Set?p.values():p.keys())b.has(S)||_.add(S);return _}class FeatureTileSubscriptionManager_i{constructor(p){this.version=p}}class FeatureTileSubscriptionManager_t{constructor(p){this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=p}destroy(){}get _coverageSet(){const p=this._coverage?Array.from(this._coverage.keys()).map((p=>p.id)):[];return new Set(p)}suspend(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(p){return this._version=this._version+1%Number.MAX_SAFE_INTEGER,this._updateCoverage(p),this._updateSubscriptions(),new Set(this._visible)}_updateCoverage(p){this._coverage=this._config.tileInfoView.getTileCoverage(p.state,0,!0,"closest")}_updateSubscriptions(){const p=this._coverageSet,b=this._updateVisibility(),_=e(b,p),S=e(this._subscriptions,b),V=e(p,this._subscriptions),E=e(S,p),F=e(_,E),T=e(F,this._paused);this._visible=b;for(const N of V.values())this._subscriptions.set(N,new FeatureTileSubscriptionManager_i(this._version));for(const N of T.values())this._paused.add(N);for(const N of E.values())this._subscriptions.delete(N),this._paused.delete(N);(V.size||E.size||T.size)&&this._sendUpdateSubscriptions(V,E,T)}_sendUpdateSubscriptions(p,b,_){const S=Array.from(p.values()).map((p=>({tileId:p,version:this._subscriptions.get(p).version})));this._config.updateSubscriptions({subscribe:S,unsubscribe:Array.from(b.values()),pause:Array.from(_.values()),tileInfoJSON:this._config.tileInfoView.tileInfo.toJSON()})}_updateVisibility(){const p=new Set;if(!this._coverage)return p;for(const b of this._coverage.keys())this._config.isDone(b)?p.add(b.id):this._addVisibleParent(p,b)||this._addVisibleChildren(p,b)||p.add(b.id);return p}_addVisibleParent(p,b){let _=!1;for(const S of this._visible.values())new Se.A(S).containsChild(b)&&(p.add(S),_=!0);return _}_addVisibleChildren(p,b){let _=!1;for(const S of this._visible.values()){const V=new Se.A(S);b.containsChild(V)&&(p.add(S),_=!0)}return _}}var tt=_(67612),it=_(27012),rt=_(59995),st=_(84661);const at=4294967294;async function Z(p,b){try{return await p}catch(ie){if("no-queryEngine"!==ie.name)throw ie;return b}}let nt=class extends((0,tt.A)((0,rt.A)((0,pe.e)(it.A)))){constructor(){super(...arguments),this._commandsQueue=new Xe.A({process:p=>{switch(p.type){case"processed-edit":return this._doEdit(p);case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightCounter=new et.t,this._updateHighlight=(0,K.sg)((async()=>{const p=[];for(const b of this._highlightCounter.ids()){const _=this._highlightCounter.getHighestReason(b),S=(0,he.$r)(_);p.push({objectId:b,highlightFlags:S})}this._worker.pipeline.updateHighlight({highlights:p})})),this._lastAvailableFields=[],this.eventLog=new Ae,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._fields=null,this.featureEffectView=new ie}destroy(){var p;null!==(p=this._worker)&&void 0!==p&&p.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransitions()}async _initProxy(){var p;const b=this.layer;if("isTable"in b&&b.isTable)throw new H.A("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:b});if("mesh"===b.geometryType)throw new H.A("featurelayerview:geometry-type-not-supported","Geometry type of ".concat(b.geometryType," is not supported"),{layer:b});if(("feature"===b.type||"subtype-group"===b.type)&&!1===(null===(p=(0,ae.BR)(b))||void 0===p?void 0:p.operations.supportsQuery))throw new H.A("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:b});this._worker&&this._worker.destroy();const _=this._createClientOptions();this._worker=await async function FeaturePipelineWorkerProxy_t(p){const b=await(0,Ie.ho)("FeaturePipelineWorker",{client:p,strategy:"dedicated"});return new FeaturePipelineWorkerProxy_n(b)}(_)}get hasAllFeatures(){return this.layer.visible&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const p=this.layerAdapter.getLabelingDeconflictionInfo(this.view),b=this.layer.geometryType,_=!this.suspended;return p.map((p=>{let{vvEvaluators:S,deconflictionEnabled:V}=p;return{container:this.featureContainer,vvEvaluators:S,deconflictionEnabled:V,geometryType:b,visible:_}}))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new InMemoryLayerAdapter_p(this.layer):new FeatureLayerAdapter_u(this.layer);case"geojson":case"csv":case"wfs":return new InMemoryLayerAdapter_p(this.layer);case"subtype-group":return new SubtypeGroupLayerAdapter_c(this.layer);case"ogc-feature":return new OGCFeatureLayerAdapter_d(this.layer);case"stream":return new StreamLayerAdapter_s(this.layer);case"oriented-imagery":return new OrientedImageryLayerAdapter_u(this.layer);case"knowledge-graph-sublayer":return new KnowledgeGraphSublayerAdapter_c(this.layer);case"catalog-footprint":return new CatalogFootprintLayerAdapter_d(this.layer);default:(0,j.Xb)(this.layer)}return null}get updateHash(){if(!this.layerAdapter)return null;const{availableFields:p,_displayRefreshVersion:b,timeExtent:_,clips:S,filter:V,featureEffect:E,_sourceRefreshVersion:F,view:{timeZone:T}}=this,N=JSON.stringify(S),B=null===E||void 0===E?void 0:E.toJSON(),q=null===V||void 0===V?void 0:V.toJSON();return JSON.stringify({availableFields:p,clipsHash:N,displayRefreshVersion:b,effectHash:B,filterHash:q,sourceRefreshVersion:F,timeExtent:_,timeZone:T,...this.layerAdapter.getUpdateHashProperties(this.view)})}getDisplayStatistics(p,b){var _;return null===(_=this.featureContainer)||void 0===_?void 0:_.getDisplayStatistics(p,b)}async queryHeatmapStatistics(p){return this._worker.pipeline.queryHeatmapStatistics(p)}highlight(p){var b;let _,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"highlight";p instanceof V.A?_=[p.getObjectId()]:"number"==typeof p||"string"==typeof p?_=[p]:J.A.isCollection(p)&&p.length>0?_=p.map((p=>null===p||void 0===p?void 0:p.getObjectId())).toArray():Array.isArray(p)&&p.length>0&&(_="number"==typeof p[0]||"string"==typeof p[0]?p:p.map((p=>null===p||void 0===p?void 0:p.getObjectId())));const E=null===(b=_)||void 0===b?void 0:b.filter(D.Ru);return null!==E&&void 0!==E&&E.length?(this._addHighlight(E,S),(0,Q.hA)((()=>this._removeHighlight(E,S)))):(0,Q.hA)()}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}async hitTest(p,b){const _=await this.featureContainer.hitTest(b);if(0===_.length)return null;const{features:S,aggregates:E}=await this._worker.pipeline.getDisplayFeatures(_),F=this.featureContainer.getSortKeys(_),u=(p,b)=>{let{displayId:_}=p,{displayId:S}=b;return F.has(_)&&F.has(S)?F.get(_)-F.get(S):_-S};return S.sort(u).reverse(),E.sort(u).reverse(),[...E.map((b=>this._createGraphicHit(p,q.fromJSON(b)))),...S.map((b=>this._createGraphicHit(p,V.A.fromJSON(b))))]}queryStatistics(){return Z(this._worker.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}querySummaryStatistics(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.features.executeQueryForSummaryStatistics(this._cleanUpQuery(p),S,_),{})}async queryAggregateSummaryStatistics(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(p),S,_),{})}async queryUniqueValues(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.features.executeQueryForUniqueValues(this._cleanUpQuery(p),S,_),{uniqueValueInfos:[]})}async queryAggregateUniqueValues(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(p),S,_),{uniqueValueInfos:[]})}async queryClassBreaks(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.features.executeQueryForClassBreaks(this._cleanUpQuery(p),S,_),{classBreakInfos:[]})}async queryAggregateClassBreaks(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(p),S,_),{classBreakInfos:[]})}async queryHistogram(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.features.executeQueryForHistogram(this._cleanUpQuery(p),S,_),{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(p,b,_){const S={...b,scale:this.view.scale};return Z(this._worker.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(p),S,_),{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(p,b){return this.queryFeaturesJSON(p,b).then((p=>{const b=le.A.fromJSON(p);return b.features.forEach((p=>this._setLayersForFeature(p))),b}))}async queryVisibleFeatures(p,b){const _=this._worker.pipeline.queryVisibleFeatures(this._cleanUpQuery(p),b),S=await Z(_,{features:[]}),V=le.A.fromJSON(S);return V.features.forEach((p=>this._setLayersForFeature(p))),V}async queryAggregates(p,b){const _=this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(p),b),S=await Z(_,{features:[]}),V=ce.fromJSON(S);return V.features.forEach((p=>this._setLayersForFeature(p))),V}queryAggregateIds(p,b){return Z(this._worker.aggregates.executeQueryForIds(this._cleanUpAggregateQuery(p),b),[])}queryAggregateCount(p,b){return Z(this._worker.aggregates.executeQueryForCount(this._cleanUpAggregateQuery(p),b),0)}queryAggregateJSON(p,b){return Z(this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(p),b),{features:[]})}async queryFeaturesJSON(p,b){return Z(this._worker.features.executeQuery(this._cleanUpQuery(p),b),{features:[]})}queryObjectIds(p,b){return Z(this._worker.features.executeQueryForIds(this._cleanUpQuery(p),b),[])}queryFeatureCount(p,b){return Z(this._worker.features.executeQueryForCount(this._cleanUpQuery(p),b),0)}async queryExtent(p,b){const _=this._worker.features.executeQueryForExtent(this._cleanUpQuery(p),b),S=await Z(_,{count:0,extent:null});return{count:S.count,extent:st.A.fromJSON(S.extent)}}async getSampleFeatures(p){return this._worker.pipeline.getSampleFeatures(p)}setVisibility(p,b){b?this._visibilityOverrides.delete(p):this._visibilityOverrides.add(p),this._update()}update(p){if(!this._subscriptionManager)return;const b=this._subscriptionManager.update(p);this.featureContainer.setVisibleTiles(b)}attach(){(0,F.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),this.featureContainer=new u(this),this.container.addChild(this.featureContainer),this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._subscriptionManager=new FeatureTileSubscriptionManager_t({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:p=>{this.featureContainer.updateSubscriptions(p),this._worker.pipeline.updateSubscriptions(p)},isDone:p=>this.featureContainer.isDone(p)}),this.requestUpdate(),this.addAttachHandles([(0,Y.wB)((()=>this.updateHash),(()=>this._update()),Y.Vh),(0,Y.wB)((()=>this.updateSuspended),(p=>{p||this._subscriptionManager.resume()}))]),"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",(p=>this._edit(p))))}detach(){(0,F.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._fields=null,this.featureContainer.destroy(),this._commandsQueue.clear(),this.container.removeAllChildren(),this._subscriptionManager=(0,G.pR)(this._subscriptionManager),this._worker.pipeline.onDetach()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const p="renderer"in this.layer&&null!=this.layer.renderer,b=this._commandsQueue.updateTracking.updating,_=null!=this._updatingRequiredFieldsPromise,S=this.featureContainer.updatingHandles.updating,V=p&&(b||_)||S||this._pipelineUpdating||this.dataUpdating;if((0,F.A)("esri-2d-log-updating")){console.log("Updating FLV2D (".concat(this.layer.id,"): ").concat(V,"\n  -> hasRenderer ").concat(p,"\n  -> updatingRequiredFields ").concat(_,"\n  -> hasPendingCommand ").concat(b,"\n  -> dataUpdating ").concat(this.dataUpdating,"\n  -> processing ").concat(this._pipelineUpdating,"\n  -> updatingContainer ").concat(S,"\n"));for(const p of this.featureContainer.subscriptions())console.log("    -> Tile[".concat(p.id,"] Done: ").concat(p.done))}return V}_createClientOptions(){const p=this;return{get container(){return p.featureContainer},setUpdating:p=>{this._set("_pipelineUpdating",p.pipeline),this._set("dataUpdating",p.data)},emitEvent:p=>{this.emit(p.name,p.event)},get eventLog(){return p.eventLog},fetch:b=>Promise.all(b.map((b=>p.view.stage.painter.textureManager.rasterizeItem(b)))),fetchDictionary:p=>Promise.all(p.map((p=>this._fetchDictionaryRequest(p))))}}async _fetchDictionaryRequest(p){try{if("subtype-group"===this.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const b=this.layer.renderer;if(!b||"dictionary"!==b.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const _=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==_.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const S={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:_.scaleExpression};this._fields||(this._fields=this.layer.fields.map((p=>p.toJSON())));const V=_.visualVariableUniforms,E=await b.getSymbolAsync(p.feature,{fields:this._fields});return E&&E.data?{type:"dictionary-response",meshes:await(0,Ge.Jk)(E.data,{uniforms:V,path:"renderer",schemaOptions:S})}:{type:"dictionary-response",meshes:[]}}catch(t){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(p){const b=de.A.from(p)||this.createQuery();return b.outSpatialReference||(b.outSpatialReference=this.view.spatialReference),b.toJSON()}_cleanUpAggregateQuery(p){var b;const _=de.A.from(p)||this.createAggregateQuery();_.outSpatialReference||(_.outSpatialReference=this.view.spatialReference);const S=null!==(b=_.objectIds)&&void 0!==b?b:[];for(const E of null!==(V=_.aggregateIds)&&void 0!==V?V:[]){var V;S.push(E)}return _.objectIds=S,_.aggregateIds=[],_.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(p){if(!this.updateSuspended)return this._validateEdit(p)?this._commandsQueue.push({type:"edit",edits:p}).catch(K.jH):void 0;this._subscriptionManager.suspend()}async doRefresh(p){this.attached&&(this.updateSuspended&&p||(p?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%at+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%at+1}_validateEdit(p){const b="globalIdField"in this.layer&&this.layer.globalIdField,_=p.deletedFeatures.some((p=>-1===p.objectId||!p.objectId)),S=b&&this.availableFields.includes(b);return _&&!S?(T.A.getLogger(this).error(new H.A("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(b," to be included the layer's outFields for updates to be reflected on the map"))),null):p}async _doUpdate(){var p;"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=null===(p=this.layer.featureReduction)||void 0===p?void 0:p.clone(),this._lastFeatureReduction=this.layer.featureReduction);try{var b,_,S;if(await this._updateRequiredFields(),this.destroyed||null===(b=this.layerAdapter)||void 0===b||!b.hasRequiredSupport||!this._subscriptionManager)return;const p=this.featureContainer.instanceStore;this.featureContainer.attributeView.lockTextureUploads(),p.updateStart();const V=this.featureEffect,E={store:p,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},T=await this.layerAdapter.createServiceOptions(this.view),N=this._createViewSchemaConfig(),B={source:this.layerAdapter.createSourceSchema(T,N,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(E,N,this._displayRefreshVersion)},q=!!(0,$.Ui)(null===(_=this._lastSchema)||void 0===_?void 0:_.source.mutable,B.source.mutable)||!!(0,$.Ui)(null===(S=this._lastSchema)||void 0===S?void 0:S.processor,B.processor);if(!q)return this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),p.updateEnd(),void(this.featureEffectView.featureEffect=V);this._lastSchema=B,this._fields=null;const D=Math.round(performance.now());(0,F.A)("esri-2d-update-debug")&&console.debug("Id[".concat(this.layer.uid,"] Version[").concat(D,"] FeatureLayerView2D._doUpdate"),{changes:q});let J=[];Array.isArray(T.source)&&(J=T.source),await this._worker.pipeline.updateSchema(B,D,{transferList:J}),p.updateEnd(),this.featureEffectView.featureEffect=V,this.featureEffectView.endTransitions(),this.featureContainer.attributeView.unlockTextureUploads(),this.featureContainer.swapRenderState(),this.featureContainer.requestRender(),(0,F.A)("esri-2d-update-debug")&&console.debug("Version[".concat(D,"] FeatureLayerView2D.updateEnd")),this.requestUpdate()}catch(e){(0,F.A)("esri-2d-update-debug")&&console.error("Encountered an error during update",e)}}async _doEdit(p){try{this.featureContainer.editStart(),await this._worker.pipeline.onEdits(p),this.featureContainer.editEnd()}catch(t){(0,K.zf)(t)}}get hasFilter(){var p,b,_;const S=null!==(p=null===(b=(_=this.layerAdapter).hasFilters)||void 0===b?void 0:b.call(_,this.view))&&void 0!==p&&p;return null!=this.filter||null!=this.timeExtent||this._visibilityOverrides.size>0||S}_getEffectiveAvailableFields(p){const b=function P(p,b){const _=new Set;return p&&p.forEach((p=>_.add(p))),b&&b.forEach((p=>_.add(p))),_.has("*")?["*"]:Array.from(_)}(this._lastAvailableFields,p);return this._lastAvailableFields=b,(0,se.hW)(this.layer.fieldsIndex,b)}_createViewSchemaConfig(){var p,b;const _=[W(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter),null!==(p=null===(b=this.featureEffect)||void 0===b||null===(b=b.filter)||void 0===b?void 0:b.toJSON())&&void 0!==p?p:null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:_,outSpatialReference:this.view.spatialReference,tileInfoJSON:this.view.featuresTilingScheme.tileInfo.toJSON(),scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlight(p,b){this._highlightCounter.addReason(p,b),this._updateHighlight().catch((p=>{(0,K.zf)(p)||T.A.getLogger(this).error(p)}))}_removeHighlight(p,b){this._highlightCounter.deleteReason(p,b),this._updateHighlight().catch((p=>{(0,K.zf)(p)||T.A.getLogger(this).error(p)}))}_setLayersForFeature(p){p.layer=p.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(p)}_createGraphicHit(p,b){return this._setLayersForFeature(b),null!=b.geometry&&(b.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:b,layer:this.layer,mapPoint:p}}};function W(p,b,_,S,V){var E,F,T,N,B,q;V&&(V=V.clone());const D=null!=V?V.timeExtent:null,J=null!=_&&null!=D?_.intersection(D):_||D;J&&(null!==(E=V)&&void 0!==E||(V=new re.A),V.timeExtent=J);let j=null!==(N=null===(B=V=null!==(F=null===(T=b.addFilters)||void 0===T?void 0:T.call(b,V,p))&&void 0!==F?F:V)||void 0===B?void 0:B.toJSON())&&void 0!==N?N:null;return S.size&&(null!==(q=j)&&void 0!==q||(j=(new re.A).toJSON()),j.hiddenIds=Array.from(S)),j}(0,S._)([(0,E.MZ)()],nt.prototype,"_worker",void 0),(0,S._)([(0,E.MZ)()],nt.prototype,"_commandsQueue",void 0),(0,S._)([(0,E.MZ)()],nt.prototype,"_sourceRefreshVersion",void 0),(0,S._)([(0,E.MZ)()],nt.prototype,"_displayRefreshVersion",void 0),(0,S._)([(0,E.MZ)({readOnly:!0})],nt.prototype,"_pipelineUpdating",void 0),(0,S._)([(0,E.MZ)({readOnly:!0})],nt.prototype,"hasAllFeatures",null),(0,S._)([(0,E.MZ)({readOnly:!0})],nt.prototype,"hasAllFeaturesInView",null),(0,S._)([(0,E.MZ)({readOnly:!0})],nt.prototype,"hasFullGeometries",null),(0,S._)([(0,E.MZ)()],nt.prototype,"featureEffectView",void 0),(0,S._)([(0,E.MZ)()],nt.prototype,"labelingCollisionInfos",null),(0,S._)([(0,E.MZ)()],nt.prototype,"layerAdapter",null),(0,S._)([(0,E.MZ)()],nt.prototype,"updateHash",null),(0,S._)([(0,E.MZ)()],nt.prototype,"updating",void 0),nt=(0,S._)([(0,N.$)("esri.views.2d.layers.FeatureLayerView2D")],nt);const lt=nt},86083:(p,b,_)=>{_.d(b,{e:()=>m});var S,V=_(80671),E=_(39652),F=_(86479),T=_(4180),N=_(63390),B=_(57453),q=(_(50886),_(89412),_(76761),_(68682)),D=_(16906),J=_(5528),j=_(45104),H=_(6673);let Q=S=class extends H.A{constructor(p){super(p),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new S({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,V._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],Q.prototype,"left",void 0),(0,V._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],Q.prototype,"right",void 0),(0,V._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],Q.prototype,"top",void 0),(0,V._)([(0,B.MZ)({type:[Number,String],json:{write:!0}})],Q.prototype,"bottom",void 0),Q=S=(0,V._)([(0,q.$)("esri.views.layers.support.ClipRect")],Q);const G=Q;var K=_(90874);let Y=class extends H.A{constructor(p){super(p),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,V._)([(0,B.MZ)({type:[[[Number]]],json:{write:!0}})],Y.prototype,"path",void 0),Y=(0,V._)([(0,q.$)("esri.views.layers.support.Path")],Y);const $=Y,X=E.A.ofType({key:"type",base:null,typeMap:{rect:G,path:$,geometry:K.A}}),m=p=>{let b=class extends p{constructor(){super(...arguments),this.attached=!1,this.clips=new X,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1,this.highlightOptions=null}initialize(){var p,b,_,S;const V=null===(p=null===(b=this.view)||void 0===b?void 0:b.spatialReferenceLocked)||void 0===p||p;(null===(_=this.view)||void 0===_?void 0:_.spatialReference)&&V&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new T.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new J.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,N.wB)((()=>this.suspended),(p=>{this.container&&(this.container.visible=!p)}),N.pc),(0,N.wB)((()=>this.updateSuspended),(p=>{this.view&&!p&&this.updateRequested&&this.view.requestUpdate()}),N.pc),(0,N.wB)((()=>{var p,b;return null!==(p=null===(b=this.layer)||void 0===b?void 0:b.opacity)&&void 0!==p?p:1}),(p=>{this.container&&(this.container.opacity=p)}),N.pc),(0,N.wB)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(p=>{this.container&&(this.container.blendMode=p)}),N.pc),(0,N.wB)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(p=>{this.container&&(this.container.effect=p)}),N.pc),(0,N.wB)((()=>this.highlightOptions),(p=>this.container.highlightOptions=p),N.pc),(0,N.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),N.pc),(0,N.wB)((()=>{var p;return{scale:null===(p=this.view)||void 0===p?void 0:p.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}}),(p=>{let{scale:b}=p;const _=null!=b&&this.isVisibleAtScale(b);_!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",_)}),N.pc)],"constructor"),null!==(S=this.view)&&void 0!==S&&S.whenLayerView?this.view.whenLayerView(this.layer).then((p=>{p===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var p;const b=null===(p=this.view)||void 0===p?void 0:p.spatialReference;return null==b||this.supportsSpatialReference(b)}get updateSuspended(){return this.suspended}get updating(){var p;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(p=this._updatingHandles)||void 0===p||!p.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(p){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;const{minScale:_,maxScale:S}=b;return(0,D.zx)(p,_,S)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(p){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",p),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(p))):this.updateRequested=!1}hitTest(p,b){return Promise.resolve(null)}supportsSpatialReference(p){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const p=super.getSuspendInfo(),b=!this.spatialReferenceSupported,_=this.visibleAtCurrentScale;return b&&(p.spatialReferenceNotSupported=b),_&&(p.outsideScaleRange=_),p}addAttachHandles(p){this.addHandles(p,"attach")}};return(0,V._)([(0,B.MZ)()],b.prototype,"attached",void 0),(0,V._)([(0,B.MZ)({type:X,set(p){const b=(0,F.V)(p,this._get("clips"),X);this._set("clips",b)}})],b.prototype,"clips",void 0),(0,V._)([(0,B.MZ)()],b.prototype,"container",void 0),(0,V._)([(0,B.MZ)()],b.prototype,"moving",void 0),(0,V._)([(0,B.MZ)({readOnly:!0})],b.prototype,"spatialReferenceSupported",null),(0,V._)([(0,B.MZ)({readOnly:!0})],b.prototype,"updateParameters",void 0),(0,V._)([(0,B.MZ)()],b.prototype,"updateRequested",void 0),(0,V._)([(0,B.MZ)()],b.prototype,"updateSuspended",null),(0,V._)([(0,B.MZ)()],b.prototype,"updating",null),(0,V._)([(0,B.MZ)()],b.prototype,"view",void 0),(0,V._)([(0,B.MZ)({readOnly:!0})],b.prototype,"visibleAtCurrentScale",void 0),(0,V._)([(0,B.MZ)({type:j.A})],b.prototype,"highlightOptions",void 0),b=(0,V._)([(0,q.$)("esri.views.2d.layers.LayerView2D")],b),b}},4690:(p,b,_)=>{function o(p,b,_,S){const V=p.clone(),E=1<<V.level,F=V.col+b,T=V.row+_;return S&&F<0?(V.col=F+E,V.world-=1):F>=E?(V.col=F-E,V.world+=1):V.col=F,V.row=T,V}_.d(b,{K:()=>o})},57283:(p,b,_)=>{_.d(b,{t:()=>t});var S=_(80050);class t{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addReason(p,b){for(const _ of p){let p=this._idToCounters.get(_);p||(p=new Map,this._idToCounters.set(_,p)),p.set(b,(p.get(b)||0)+1)}}deleteReason(p,b){for(const _ of p){const p=this._idToCounters.get(_);if(!p)continue;let S=p.get(b);if(null==S)return;S--,S>0?p.set(b,S):p.delete(b),0===p.size&&this._idToCounters.delete(_)}}getHighestReason(p){const b=this._idToCounters.get(p);if(!b)return null;let _=null;for(const V of S.M$)b.get(V)&&(_=V);return _||null}ids(){return this._idToCounters.keys()}}},6673:(p,b,_)=>{_.d(b,{A:()=>N});var S=_(80671),V=_(83375),E=_(57453),F=(_(50886),_(89412),_(76761),_(68682));let T=class extends V.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,S._)([(0,E.MZ)({readOnly:!0})],T.prototype,"version",null),T=(0,S._)([(0,F.$)("esri.views.layers.support.ClipArea")],T);const N=T},90874:(p,b,_)=>{_.d(b,{A:()=>H});var S,V=_(80671),E=(_(30174),_(57453)),F=(_(50886),_(89412),_(76761),_(68682)),T=_(66445),N=_(31670),B=_(6673),q=_(84661),D=_(48343);const J={base:T.A,key:"type",typeMap:{extent:q.A,polygon:D.A}};let j=S=class extends B.A{constructor(p){super(p),this.type="geometry",this.geometry=null}clone(){var p,b;return new S({geometry:null!==(p=null===(b=this.geometry)||void 0===b?void 0:b.clone())&&void 0!==p?p:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,V._)([(0,E.MZ)({types:J,json:{read:N.rS,write:!0}})],j.prototype,"geometry",void 0),j=S=(0,V._)([(0,F.$)("esri.views.layers.support.Geometry")],j);const H=j}}]);
//# sourceMappingURL=9552.0ebaaa3c.chunk.js.map