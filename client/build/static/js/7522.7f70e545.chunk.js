"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[7522],{30925:(p,M,T)=>{T.d(M,{w:()=>s});var k=T(16842),E=T(17244),N=T(60964);class s{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,M=arguments.length>1?arguments[1]:void 0;this._compareMinX=o,this._compareMinY=l,this._toBBox=p=>p,this._maxEntries=Math.max(4,p||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),M&&("function"==typeof M?this._toBBox=M:this._initFormat(M)),this.clear()}destroy(){this.clear(),D.prune(),F.prune(),Z.prune(),O.prune()}all(p){this._all(this._data,p)}search(p,M){let T=this._data;const k=this._toBBox;if(x(p,T))for(D.clear();T;){for(let E=0,N=T.children.length;E<N;E++){const N=T.children[E],F=T.leaf?k(N):N;x(p,F)&&(T.leaf?M(N):_(p,F)?this._all(N,M):D.push(N))}T=D.pop()}}collides(p){let M=this._data;const T=this._toBBox;if(!x(p,M))return!1;for(D.clear();M;){for(let k=0,E=M.children.length;k<E;k++){const E=M.children[k],N=M.leaf?T(E):E;if(x(p,N)){if(M.leaf||_(p,N))return!0;D.push(E)}}M=D.pop()}return!1}load(p){if(!p.length)return this;if(p.length<this._minEntries){for(let M=0,T=p.length;M<T;M++)this.insert(p[M]);return this}let M=this._build(p.slice(0,p.length),0,p.length-1,0);if(this._data.children.length)if(this._data.height===M.height)this._splitRoot(this._data,M);else{if(this._data.height<M.height){const p=this._data;this._data=M,M=p}this._insert(M,this._data.height-M.height-1,!0)}else this._data=M;return this}insert(p){return p&&this._insert(p,this._data.height-1),this}clear(){return this._data=new w([]),this}remove(p){if(!p)return this;let M,T=this._data,E=null,N=0,D=!1;const F=this._toBBox(p);for(Z.clear(),O.clear();T||Z.length>0;){var q;if(T||(T=Z.pop(),E=Z.data[Z.length-1],N=null!==(q=O.pop())&&void 0!==q?q:0,D=!0),T.leaf&&(M=(0,k.qh)(T.children,p,T.children.length,T.indexHint),-1!==M))return T.children.splice(M,1),Z.push(T),this._condense(Z),this;D||T.leaf||!_(T,F)?E?(N++,T=E.children[N],D=!1):T=null:(Z.push(T),O.push(N),N=0,E=T,T=T.children[0])}return this}toJSON(){return this._data}fromJSON(p){return this._data=p,this}_all(p,M){let T=p;for(F.clear();T;){var k;if(!0===T.leaf)for(const p of T.children)M(p);else F.pushArray(T.children);T=null!==(k=F.pop())&&void 0!==k?k:null}}_build(p,M,T,k){const E=T-M+1;let N=this._maxEntries;if(E<=N){const k=new w(p.slice(M,T+1));return h(k,this._toBBox),k}k||(k=Math.ceil(Math.log(E)/Math.log(N)),N=Math.ceil(E/N**(k-1)));const D=new b([]);D.height=k;const F=Math.ceil(E/N),Z=F*Math.ceil(Math.sqrt(N));f(p,M,T,Z,this._compareMinX);for(let O=M;O<=T;O+=Z){const M=Math.min(O+Z-1,T);f(p,O,M,F,this._compareMinY);for(let T=O;T<=M;T+=F){const E=Math.min(T+F-1,M);D.children.push(this._build(p,T,E,k-1))}}return h(D,this._toBBox),D}_chooseSubtree(p,M,T,k){for(;k.push(M),!0!==M.leaf&&k.length-1!==T;){let T,k=1/0,E=1/0;for(let N=0,D=M.children.length;N<D;N++){const D=M.children[N],F=c(D),Z=d(p,D)-F;Z<E?(E=Z,k=F<k?F:k,T=D):Z===E&&F<k&&(k=F,T=D)}M=T||M.children[0]}return M}_insert(p,M,T){const k=this._toBBox,E=T?p:k(p);Z.clear();const N=this._chooseSubtree(E,this._data,M,Z);for(N.children.push(p),r(N,E);M>=0&&Z.data[M].children.length>this._maxEntries;)this._split(Z,M),M--;this._adjustParentBBoxes(E,Z,M)}_split(p,M){const T=p.data[M],k=T.children.length,E=this._minEntries;this._chooseSplitAxis(T,E,k);const N=this._chooseSplitIndex(T,E,k);if(!N)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const D=T.children.splice(N,T.children.length-N),F=T.leaf?new w(D):new b(D);F.height=T.height,h(T,this._toBBox),h(F,this._toBBox),M?p.data[M-1].children.push(F):this._splitRoot(T,F)}_splitRoot(p,M){this._data=new b([p,M]),this._data.height=p.height+1,h(this._data,this._toBBox)}_chooseSplitIndex(p,M,T){let k,E,N;k=E=1/0;for(let D=M;D<=T-M;D++){const M=a(p,0,D,this._toBBox),F=a(p,D,T,this._toBBox),Z=u(M,F),O=c(M)+c(F);Z<k?(k=Z,N=D,E=O<E?O:E):Z===k&&O<E&&(E=O,N=D)}return N}_chooseSplitAxis(p,M,T){const k=p.leaf?this._compareMinX:o,E=p.leaf?this._compareMinY:l;this._allDistMargin(p,M,T,k)<this._allDistMargin(p,M,T,E)&&p.children.sort(k)}_allDistMargin(p,M,T,k){p.children.sort(k);const E=this._toBBox,N=a(p,0,M,E),D=a(p,T-M,T,E);let F=m(N)+m(D);for(let Z=M;Z<T-M;Z++){const M=p.children[Z];r(N,p.leaf?E(M):M),F+=m(N)}for(let Z=T-M-1;Z>=M;Z--){const M=p.children[Z];r(D,p.leaf?E(M):M),F+=m(D)}return F}_adjustParentBBoxes(p,M,T){for(let k=T;k>=0;k--)r(M.data[k],p)}_condense(p){for(let M=p.length-1;M>=0;M--){const T=p.data[M];if(0===T.children.length)if(M>0){const E=p.data[M-1],N=E.children;N.splice((0,k.qh)(N,T,N.length,E.indexHint),1)}else this.clear();else h(T,this._toBBox)}}_initFormat(p){const M=["return a"," - b",";"];this._compareMinX=new Function("a","b",M.join(p[0])),this._compareMinY=new Function("a","b",M.join(p[1])),this._toBBox=new Function("a","return {minX: a"+p[0]+", minY: a"+p[1]+", maxX: a"+p[2]+", maxY: a"+p[3]+"};")}}function h(p,M){a(p,0,p.children.length,M,p)}function a(p,M,T,k,E){E||(E=new w([])),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(let N,D=M;D<T;D++)N=p.children[D],r(E,p.leaf?k(N):N);return E}function r(p,M){p.minX=Math.min(p.minX,M.minX),p.minY=Math.min(p.minY,M.minY),p.maxX=Math.max(p.maxX,M.maxX),p.maxY=Math.max(p.maxY,M.maxY)}function o(p,M){return p.minX-M.minX}function l(p,M){return p.minY-M.minY}function c(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function m(p){return p.maxX-p.minX+(p.maxY-p.minY)}function d(p,M){return(Math.max(M.maxX,p.maxX)-Math.min(M.minX,p.minX))*(Math.max(M.maxY,p.maxY)-Math.min(M.minY,p.minY))}function u(p,M){const T=Math.max(p.minX,M.minX),k=Math.max(p.minY,M.minY),E=Math.min(p.maxX,M.maxX),N=Math.min(p.maxY,M.maxY);return Math.max(0,E-T)*Math.max(0,N-k)}function _(p,M){return p.minX<=M.minX&&p.minY<=M.minY&&M.maxX<=p.maxX&&M.maxY<=p.maxY}function x(p,M){return M.minX<=p.maxX&&M.minY<=p.maxY&&M.maxX>=p.minX&&M.maxY>=p.minY}function f(p,M,T,k,E){const D=[M,T];for(;D.length;){const M=D.pop(),T=D.pop();if(M-T<=k)continue;const F=T+Math.ceil((M-T)/k/2)*k;(0,N.q)(p,F,T,M,E),D.push(T,F,F,M)}}const D=new E.A,F=new E.A,Z=new E.A,O=new E.A({deallocator:void 0});class Y{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class B extends Y{constructor(){super(...arguments),this.height=1,this.indexHint=new k.vW}}class w extends B{constructor(p){super(),this.children=p,this.leaf=!0}}class b extends B{constructor(p){super(),this.children=p,this.leaf=!1}}},77262:(p,M,T)=>{T.d(M,{Hq:()=>R,Qj:()=>z,V2:()=>S,m_:()=>A});T(50886);var k=T(48237),E=T(84661),N=T(48343),D=T(98664),F=T(39572),Z=T(32050),O=T(41156),q=T(22786);const Q=new Float64Array(2),X=new Float64Array(2),J="0123456789bcdefghjkmnpqrstuvwxyz",H=64;function S(p,M,T,k){const F=[p.xmin,p.ymin,p.xmax,p.ymax],Q=N.A.fromExtent(E.A.fromBounds(F,k)),X=(0,q.Cv)(Q,k,D.A.WGS84,{densificationStep:M*H});if(!X)return null;const J=(0,Z.Ye)(new O.A,X,!1,!1),K=J.coords.filter(((p,M)=>!(M%2))),$=J.coords.filter(((p,M)=>M%2)),V=Math.min(...K),ee=Math.min(...$),te=Math.max(...K),ie=Math.max(...$),ne=A(V,ee,T,D.A.WGS84),ae=A(te,ie,T,D.A.WGS84);return ne&&ae?{bounds:F,geohashBounds:{xLL:ne[0],yLL:ne[1],xTR:ae[0],yTR:ae[1]},level:T}:null}function A(p,M,T,E){if(E.isWebMercator){const E=(0,k.KJ)(p/F.$O.radius),N=E-360*Math.floor((E+180)/360),D=[0,0];return Y(D,0,(0,k.KJ)(Math.PI/2-2*Math.atan(Math.exp(-M/F.$O.radius))),N,T),D}const N=(0,q.Cv)({x:p,y:M},E,D.A.WGS84);if(!N)return null;const Z=[0,0];return Y(Z,0,N.y,N.x,T),Z}function W(p){return J[p]}function b(p){return(p[0]+p[1])/2}function w(p,M,T){return p[0]=M,p[1]=T,p}function C(p,M){const T=b(p),k=M,E=!M;p[0]=E*p[0]+k*T,p[1]=E*T+k*p[1]}function L(p,M){const T=M>b(p);return C(p,T),T}function R(p,M){let T=-90,k=90,E=-180,N=180;for(let D=0;D<M;D++){const M=Math.ceil((D+1)/2),F=Math.floor((D+1)/2),Z=1-D%2,O=30-(3*M+2*F),q=30-(2*M+3*F),Q=3*Z+2*(1-Z),X=2*Z+3*(1-Z),J=3*Z+7*(1-Z)<<q,H=(7*Z+3*(1-Z)<<O&p.geohashX)>>O,K=(J&p.geohashY)>>q;for(let p=Q-1;p>=0;p--){const M=(E+N)/2,T=H&1<<p?1:0;E=(1-T)*E+T*M,N=(1-T)*M+T*N}for(let p=X-1;p>=0;p--){const M=(T+k)/2,E=K&1<<p?1:0;T=(1-E)*T+E*M,k=(1-E)*M+E*k}}return[E,T,N,k]}function Y(p,M,T,k,E){E%2&&(E+=1);let N=0,D=0,F=-90,Z=90,O=-180,q=180;for(let Q=0;Q<E/2;Q++){for(let p=0;p<5;p++){const M=(O+q)/2,T=k>M?1:0;N|=T<<29-(p+5*Q),O=(1-T)*O+T*M,q=(1-T)*M+T*q}for(let p=0;p<5;p++){const M=(F+Z)/2,k=T>M?1:0;D|=k<<29-(p+5*Q),F=(1-k)*F+k*M,Z=(1-k)*M+k*Z}}p[2*M]=N,p[2*M+1]=D}function z(p,M,T){let k="";const E=w(Q,-90,90),N=w(X,-180,180);for(let D=0;D<T;D++){let T=0;D%2?(T|=L(E,p)<<4,T|=L(N,M)<<3,T|=L(E,p)<<2,T|=L(N,M)<<1,T|=L(E,p)<<0):(T|=L(N,M)<<4,T|=L(E,p)<<3,T|=L(N,M)<<2,T|=L(E,p)<<1,T|=L(N,M)<<0),k+=W(T)}return k}},77026:(p,M,T)=>{T.d(M,{g:()=>k});const k={convertToGEGeometry:function s(p,M){return null==M?null:p.convertJSONToGeometry(M)},exportPoint:function n(p,M,T){const k=new i(p.getPointX(M),p.getPointY(M),T),E=p.hasZ(M),N=p.hasM(M);return E&&(k.z=p.getPointZ(M)),N&&(k.m=p.getPointM(M)),k},exportPolygon:function o(p,M,T){return new e(p.exportPaths(M),T,p.hasZ(M),p.hasM(M))},exportPolyline:function a(p,M,T){return new h(p.exportPaths(M),T,p.hasZ(M),p.hasM(M))},exportMultipoint:function c(p,M,T){return new r(p.exportPoints(M),T,p.hasZ(M),p.hasM(M))},exportExtent:function m(p,M,T){const k=p.hasZ(M),E=p.hasM(M),N=new x(p.getXMin(M),p.getYMin(M),p.getXMax(M),p.getYMax(M),T);if(k){const T=p.getZExtent(M);N.zmin=T.vmin,N.zmax=T.vmax}if(E){const T=p.getMExtent(M);N.mmin=T.vmin,N.mmax=T.vmax}return N}};class i{constructor(p,M,T){this.x=p,this.y=M,this.spatialReference=T,this.z=void 0,this.m=void 0}}class e{constructor(p,M,T,k){this.rings=p,this.spatialReference=M,this.hasZ=void 0,this.hasM=void 0,T&&(this.hasZ=T),k&&(this.hasM=k)}}class h{constructor(p,M,T,k){this.paths=p,this.spatialReference=M,this.hasZ=void 0,this.hasM=void 0,T&&(this.hasZ=T),k&&(this.hasM=k)}}class r{constructor(p,M,T,k){this.points=p,this.spatialReference=M,this.hasZ=void 0,this.hasM=void 0,T&&(this.hasZ=T),k&&(this.hasM=k)}}class x{constructor(p,M,T,k,E){this.xmin=p,this.ymin=M,this.xmax=T,this.ymax=k,this.spatialReference=E,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},49898:(p,M,T)=>{T.r(M),T.d(M,{default:()=>st});var k=T(80671),E=(T(30174),T(39652)),N=T(4180),D=T(89412),F=T(81618),Z=T(57453),O=(T(50886),T(76761),T(68682)),q=T(77262),Q=T(78658),X=T(32050),J=T(41156),H=T(18763),K=T(69719),$=T(25986),V=T(48343),ee=T(54208),te=T(78395),ie=T(57224),ne=T(31670);class SessionMemoryStorage_o{constructor(){this._featureLookup=new Map}static getInstance(){return SessionMemoryStorage_o.instance||(SessionMemoryStorage_o.instance=new SessionMemoryStorage_o),SessionMemoryStorage_o.instance}static resetInstance(){SessionMemoryStorage_o.instance&&(SessionMemoryStorage_o.instance=null)}deleteFromStore(p){p.forEach((p=>{this._featureLookup.delete(p)}))}readFromStoreByList(p){const M=[];return p.forEach((p=>{const T=this.readFromStoreById(p);T&&M.push(T)})),M}readFromStoreById(p){var M;return null!==(M=this._featureLookup.get(p))&&void 0!==M?M:null}writeToStore(p,M,T){const k=[];return p.forEach((p=>{if(null===p||void 0===p||!p.id)return;p.properties||(p.properties=[]);let E,N=null;if(T&&p.properties[T]&&(N=(0,X.Ux)(p.properties[T])),"originId"in p&&"destinationId"in p&&(p.properties.ESRI__ORIGIN_ID=p.originId,p.properties.ESRI__DESTINATION_ID=p.destinationId),p.properties[M]=p.id,p.id&&this._featureLookup.has(p.id)&&this._featureLookup.get(p.id).attributes){const k=this._featureLookup.get(p.id),D=JSON.parse(JSON.stringify(Object.assign(k.attributes,p.properties)));T&&p.properties[T]&&(D[T]=(0,ne.rS)(p.properties[T])),E=new ie.Om(N?JSON.parse(JSON.stringify(N)):null!==k&&void 0!==k&&k.geometry?JSON.parse(JSON.stringify(k.geometry)):null,D,null,p.properties[M])}else E=new ie.Om(N?JSON.parse(JSON.stringify(N)):null,p.properties,null,p.properties[M]);this._featureLookup.set(p.id,E),k.push(E)})),k}}T(53705);var ae,oe=T(9422),se=T(31827);T(98664);!function(p){p.ELEMENTUID="ELEMENTUID",p.TYPENAME="TYPENAME"}(ae||(ae={}));ae.ELEMENTUID,ae.TYPENAME;var re,le;!function(p){p[p.ELEMENTUID=0]="ELEMENTUID",p[p.TYPENAME=1]="TYPENAME"}(re||(re={})),function(p){p[p.ELEMENTUID=0]="ELEMENTUID",p[p.TYPENAME=1]="TYPENAME",p[p.FROMUID=2]="FROMUID",p[p.TOUID=3]="TOUID"}(le||(le={}));var he,de,ue,ce;T(11350),T(19566);function supportUtils_u(p){if(!p.spatialReference.isWGS84)throw new N.A("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let M;return M=p.xmax>180&&p.xmin<180?[[[p.xmin,p.ymin],[p.xmin,p.ymax],[180,p.ymax],[180,p.ymin],[p.xmin,p.ymin]],[[-180,p.ymin],[-180,p.ymax],[p.xmax-360,p.ymax],[p.xmax-360,p.ymin],[-180,p.ymin]]]:p.xmax>180&&p.xmin>180?[[[p.xmin-360,p.ymin],[p.xmin-360,p.ymax],[p.xmax-360,p.ymax],[p.xmax-360,p.ymin],[p.xmin-360,p.ymin]]]:p.xmax>-180&&p.xmin<-180?[[[p.xmin+360,p.ymin],[p.xmin+360,p.ymax],[180,p.ymax],[180,p.ymin],[p.xmin+360,p.ymin]],[[-180,p.ymin],[-180,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[-180,p.ymin]]]:p.xmax<-180&&p.xmin<-180?[[[p.xmin+360,p.ymin],[p.xmin+360,p.ymax],[p.xmax+360,p.ymax],[p.xmax+360,p.ymin],[p.xmin+360,p.ymin]]]:[[[p.xmin,p.ymin],[p.xmin,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[p.xmin,p.ymin]]],M}!function(p){p[p.featureResult=0]="featureResult",p[p.countResult=1]="countResult",p[p.idsResult=2]="idsResult"}(he||(he={})),function(p){p[p.upperLeft=0]="upperLeft",p[p.lowerLeft=1]="lowerLeft"}(de||(de={})),function(p){p[p.sqlTypeBigInt=0]="sqlTypeBigInt",p[p.sqlTypeBinary=1]="sqlTypeBinary",p[p.sqlTypeBit=2]="sqlTypeBit",p[p.sqlTypeChar=3]="sqlTypeChar",p[p.sqlTypeDate=4]="sqlTypeDate",p[p.sqlTypeDecimal=5]="sqlTypeDecimal",p[p.sqlTypeDouble=6]="sqlTypeDouble",p[p.sqlTypeFloat=7]="sqlTypeFloat",p[p.sqlTypeGeometry=8]="sqlTypeGeometry",p[p.sqlTypeGUID=9]="sqlTypeGUID",p[p.sqlTypeInteger=10]="sqlTypeInteger",p[p.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",p[p.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",p[p.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",p[p.sqlTypeNChar=14]="sqlTypeNChar",p[p.sqlTypeNVarChar=15]="sqlTypeNVarChar",p[p.sqlTypeOther=16]="sqlTypeOther",p[p.sqlTypeReal=17]="sqlTypeReal",p[p.sqlTypeSmallInt=18]="sqlTypeSmallInt",p[p.sqlTypeSqlXml=19]="sqlTypeSqlXml",p[p.sqlTypeTime=20]="sqlTypeTime",p[p.sqlTypeTimestamp=21]="sqlTypeTimestamp",p[p.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",p[p.sqlTypeTinyInt=23]="sqlTypeTinyInt",p[p.sqlTypeVarbinary=24]="sqlTypeVarbinary",p[p.sqlTypeVarchar=25]="sqlTypeVarchar"}(ue||(ue={})),function(p){p[p.OID_ARRAY=0]="OID_ARRAY",p[p.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",p[p.STRING_ARRAY=2]="STRING_ARRAY",p[p.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(ce||(ce={}));var pe=T(49096),ye=T(84661);const me="ESRI__ID",fe="ESRI__ORIGIN_ID",ge="ESRI__DESTINATION_ID",ve="ESRI__LAYOUT_GEOMETRY",xe="ESRI__AGGREGATION_COUNT",Me=12;let _e=class extends H.A{constructor(p){var M,T,k;super(p),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const E=new Map;null!==(M=p.knowledgeGraph.dataModel.entityTypes)&&void 0!==M&&M.forEach((M=>{var T,k;M.name&&(E.set(M.name,"entity"),this._processingCacheUpdatesLookup.set(M.name,[]),p.inclusionModeDefinition&&!(null!==(T=p.inclusionModeDefinition)&&void 0!==T&&T.generateAllSublayers)||this.entityTypeNames.add(M.name),null===(k=M.properties)||void 0===k||k.forEach((p=>{var T;p.geometryType&&"esriGeometryNull"!==p.geometryType&&this.geographicLookup.set(M.name,{name:null!==(T=p.name)&&void 0!==T?T:"",geometryType:p.geometryType})})))})),null!==(T=p.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==T&&T.forEach((M=>{var T,k;M.name&&(E.set(M.name,"relationship"),this._processingCacheUpdatesLookup.set(M.name,[]),p.inclusionModeDefinition&&!(null!==(T=p.inclusionModeDefinition)&&void 0!==T&&T.generateAllSublayers)||this.relationshipTypeNames.add(M.name),null===(k=M.properties)||void 0===k||k.forEach((p=>{var T;p.geometryType&&"esriGeometryNull"!==p.geometryType&&this.geographicLookup.set(M.name,{name:null!==(T=p.name)&&void 0!==T?T:"",geometryType:p.geometryType})})))})),null===(k=p.inclusionModeDefinition)||void 0===k||k.namedTypeDefinitions.forEach(((M,T)=>{var k;if("entity"===E.get(T))this.entityTypeNames.add(T);else{var N;if("relationship"!==E.get(T))return D.A.getLogger(this).warn("A named type, ".concat(T,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(N=p.inclusionModeDefinition)||void 0===N||N.namedTypeDefinitions.delete(T));this.relationshipTypeNames.add(T)}const F=new Map;null!==(k=M.members)&&void 0!==k&&k.forEach((p=>{(0,K.tE)(this.memberIdTypeLookup,p.id,(()=>new Set)).add(T);const M=this.getById(p.id);M&&F.set(p.id,M)})),this.sublayerCaches.set(T,F)}))}addToLayer(p){p.forEach((p=>{let{typeName:M,id:T}=p;if(!this.inclusionModeDefinition)throw new N.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(M)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(M)){const p=this.inclusionModeDefinition.namedTypeDefinitions.get(M);p.members||(p.members=new Map),p.members.set(T,{id:T}),(0,K.tE)(this.memberIdTypeLookup,T,(()=>new Set)).add(M)}}else{const p=new Map;p.set(T,{id:T}),this.inclusionModeDefinition.namedTypeDefinitions.set(M,{useAllData:!1,members:p}),(0,K.tE)(this.memberIdTypeLookup,T,(()=>new Set)).add(M)}}))}getById(p){return SessionMemoryStorage_o.getInstance().readFromStoreById(p)}async getData(p,M,T){var k;if(M.objectType.name&&null!==(k=this.inclusionModeDefinition)&&void 0!==k&&k.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(M.objectType.name))return[];let E;if(E=p||new pe.A({where:"1=1",outFields:["*"]}),"link-chart"===M.parentCompositeLayer.type){var N,D,F;const p=M.parentCompositeLayer,T=this._processingCacheUpdatesLookup.get(null!==(N=M.objectType.name)&&void 0!==N?N:""),k=E.outFields,Z=E.geometry;let O="",Q="";Z&&Z.extent&&(O=(0,q.Qj)(Z.extent.ymin,Z.extent.xmin,Me),Q=(0,q.Qj)(Z.extent.ymax,Z.extent.xmax,Me)),k&&1===k.length&&k[0]===me&&"1=1"===E.where||await Promise.all(null!==T&&void 0!==T?T:[]);const X=this.sublayerCaches.has(null!==(D=M.objectType.name)&&void 0!==D?D:"")?Array.from(null===(F=this.sublayerCaches.get(M.objectType.name))||void 0===F?void 0:F.values()):[],J=[];return X.forEach((T=>{if(this.relationshipTypeNames.has(M.objectType.name)?T.geometry=p.relationshipLinkChartDiagramLookup.get(T.attributes[M.objectIdField]):T.geometry=p.entityLinkChartDiagramLookup.get(T.attributes[M.objectIdField]),T.attributes[ve]=T.geometry,O&&Q){const k=p.linkChartGeohashLookup.get(T.attributes[M.objectIdField]);k?k>=O&&k<=Q&&J.push(T):J.push(T)}else J.push(T)})),J}return this.retrieveDataFromService(E,M,T)}async getConnectedRecordIds(p,M){const T=[];let k="";const E=[],N=new Map;if(p.forEach((p=>{if(this.memberIdTypeLookup.has(p))for(const T of this.memberIdTypeLookup.get(p)){var M;if(!this.entityTypeNames.has(T))return;N.has(T)?null===(M=N.get(T))||void 0===M||M.push(p):N.set(T,[p])}})),M&&0!==(null===M||void 0===M?void 0:M.length)){for(const p of M)k=k+p+"|";k=k.slice(0,-1)}return N.forEach(((p,N)=>{let F;F=M&&0!==(null===M||void 0===M?void 0:M.length)?"MATCH (n:".concat(N,")-[r:").concat(k,"]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]"):"MATCH (n:".concat(N,")-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]");const Z=new Promise((M=>{(async()=>{const M=(await(0,oe.executeQueryStreaming)(this.knowledgeGraph,new se.A({openCypherQuery:F,bindParameters:{ids:p}}))).resultRowsStream.getReader();try{for(;;){const{done:p,value:k}=await M.read();if(p)break;for(let M=0;M<k.length;M++){const p=k[M];T.push({id:p[0],typeName:p[1]}),T.push({id:p[2],typeName:p[3]})}}}catch(k){if("AbortError"!==k.name)throw k;D.A.getLogger(this).info("Request aborted as expected")}})().then((()=>{M()}))}));E.push(Z)})),this.refreshCacheContent(),await Promise.all(E),T}async refreshCacheContent(p,M,T){var k,E,D,F,Z;let O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=SessionMemoryStorage_o.getInstance(),Q=[],X=new Map,J=new Map;null!==(k=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==k&&k.forEach((p=>{p.name&&J.set(p.name,p)})),null!==(E=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==E&&E.forEach((p=>{p.name&&J.set(p.name,p)})),p||this.inclusionModeDefinition?p?p.forEach((p=>{if(this.memberIdTypeLookup.has(p))for(const T of this.memberIdTypeLookup.get(p)){var M;X.has(T)?null===(M=X.get(T))||void 0===M||M.push(p):X.set(T,[p])}})):null===(D=this.inclusionModeDefinition)||void 0===D||null===(D=D.namedTypeDefinitions)||void 0===D||D.forEach(((p,M)=>{p.useAllData?X.set(M,null):p.members&&p.members.forEach((p=>{var T;X.has(M)&&null!==X.get(M)?null===(T=X.get(M))||void 0===T||T.push(p.id):X.set(M,[p.id])}))})):(null!==(F=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==F&&F.forEach((p=>{p.name&&X.set(p.name,null)})),null===(Z=this.knowledgeGraph.dataModel.entityTypes)||void 0===Z||Z.forEach((p=>{p.name&&X.set(p.name,null)})));for(const[$,V]of X){var H;const p=new Promise((p=>{(async()=>{var p;const k=new Set,E=[];let D,F="",Z=!1;if(M||null!==(p=J.get($))&&void 0!==p&&null!==(p=p.properties)&&void 0!==p&&p.forEach((p=>{p.name&&k.add(p.name)})),T&&this.geographicLookup.has($)){var Q;const p=null===(Q=this.geographicLookup.get($))||void 0===Q?void 0:Q.name;p&&k.add(p)}if(this.entityTypeNames.has($))F="MATCH (n:".concat($,") ").concat(V?"WHERE id(n) IN $ids ":"","return ID(n)"),k.forEach((p=>{F+=", n.".concat(p),E.push(p)}));else{if(!this.relationshipTypeNames.has($))throw new N.A("knowledge-graph:layer-data-manager","The graph type of ".concat($," could not be determined. Was this type set in the KG data model and inclusion definition?"));Z=!0,F="MATCH ()-[n:".concat($,"]->() ").concat(V?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),k.forEach((p=>{F+=", n.".concat(p),E.push(p)}))}D=new se.A(V?{openCypherQuery:F,bindParameters:{ids:V}}:{openCypherQuery:F});const X=(await(0,oe.executeQueryStreaming)(this.knowledgeGraph,D)).resultRowsStream.getReader();for(;;){var H,ee,te,ie;const{done:p,value:M}=await X.read();if(p)break;const T=[];for(let D=0;D<M.length;D++){const p=M[D];let k=0,N=0;const F={properties:{}};for(F.id=p[k],k++,N++,Z&&(F.originId=p[k],k++,N++,F.destinationId=p[k],k++,N++,(0,K.tE)(this.nodeConnectionsLookup,F.originId,(()=>new Set)).add(F.id),(0,K.tE)(this.nodeConnectionsLookup,F.destinationId,(()=>new Set)).add(F.id),(0,K.tE)(this.relationshipConnectionsLookup,F.id,(()=>[F.originId,F.destinationId])));k<p.length;k++)F.properties[E[k-N]]=p[k];T.push(F)}const k=q.writeToStore(T,me,null===(H=this.geographicLookup.get($))||void 0===H?void 0:H.name);this.sublayerCaches.has($)||this.sublayerCaches.set($,new Map),O&&!(null!==(ee=this.inclusionModeDefinition)&&void 0!==ee&&ee.namedTypeDefinitions.has($))&&null!==(te=this.inclusionModeDefinition)&&void 0!==te&&te.namedTypeDefinitions.set($,{useAllData:!1,members:new Map}),O&&(null===(ie=this.inclusionModeDefinition)||void 0===ie||!ie.namedTypeDefinitions.get($).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get($).members=new Map);const N=this.sublayerCaches.get($);k.forEach((p=>{var M,T;null!==N&&void 0!==N&&N.set(p.attributes[me],p),O&&(null===(M=this.inclusionModeDefinition)||void 0===M||!M.namedTypeDefinitions.get($).members.has(p.attributes[me]))&&(null!==(T=this.inclusionModeDefinition)&&void 0!==T&&T.namedTypeDefinitions.get($).members.set(p.attributes[me],{id:p.attributes[me]}),(0,K.tE)(this.memberIdTypeLookup,p.attributes[me],(()=>new Set)).add($))}))}})().then((()=>{p(null)}))}));Q.push(p),null===(H=this._processingCacheUpdatesLookup.get($))||void 0===H||H.push(p)}await Promise.all(Q)}removeFromLayer(p){const M=new Set,T=new Set(p.map((p=>p.id)));for(const D of p){var k,E,N;M.add(D.typeName),1===(null===(k=this.memberIdTypeLookup.get(D.id))||void 0===k?void 0:k.size)?this.memberIdTypeLookup.delete(D.id):null===(E=this.memberIdTypeLookup.get(D.id))||void 0===E||E.delete(D.typeName),null===(N=this.inclusionModeDefinition)||void 0===N||N.namedTypeDefinitions.forEach(((p,M)=>{var T;M===D.typeName&&(null===(T=p.members)||void 0===T?void 0:T.has(D.id))&&p.members.delete(D.id)}))}M.forEach((p=>{var M;null===(M=this.sublayerCaches.get(p))||void 0===M||M.forEach(((M,k)=>{var E;T.has(k)&&(null===(E=this.sublayerCaches.get(p))||void 0===E||E.delete(k))}))}))}async retrieveDataFromService(p,M,T){var k,E,D;const F=SessionMemoryStorage_o.getInstance(),Z=new Set,O=[];let q,Q="",X=[];const J="relationship"===M.graphType,H=null===(k=this.inclusionModeDefinition)||void 0===k||null===(k=k.namedTypeDefinitions)||void 0===k||null===(k=k.get(M.objectType.name))||void 0===k?void 0:k.useAllData,K=M.parentCompositeLayer.sublayerIdsCache.get(M.objectType.name);let ie=!H&&K?Array.from(K).sort():null;if(null!==(E=this.inclusionModeDefinition)&&void 0!==E&&null!==(E=E.namedTypeDefinitions)&&void 0!==E&&null!==(E=E.get(M.objectType.name))&&void 0!==E&&E.useAllData)(null===(D=this.inclusionModeDefinition)||void 0===D||null===(D=D.namedTypeDefinitions)||void 0===D||null===(D=D.get(M.objectType.name))||void 0===D?void 0:D.useAllData)&&null!=p.objectIds&&(ie=p.objectIds);else if(null!=p.objectIds&&ie&&ie.length>0){const M=p.objectIds;p.objectIds=ie.filter((p=>M.includes(p)))}else if(null!=p.objectIds)ie=p.objectIds;else{var ne,ae,re;if(null!==(ne=this.inclusionModeDefinition)&&void 0!==ne&&ne.namedTypeDefinitions.has(M.objectType.name)&&(null===(ae=this.inclusionModeDefinition.namedTypeDefinitions.get(M.objectType.name))||void 0===ae||!ae.members||(null===(re=this.inclusionModeDefinition.namedTypeDefinitions.get(M.objectType.name))||void 0===re||null===(re=re.members)||void 0===re?void 0:re.size)<1))return p.objectIds=[],[];p.objectIds=ie}if(null!=p.outFields){const T=p.outFields;T.includes("*")?M.fields.forEach((p=>{Z.add(p.name)})):T.forEach((p=>{p!==me&&p!==M.geometryFieldName&&Z.add(p)}))}if(null!=p.geometry){var le,he,de;const T=p.geometry;let k;const E=M.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,D=null===E||void 0===E?void 0:E.spatialReference,F=null===E||void 0===E||null===(le=E.serviceCapabilities)||void 0===le?void 0:le.geometryCapabilities;let X=null===F||void 0===F?void 0:F.geometryMaxBoundingRectangleSizeX,H=null===F||void 0===F?void 0:F.geometryMaxBoundingRectangleSizeY;if(null===T||void 0===T||null===(he=T.extent)||void 0===he||!he.spatialReference||null!==(de=T.spatialReference)&&void 0!==de&&de.isWGS84?k=T.extent:(await(0,ee.initializeProjection)(T.extent.spatialReference,te.KK),k=(0,ee.project)(T.extent,te.KK)),X&&H&&D){if(4326!==D.wkid){const p=new ye.A({spatialReference:D,xmax:X,ymax:H}),M=(0,ee.project)(p,te.KK);X=M.xmax,H=M.ymax}if(k.xmax-k.xmin>X)throw new N.A("knowledge-graph:layer-data-manager","Extent x bounds should be within ".concat(X,"\xb0 latitude, limit exceeded"));if(k.ymax-k.ymin>H)throw new N.A("knowledge-graph:layer-data-manager","Extent y bounds should be within ".concat(H,"\xb0 longitude, limit exceeded"))}if(null!=p.where&&"1=1"!==p.where){const T=await(0,$.G)(p.where.toUpperCase(),M.fieldsIndex);M.fields.forEach((p=>{T.fieldNames.includes(p.name)&&Z.add(p.name)}))}Q=J?"Match ()-[n:".concat(M.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(M.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(M.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(M.geometryFieldName,") return ID(n)"),M.geometryFieldName&&Z.add(M.geometryFieldName),Z.forEach((p=>{Q+=", n.".concat(p),O.push(p)})),q=new se.A({openCypherQuery:Q,bindParameters:{param_filter_geom:new V.A({rings:supportUtils_u(k)})}})}else{let T="";if(null!=p.where&&"1=1"!==p.where){const k=await(0,$.G)(p.where,M.fieldsIndex);M.fields.forEach((p=>{k.fieldNames.includes(p.name)&&Z.add(p.name)}));const E=new Set(["column-reference","string","number","binary-expression"]),N=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let D=!1;const d=p=>{if("column-reference"===p.type)return"n.".concat(p.column);if("string"===p.type)return"'".concat(p.value,"'");if("number"===p.type)return"".concat(p.value);if("binary-expression"===p.type&&E.has(p.left.type)&&E.has(p.right.type)&&N.has(p.operator))return"".concat(d(p.left)," ").concat(p.operator," ").concat(d(p.right));if("binary-expression"===p.type&&"LIKE"===p.operator){let M="";if("function"===p.left.type&&"column-reference"===p.left.args.value[0].type)M+="lower(n.".concat(p.left.args.value[0].column,")");else{if("column-reference"!==p.left.type)return D=!0,"";M+="lower(n.".concat(p.left.column,")")}if(M+=" CONTAINS (","string"!==p.right.type)return D=!0,"";{let T=p.right.value;"%"===T.charAt(0)&&(T=T.slice(1)),"%"===T.charAt(T.length-1)&&(T=T.slice(0,-1)),M+="'".concat(T.toLowerCase(),"')")}return M}return D=!0,""};T=d(k.parseTree),D&&(T="")}let k="";k=J?"Match ()-[n:".concat(M.objectType.name,"]->()"):"Match (n:".concat(M.objectType.name,")");let E=!1;ie&&(E=!0,k+=" WHERE ID(n) IN $ids"),T&&(k+=E?" AND":" WHERE",k+=" ".concat(T)),k+=" return ID(n)",J&&(k+=", id(startNode(n)), id(endNode(n))"),p.returnGeometry&&M.geometryFieldName&&Z.add(M.geometryFieldName),Z.forEach((p=>{k+=", n.".concat(p),O.push(p)})),q=new se.A(ie?{openCypherQuery:k,bindParameters:{ids:ie}}:{openCypherQuery:k})}const ue=(await(0,oe.executeQueryStreaming)(M.parentCompositeLayer.dataManager.knowledgeGraph,q,T)).resultRowsStream.getReader();for(;;){var ce;const{done:p,value:T}=await ue.read();if(p)break;const k=[];for(let M=0;M<T.length;M++){const p=T[M];let E=0,N=0;const D={properties:{}};for(D.id=p[E],E++,N++,J&&(D.originId=p[E],E++,N++,D.destinationId=p[E],E++,N++);E<p.length;E++)D.properties[O[E-N]]=p[E];k.push(D)}X=X.concat(F.writeToStore(k,me,null===(ce=M.parentCompositeLayer.dataManager.geographicLookup.get(M.objectType.name))||void 0===ce?void 0:ce.name))}return X}};(0,k._)([(0,Z.MZ)()],_e.prototype,"knowledgeGraph",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"inclusionModeDefinition",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"entityTypeNames",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"relationshipTypeNames",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"geographicLookup",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"sublayerCaches",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"nodeConnectionsLookup",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"relationshipConnectionsLookup",void 0),(0,k._)([(0,Z.MZ)()],_e.prototype,"memberIdTypeLookup",void 0),_e=(0,k._)([(0,O.$)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],_e);var be=T(21365),we=(T(1804),T(26374),T(2725),T(66178),T(52902),T(55088),T(27150),T(16534),T(53440)),Te=T(80830),Le=(T(80563),T(45691)),Ce=T(56103),ke=T(39584);const Ie=(0,T(19894).p)(),KnowledgeGraphSublayerBase_p=p=>{let M=class extends p{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,k._)([(0,Z.MZ)(Ie.fields)],M.prototype,"fields",void 0),(0,k._)([(0,Z.MZ)(Ie.fieldsIndex)],M.prototype,"fieldsIndex",void 0),M=(0,k._)([(0,O.$)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],M),M};var Ee=T(53200),Ae=T(38180),Re=T(68777),Se=T(38362),Ne=T(32277),De=T(67871),Ge=T(57022),Be=T(94309),je=T(7445),Pe=T(58697),Fe=T(60141),Ze=T(40304);let Oe=class extends((0,Ae.J)(KnowledgeGraphSublayerBase_p((0,Ee.d)((0,Se.j)((0,Re.J)(Q.A)))))){constructor(p){var M,T,k,E,N;if(super(p),M=this,this.capabilities=(0,ke.f)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=me,this.objectType=null,this.parentCompositeLayer=null,this.popupEnabled=!0,this.popupTemplate=null,this.source={openPorts:()=>this.load().then((()=>{const p=new MessageChannel;return new Pe.A(p.port1,{channel:p,client:{queryFeatures:function(p){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const k=pe.A.fromJSON(p);return M.queryFeaturesJSON(k,T)}}}),[p.port2]}))},this.type="knowledge-graph-sublayer","link-chart"===p.parentCompositeLayer.type)"relationship"===p.graphType?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName=ve;else if(null!==(T=p.parentCompositeLayer.dataManager.geographicLookup.get(p.objectType.name))&&void 0!==T&&T.geometryType&&"esriGeometryNull"!==(null===(k=p.parentCompositeLayer.dataManager.geographicLookup.get(p.objectType.name))||void 0===k?void 0:k.geometryType)){var D,F,Z,O;const M=p.parentCompositeLayer.dataManager.geographicLookup.get(p.objectType.name);this.geometryFieldName=null!==(D=null===M||void 0===M?void 0:M.name)&&void 0!==D?D:null,this.geometryType=null!==M&&void 0!==M&&M.geometryType?Ze.g.fromJSON(M.geometryType):null;const T=null===M||void 0===M?void 0:M.name,k=T?null===(F=p.objectType.properties)||void 0===F?void 0:F[T]:null;k?(this.hasM=null!==(Z=k.hasM)&&void 0!==Z&&Z,this.hasZ=null!==(O=k.hasZ)&&void 0!==O&&O):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;null!==(E=p.objectType.properties)&&void 0!==E&&E.forEach((p=>{let M=p.fieldType;"esriFieldTypeOID"===M&&(M="esriFieldTypeInteger"),this.fields.push(De.A.fromJSON({name:p.name,type:M,alias:p.alias,defaultValue:null,editable:p.editable,nullable:p.nullable}))})),this.fields.push(De.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this.fields.push(De.A.fromJSON({name:xe,type:"esriFieldTypeInteger",alias:xe,editable:!1})),this._set("fields",[...this.fields]),null!==(N=p.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)&&void 0!==N&&N.spatialReference&&(this.spatialReference=p.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===p.parentCompositeLayer.type?"relationship"===p.graphType?this.renderer=(0,we.r)((0,ke.F0)(Ze.g.toJSON("polyline")).renderer):this.renderer=(0,we.r)((0,ke.F0)(Ze.g.toJSON("point")).renderer):this.renderer=(0,we.r)((0,ke.F0)(Ze.g.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(p){(0,Ge.yp)(p,this.fieldsIndex),this._set("renderer",p)}createPopupTemplate(p){return(0,je.tn)(this,p)}createQuery(){return new pe.A({where:"1=1",outFields:["*"]})}getField(p){for(let M=0;M<this.fields.length;M++)if(this.fields[M].name===p)return this.fields[M];return null}getFieldDomain(p,M){return null}async queryFeatures(p,M){const{resolvedQuery:T,queryEngine:k}=await this._setupQueryObjects(p),E=Be.A.fromJSON(await k.executeQuery(T.toJSON(),null===M||void 0===M?void 0:M.signal));return E.features.forEach((p=>{p.sourceLayer=this})),E}async queryFeaturesJSON(p,M){const{resolvedQuery:T,queryEngine:k}=await this._setupQueryObjects(p);return await k.executeQuery(T.toJSON(),null===M||void 0===M?void 0:M.signal)}async queryFeatureCount(p,M){const{resolvedQuery:T,queryEngine:k}=await this._setupQueryObjects(p);return k.executeQueryForCount(T.toJSON(),null===M||void 0===M?void 0:M.signal)}async queryExtent(){var p,M,T,k;let E=arguments.length>1?arguments[1]:void 0;const N={...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},returnGeometry:!0},{resolvedQuery:D,queryEngine:F}=await this._setupQueryObjects(N),Z=await F.executeQueryForExtent(D.toJSON(),null===E||void 0===E?void 0:E.signal);let O;return O=null!=(null===(p=Z.extent)||void 0===p?void 0:p.xmin)&&null!=(null===(M=Z.extent)||void 0===M?void 0:M.xmax)&&null!=(null===(T=Z.extent)||void 0===T?void 0:T.ymin)&&null!=(null===(k=Z.extent)||void 0===k?void 0:k.ymax)?new ye.A(Z.extent):new ye.A,{count:Z.count,extent:O}}async queryObjectIds(p,M){const T=pe.A.from(p);let k;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)k=this._cachedQueryEngine;else{const p=await this.parentCompositeLayer.dataManager.getData(T,this,M);k=this.loadQueryEngine(p)}return k.executeQueryForIds(T.toJSON(),null===M||void 0===M?void 0:M.signal)}loadQueryEngine(p){const M=new Le.A({geometryType:Ze.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),T=new Ce.d({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:Ze.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:M});return T.featureStore.addMany(p),T}async refreshCachedQueryEngine(){const p=await this.parentCompositeLayer.dataManager.getData(new pe.A({where:"1=1",outFields:[me]}),this);this._cachedQueryEngine=this.loadQueryEngine(p)}async _setupQueryObjects(p,M){var T;const k=pe.A.from(p),E=k.geometry;let N;if(E&&!(null!==(T=E.spatialReference)&&void 0!==T&&T.isWGS84)&&(await(0,ee.initializeProjection)(E.spatialReference,te.KK),k.geometry=(0,ee.project)(E instanceof V.A||E instanceof Fe.A?E:E.extent,te.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)N=this._cachedQueryEngine;else{const p=await this.parentCompositeLayer.dataManager.getData(k,this,M);N=this.loadQueryEngine(p)}return{resolvedQuery:k,queryEngine:N}}};(0,k._)([(0,Z.MZ)()],Oe.prototype,"capabilities",void 0),(0,k._)([(0,Z.MZ)({readOnly:!0})],Oe.prototype,"defaultPopupTemplate",null),(0,k._)([(0,Z.MZ)()],Oe.prototype,"definitionExpression",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"displayField",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"elevationInfo",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"geometryType",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"geometryFieldName",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"graphType",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"hasM",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"hasZ",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"labelsVisible",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"labelingInfo",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"objectIdField",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"objectType",void 0),(0,k._)([(0,Z.MZ)()],Oe.prototype,"parentCompositeLayer",void 0),(0,k._)([(0,Z.MZ)(Ne.M6)],Oe.prototype,"popupEnabled",void 0),(0,k._)([(0,Z.MZ)({type:be.A,json:{name:"popupInfo",write:!0}})],Oe.prototype,"popupTemplate",void 0),(0,k._)([(0,Z.MZ)({types:Te.H,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],Oe.prototype,"renderer",null),(0,k._)([(0,Z.MZ)()],Oe.prototype,"source",void 0),(0,k._)([(0,Z.MZ)({json:{read:!1}})],Oe.prototype,"type",void 0),Oe=(0,k._)([(0,O.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],Oe);const qe=Oe;var Ye=T(14795);let Qe,Ue=null;function LinkChartLayout_n(){return Qe||(Qe=T.e(6996).then(T.bind(T,96996)).then((p=>p.l)).then((p=>{let{default:M}=p;return M({locateFile:p=>(0,Ye.s)("esri/libs/linkchartlayout/".concat(p))})})).then((p=>{!function LinkChartLayout_s(p){Ue=p}(p)})),Qe)}var ze,Xe;function LinkChartLayout_y(p,M,T,k,E,N){const D=T.length,F=E.length,Z=Float64Array.BYTES_PER_ELEMENT,O=Uint32Array.BYTES_PER_ELEMENT,q=Uint8Array.BYTES_PER_ELEMENT,Q=15+D*(q+2*Z)+F*(2*O),X=Ue._malloc(Q);try{const q=X+16-X%16,Q=q+D*Z,J=Q+D*Z,H=J+F*O,K=H+F*O,L=()=>[Ue.HEAPF64.subarray(q>>3,(q>>3)+D),Ue.HEAPF64.subarray(Q>>3,(Q>>3)+D),Ue.HEAPU32.subarray(J>>2,(J>>2)+F),Ue.HEAPU32.subarray(H>>2,(H>>2)+F),Ue.HEAPU8.subarray(K,K+D)],[$,V,ee,te,ie]=L();$.set(T),V.set(k),ee.set(E),te.set(N),ie.set(M);let ne=p(D,K,q,Q,F,J,H),ae=null;if(ne){const p=Ue.getLayoutLinksTypes(),M=Ue.getLayoutLinksVerticesEndIndices(),T=Ue.getLayoutLinksVertices(),k=Ue.countLayoutLinksVertices();!F||p&&M?k&&!T?ne=!1:ae={types:new Uint8Array(Ue.HEAPU8.subarray(p,p+F)),vertexEndIndex:new Uint32Array(Ue.HEAPU32.subarray(M>>2,(M>>2)+F)),vertices:new Float64Array(Ue.HEAPF64.subarray(T>>3,(T>>3)+2*k))}:ne=!1}const[oe,se,re,le,he]=L();return T.set(oe),k.set(se),E.set(re),N.set(le),M.set(he),{success:ne,links:ae}}finally{Ue._free(X),Ue.cleanupLayout()}}!function(p){p[p.None=0]="None",p[p.IsMovable=1]="IsMovable",p[p.IsGeographic=2]="IsGeographic",p[p.IsRoot=4]="IsRoot"}(ze||(ze={})),function(p){p[p.Regular=0]="Regular",p[p.Orthogonal=1]="Orthogonal",p[p.Curved=2]="Curved",p[p.Recursive=3]="Recursive"}(Xe||(Xe={}));var Je,He,Ke,We,$e,Ve,et,tt;!function(p){p.getMinIdealEdgeLength=function e(){return Ue.getMinIdealEdgeLength()},p.apply=function a(p,M,T,k,E){let N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return LinkChartLayout_y(((p,M,T,k,E,Z,O)=>Ue.applyForceDirectedLayout(p,M,T,k,E,Z,O,N,D,F)),p,M,T,k,E)}}(Je||(Je={})),function(p){p.apply=function e(p,M,T,k,E){let N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return LinkChartLayout_y(((p,M,T,k,E,Z,O)=>Ue.applyCommunityLayout(p,M,T,k,E,Z,O,N,D,F)),p,M,T,k,E)}}(He||(He={})),function(p){p.apply=function e(p,M,T,k,E){return LinkChartLayout_y(Ue.applySimpleLayout,p,M,T,k,E)}}(Ke||(Ke={})),function(p){p.apply=function e(p,M,T,k,E){return LinkChartLayout_y(Ue.applyHierarchicalLayout,p,M,T,k,E)}}(We||(We={})),function(p){p.apply=function e(p,M,T,k,E){return LinkChartLayout_y(Ue.applyRadialTreeLayout,p,M,T,k,E)}}($e||($e={})),function(p){p.apply=function e(p,M,T,k,E){return LinkChartLayout_y(Ue.applySmartTreeLayout,p,M,T,k,E)}}(Ve||(Ve={})),function(p){p[p.Undirected=0]="Undirected",p[p.Directed=1]="Directed",p[p.Reversed=2]="Reversed"}(et||(et={})),function(p){p[p.ByCC_Raw=0]="ByCC_Raw",p[p.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",p[p.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(tt||(tt={}));var it=T(75561),nt=T(56260),at=T(57264);let ot=class extends((0,Ee.d)((0,Se.j)(Q.A))){constructor(p){if(super(p),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new E.A,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new ye.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new E.A,this.type="link-chart",this._originalInclusionList=p.inclusionModeDefinition,p.dataPreloadedInLocalCache&&!p.inclusionModeDefinition)throw new N.A("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(p){return{url:p.url,title:p.title,dataPreloadedInLocalCache:p.dataPreloadedInLocalCache,defaultLinkChartConfig:p.defaultLinkChartConfig}}_initializeLayerProperties(p){var M,T,k,E,F,Z,O,q,Q,X;if(!this.title&&this.url){const p=this.url.split("/");this.title=p[p.length-2]}const J=new Set;let H=[],K=[];if(p.inclusionModeDefinition&&(!p.inclusionModeDefinition.namedTypeDefinitions||p.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new N.A("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(M=p.knowledgeGraph.dataModel.entityTypes)&&void 0!==M&&M.forEach((p=>{p.name&&this._graphTypeLookup.set(p.name,p)})),null!==(T=p.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==T&&T.forEach((p=>{p.name&&this._graphTypeLookup.set(p.name,p)})),null!==(k=p.inclusionModeDefinition)&&void 0!==k&&k.generateAllSublayers?(H=null!==(E=p.knowledgeGraph.dataModel.entityTypes)&&void 0!==E?E:[],K=null!==(F=p.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==F?F:[]):null!==(Z=p.inclusionModeDefinition)&&void 0!==Z&&Z.namedTypeDefinitions&&(null===(O=p.inclusionModeDefinition)||void 0===O?void 0:O.namedTypeDefinitions.size)>0?null===(q=p.inclusionModeDefinition)||void 0===q||q.namedTypeDefinitions.forEach(((M,T)=>{var k,E;if(!this._graphTypeLookup.get(T))return D.A.getLogger(this).warn("A named type, ".concat(T,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(k=p.inclusionModeDefinition)||void 0===k||k.namedTypeDefinitions.delete(T));this._graphTypeLookup.get(T)instanceof nt.A||"strictOrigin"in this._graphTypeLookup.get(T)?J.has(T)||(J.add(T),K.push(this._graphTypeLookup.get(T))):this._graphTypeLookup.get(T)instanceof it.A||"properties"in this._graphTypeLookup.get(T)?J.has(T)||(J.add(T),H.push(this._graphTypeLookup.get(T))):(D.A.getLogger(this).warn("A named type, ".concat(T,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(E=p.inclusionModeDefinition)||void 0===E||E.namedTypeDefinitions.delete(T))})):(H=null!==(Q=p.knowledgeGraph.dataModel.entityTypes)&&void 0!==Q?Q:[],K=null!==(X=p.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==X?X:[]);const $=new _e({knowledgeGraph:p.knowledgeGraph,inclusionModeDefinition:p.inclusionModeDefinition});this.knowledgeGraph=p.knowledgeGraph,this.memberEntityTypes=H,this.memberRelationshipTypes=K,this.dataManager=$}load(p){return this.addResolvingPromise(new Promise((M=>{(0,oe.fetchKnowledgeGraph)(this.url).then((T=>{var k,E,N,D;if(this._initializeLayerProperties({knowledgeGraph:T,inclusionModeDefinition:this._originalInclusionList}),null!==(k=this.dataManager.inclusionModeDefinition)&&void 0!==k&&null!==(k=k.namedTypeDefinitions)&&void 0!==k&&k.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(E=this.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==E&&E.forEach((p=>{var M;p.name&&(null===(M=this.dataManager.inclusionModeDefinition)||void 0===M||M.namedTypeDefinitions.set(p.name,{useAllData:!0}))})),null!==(N=this.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==N&&N.forEach((p=>{var M;p.name&&(null===(M=this.dataManager.inclusionModeDefinition)||void 0===M||M.namedTypeDefinitions.set(p.name,{useAllData:!0}))}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(D=this.dataManager.inclusionModeDefinition)||void 0===D||D.namedTypeDefinitions.forEach((p=>{var M;p.useAllData=!1,null!==(M=p.members)&&void 0!==M&&M.forEach((p=>{let M;M=p.linkChartLocation instanceof J.A?p.linkChartLocation:p.linkChartLocation?(0,X.Ux)(p.linkChartLocation):null,M&&2===M.coords.length&&0===M.lengths.length?(this.linkChartGeohashLookup.set(p.id,(0,q.Qj)(M.coords[1],M.coords[0],Me)),this.entityLinkChartDiagramLookup.set(p.id,M)):(this.linkChartGeohashLookup.set(p.id,""),this.relationshipLinkChartDiagramLookup.set(p.id,M))})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async p=>{await p.refreshCachedQueryEngine()})),this.tables.forEach((async p=>{await p.refreshCachedQueryEngine()}))})))}));else{var Z;const M="GEOGRAPHIC"===(null===(Z=this.defaultLinkChartConfig)||void 0===Z?void 0:Z.layoutMode);this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,M,!0).then((async()=>{(0,F.Te)(p);const M=[],T=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((p=>{p.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((p=>{T.push(p.refreshCachedQueryEngine()),M.push(new Promise((M=>{p.on("layerview-create",(()=>{M(null)}))})))})),this.tables.forEach((p=>{T.push(p.refreshCachedQueryEngine())})),await Promise.all(T)})))}M(null)}))}))),Promise.resolve(this)}async addRecords(p,M){let T=[];(null===M||void 0===M?void 0:M.cascadeAddRelationshipEndNodes)&&this.dataManager.knowledgeGraph.dataModel&&(T=await async function w(p,M){var T;const k=[],E=new Map,N=[];if(null!==(T=M.dataModel)&&void 0!==T&&T.relationshipTypes)for(const F of M.dataModel.relationshipTypes)F.name&&E.set(F.name,[]);for(const F of p){var D;E.has(F.typeName)&&(null===(D=E.get(F.typeName))||void 0===D||D.push(F.id))}for(const[F,Z]of E){if(Z.length<1)continue;const p=new se.A({openCypherQuery:"MATCH (n)-[r:".concat(F,"]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]"),bindParameters:{ids:Z}});N.push((0,oe.executeQueryStreaming)(M,p).then((async p=>{const M=p.resultRowsStream.getReader();for(;;){const{done:p,value:T}=await M.read();if(p)break;for(const M of T)k.push({id:M[0],typeName:M[1]}),k.push({id:M[2],typeName:M[3]})}})))}return await Promise.all(N),k}(p,this.dataManager.knowledgeGraph));const k=p.concat(T).filter((p=>{var M;return!(null!==(M=this.sublayerIdsCache.get(p.typeName))&&void 0!==M&&M.has(p.id))}));await this._handleNewRecords(k)}async removeRecords(p){let{cascadeRemoveRelationships:M=!0,recalculateLayout:T=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cascadeRemoveRelationships:!0,recalculateLayout:!1},k=[];for(const Z of p){var E,N;!1===(null===(E=this.dataManager.inclusionModeDefinition)||void 0===E||null===(E=E.namedTypeDefinitions)||void 0===E||null===(E=E.get(Z.typeName))||void 0===E?void 0:E.useAllData)&&(null===(N=this.dataManager.inclusionModeDefinition)||void 0===N||null===(N=N.namedTypeDefinitions)||void 0===N||null===(N=N.get(Z.typeName))||void 0===N||null===(N=N.members)||void 0===N?void 0:N.has(Z.id))&&k.push(Z)}if(M){const p=new Set,M=[];for(const T of k)if(this.dataManager.nodeConnectionsLookup.has(T.id))for(const M of this.dataManager.nodeConnectionsLookup.get(T.id))p.add(M);for(const T of p)if(this.dataManager.memberIdTypeLookup.has(T))for(const p of this.dataManager.memberIdTypeLookup.get(T))this.dataManager.relationshipTypeNames.has(p)&&M.push({id:T,typeName:p});k=k.concat(M)}this.dataManager.removeFromLayer(k);for(const Z of k){var D;null!==(D=this.sublayerIdsCache.get(Z.typeName))&&void 0!==D&&D.delete(Z.id),this.dataManager.relationshipTypeNames.has(Z.typeName)?this.relationshipLinkChartDiagramLookup.delete(Z.id):this.entityLinkChartDiagramLookup.delete(Z.id)}T&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{});const F=[];return this.layers.forEach((p=>{F.push(p.refreshCachedQueryEngine())})),await Promise.all(F),this._refreshNamedTypes(),k}async expand(p,M){const T=await this.dataManager.getConnectedRecordIds(p,M),k=T.filter((p=>{var M;return!(null!==(M=this.sublayerIdsCache.get(p.typeName))&&void 0!==M&&M.has(p.id))}));return await this._handleNewRecords(T),{records:k}}loadLayerAssumingLocalCache(){var p,M;this.memberRelationshipTypes.forEach((p=>{const M=new qe({objectType:p,parentCompositeLayer:this,graphType:"relationship",title:p.name});M.geometryType?this.layers.push(M):this.tables.push(M),this.dataManager.sublayerCaches.has(p.name)||this.dataManager.sublayerCaches.set(p.name,new Map)})),this.memberEntityTypes.forEach((p=>{const M=new qe({objectType:p,parentCompositeLayer:this,graphType:"entity",title:p.name});M.geometryType?this.layers.push(M):this.tables.push(M),this.dataManager.sublayerCaches.has(p.name)||this.dataManager.sublayerCaches.set(p.name,new Map)})),(null===(p=this.dataManager.inclusionModeDefinition)||void 0===p?void 0:p.namedTypeDefinitions)&&(null===(M=this.dataManager.inclusionModeDefinition)||void 0===M||M.namedTypeDefinitions.forEach(((p,M)=>{var T;const k=((p,M,T)=>(p.has(M)||p.set(M,T()),p.get(M)))(this.sublayerIdsCache,M,(()=>new Set));null===(T=p.members)||void 0===T||T.forEach((p=>{if(k.add(p.id),p.linkChartLocation)if(p.linkChartLocation instanceof J.A)this.dataManager.relationshipTypeNames.has(M)?this.relationshipLinkChartDiagramLookup.set(p.id,p.linkChartLocation):this.entityLinkChartDiagramLookup.set(p.id,p.linkChartLocation),2===p.linkChartLocation.coords.length&&0===p.linkChartLocation.lengths.length?this.linkChartGeohashLookup.set(p.id,(0,q.Qj)(p.linkChartLocation.coords[1],p.linkChartLocation.coords[0],Me)):this.linkChartGeohashLookup.set(p.id,"");else{const T=(0,X.Ux)(p.linkChartLocation);this.dataManager.relationshipTypeNames.has(M)?this.relationshipLinkChartDiagramLookup.set(p.id,p.linkChartLocation?T:null):this.entityLinkChartDiagramLookup.set(p.id,p.linkChartLocation?T:null),"x"in p.linkChartLocation&&"y"in p.linkChartLocation?this.linkChartGeohashLookup.set(p.id,(0,q.Qj)(p.linkChartLocation.x,p.linkChartLocation.y,Me)):this.linkChartGeohashLookup.set(p.id,"")}}))})))}async calculateLinkChartLayout(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",M=arguments.length>1?arguments[1]:void 0;const T=[],k=[],E=[];this.dataManager.sublayerCaches.forEach(((p,M)=>{this.dataManager.entityTypeNames.has(M)?p.forEach((p=>{T.push({typeName:M,feature:p})})):this.dataManager.relationshipTypeNames.has(M)&&p.forEach((p=>{k.push({typeName:M,feature:p})}))})),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map;const F=new Map,Z=new Map,O=new Map,Q=new Map,J=new Uint8Array(T.length),H=new Float64Array(T.length),K=new Float64Array(T.length),$=new Uint32Array(k.length),V=new Uint32Array(k.length),ee=[],te=new ye.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let ie,ne="FORCE_DIRECTED",ae=0,oe=0;switch(ne="GEOGRAPHIC"===p?"FORCE_DIRECTED":p,ne){case"FORCE_DIRECTED":ie=Je.apply;break;case"COMMUNITY":ie=He.apply;break;case"HIERARCHICAL":ie=We.apply;break;case"RADIAL_TREE":ie=$e.apply;break;case"SMART_TREE":ie=Ve.apply;break;default:ie=Ke.apply}T.forEach((T=>{var k,E,N,D,F,Z;let{typeName:O,feature:q}=T;if(null!==M&&void 0!==M&&null!==(k=M.lockedNodeLocations)&&void 0!==k&&k.has(q.attributes[me])){"GEOGRAPHIC"===p&&this.dataManager.geographicLookup.has(O)?J[ae]=ze.IsGeographic:J[ae]=ze.None;const T=M.lockedNodeLocations.get(q.attributes[me]);H[ae]=T.x,K[ae]=T.y}else if("GEOGRAPHIC"===p&&this.dataManager.geographicLookup.has(O)){var X;J[ae]=ze.IsGeographic;let p=null;const M=q.attributes[this.dataManager.geographicLookup.get(O).name];switch(null===(X=this.dataManager.geographicLookup.get(O))||void 0===X?void 0:X.geometryType){case"esriGeometryPoint":H[ae]=null===M||void 0===M?void 0:M.x,K[ae]=null===M||void 0===M?void 0:M.y;break;case"esriGeometryPolygon":p=null===M||void 0===M?void 0:M.centroid,null!=(null===(E=p)||void 0===E?void 0:E.x)&&null!=(null===(N=p)||void 0===N?void 0:N.y)?(H[ae]=p.x,K[ae]=p.y):J[ae]=ze.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":p=null===M||void 0===M||null===(D=M.extent)||void 0===D?void 0:D.center,null!=(null===(F=p)||void 0===F?void 0:F.x)&&null!=(null===(Z=p)||void 0===Z?void 0:Z.y)?(H[ae]=p.x,K[ae]=p.y):J[ae]=ze.IsMovable;break;default:J[ae]=ze.IsMovable}(null==H[ae]||null==K[ae]||Number.isNaN(H[ae])||Number.isNaN(K[ae]))&&(J[ae]=ze.IsMovable,H[ae]=0,K[ae]=0)}else J[ae]=ze.IsMovable,H[ae]=0,K[ae]=0;Q.set(q.attributes[me],ae),ee[ae]={feature:q,typeName:O},ae++}));let se=!1;const re=new Map;k.forEach((p=>{const M=p.feature.attributes[fe],T=p.feature.attributes[ge],k=Q.get(M),N=Q.get(T);if(void 0!==k&&void 0!==N){const D=M+"-"+T,F=re.get(D);(null===F||void 0===F?void 0:F.has(p.typeName))||($[oe]=k,V[oe]=N,void 0===F?re.set(D,new Map([[p.typeName,oe]])):F.set(p.typeName,oe),oe++),E.push(p)}else se=!0,this.relationshipLinkChartDiagramLookup.set(M,null),this.linkChartGeohashLookup.set(M,null)})),se&&D.A.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await LinkChartLayout_n();const{success:le,links:he}=ie(J,H,K,$.subarray(0,oe),V.subarray(0,oe));if(!le)throw new N.A("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let N=0;N<ee.length;N++){if(K[N]>84.9999?K[N]=84.9999:K[N]<-84.9999&&(K[N]=-84.9999),H[N]>179.9999?H[N]=179.9999:H[N]<-179.9999&&(H[N]=-179.9999),ee[N].feature.attributes[ve]=new at.A(H[N],K[N]),F.has(ee[N].typeName)){const p=F.get(ee[N].typeName);null===p||void 0===p||p.set(ee[N].feature.attributes[me],ee[N].feature)}else{const p=new Map;p.set(ee[N].feature.attributes[me],ee[N].feature),F.set(ee[N].typeName,p)}O.set(ee[N].feature.attributes[me],ee[N].feature);const p=(0,X.Ux)(ee[N].feature.attributes[ve]);this.entityLinkChartDiagramLookup.set(ee[N].feature.attributes[me],ee[N].feature.attributes[ve]?p:null),this.linkChartGeohashLookup.set(ee[N].feature.attributes[me],(0,q.Qj)(ee[N].feature.attributes[ve].y,ee[N].feature.attributes[ve].x,Me)),ee[N].feature.attributes[ve].x<te.xmin&&(te.xmin=ee[N].feature.attributes[ve].x),ee[N].feature.attributes[ve].x>te.xmax&&(te.xmax=ee[N].feature.attributes[ve].x),ee[N].feature.attributes[ve].y<te.ymin&&(te.ymin=ee[N].feature.attributes[ve].y),ee[N].feature.attributes[ve].y>te.ymax&&(te.ymax=ee[N].feature.attributes[ve].y)}if(this.linkChartExtent.xmin=te.xmin,this.linkChartExtent.xmax=te.xmax,this.linkChartExtent.ymin=te.ymin,this.linkChartExtent.ymax=te.ymax,!he)throw new N.A("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const de=new Map,ue=new Map,ce=new Map,pe=new Set;for(let N=0;N<E.length;N++){const p=[],M=E[N],T=M.feature.attributes[fe],k=M.feature.attributes[ge],F=T+"-"+k,q=re.get(F).get(M.typeName),J=0===q?0:null===he||void 0===he?void 0:he.vertexEndIndex[q-1];if(!pe.has(q)){var _e,be;if(pe.add(q),he.types[q]===Xe.Recursive){const M=[he.vertices[2*J],he.vertices[2*J+1]],T=[he.vertices[2*(J+1)],he.vertices[2*(J+1)+1]],k=[.5*(M[0]+T[0]),.5*(M[1]+T[1])],E=[k[0]-M[0],k[1]-M[1]],N=[k[0]+E[1],k[1]-E[0]],D=[k[0]-E[1],k[1]+E[0]];p.push(M),p.push(N),p.push(T),p.push(D),p.push(M)}else{if(he.types[q]!==Xe.Regular){D.A.getLogger(this).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let M=J;M<he.vertexEndIndex[q];M++)p.push([he.vertices[2*M],he.vertices[2*M+1]])}const M=null===(_e=ee[Q.get(T)])||void 0===_e?void 0:_e.feature.attributes[ve],E=null===(be=ee[Q.get(k)])||void 0===be?void 0:be.feature.attributes[ve];p[0][0]===M.x&&p[0][1]===M.y||(p[0]=[M.x,M.y]),p[p.length-1][0]===E.x&&p[p.length-1][1]===E.y||(p[p.length-1]=[E.x,E.y]);for(let T=1;T<p.length-1;T++)p[T][1]>85.5?p[T][1]=85.5:p[T][1]<-85.5&&(p[T][1]=-85.5),p[T][0]>179.9999?p[T][0]=179.9999:p[T][0]<-179.9999&&(p[T][0]=-179.9999);de.has(F)?de.get(F).push(p):de.set(F,[p])}const H=de.get(F);ue.has(F)||(ue.set(F,new Map),ce.set(F,new Map));const K=ue.get(F),$=ce.get(F);K.has(M.typeName)||(K.set(M.typeName,H.shift()),$.set(M.typeName,0));const V=K.get(M.typeName);$.set(M.typeName,$.get(M.typeName)+1);const te=new Fe.A({paths:V});if(M.feature.attributes[ve]=te,Z.has(M.typeName)){const p=Z.get(M.typeName);null===p||void 0===p||p.set(M.feature.attributes[me],M.feature)}else{const p=new Map;p.set(M.feature.attributes[me],M.feature),Z.set(M.typeName,p)}O.set(M.feature.attributes[me],M.feature);const ie=(0,X.Ux)(M.feature.attributes[ve]);this.relationshipLinkChartDiagramLookup.set(M.feature.attributes[me],M.feature.attributes[ve]?ie:null),this.linkChartGeohashLookup.set(M.feature.attributes[me],"")}for(const N of E){var we,Te;N.feature.attributes[xe]=null!==(we=null===(Te=ce.get(N.feature.attributes[fe]+"-"+N.feature.attributes[ge]))||void 0===Te?void 0:Te.get(N.typeName))&&void 0!==we?we:null}return this._currentLinkChartConfig={layoutMode:p},{nodes:F,links:Z,idMap:O}}async applyNewLinkChartLayout(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",M=arguments.length>1?arguments[1]:void 0;const T=[];await this.calculateLinkChartLayout(p,M),this.layers.forEach((p=>{T.push(p.refreshCachedQueryEngine())})),await Promise.all(T),this._refreshNamedTypes()}getCurrentNodeLocations(){var p;const M=new Map;return null!==(p=this.dataManager.inclusionModeDefinition)&&void 0!==p&&null!==(p=p.namedTypeDefinitions)&&void 0!==p&&p.forEach((p=>{var T;null===p||void 0===p||null===(T=p.members)||void 0===T||T.forEach((p=>{const T=p.linkChartLocation;let k;const E=p.id;T&&(k="x"in T?{x:T.x,y:T.y}:{x:T.coords[0],y:T.coords[1]},M.set(E,new at.A({x:k.x,y:k.y})))}))})),M}async synchronizeInclusionListWithCache(){return new Promise((p=>{var M;null!==(M=this.dataManager.inclusionModeDefinition)&&void 0!==M&&M.namedTypeDefinitions.forEach(((p,M)=>{if(p.useAllData=!1,p.members&&p.members.size>0){if(!this.dataManager.sublayerCaches.get(M))return;const T=new Set(Array.from(this.dataManager.sublayerCaches.get(M).keys()));Array.from(p.members.keys()).filter((p=>!T.has(p))).forEach((M=>{var T;null===(T=p.members)||void 0===T||T.delete(M)}))}})),p()}))}async refreshLinkChartCache(p){await this.dataManager.refreshCacheContent(p);const M=[];this.layers.forEach((p=>{M.push(p.refreshCachedQueryEngine())})),await Promise.all(M),this._refreshNamedTypes()}async _handleNewRecords(p){const M=[];this.dataManager.addToLayer(p);for(const T of p)this.sublayerIdsCache.has(T.typeName)||(this.sublayerIdsCache.set(T.typeName,new Set),M.push(T.typeName)),this.sublayerIdsCache.get(T.typeName).add(T.id);for(const T of M)if(this._graphTypeLookup.has(T)){const p=this._graphTypeLookup.get(T),M="endPoints"in p?"relationship":"entity",k=new qe({objectType:p,parentCompositeLayer:this,graphType:M,title:T});"entity"===M?this.dataManager.entityTypeNames.add(T):this.dataManager.relationshipTypeNames.add(T),k.geometryType?this.layers.push(k):this.tables.push(k),this.dataManager.sublayerCaches.set(T,new Map)}await this.dataManager.refreshCacheContent(p.map((p=>p.id))),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode)}async _initializeDiagram(){var p;this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(null!==(p=this.dataManager.inclusionModeDefinition)&&void 0!==p&&null!==(p=p.namedTypeDefinitions)&&void 0!==p&&p.forEach(((p,M)=>{var T;null===p||void 0===p||null===(T=p.members)||void 0===T||T.forEach((p=>{const T=p.linkChartLocation;let k;const E=p.id;if(!T)return;k="x"in T?{x:T.x,y:T.y}:{x:T.coords[0],y:T.coords[1]};const N=(0,X.Ux)(k);this.dataManager.relationshipTypeNames.has(M)?this.relationshipLinkChartDiagramLookup.set(E,N):this.entityLinkChartDiagramLookup.set(E,N),this.linkChartGeohashLookup.set(E,(0,q.Qj)(k.x,k.y,Me)),this.linkChartExtent.xmin>k.x&&(this.linkChartExtent.xmin=k.x),this.linkChartExtent.xmax<k.x&&(this.linkChartExtent.xmax=k.x),this.linkChartExtent.ymin>k.y&&(this.linkChartExtent.ymin=k.y),this.linkChartExtent.ymax<k.y&&(this.linkChartExtent.ymax=k.y)}))})),this.memberRelationshipTypes.forEach((p=>{var M;p.name&&(null===(M=this.dataManager.sublayerCaches.get(p.name))||void 0===M||M.forEach((p=>{const M=this.relationshipLinkChartDiagramLookup.get(p.attributes[fe]),T=this.relationshipLinkChartDiagramLookup.get(p.attributes[ge]);if(M&&T){const k=(0,X.Ux)(new Fe.A({paths:[[M.coords[0],M.coords[1]],[T.coords[0],T.coords[1]]]}));this.relationshipLinkChartDiagramLookup.set(p.attributes[me],k)}else this.relationshipLinkChartDiagramLookup.set(p.attributes[me],null);this.linkChartGeohashLookup.set(p.attributes[me],"")})))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const p of this.layers)p.emit("refresh",{dataChanged:!0});for(const p of this.tables)p.emit("refresh",{dataChanged:!0})}};(0,k._)([(0,Z.MZ)()],ot.prototype,"dataPreloadedInLocalCache",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"defaultLinkChartConfig",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"dataManager",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"knowledgeGraph",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"layers",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"entityLinkChartDiagramLookup",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"linkChartExtent",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"linkChartGeohashLookup",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"memberEntityTypes",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"memberRelationshipTypes",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"sublayerIdsCache",void 0),(0,k._)([(0,Z.MZ)()],ot.prototype,"tables",void 0),(0,k._)([(0,Z.MZ)({json:{read:!1}})],ot.prototype,"type",void 0),ot=(0,k._)([(0,O.$)("esri.layers.LinkChartLayer")],ot);const st=ot},61816:(p,M,T)=>{T.d(M,{F:()=>o});var k=T(50886),E=T(30925),N=T(88965);const D={minX:0,minY:0,maxX:0,maxY:0};function e(p,M,T){(function t(p){D.minX=p[0],D.minY=p[1],D.maxX=p[2],D.maxY=p[3]})(M),p.search(D,T)}class o{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new E.w(9,(0,k.A)("esri-csp-restrictions")?p=>({minX:p[0],minY:p[1],maxX:p[2],maxY:p[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const p=new Array(this._idByBounds.size);let M=0;this._idByBounds.forEach(((T,k)=>{p[M++]=k})),this._indexInvalid=!1,this._index.clear(),this._index.load(p)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((p=>this._idByBounds.has(p)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const p=(0,N.Ie)();for(const M of this._boundsById.values())M&&(p[0]=Math.min(M[0],p[0]),p[1]=Math.min(M[1],p[1]),p[2]=Math.max(M[2],p[2]),p[3]=Math.max(M[3],p[3]));return p}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(p){const M=this._boundsById.get(p);this._boundsById.delete(p),M&&(this._idByBounds.delete(M),this._indexInvalid||this._index.remove(M))}forEachInBounds(p,M){this._loadIndex(),e(this._index,p,(p=>M(this._idByBounds.get(p))))}get(p){return this._boundsById.get(p)}has(p){return this._boundsById.has(p)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(p,M){if(!this._indexInvalid){const M=this._boundsById.get(p);M&&(this._index.remove(M),this._idByBounds.delete(M))}this._boundsById.set(p,M),M&&(this._idByBounds.set(M,p),this._indexInvalid||(this._boundsToLoad.push(M),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},45691:(p,M,T)=>{T.d(M,{A:()=>m});var k=T(16842),E=T(4180),N=T(73067),D=T(89412),F=T(21374),Z=T(88965),O=T(32050),q=T(61816),Q=T(23047),X=T(19464);const J=(0,F.vt)();class m{constructor(p){this.geometryInfo=p,this._boundsStore=new q.F,this._featuresById=new Map,this._markedIds=new Set,this.events=new N.A,this.featureAdapter=X.T}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let p=0;return this._featuresById.forEach((M=>{null!=M.geometry&&M.geometry.coords&&(p+=M.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:p/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(p){if(null==this.fullBounds)return null;const[M,T,k,E]=this.fullBounds;return{xmin:M,ymin:T,xmax:k,ymax:E,spatialReference:(0,Q.ag)(p)}}add(p){this._add(p),this._emitChanged()}addMany(p){for(const M of p)this._add(M);this._emitChanged()}upsertMany(p){const M=p.map((p=>this._upsert(p)));return this._emitChanged(),M.filter(k.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(p){const M=this._featuresById.get(p);return M?(this._remove(M),this._emitChanged(),M):null}removeManyById(p){this._boundsStore.invalidateIndex();for(const M of p){const p=this._featuresById.get(M);p&&this._remove(p)}this._emitChanged()}forEachBounds(p,M){for(const T of p){const p=this._boundsStore.get(T.objectId);p&&M((0,F.Jt)(J,p))}}getFeature(p){return this._featuresById.get(p)}has(p){return this._featuresById.has(p)}forEach(p){this._featuresById.forEach((M=>p(M)))}forEachInBounds(p,M){this._boundsStore.forEachInBounds(p,(p=>{M(this._featuresById.get(p))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let p=!1;this._featuresById.forEach(((M,T)=>{this._markedIds.has(T)||(p=!0,this._remove(M))})),this._markedIds.clear(),p&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(p){var M;if(!p)return;const T=p.objectId;if(null==T)return void D.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new E.A("featurestore:invalid-feature","feature id is missing",{feature:p}));const k=this._featuresById.get(T);let N;if(this._markedIds.add(T),k?(p.displayId=k.displayId,N=this._boundsStore.get(T),this._boundsStore.delete(T)):null!=this.onFeatureAdd&&this.onFeatureAdd(p),null===(M=p.geometry)||void 0===M||null===(M=M.coords)||void 0===M||!M.length)return this._boundsStore.set(T,null),void this._featuresById.set(T,p);N=(0,O.jQ)(null!=N?N:(0,Z.vt)(),p.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=N&&this._boundsStore.set(T,N),this._featuresById.set(T,p)}_upsert(p){var M;const T=null===p||void 0===p?void 0:p.objectId;if(null==T)return D.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new E.A("featurestore:invalid-feature","feature id is missing",{feature:p})),null;const k=this._featuresById.get(T);if(!k)return this._add(p),p;this._markedIds.add(T);const{geometry:N,attributes:F}=p;for(const E in F)k.attributes[E]=F[E];return N&&(k.geometry=N,this._boundsStore.set(T,null!==(M=(0,O.jQ)((0,Z.vt)(),N,this.geometryInfo.hasZ,this.geometryInfo.hasM))&&void 0!==M?M:null)),k}_remove(p){null!=this.onFeatureRemove&&this.onFeatureRemove(p);const M=p.objectId;return this._markedIds.delete(M),this._boundsStore.delete(M),this._featuresById.delete(M),p}}},23047:(p,M,T)=>{T.d(M,{LQ:()=>y,ag:()=>h,pL:()=>a});var k=T(32050),E=T(41156);const N=new E.A,D=new E.A,F=new E.A,Z={esriGeometryPoint:k.DF,esriGeometryPolyline:k.BW,esriGeometryPolygon:k.z5,esriGeometryMultipoint:k.qK};function y(p,M,T){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.hasZ,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:p.hasM;if(null==M)return null;const D=p.hasZ&&E,Z=p.hasM&&N;if(T){const O=(0,k.Nl)(F,M,p.hasZ,p.hasM,"esriGeometryPoint",T,E,N);return(0,k.DF)(O,D,Z)}return(0,k.DF)(M,D,Z)}function a(p,M,T,E,O,q){var Q,X;let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:M,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:T;const K=M&&J,$=T&&H,V=null!=E?"coords"in E?E:E.geometry:null;if(null==V)return null;if(O){var ee,te;let E=(0,k.kz)(D,V,M,T,p,O,J,H);return q&&(E=(0,k.Nl)(F,E,K,$,p,q)),null!==(ee=null===(te=Z[p])||void 0===te?void 0:te.call(Z,E,K,$))&&void 0!==ee?ee:null}if(q){var ie,ne;const E=(0,k.Nl)(F,V,M,T,p,q,J,H);return null!==(ie=null===(ne=Z[p])||void 0===ne?void 0:ne.call(Z,E,K,$))&&void 0!==ie?ie:null}return(0,k.Q4)(N,V,M,T,J,H),null!==(Q=null===(X=Z[p])||void 0===X?void 0:X.call(Z,N,K,$))&&void 0!==Q?Q:null}function h(p){return p&&O in p?JSON.parse(JSON.stringify(p,G)):p}const O="_geVersion",G=(p,M)=>p!==O?M:void 0},22786:(p,M,T)=>{T.d(M,{Cv:()=>j,Nk:()=>x,lK:()=>b});var k=T(16842),E=T(81618),N=T(54208),D=T(77026),F=T(78395),Z=T(80417);const O=[0,0];function h(p,M){if(!M)return null;if("x"in M){const T={x:0,y:0};return[T.x,T.y]=p(M.x,M.y,O),null!=M.z&&(T.z=M.z),null!=M.m&&(T.m=M.m),T}if("xmin"in M){const T={xmin:0,ymin:0,xmax:0,ymax:0};return[T.xmin,T.ymin]=p(M.xmin,M.ymin,O),[T.xmax,T.ymax]=p(M.xmax,M.ymax,O),M.hasZ&&(T.zmin=M.zmin,T.zmax=M.zmax,T.hasZ=!0),M.hasM&&(T.mmin=M.mmin,T.mmax=M.mmax,T.hasM=!0),T}return"rings"in M?{rings:l(M.rings,p),hasM:M.hasM,hasZ:M.hasZ}:"paths"in M?{paths:l(M.paths,p),hasM:M.hasM,hasZ:M.hasZ}:"points"in M?{points:f(M.points,p),hasM:M.hasM,hasZ:M.hasZ}:null}function l(p,M){const T=[];for(const k of p)T.push(f(k,M));return T}function f(p,M){const T=[];for(const k of p){const p=M(k[0],k[1],[0,0]);T.push(p),k.length>2&&p.push(k[2]),k.length>3&&p.push(k[3])}return T}async function x(p,M){if(!p||!M)return;const T=Array.isArray(p)?p.map((p=>null!=p.geometry?p.geometry.spatialReference:null)).filter(k.Ru):[p];await(0,N.initializeProjection)(T.map((p=>({source:p,dest:M}))))}const q=h.bind(null,Z.je),Q=h.bind(null,Z.tD);function j(p,M,T,k){if(!p)return p;if(T||(T=M,M=p.spatialReference),!(0,F.fn)(M)||!(0,F.fn)(T)||(0,F.aI)(M,T))return p;if((0,Z.y7)(M,T)){const M=(0,F.K8)(T)?q(p):Q(p);return M.spatialReference=T,M}return(0,N.projectMany)(D.g,[p],M,T,null,k)[0]}const X=new class _{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(p,M,T,k){var N;if(null===p||void 0===p||!p.length||!M||!T||(0,F.aI)(M,T))return p;const D={geometries:p,inSpatialReference:M,outSpatialReference:T,geographicTransformation:k,resolve:(0,E.Tw)()};return this._jobs.push(D),null!==(N=this._timer)&&void 0!==N||(this._timer=setTimeout(this._process,10)),D.resolve.promise}_process(){this._timer=null;const p=this._jobs.shift();if(!p)return;const{geometries:M,inSpatialReference:T,outSpatialReference:k,resolve:E,geographicTransformation:O}=p;(0,Z.y7)(T,k)?(0,F.K8)(k)?E(M.map(q)):E(M.map(Q)):E((0,N.projectMany)(D.g,M,T,k,O,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function b(p,M,T,k){return X.push(p,M,T,k)}},70857:(p,M,T)=>{T.d(M,{GC:()=>S,T2:()=>j,v8:()=>X});var k=T(40530),E=T(49049),N=T(54208),D=T(25076),F=T(31670),Z=T(30172),O=T(78395),q=T(22786);const Q=new k.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),X=Object.freeze({});async function S(p,M,T){const{outFields:k,orderByFields:E,groupByFieldsForStatistics:N,outStatistics:D}=p;if(k)for(let F=0;F<k.length;F++)k[F]=k[F].trim();if(E)for(let F=0;F<E.length;F++)E[F]=E[F].trim();if(N)for(let F=0;F<N.length;F++)N[F]=N[F].trim();if(D)for(let F=0;F<D.length;F++)D[F].onStatisticField&&(D[F].onStatisticField=D[F].onStatisticField.trim());return p.geometry&&!p.outSR&&(p.outSR=p.geometry.spatialReference),j(p,M,T)}async function j(p,M,k){var N;if(!p)return null;let{where:J}=p;if(p.where=J=null===(N=J)||void 0===N?void 0:N.trim(),(!J||/^1 *= *1$/.test(J)||M&&M===J)&&(p.where=null),!p.geometry)return p;let H=await async function d(p){const{distance:M,units:k}=p,N=p.geometry;if(null==M||"vertexAttributes"in N)return N;const D=N.spatialReference,F=k?Q.fromJSON(k):(0,E.Ij)(D),Z=D&&((0,O.EA)(D)||(0,O.K8)(D))?N:await(0,q.Nk)(D,O.KK).then((()=>(0,q.Cv)(N,O.KK)));return(await async function U(){return(await Promise.all([T.e(8300),T.e(6282)]).then(T.bind(T,93901))).geodesicBuffer}())(Z.spatialReference,Z,M,F)}(p);if(p.distance=0,p.units=null,"esriSpatialRelEnvelopeIntersects"===p.spatialRel){const{spatialReference:M}=p.geometry;H=(0,D.HA)(H),H.spatialReference=M}if(H){var K;await(0,q.Nk)(H.spatialReference,k),H=function x(p,M){const T=p.spatialReference;return w(p,M)&&(0,F.ZC)(p)?{spatialReference:T,rings:[[[p.xmin,p.ymin],[p.xmin,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[p.xmin,p.ymin]]]}:p}(H,k);const M=(await(0,Z.el)((0,F.rS)(H)))[0];if(null==M)throw X;const T="quantizationParameters"in p&&(null===(K=p.quantizationParameters)||void 0===K?void 0:K.tolerance)||"maxAllowableOffset"in p&&p.maxAllowableOffset||0,E=T&&w(H,k)?{densificationStep:8*T}:void 0,N=M.toJSON(),D=(0,q.Cv)(N,N.spatialReference,k,E);if(!D)throw X;D.spatialReference=k,p.geometry=D}return p}function w(p,M){if(!p)return!1;const T=p.spatialReference;return((0,F.ZC)(p)||(0,F.Bi)(p)||(0,F.Rg)(p))&&!(0,O.aI)(T,M)&&!(0,N.canProjectWithoutEngine)(T,M)}},70564:(p,M,T)=>{T.d(M,{tC:()=>I,c0:()=>P,xt:()=>v});var k=T(4180),E=T(94224),N=T(5522);var D=T(31670),F=T(78395);function n(p,M){return p?M?4:3:M?3:2}function contains_r(p,M,T,k,E,N){const D=n(E,N),{coords:F,lengths:Z}=k;if(!Z)return!1;for(let O=0,q=0;O<Z.length;O++,q+=D)if(!o(p,M,T,F[q],F[q+1]))return!1;return!0}function o(p,M,T,k,E){if(!p)return!1;const N=n(M,T),{coords:D,lengths:F}=p;let Z=!1,O=0;for(const q of F)Z=e(Z,D,N,O,q,k,E),O+=q*N;return Z}function e(p,M,T,k,E,N,D){let F=p,Z=k;for(let O=k,q=k+E*T;O<q;O+=T){Z=O+T,Z===q&&(Z=k);const p=M[O],E=M[O+1],Q=M[Z],X=M[Z+1];(E<D&&X>=D||X<D&&E>=D)&&p+(D-E)/(X-E)*(Q-p)<N&&(F=!F)}return F}var Z=T(32050),O=T(41156),q=T(23047),Q=T(22786);const X="unsupported-query",J={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},H={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function v(p,M,k,F,Q){if((0,D.Bi)(M)&&"esriGeometryPoint"===k&&("esriSpatialRelIntersects"===p||"esriSpatialRelContains"===p)){const p=(0,Z.Ye)(new O.A,M,!1,!1);return Promise.resolve((M=>function t(p,M,T,k){return o(p,M,T,k.coords[0],k.coords[1])}(p,!1,!1,M)))}if((0,D.Bi)(M)&&"esriGeometryMultipoint"===k){const T=(0,Z.Ye)(new O.A,M,!1,!1);if("esriSpatialRelContains"===p)return Promise.resolve((p=>contains_r(T,!1,!1,p,F,Q)))}if((0,D.ZC)(M)&&"esriGeometryPoint"===k&&("esriSpatialRelIntersects"===p||"esriSpatialRelContains"===p))return Promise.resolve((p=>(0,E.qz)(M,(0,q.pL)(k,F,Q,p))));if((0,D.ZC)(M)&&"esriGeometryMultipoint"===k&&"esriSpatialRelContains"===p)return Promise.resolve((p=>(0,E.rL)(M,(0,q.pL)(k,F,Q,p))));if((0,D.ZC)(M)&&"esriSpatialRelIntersects"===p){const p=function s(p){return"mesh"===p?N.xB:(0,N.xK)(p)}(k);return Promise.resolve((T=>p(M,(0,q.pL)(k,F,Q,T))))}return function h(){return Promise.all([T.e(8300),T.e(6282)]).then(T.bind(T,93901))}().then((T=>{const E=T[J[p]].bind(null,M.spatialReference,M);return p=>E((0,q.pL)(k,F,Q,p))}))}async function P(p,M,T){const{spatialRel:E,geometry:N}=p;if(N){if(!function G(p){return null!=p&&!0===H.spatialRelationship[p]}(E))throw new k.A(X,"Unsupported query spatial relationship",{query:p});if((0,F.fn)(N.spatialReference)&&(0,F.fn)(T)){var Z;if(!function g(p){return null!=p&&!0===H.queryGeometry[(0,D.$B)(p)]}(N))throw new k.A(X,"Unsupported query geometry type",{query:p});if(!function j(p){return null!=p&&!0===H.layerGeometry[p]}(M))throw new k.A(X,"Unsupported layer geometry type",{query:p});if(p.outSR)return(0,Q.Nk)(null===(Z=p.geometry)||void 0===Z?void 0:Z.spatialReference,p.outSR)}}}function I(p){if((0,D.ZC)(p))return!0;if((0,D.Bi)(p)){for(const M of p.rings){if(5!==M.length)return!1;if(M[0][0]!==M[1][0]||M[0][0]!==M[4][0]||M[2][0]!==M[3][0]||M[0][1]!==M[3][1]||M[0][1]!==M[4][1]||M[1][1]!==M[2][1])return!1}return!0}return!1}},66174:(p,M,T)=>{async function n(p,M){if(!p)return null;const T=M.featureAdapter,{startTimeField:k,endTimeField:E}=p;let N=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY;if(k&&E)await M.forEach((p=>{const M=T.getAttribute(p,k),F=T.getAttribute(p,E);null==M||isNaN(M)||(N=Math.min(N,M)),null==F||isNaN(F)||(D=Math.max(D,F))}));else{const p=k||E;await M.forEach((M=>{const k=T.getAttribute(M,p);null==k||isNaN(k)||(N=Math.min(N,k),D=Math.max(D,k))}))}return{start:N,end:D}}function t(p,M,T){var k,E;if(!M||!p)return null;const{startTimeField:N,endTimeField:D}=p;if(!N&&!D)return null;const{start:F,end:Z}=M;if(null===F&&null===Z)return null;if(void 0===F&&void 0===Z)return()=>!1;const O=null!==(k=null===(E=T.getAttributeAsTimestamp)||void 0===E?void 0:E.bind(T))&&void 0!==k?k:T.getAttribute.bind(T);return N&&D?function l(p,M,T,k,E){return null!=k&&null!=E?N=>{const D=p(N,M),F=p(N,T);return(null==D||D<=E)&&(null==F||F>=k)}:null!=k?M=>{const E=p(M,T);return null==E||E>=k}:null!=E?T=>{const k=p(T,M);return null==k||k<=E}:void 0}(O,N,D,F,Z):function u(p,M,T,k){return null!=T&&null!=k&&T===k?k=>p(k,M)===T:null!=T&&null!=k?E=>{const N=p(E,M);return null!=N&&N>=T&&N<=k}:null!=T?k=>{const E=p(k,M);return null!=E&&E>=T}:null!=k?T=>{const E=p(T,M);return null!=E&&E<=k}:void 0}(O,N||D,F,Z)}T.d(M,{I:()=>t,W:()=>n})},63721:(p,M,T)=>{T.d(M,{A:()=>O});var k=T(80671),E=(T(30174),T(57453)),N=(T(50886),T(89412),T(76761),T(68682)),D=T(9248),F=T(57264);let Z=class extends D.A{constructor(p){super(p),this.layoutGeometry=null}};(0,k._)([(0,E.MZ)({type:F.A,json:{write:!0}})],Z.prototype,"layoutGeometry",void 0),Z=(0,k._)([(0,N.$)("esri.rest.knowledgeGraph.Entity")],Z);const O=Z},9248:(p,M,T)=>{T.d(M,{A:()=>Z});var k=T(80671),E=T(57453),N=(T(50886),T(89412),T(76761),T(68682)),D=T(87831);let F=class extends D.A{constructor(p){super(p),this.typeName=null,this.id=null}};(0,k._)([(0,E.MZ)({type:String,json:{write:!0}})],F.prototype,"typeName",void 0),(0,k._)([(0,E.MZ)({type:String,json:{write:!0}})],F.prototype,"id",void 0),F=(0,k._)([(0,N.$)("esri.rest.knowledgeGraph.GraphNamedObject")],F);const Z=F},87831:(p,M,T)=>{T.d(M,{A:()=>Z});var k=T(80671),E=T(83375),N=T(57453),D=(T(50886),T(89412),T(76761),T(68682));let F=class extends E.oY{constructor(p){super(p),this.properties=null}};(0,k._)([(0,N.MZ)({json:{write:!0}})],F.prototype,"properties",void 0),F=(0,k._)([(0,D.$)("esri.rest.knowledgeGraph.GraphObject")],F);const Z=F},31827:(p,M,T)=>{T.d(M,{A:()=>q});var k=T(80671),E=T(57453),N=(T(50886),T(89412),T(76761),T(68682)),D=T(18763);let F=class extends D.A{constructor(p){super(p),this.openCypherQuery=""}};(0,k._)([(0,E.MZ)()],F.prototype,"openCypherQuery",void 0),F=(0,k._)([(0,N.$)("esri.rest.knowledgeGraph.GraphQuery")],F);const Z=F;let O=class extends Z{constructor(p){super(p),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null}};(0,k._)([(0,E.MZ)()],O.prototype,"bindParameters",void 0),(0,k._)([(0,E.MZ)()],O.prototype,"bindGeometryQuantizationParameters",void 0),(0,k._)([(0,E.MZ)()],O.prototype,"outputQuantizationParameters",void 0),(0,k._)([(0,E.MZ)()],O.prototype,"outputSpatialReference",void 0),O=(0,k._)([(0,N.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],O);const q=O},68708:(p,M,T)=>{T.d(M,{A:()=>F});var k=T(80671),E=(T(89412),T(50886),T(76761),T(4180),T(68682)),N=T(87831);let D=class extends N.A{constructor(p){super(p)}};D=(0,k._)([(0,E.$)("esri.rest.knowledgeGraph.ObjectValue")],D);const F=D},13389:(p,M,T)=>{T.d(M,{A:()=>O});var k=T(80671),E=T(83375),N=T(57453),D=(T(50886),T(89412),T(76761),T(68682)),F=T(87831);let Z=class extends E.oY{constructor(p){super(p),this.path=null}};(0,k._)([(0,N.MZ)({type:[F.A],json:{write:!0}})],Z.prototype,"path",void 0),Z=(0,k._)([(0,D.$)("esri.rest.knowledgeGraph.Path")],Z);const O=Z},83836:(p,M,T)=>{T.d(M,{A:()=>O});var k=T(80671),E=(T(30174),T(57453)),N=(T(50886),T(89412),T(76761),T(68682)),D=T(9248),F=T(60141);let Z=class extends D.A{constructor(p){super(p),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,k._)([(0,E.MZ)({type:String,json:{write:!0}})],Z.prototype,"originId",void 0),(0,k._)([(0,E.MZ)({type:String,json:{write:!0}})],Z.prototype,"destinationId",void 0),(0,k._)([(0,E.MZ)({type:F.A,json:{write:!0}})],Z.prototype,"layoutGeometry",void 0),Z=(0,k._)([(0,N.$)("esri.rest.Relationship.Relationship")],Z);const O=Z}}]);
//# sourceMappingURL=7522.7f70e545.chunk.js.map