"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[798,2658,1230,1322,5308],{11277:(w,D,he)=>{var ve;he.d(D,{u:()=>ve}),function(w){w[w.KILOBYTES=1024]="KILOBYTES",w[w.MEGABYTES=1048576]="MEGABYTES",w[w.GIGABYTES=1073741824]="GIGABYTES"}(ve||(ve={}))},83255:(w,D,he)=>{he.d(D,{A:()=>s});var ve=he(39798),_e=he(63454);class s{constructor(w){this._observable=new _e.I,this._set=new Set(w)}get size(){return(0,ve.gc)(this._observable),this._set.size}add(w){const D=this._set.size;return this._set.add(w),this._set.size!==D&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(w){const D=this._set.delete(w);return D&&this._observable.notify(),D}entries(){return(0,ve.gc)(this._observable),this._set.entries()}forEach(w,D){(0,ve.gc)(this._observable),this._set.forEach(((he,ve)=>w.call(D,he,ve,this)),D)}has(w){return(0,ve.gc)(this._observable),this._set.has(w)}keys(){return(0,ve.gc)(this._observable),this._set.keys()}values(){return(0,ve.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,ve.gc)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},17067:(w,D,he)=>{function c(w){return w=w||globalThis.location.hostname,Fe.some((D=>{var he;return null!=(null===(he=w)||void 0===he?void 0:he.match(D))}))}function a(w,D){return w&&(D=D||globalThis.location.hostname)?null!=D.match(ve)||null!=D.match(be)?w.replace("static.arcgis.com","staticdev.arcgis.com"):null!=D.match(_e)||null!=D.match(Me)?w.replace("static.arcgis.com","staticqa.arcgis.com"):w:w}he.d(D,{EM:()=>a,b5:()=>c});const ve=/^devext.arcgis.com$/,_e=/^qaext.arcgis.com$/,be=/^[\w-]*\.mapsdevext.arcgis.com$/,Me=/^[\w-]*\.mapsqa.arcgis.com$/,Fe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,ve,_e,/^jsapps.esri.com$/,be,Me]},16906:(w,D,he)=>{he.d(D,{X_:()=>i,i1:()=>o,zx:()=>d});var ve=he(48237),_e=he(49049);const be=96;function i(w,D){const he=D||w.extent,ve=w.width,Me=(0,_e.GA)(null===he||void 0===he?void 0:he.spatialReference);return he&&ve?he.width/ve*Me*_e.dy*be:0}function o(w,D){return w/((0,_e.GA)(D)*_e.dy*be)}function d(w,D,he){return function a(w,D){return 0===D||(0,ve.Sp)(w,D)||w<D}(w,D)&&function p(w,D){return 0===D||(0,ve.Sp)(w,D)||w>D}(w,he)}},57224:(w,D,he)=>{he.d(D,{N3:()=>s,Om:()=>t});class t{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},he=arguments.length>2?arguments[2]:void 0,ve=arguments.length>3?arguments[3]:void 0;this.geometry=w,this.attributes=D,this.centroid=he,this.objectId=ve,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const w=new t(this.geometry,this.attributes,this.centroid,this.objectId);return w.displayId=this.displayId,w.geohashX=this.geohashX,w.geohashY=this.geohashY,w}clone(){var w,D;const he=null===(w=this.geometry)||void 0===w?void 0:w.clone(),ve=new t(he,{...this.attributes},null===(D=this.centroid)||void 0===D?void 0:D.clone(),this.objectId);return ve.displayId=this.displayId,ve.geohashX=this.geohashX,ve.geohashY=this.geohashY,ve}}function s(w){var D;return!(null===(D=w.geometry)||void 0===D||null===(D=D.coords)||void 0===D||!D.length)}},30194:(w,D,he)=>{he.d(D,{A:()=>e});class e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const w=new e;return w.objectIdFieldName=this.objectIdFieldName,w.globalIdFieldName=this.globalIdFieldName,w.geohashFieldName=this.geohashFieldName,w.geometryProperties=this.geometryProperties,w.geometryType=this.geometryType,w.spatialReference=this.spatialReference,w.hasZ=this.hasZ,w.hasM=this.hasM,w.features=this.features,w.fields=this.fields,w.transform=this.transform,w.exceededTransferLimit=this.exceededTransferLimit,w.uniqueIdField=this.uniqueIdField,w.queryGeometry=this.queryGeometry,w.queryGeometryType=this.queryGeometryType,w}}},41156:(w,D,he)=>{he.d(D,{A:()=>e});class e{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],he=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.lengths=null!==w&&void 0!==w?w:[],this.coords=null!==D&&void 0!==D?D:[],this.hasIndeterminateRingOrder=he}static fromRect(w){const[D,he,ve,_e]=w,be=ve-D,Me=_e-he;return new e([5],[D,he,be,0,0,Me,-be,0,0,-Me])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((w,D)=>w+D))}forEachVertex(w){let D=0;this.lengths.length||w(this.coords[0],this.coords[1]);for(let he=0;he<this.lengths.length;he++){const ve=this.lengths[he];for(let he=0;he<ve;he++)w(this.coords[2*(he+D)],this.coords[2*(he+D)+1]);D+=ve}}deltaDecode(){const w=this.clone(),{coords:D,lengths:he}=w;let ve=0;for(const _e of he){for(let w=1;w<_e;w++)D[2*(ve+w)]+=D[2*(ve+w)-2],D[2*(ve+w)+1]+=D[2*(ve+w)-1];ve+=_e}return w}clone(w){if(0===this.lengths.length)return new e([],[this.coords[0],this.coords[1]]);const D=2*(0===this.lengths.length?1:this.lengths.reduce(((w,D)=>w+D))),he=this.coords.slice(0,D);return w?(w.set(he),new e(this.lengths,w,this.hasIndeterminateRingOrder)):new e(Array.from(this.lengths),Array.from(he),this.hasIndeterminateRingOrder)}}},98878:(w,D,he)=>{he.d(D,{p:()=>i});var ve=he(80671),_e=he(57453),be=(he(50886),he(89412),he(76761),he(68682));const i=w=>{let D=class extends w{get apiKey(){var w;return this._isOverridden("apiKey")?this._get("apiKey"):function s(w){return"portalItem"in w}(this)?null===(w=this.portalItem)||void 0===w?void 0:w.apiKey:null}set apiKey(w){null!=w?this._override("apiKey",w):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,ve._)([(0,_e.MZ)({type:String})],D.prototype,"apiKey",null),D=(0,ve._)([(0,be.$)("esri.layers.mixins.APIKeyMixin")],D),D}},47478:(w,D,he)=>{he.d(D,{b:()=>l});var ve=he(80671),_e=he(89412),be=he(57453),Me=(he(50886),he(76761),he(68682)),Fe=he(26128);const l=w=>{let D=class extends w{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const w=(0,Fe.qg)(this.url);if(null!=w&&w.title)return w.title}return this._get("title")||""}set title(w){this._set("title",w)}set url(w){this._set("url",(0,Fe.Jf)(w,_e.A.getLogger(this)))}};return(0,ve._)([(0,be.MZ)()],D.prototype,"title",null),(0,ve._)([(0,be.MZ)({type:String})],D.prototype,"url",null),D=(0,ve._)([(0,Me.$)("esri.layers.mixins.ArcGISService")],D),D}},9989:(w,D,he)=>{he.d(D,{A:()=>ke});var ve=he(80671),_e=he(88706),be=he(83375),Me=he(57453),Fe=(he(50886),he(89412),he(76761),he(59299)),Ae=he(68682),Ce=he(51715),xe=he(78091),Le=he(10171);let Ee=class extends((0,_e.O)(be.oY)){constructor(w){super(w),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(w){const D={};for(const he of Object.keys(w))D[he]=(0,xe.rS)(w[he]);return D}writeDomains(w,D){const he={};for(const _e of Object.keys(w)){var ve;w[_e]&&(he[_e]=null===(ve=w[_e])||void 0===ve?void 0:ve.toJSON())}D.domains=he}};(0,ve._)([(0,Me.MZ)({json:{write:!0}})],Ee.prototype,"id",void 0),(0,ve._)([(0,Me.MZ)({json:{write:!0}})],Ee.prototype,"name",void 0),(0,ve._)([(0,Me.MZ)({json:{write:!0}})],Ee.prototype,"domains",void 0),(0,ve._)([(0,Fe.w)("domains")],Ee.prototype,"readDomains",null),(0,ve._)([(0,Ce.K)("domains")],Ee.prototype,"writeDomains",null),(0,ve._)([(0,Me.MZ)({type:[Le.A],json:{write:!0}})],Ee.prototype,"templates",void 0),Ee=(0,ve._)([(0,Ae.$)("esri.layers.support.FeatureType")],Ee);const ke=Ee},218:(w,D,he)=>{he.d(D,{A:()=>xe});var ve,_e=he(80671),be=he(39652),Me=he(83375),Fe=he(57453),Ae=(he(50886),he(89412),he(76761),he(68682));let Ce=ve=class extends Me.oY{constructor(w){super(w),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new be.A}clone(){return new ve({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,_e._)([(0,Fe.MZ)({type:String,json:{write:!0}})],Ce.prototype,"floorField",void 0),(0,_e._)([(0,Fe.MZ)({json:{read:!1,write:!1}})],Ce.prototype,"viewAllMode",void 0),(0,_e._)([(0,Fe.MZ)({json:{read:!1,write:!1}})],Ce.prototype,"viewAllLevelIds",void 0),Ce=ve=(0,_e._)([(0,Ae.$)("esri.layers.support.LayerFloorInfo")],Ce);const xe=Ce},26487:(w,D,he)=>{he.d(D,{S:()=>a});var ve=he(50886),_e=he(26128);function jsonUtils_n(w,D,he){return!!t(w,D,he)}function r(w,D,he){return t(w,D,he)}function t(w,D,he){return w&&w.hasOwnProperty(D)?w[D]:he}const be={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function o(w){var D;const he=null===w||void 0===w||null===(D=w.supportedSpatialAggregationStatistics)||void 0===D?void 0:D.map((w=>w.toLowerCase()));return{envelope:!(null===he||void 0===he||!he.includes("envelopeaggregate")),centroid:!(null===he||void 0===he||!he.includes("centroidaggregate")),convexHull:!(null===he||void 0===he||!he.includes("convexhullaggregate"))}}function u(w,D){var he;const ve=null===w||void 0===w||null===(he=w.supportedOperationsWithCacheHint)||void 0===he?void 0:he.map((w=>w.toLowerCase()));return!(null===ve||void 0===ve||!ve.includes(D.toLowerCase()))}function a(w,D){return{analytics:n(w),attachment:i(w),data:c(w),metadata:d(w),operations:l(w.capabilities,w,D),query:y(w,D),queryRelated:m(w),queryTopFeatures:C(w),editing:h(w)}}function n(w){return{supportsCacheHint:u(w.advancedQueryCapabilities,"queryAnalytics")}}function i(w){const D=w.attachmentProperties,he={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:u(w.advancedQueryCapabilities,"queryAttachments"),supportsResize:jsonUtils_n(w,"supportsAttachmentsResizing",!1)};return D&&Array.isArray(D)&&D.forEach((w=>{const D=be[w.name];D&&(he[D]=!!w.isEnabled)})),he}function c(w){return{isVersioned:jsonUtils_n(w,"isDataVersioned",!1),supportsAttachment:jsonUtils_n(w,"hasAttachments",!1),supportsM:jsonUtils_n(w,"hasM",!1),supportsZ:jsonUtils_n(w,"hasZ",!1)}}function d(w){return{supportsAdvancedFieldProperties:jsonUtils_n(w,"supportsFieldDescriptionProperty",!1)}}function l(w,D,he){const ve=w?w.toLowerCase().split(",").map((w=>w.trim())):[],be=he?(0,_e.qg)(he):null,Me=ve.includes(null!=be&&"MapServer"===be.serverType?"data":"query"),Fe=ve.includes("editing")&&!D.datesInUnknownTimezone;let Ae=Fe&&ve.includes("create"),Ce=Fe&&ve.includes("delete"),xe=Fe&&ve.includes("update");const Le=ve.includes("changetracking"),Ee=D.advancedQueryCapabilities;return Fe&&!(Ae||Ce||xe)&&(Ae=Ce=xe=!0),{supportsCalculate:jsonUtils_n(D,"supportsCalculate",!1),supportsTruncate:jsonUtils_n(D,"supportsTruncate",!1),supportsValidateSql:jsonUtils_n(D,"supportsValidateSql",!1),supportsAdd:Ae,supportsDelete:Ce,supportsEditing:Fe,supportsChangeTracking:Le,supportsQuery:Me,supportsQueryAnalytics:jsonUtils_n(Ee,"supportsQueryAnalytic",!1),supportsQueryAttachments:jsonUtils_n(Ee,"supportsQueryAttachments",!1),supportsQueryTopFeatures:jsonUtils_n(Ee,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:jsonUtils_n(D,"supportsAttachmentsResizing",!1),supportsSync:ve.includes("sync"),supportsUpdate:xe,supportsExceedsLimitStatistics:jsonUtils_n(D,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:jsonUtils_n(D,"supportsAsyncConvert3D",!1)}}function y(w,D){var he;const be=w.advancedQueryCapabilities,Me=w.ownershipBasedAccessControlForFeatures,Fe=w.archivingInfo,Ae=w.currentVersion,Ce=!(null===D||void 0===D?void 0:D.includes("MapServer"))||Ae>=(0,ve.A)("mapserver-pbf-version-support"),xe=(0,_e.Wo)(D),Le=new Set((null!==(he=w.supportedQueryFormats)&&void 0!==he?he:"").split(",").map((w=>w.toLowerCase().trim())));return{supportsStatistics:jsonUtils_n(be,"supportsStatistics",w.supportsStatistics),supportsPercentileStatistics:jsonUtils_n(be,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:jsonUtils_n(be,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:o(be),supportsCentroid:jsonUtils_n(be,"supportsReturningGeometryCentroid",!1),supportsDistance:jsonUtils_n(be,"supportsQueryWithDistance",!1),supportsDistinct:jsonUtils_n(be,"supportsDistinct",w.supportsAdvancedQueries),supportsExtent:jsonUtils_n(be,"supportsReturningQueryExtent",!1),supportsGeometryProperties:jsonUtils_n(be,"supportsReturningGeometryProperties",!1),supportsHavingClause:jsonUtils_n(be,"supportsHavingClause",!1),supportsOrderBy:jsonUtils_n(be,"supportsOrderBy",w.supportsAdvancedQueries),supportsPagination:jsonUtils_n(be,"supportsPagination",!1),supportsQuantization:jsonUtils_n(w,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:jsonUtils_n(w,"supportsQuantizationEditMode",!1),supportsQueryGeometry:jsonUtils_n(w,"supportsReturningQueryGeometry",!1),supportsResultType:jsonUtils_n(be,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:jsonUtils_n(be,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:jsonUtils_n(be,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:jsonUtils_n(w,"useStandardizedQueries",!1),supportsTopFeaturesQuery:jsonUtils_n(be,"supportsTopFeaturesQuery",!1),supportsQueryByAnonymous:jsonUtils_n(Me,"allowAnonymousToQuery",!0),supportsQueryByOthers:jsonUtils_n(Me,"allowOthersToQuery",!0),supportsHistoricMoment:jsonUtils_n(Fe,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:Ce&&Le.has("pbf"),supportsDisjointSpatialRelationship:jsonUtils_n(be,"supportsDisjointSpatialRel",!1),supportsCacheHint:jsonUtils_n(be,"supportsQueryWithCacheHint",!1)||u(be,"query"),supportsDefaultSpatialReference:jsonUtils_n(be,"supportsDefaultSR",!1),supportsCompactGeometry:xe,supportsFullTextSearch:jsonUtils_n(be,"supportsFullTextSearch",!1),maxRecordCountFactor:r(w,"maxRecordCountFactor",void 0),maxRecordCount:r(w,"maxRecordCount",void 0),standardMaxRecordCount:r(w,"standardMaxRecordCount",void 0),tileMaxRecordCount:r(w,"tileMaxRecordCount",void 0)}}function m(w){const D=w.advancedQueryCapabilities,he=jsonUtils_n(D,"supportsAdvancedQueryRelated",!1);return{supportsPagination:jsonUtils_n(D,"supportsQueryRelatedPagination",!1),supportsCount:he,supportsOrderBy:he,supportsCacheHint:u(D,"queryRelated")}}function C(w){return{supportsCacheHint:u(w.advancedQueryCapabilities,"queryTopFilter")}}function h(w){const D=w.ownershipBasedAccessControlForFeatures,he=w?w.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:jsonUtils_n(w,"allowGeometryUpdates",!0),supportsGlobalId:jsonUtils_n(w,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:jsonUtils_n(w,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:jsonUtils_n(w,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:jsonUtils_n(w,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:jsonUtils_n(w,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:jsonUtils_n(D,"allowAnonymousToDelete",!0),supportsDeleteByOthers:jsonUtils_n(D,"allowOthersToDelete",!0),supportsUpdateByAnonymous:jsonUtils_n(D,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:jsonUtils_n(D,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:jsonUtils_n(he,"supportsAsyncApplyEdits",!1),zDefault:r(w,"zDefault",void 0)}}},14449:(w,D,he)=>{he.d(D,{GP:()=>c,LI:()=>u,lc:()=>i,u5:()=>l});he(55072);var ve=he(16913);const _e=/^-?(\d+)(\.(\d+))?$/i;function e(w,D){return w-D}function r(w,D){let he,ve;return he=Number(w.toFixed(D)),he<w?ve=he+1/10**D:(ve=he,he-=1/10**D),he=Number(he.toFixed(D)),ve=Number(ve.toFixed(D)),[he,ve]}function o(w,D,he,ve,_e){const be=l(w,D,he,ve),Me=null==be.previous||be.previous<=_e,Fe=null==be.next||be.next<=_e;return Me&&Fe||be.previous+be.next<=2*_e}function i(w){const D=String(w),he=D.match(_e);if(he&&he[1])return{integer:he[1].split("").length,fractional:he[3]?he[3].split("").length:0};if(D.toLowerCase().includes("e")){const w=D.split("e"),he=w[0],ve=w[1];if(he&&ve){const w=Number(he);let D=Number(ve);const _e=D>0;_e||(D=Math.abs(D));const be=i(w);return _e?(be.integer+=D,D>be.fractional?be.fractional=0:be.fractional-=D):(be.fractional+=D,D>be.integer?be.integer=1:be.integer-=D),be}}return{integer:0,fractional:0}}function l(w,D,he,ve){const _e={previous:null,next:null};if(null!=he){const ve=w-he,be=D-he-ve;_e.previous=Math.floor(Math.abs(100*be/ve))}if(null!=ve){const he=ve-w,be=ve-D-he;_e.next=Math.floor(Math.abs(100*be/he))}return _e}function u(w){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const he=w.slice(0),{tolerance:ve=2,strictBounds:_e=!1,indexes:be=he.map(((w,D)=>D))}=D;be.sort(e);for(let Me=0;Me<be.length;Me++){const w=be[Me],D=he[w],Fe=0===w?null:he[w-1],Ae=w===he.length-1?null:he[w+1],Ce=i(D).fractional;if(Ce){let be,xe=0,Le=!1;for(;xe<=Ce&&!Le;){const w=r(D,xe);be=_e&&0===Me?w[1]:w[0],Le=o(D,be,Fe,Ae,ve),xe++}Le&&(he[w]=be)}}return he}const be={maximumFractionDigits:20};function c(w){return(0,ve.ZV)(w,be)}},19766:(w,D,he)=>{function t(w){const D={};for(const he in w){if("declaredClass"===he)continue;const ve=w[he];if(null!=ve&&"function"!=typeof ve)if(Array.isArray(ve)){D[he]=[];for(let w=0;w<ve.length;w++)D[he][w]=t(ve[w])}else"object"==typeof ve?ve.toJSON&&(D[he]=JSON.stringify(ve)):D[he]=ve}return D}he.d(D,{z:()=>t})},35761:(w,D,he)=>{he.d(D,{e:()=>a,s:()=>s});var ve=he(95530),_e=he(83947),be=he(94309),Me=he(49096);async function s(w,D,he){const ve=await a(w,D,he);return be.A.fromJSON(ve)}async function a(w,D,he){const be=(0,ve.Dl)(w),Fe={...he},Ae=Me.A.from(D),{data:Ce}=await(0,_e.eW)(be,Ae,Ae.sourceSpatialReference,Fe);return Ce}},83947:(w,D,he)=>{he.d(D,{GB:()=>E,IJ:()=>f,Jf:()=>x,Pk:()=>p,eW:()=>c,gW:()=>S,kS:()=>d});var ve=he(53705),_e=he(4270),be=he(31670),Me=he(30172),Fe=he(78395),Ae=he(19766),Ce=he(84714),xe=he(34127);const Le="Layer does not support extent calculation.";function y(w,D){var he;const ve=w.geometry,_e=w.toJSON();delete _e.compactGeometryEnabled,delete _e.defaultSpatialReferenceEnabled;const Me=_e;let Ae,Ce,xe;if(null!=ve&&(Ce=ve.spatialReference,xe=(0,Fe.YX)(Ce),Me.geometryType=(0,be.$B)(ve),Me.geometry=function m(w,D){if(D&&"extent"===w.type)return"".concat(w.xmin,",").concat(w.ymin,",").concat(w.xmax,",").concat(w.ymax);if(D&&"point"===w.type)return"".concat(w.x,",").concat(w.y);const he=w.toJSON();return delete he.spatialReference,JSON.stringify(he)}(ve,w.compactGeometryEnabled),Me.inSR=xe),_e.groupByFieldsForStatistics&&(Me.groupByFieldsForStatistics=_e.groupByFieldsForStatistics.join(",")),_e.objectIds&&(Me.objectIds=_e.objectIds.join(",")),_e.orderByFields&&(Me.orderByFields=_e.orderByFields.join(",")),!_e.outFields||!_e.returnDistinctValues&&(null!==D&&void 0!==D&&D.returnCountOnly||null!==D&&void 0!==D&&D.returnExtentOnly||null!==D&&void 0!==D&&D.returnIdsOnly)?delete Me.outFields:_e.outFields.includes("*")?Me.outFields="*":Me.outFields=_e.outFields.join(","),_e.outSR?(Me.outSR=(0,Fe.YX)(_e.outSR),Ae=w.outSpatialReference):ve&&(_e.returnGeometry||_e.returnCentroid)&&(Me.outSR=Me.inSR,Ae=Ce),_e.returnGeometry&&delete _e.returnGeometry,_e.outStatistics&&(Me.outStatistics=JSON.stringify(_e.outStatistics)),_e.fullText&&(Me.fullText=JSON.stringify(_e.fullText)),_e.pixelSize&&(Me.pixelSize=JSON.stringify(_e.pixelSize)),_e.quantizationParameters&&(w.defaultSpatialReferenceEnabled&&null!=Ce&&null!=(null===(he=w.quantizationParameters)||void 0===he?void 0:he.extent)&&Ce.equals(w.quantizationParameters.extent.spatialReference)&&delete _e.quantizationParameters.extent.spatialReference,Me.quantizationParameters=JSON.stringify(_e.quantizationParameters)),_e.parameterValues&&(Me.parameterValues=JSON.stringify(_e.parameterValues)),_e.rangeValues&&(Me.rangeValues=JSON.stringify(_e.rangeValues)),_e.dynamicDataSource&&(Me.layer=JSON.stringify({source:_e.dynamicDataSource}),delete _e.dynamicDataSource),_e.timeExtent){const w=_e.timeExtent,{start:D,end:he}=w;null==D&&null==he||(Me.time=D===he?D:"".concat(null!==D&&void 0!==D?D:"null",",").concat(null!==he&&void 0!==he?he:"null")),delete _e.timeExtent}return w.defaultSpatialReferenceEnabled&&null!=Ce&&null!=Ae&&Ce.equals(Ae)&&(Me.defaultSR=Me.inSR,delete Me.inSR,delete Me.outSR),Me}async function c(w,D,he,ve){const _e=null!=D.timeExtent&&D.timeExtent.isEmpty?{data:{features:[]}}:await E(w,D,"json",ve);return(0,xe.q)(D,he,_e.data),_e}async function f(w,D,he,ve){if(null!=D.timeExtent&&D.timeExtent.isEmpty)return{data:he.createFeatureResult()};const _e=await d(w,D,ve),be=_e;return be.data=(0,Ce.m)(_e.data,he),be}function d(w,D,he){return E(w,D,"pbf",he)}function p(w,D,he){return null!=D.timeExtent&&D.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(w,D,"json",he,{returnIdsOnly:!0})}function S(w,D,he){return null!=D.timeExtent&&D.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(w,D,"json",he,{returnIdsOnly:!0,returnCountOnly:!0})}async function x(w,D,he){if(null!=D.timeExtent&&D.timeExtent.isEmpty)return{data:{count:0,extent:null}};const ve=await E(w,D,"json",he,{returnExtentOnly:!0,returnCountOnly:!0}),_e=ve.data;if(_e.hasOwnProperty("extent"))return ve;if(_e.features)throw new Error(Le);if(_e.hasOwnProperty("count"))throw new Error(Le);return ve}async function E(w,D,he){let be=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},Fe=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const Ce="string"==typeof w?(0,_e.An)(w):w,xe=D.geometry?[D.geometry]:[],Le=await(0,Me.el)(xe,null,{signal:be.signal}),Ee=null===Le||void 0===Le?void 0:Le[0];null!=Ee&&((D=D.clone()).geometry=Ee);const ke=(0,Ae.z)({...Ce.query,f:he,...Fe,...y(D,Fe)});return(0,ve.A)((0,_e.fj)(Ce.path,function g(w,D){return null!=w.formatOf3DObjects&&!(D.returnCountOnly||D.returnExtentOnly||D.returnIdsOnly)}(D,Fe)?"query3d":"query"),{...be,responseType:"pbf"===he?"array-buffer":"json",query:{...ke,...be.query}})}},34127:(w,D,he)=>{he.d(D,{q:()=>t});var ve=he(8641);function t(w,D,he){if(null===he||void 0===he||!he.features||!he.hasZ)return;const _e=(0,ve.N)(he.geometryType,D,w.outSpatialReference);if(null!=_e)for(const ve of he.features)_e(ve.geometry)}},72466:(w,D,he)=>{he.d(D,{A:()=>Le});var ve,_e=he(80671),be=he(83375),Me=he(57453),Fe=he(6493),Ae=(he(76761),he(50886),he(68682));function n(w){const{exifInfo:D,exifName:he,tagName:ve}=w;if(!D||!he||!ve)return null;const _e=D.find((w=>w.name===he));return _e?function t(w){const{tagName:D,tags:he}=w;if(!he||!D)return null;const ve=he.find((w=>w.name===D));return(null===ve||void 0===ve?void 0:ve.value)||null}({tagName:ve,tags:_e.tags}):null}const Ce={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let xe=ve=class extends be.oY{constructor(w){super(w),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:w}=this,D=n({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:w});return Ce[D]||null}clone(){return new ve({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,_e._)([(0,Me.MZ)({type:String})],xe.prototype,"contentType",void 0),(0,_e._)([(0,Me.MZ)()],xe.prototype,"exifInfo",void 0),(0,_e._)([(0,Me.MZ)({readOnly:!0})],xe.prototype,"orientationInfo",null),(0,_e._)([(0,Me.MZ)({type:Fe.jz})],xe.prototype,"id",void 0),(0,_e._)([(0,Me.MZ)({type:String})],xe.prototype,"globalId",void 0),(0,_e._)([(0,Me.MZ)({type:String})],xe.prototype,"keywords",void 0),(0,_e._)([(0,Me.MZ)({type:String})],xe.prototype,"name",void 0),(0,_e._)([(0,Me.MZ)({json:{read:!1}})],xe.prototype,"parentGlobalId",void 0),(0,_e._)([(0,Me.MZ)({json:{read:!1}})],xe.prototype,"parentObjectId",void 0),(0,_e._)([(0,Me.MZ)({type:Fe.jz})],xe.prototype,"size",void 0),(0,_e._)([(0,Me.MZ)({json:{read:!1}})],xe.prototype,"url",void 0),xe=ve=(0,_e._)([(0,Ae.$)("esri.layers.support.AttachmentInfo")],xe);const Le=xe},86241:(w,D,he)=>{he.d(D,{fs:()=>Z,i0:()=>N});var ve=he(87328),_e=he(57022),be=(he(39368),he(22132),he(52994));new Set(["integer","small-integer"]);function Z(w){return(0,_e.vE)(w)||(0,_e.zD)(w)||(0,_e.Ah)(w)}function N(w,D){const{format:he,timeZoneOptions:_e,fieldType:Me}=null!==D&&void 0!==D?D:{};let Fe,Ae;if(_e&&({timeZone:Fe,timeZoneName:Ae}=(0,be.hv)(_e.layerTimeZone,_e.datesInUnknownTimezone,_e.viewTimeZone,(0,ve.J2)(he||"short-date-short-time"),Me)),"string"==typeof w&&isNaN(Date.parse("time-only"===Me?"1970-01-01T".concat(w,"Z"):w)))return w;switch(Me){case"date-only":{const D=(0,ve.J2)(he||"short-date");return"string"==typeof w?(0,ve.iS)(w,{...D}):(0,ve.Yq)(w,{...D,timeZone:be.n$})}case"time-only":{const D=(0,ve.J2)(he||"short-time");return"string"==typeof w?(0,ve.F8)(w,D):(0,ve.Yq)(w,{...D,timeZone:be.n$})}case"timestamp-offset":{if(!Fe&&"string"==typeof w&&new Date(w).toISOString()!==w)return w;const D=he||_e?(0,ve.J2)(he||"short-date-short-time"):void 0,be=D?{...D,timeZone:Fe,timeZoneName:Ae}:void 0;return"string"==typeof w?(0,ve.Ey)(w,be):(0,ve.Yq)(w,be)}default:{const D=he||_e?(0,ve.J2)(he||"short-date-short-time"):void 0;return(0,ve.Yq)("string"==typeof w?new Date(w):w,D?{...D,timeZone:Fe,timeZoneName:Ae}:void 0)}}}},72365:(w,D,he)=>{he.d(D,{previewSymbol3D:()=>V});var ve=he(14795),_e=he(50352),be=(he(50886),he(4180)),Me=he(89412),Fe=he(62555),Ae=he(34120),Ce=he(4341),xe=he(28915),Le=he(65141),Ee=he(15947),ke=he(80047),Ze=he(32658);const Se=Le.CB.size,Re=Le.CB.maxSize,Pe=Le.CB.maxOutlineSize,Oe=Le.CB.lineWidth,Ne=Le.CB.tallSymbolWidth;function R(w){const D=w.outline,he=null!=w.material?w.material.color:null,ve=null!=he?he.toHex():null;if(null==D||"pattern"in D&&null!=D.pattern&&"style"===D.pattern.type&&"none"===D.pattern.style)return"fill"===w.type&&"#ffffff"===ve?{color:"#bdc3c7",width:.75}:null;const _e=(0,Fe.Lz)(D.size)||0;return{color:"rgba("+(null!=D.color?D.color.toRgba():"255,255,255,1")+")",width:Math.min(_e,Pe),style:"pattern"in D&&null!=D.pattern&&"style"===D.pattern.type?(0,Ae.O1)(D.pattern.style):null,join:"butt",cap:"patternCap"in D?D.patternCap:"butt"}}function I(w){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const he=w.a,ve=(0,_e.N2)(w),be=ve.h,Me=ve.s/D,Fe=100-(100-ve.v)/D,{r:Ae,g:Ce,b:xe}=(0,_e.$)({h:be,s:Me,v:Fe});return[Ae,Ce,xe,he]}function Z(w){var D;return"water"===w.type?null==w.color?null:w.color:null==(null===(D=w.material)||void 0===D?void 0:D.color)?null:w.material.color}function q(w){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const he=Z(w);if(!he){if("fill"===w.type)return null;const he=Ae.Sw.r,ve=(0,Le.dr)(he,D);return[ve,ve,ve,100]}const ve=he.toRgba();for(let _e=0;_e<3;_e++)ve[_e]=(0,Le.dr)(ve[_e],D);return ve}async function H(w,D){const he=w.style;return"none"===he?null:{type:"pattern",x:0,y:0,src:await(0,Ae.rc)((0,ve.s)("esri/symbols/patterns/".concat(he,".png")),D.toCss(!0)),width:5,height:5}}function N(w){return w.outline?R(w):{color:"rgba(0, 0, 0, 1)",width:1.5}}function T(w,D){const he=Z(w);if(!he)return null;let ve="rgba(";return ve+=(0,Le.dr)(he.r,D)+",",ve+=(0,Le.dr)(he.g,D)+",",ve+=(0,Le.dr)(he.b,D)+",",ve+he.a+");"}function W(w,D){const he=T(w,D);return he?"pattern"in w&&null!=w.pattern&&"style"===w.pattern.type&&"none"===w.pattern.style?null:{color:he,width:Math.min(w.size?(0,Fe.Lz)(w.size):.75,Pe),style:"pattern"in w&&null!=w.pattern&&"style"===w.pattern.type?(0,Ae.O1)(w.pattern.style):null,cap:"cap"in w?w.cap:null,join:"join"in w?"miter"===w.join?(0,Fe.Lz)(2):w.join:null}:{}}function F(w,D,he){const ve=null!=he?.75*he:0;return{type:"linear",x1:ve?.25*ve:0,y1:ve?.5*ve:0,x2:ve||4,y2:ve?.5*ve:4,colors:[{color:w,offset:0},{color:D,offset:1}]}}function B(w){const D="number"==typeof(null===w||void 0===w?void 0:w.size)?null===w||void 0===w?void 0:w.size:null;return D?(0,Fe.Lz)(D):null}async function J(w,D){var he;const _e=B(D),be=null!==D&&void 0!==D&&D.maxSize?(0,Fe.Lz)(D.maxSize):null,Ae=null!==(he=null===D||void 0===D?void 0:D.disableUpsampling)&&void 0!==he&&he,Pe=w.symbolLayers,Oe=[];let Be=0,Ue=0;const Ve=Pe.at(-1);let De;Ve&&"icon"===Ve.type&&(De=Ve.size&&(0,Fe.Lz)(Ve.size)),Pe.forEach((he=>{var Me;if("icon"!==he.type&&"object"!==he.type)return;const Pe="icon"===he.type?he.size&&(0,Fe.Lz)(he.size):0,Ve=_e||Pe?Math.ceil(Math.min(_e||Pe,be||Re)):Se;if(null!==he&&void 0!==he&&null!==(Me=he.resource)&&void 0!==Me&&Me.href){const D=async function E(w,D){var he,_e;if(null!==(he=w.thumbnail)&&void 0!==he&&he.url)return w.thumbnail.url;if("icon"===D.type&&(null===D||void 0===D||null===(_e=D.resource)||void 0===_e?void 0:_e.href))return(0,ke.N7)(D);const be=(0,ve.s)("esri/images/Legend/legend3dsymboldefault.png");if(w.styleOrigin&&(w.styleOrigin.styleName||w.styleOrigin.styleUrl)){var Me;const D=await(0,Ze.resolveWebStyleSymbol)(w.styleOrigin,{portal:w.styleOrigin.portal},"webRef").catch((()=>null));if(D&&"thumbnail"in D&&null!==(Me=D.thumbnail)&&void 0!==Me&&Me.url)return D.thumbnail.url}return be}(w,he).then((w=>{var D;const ve=null===he||void 0===he||null===(D=he.material)||void 0===D?void 0:D.color,_e=function G(w){return"icon"===w.type?"multiply":"tint"}(he);return(0,Ee.UB)(w,Ve,ve,_e,Ae)})).then((w=>{const D=w.width,he=w.height;return Be=Math.max(Be,D),Ue=Math.max(Ue,he),[{shape:{type:"image",x:0,y:0,width:D,height:he,src:w.url},fill:null,stroke:null}]}));Oe.push(D)}else{var qe;let w=Ve;"icon"===he.type&&De&&_e&&(w=Ve*(Pe/De));const ve="tall"===(null===D||void 0===D?void 0:D.symbolConfig)||(null===D||void 0===D||null===(qe=D.symbolConfig)||void 0===qe?void 0:qe.isTall)||"object"===he.type&&function $(w){const D=w.depth,he=w.height,ve=w.width;return 0!==ve&&0!==D&&0!==he&&ve===D&&null!=ve&&null!=he&&ve<he}(he);Be=Math.max(Be,ve?Ne:w),Ue=Math.max(Ue,w),Oe.push(Promise.resolve(function A(w,D,he){const ve=[];if(!w)return ve;switch(w.type){case"icon":{const he=0,_e=0,be=D,Me=D;switch(w.resource&&w.resource.primitive||Ce.r){case"circle":ve.push({shape:{type:"circle",cx:0,cy:0,r:.5*D},fill:q(w,0),stroke:R(w)});break;case"square":ve.push({shape:{type:"path",path:[{command:"M",values:[he,Me]},{command:"L",values:[he,_e]},{command:"L",values:[be,_e]},{command:"L",values:[be,Me]},{command:"Z",values:[]}]},fill:q(w,0),stroke:R(w)});break;case"triangle":ve.push({shape:{type:"path",path:[{command:"M",values:[he,Me]},{command:"L",values:[.5*be,_e]},{command:"L",values:[be,Me]},{command:"Z",values:[]}]},fill:q(w,0),stroke:R(w)});break;case"cross":ve.push({shape:{type:"path",path:[{command:"M",values:[.5*be,_e]},{command:"L",values:[.5*be,Me]},{command:"M",values:[he,.5*Me]},{command:"L",values:[be,.5*Me]}]},stroke:N(w)});break;case"x":ve.push({shape:{type:"path",path:[{command:"M",values:[he,_e]},{command:"L",values:[be,Me]},{command:"M",values:[be,_e]},{command:"L",values:[he,Me]}]},stroke:N(w)});break;case"kite":ve.push({shape:{type:"path",path:[{command:"M",values:[he,.5*Me]},{command:"L",values:[.5*be,_e]},{command:"L",values:[be,.5*Me]},{command:"L",values:[.5*be,Me]},{command:"Z",values:[]}]},fill:q(w,0),stroke:R(w)})}break}case"object":switch(w.resource&&w.resource.primitive||xe.r){case"cone":{const _e=F(q(w,0),q(w,-.6),he?Ne:D),be=(0,Le.mN)(D,he);ve.push({shape:be[0],fill:_e},{shape:be[1],fill:_e});break}case"inverted-cone":{const he=q(w,0),_e=F(he,q(w,-.6),D),be=(0,Le.Pc)(D);ve.push({shape:be[0],fill:_e},{shape:be[1],fill:he});break}case"cube":{const _e=(0,Le.cZ)(D,he);ve.push({shape:_e[0],fill:q(w,0)},{shape:_e[1],fill:q(w,-.3)},{shape:_e[2],fill:q(w,-.5)});break}case"cylinder":{const _e=F(q(w,0),q(w,-.6),he?Ne:D),be=(0,Le.dt)(D,he);ve.push({shape:be[0],fill:_e},{shape:be[1],fill:_e},{shape:be[2],fill:q(w,0)});break}case"diamond":{const he=(0,Le.D)(D);ve.push({shape:he[0],fill:q(w,-.3)},{shape:he[1],fill:q(w,0)},{shape:he[2],fill:q(w,-.3)},{shape:he[3],fill:q(w,-.7)});break}case"sphere":{const he=F(q(w,0),q(w,-.6));he.x1=0,he.y1=0,he.x2=.25*D,he.y2=.25*D,ve.push({shape:{type:"circle",cx:0,cy:0,r:.5*D},fill:he});break}case"tetrahedron":{const he=(0,Le.Nz)(D);ve.push({shape:he[0],fill:q(w,-.3)},{shape:he[1],fill:q(w,0)},{shape:he[2],fill:q(w,-.6)});break}}}return ve}(he,w,ve)))}}));const qe=await Promise.allSettled(Oe),Ke=[];return qe.forEach((w=>{"fulfilled"===w.status?Ke.push(w.value):w.reason&&Me.A.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",w.reason)})),(0,Ee.fz)(Ke,[Be,Ue],{node:null===D||void 0===D?void 0:D.node,scale:!1,opacity:null===D||void 0===D?void 0:D.opacity,ariaLabel:null===D||void 0===D?void 0:D.ariaLabel})}function V(w,D){if(0===w.symbolLayers.length)return Promise.reject(new be.A("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(w.type){case"point-3d":return J(w,D);case"line-3d":return function K(w,D){const he=w.symbolLayers,ve=[],_e=(0,ke.$d)(w),be=B(D),Me=(null!==D&&void 0!==D&&D.maxSize?(0,Fe.Lz)(D.maxSize):null)||Pe;let Ae,Ce=0,xe=0;return he.forEach(((w,D)=>{if(!w)return;if("line"!==w.type&&"path"!==w.type)return;const he=[];switch(w.type){case"line":{const ve=W(w,0);if(null==ve)break;const _e=(null===ve||void 0===ve?void 0:ve.width)||0;0===D&&(Ae=_e);const Fe=Math.min(be||_e,Me),Le=0===D?Fe:be?Fe*(_e/Ae):Fe,Ee=Le>Oe/2?2*Le:Oe;xe=Math.max(xe,Le),Ce=Math.max(Ce,Ee),ve.width=Le,he.push({shape:{type:"path",path:[{command:"M",values:[0,.5*xe]},{command:"L",values:[Ce,.5*xe]}]},stroke:ve});break}case"path":{const D=Math.min(be||Se,Me),ve=q(w,0),_e=q(w,-.2),Fe=T(w,-.4),Ae=Fe?{color:Fe,width:1}:{};if("quad"===w.profile){const D=w.width,be=w.height,Me=(0,Le.KX)(D&&be?D/be:1,0===be,0===D),Fe={...Ae,join:"bevel"};he.push({shape:Me[0],fill:_e,stroke:Fe},{shape:Me[1],fill:_e,stroke:Fe},{shape:Me[2],fill:ve,stroke:Fe})}else he.push({shape:Le.nq.pathSymbol3DLayer[0],fill:_e,stroke:Ae},{shape:Le.nq.pathSymbol3DLayer[1],fill:ve,stroke:Ae});xe=Math.max(xe,D),Ce=xe}}ve.push(he)})),Promise.resolve((0,Ee.fz)(ve,[Ce,xe],{node:null===D||void 0===D?void 0:D.node,scale:_e,opacity:null===D||void 0===D?void 0:D.opacity,ariaLabel:null===D||void 0===D?void 0:D.ariaLabel}))}(w,D);case"polygon-3d":case"mesh-3d":return async function Q(w,D){const he="mesh-3d"===w.type,ve=w.symbolLayers,_e=B(D),be=null!==D&&void 0!==D&&D.maxSize?(0,Fe.Lz)(D.maxSize):null,Me=_e||Se,Ae=[];let Ce=0,xe=0,ke=!1;for(let Fe=0;Fe<ve.length;Fe++){const w=ve.at(Fe),D=[];if(!he||"fill"===w.type){switch(w.type){case"fill":{const ve=Math.min(Me,be||Re);if(Ce=Math.max(Ce,ve),xe=Math.max(xe,ve),ke=!0,he){const he=Le.nq.meshSymbol3DFill,ve=T(w,-.4),_e=ve?{color:ve,width:1,join:"round"}:{};D.push({shape:he[0],fill:q(w,0),stroke:_e},{shape:he[1],fill:q(w,-.2),stroke:_e},{shape:he[2],fill:q(w,-.6),stroke:_e})}else{let he=q(w,0);const ve="pattern"in w?w.pattern:null,_e=R(w),be=Z(w);null!=ve&&"style"===ve.type&&"solid"!==ve.style&&be&&(he=await H(ve,be)),D.push({shape:Le.nq.fill[0],fill:he,stroke:_e})}break}case"line":{const he=W(w,0);if(null==he)break;const ve={stroke:he,shape:Le.nq.fill[0]};Ce=Math.max(Ce,Se),xe=Math.max(xe,Se),D.push(ve);break}case"extrude":{const he={join:"round",width:1,...W(w,-.4)},ve=q(w,0),_e=q(w,-.2),Fe=Math.min(Me,be||Re),Ae=(0,Le.sU)(Fe);he.width=1,D.push({shape:Ae[0],fill:_e,stroke:he},{shape:Ae[1],fill:_e,stroke:he},{shape:Ae[2],fill:ve,stroke:he});const Ee=Se,ke=.7*Se+.5*Fe;Ce=Math.max(Ce,Ee),xe=Math.max(xe,ke);break}case"water":{const he=Z(w),ve=I(he),_e=I(he,2),Fe=I(he,3),Ae=(0,Le.cP)();ke=!0,D.push({shape:Ae[0],fill:ve},{shape:Ae[1],fill:_e},{shape:Ae[2],fill:Fe});const Ee=Math.min(Me,be||Re);Ce=Math.max(Ce,Ee),xe=Math.max(xe,Ee);break}}Ae.push(D)}}return(0,Ee.fz)(Ae,[Ce,xe],{node:null===D||void 0===D?void 0:D.node,scale:ke,opacity:null===D||void 0===D?void 0:D.opacity,ariaLabel:null===D||void 0===D?void 0:D.ariaLabel})}(w,D)}return Promise.reject(new be.A("symbolPreview: swatchInfo3D","symbol not supported."))}},65141:(w,D,he)=>{he.d(D,{CB:()=>ve,D:()=>s,KX:()=>m,Nz:()=>u,Pc:()=>o,QC:()=>d,cP:()=>p,cZ:()=>L,dr:()=>h,dt:()=>n,mN:()=>l,nq:()=>be,sU:()=>c});var ve,_e=he(22123);!function(w){w[w.size=22]="size",w[w.lineWidth=50]="lineWidth",w[w.maxSize=120]="maxSize",w[w.maxOutlineSize=80]="maxOutlineSize",w[w.tallSymbolWidth=20]="tallSymbolWidth"}(ve||(ve={}));const be={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function m(w,D,he){const _e=ve.size;let be=_e,Me=_e;w<1?be*=.75:w>1&&(Me*=1.25);let Fe=_e,Ae=_e;return D&&he&&(be=Me=Fe=Ae=0),[{type:"path",path:[{command:"M",values:[Fe,0]},{command:"L",values:[he?Fe:.875*Fe,0]},{command:"L",values:[he?be-.5*Fe:0,Me-.5*Ae]},{command:"L",values:[be-.5*Fe,Me-.5*Ae]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[Fe,0]},{command:"L",values:[Fe,D?0:.125*Ae]},{command:"L",values:[be-.5*Fe,D?Me-.5*Ae:Ae]},{command:"L",values:[be-.5*Fe,Me-.5*Ae]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[be-.5*Fe,Me-.5*Ae]},{command:"L",values:[he?be-.5*Fe:0,Me-.5*Ae]},{command:"L",values:[he?be-.5*Fe:0,D?Me-.5*Ae:Ae]},{command:"L",values:[be-.5*Fe,D?Me-.5*Ae:Ae]},{command:"Z",values:[]}]}]}function c(w){const D=ve.size,he=.5*w;return[{type:"path",path:[{command:"M",values:[0,.7*D*.5]},{command:"L",values:[.3*D,.7*D]},{command:"L",values:[.3*D,.7*D+he]},{command:"L",values:[0,.7*D+he-.7*D*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*D,.7*D]},{command:"L",values:[.3*D,.7*D+he]},{command:"L",values:[D,he]},{command:"L",values:[D,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*D,0]},{command:"L",values:[D,0]},{command:"L",values:[.3*D,.7*D]},{command:"L",values:[0,.7*D*.5]},{command:"Z",values:[]}]}]}function p(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function L(w,D){let he=D?ve.tallSymbolWidth:w;const _e=w,be=D?4:6;he<=ve.size?he-=.5*be:he-=be;const Me=D?.35*he:.5*he;return[{type:"path",path:[{command:"M",values:[.5*he,0]},{command:"L",values:[he,.5*Me]},{command:"L",values:[.5*he,Me]},{command:"L",values:[0,.5*Me]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*Me]},{command:"L",values:[.5*he,Me]},{command:"L",values:[.5*he,_e]},{command:"L",values:[0,_e-.5*Me]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*he,Me]},{command:"L",values:[.5*he,_e]},{command:"L",values:[he,_e-.5*Me]},{command:"L",values:[he,.5*Me]},{command:"Z",values:[]}]}]}function n(w,D){let he=D?ve.tallSymbolWidth:w;const _e=w,be=D?4:6;he<=ve.size?he-=.5*be:he-=be;const Me=.5*he,Fe=.15*he,Ae=_e-Fe;return[{type:"ellipse",cx:.5*he,cy:Ae,rx:Me,ry:Fe},{type:"path",path:[{command:"M",values:[0,Fe]},{command:"L",values:[0,Ae]},{command:"L",values:[he,Ae]},{command:"L",values:[he,Fe]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*he,cy:Fe,rx:Me,ry:Fe}]}function l(w,D){let he=D?ve.tallSymbolWidth:w;const _e=w,be=D?4:6;he<=ve.size?he-=.5*be:he-=be;const Me=.15*he,Fe=_e-Me;return[{type:"ellipse",cx:.5*he,cy:Fe,rx:.5*he,ry:Me},{type:"path",path:[{command:"M",values:[.5*he,0]},{command:"L",values:[he,Fe]},{command:"L",values:[0,Fe]},{command:"Z",values:[]}]}]}function o(w){let D=w;const he=w;D<ve.size?D-=3:D-=6;const _e=.15*D;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[D,0]},{command:"L",values:[.5*D,he-_e]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*D,cy:0,rx:.5*D,ry:_e}]}function s(w){let D=w;const he=w;D<ve.size?D-=2:D-=4;const _e=D,be=he,Me=Math.floor(w/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*_e,0]},{command:"L",values:[_e,.5*be-Me]},{command:"L",values:[.45*_e-Me,.5*be+Me]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*_e,0]},{command:"L",values:[.45*_e-Me,.5*be+Me]},{command:"L",values:[0,.5*be-Me]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*be-Me]},{command:"L",values:[.45*_e-Me,.5*be+Me]},{command:"L",values:[.45*_e,he]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*_e,he]},{command:"L",values:[_e,.5*be-Me]},{command:"L",values:[.45*_e-Me,.5*be+Me]},{command:"Z",values:[]}]}]}function u(w){const D=w;let he=w;he<ve.size?he-=1:he-=2;return[{type:"path",path:[{command:"M",values:[.45*D,0]},{command:"L",values:[D,he]},{command:"L",values:[.45*D,.6*he]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*D,0]},{command:"L",values:[.45*D,.6*he]},{command:"L",values:[0,he]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,he]},{command:"L",values:[.45*D,.6*he]},{command:"L",values:[D,he]},{command:"Z",values:[]}]}]}function h(w,D){return Math.round(Math.min(Math.max(w+255*D*.75,0),255))}function d(w,D){if(null==w)return new _e.A;if("type"in w&&("linear"===w.type||"pattern"===w.type))return w;const he=new _e.A(w);return new _e.A([h(he.r,D),h(he.g,D),h(he.b,D),he.a])}},15947:(w,D,he)=>{he.d(D,{UB:()=>d,fz:()=>l});var ve=he(50075),_e=he(53705),be=he(50352),Me=he(4180),Fe=he(50886),Ae=(he(70843),he(98916)),Ce=he(51427),xe=he(80047);const Le=(0,Ae.F)();function l(w,D,he){const ve=Math.ceil(D[0]),_e=Math.ceil(D[1]);if(!w.some((w=>!!w.length)))return null;const be=(null===he||void 0===he?void 0:he.node)||document.createElement("div");return null!=he.opacity&&(be.style.opacity=he.opacity.toString()),null!=he.effectView&&(be.style.filter=(0,xe.di)(he.effectView)),function h(w,D){Le.append(w,D),Le.detach(D)}(be,(()=>(0,Ce.d8)(w,ve,_e,he))),be}function f(w,D,he,ve,_e){switch(_e){case"multiply":w[D]*=he[0],w[D+1]*=he[1],w[D+2]*=he[2],w[D+3]*=he[3];break;default:{const _e=(0,be.N2)({r:w[D],g:w[D+1],b:w[D+2]});_e.h=ve.h,_e.s=ve.s,_e.v=_e.v/100*ve.v;const Me=(0,be.$)(_e);w[D]=Me.r,w[D+1]=Me.g,w[D+2]=Me.b,w[D+3]*=he[3];break}}}function d(w,D,he,Ae,Ce){return function g(w,D,he){return w?(0,_e.A)(w,{responseType:"image"}).then((w=>{const ve=w.data,_e=ve.width,be=ve.height,Me=_e/be;let Fe=D;if(he){const w=Math.max(_e,be);Fe=Math.min(Fe,w)}return{image:ve,width:Me<=1?Math.ceil(Fe*Me):Fe,height:Me<=1?Fe:Math.ceil(Fe/Me)}})):Promise.reject(new Me.A("renderUtils: imageDataSize","href not provided."))}(w,D,Ce).then((_e=>{var Me,Ce;const xe=null!==(Me=_e.width)&&void 0!==Me?Me:D,Le=null!==(Ce=_e.height)&&void 0!==Ce?Ce:D;if(_e.image&&function u(w,D){return!(!w||"ignore"===D)&&("multiply"!==D||255!==w.r||255!==w.g||255!==w.b||1!==w.a)}(he,Ae)){let D=_e.image.width,ve=_e.image.height;(0,Fe.A)("edge")&&/\.svg$/i.test(w)&&(D-=1,ve-=1);const Me=function m(w,D){w=Math.ceil(w),D=Math.ceil(D);const he=document.createElement("canvas");he.width=w,he.height=D,he.style.width=w+"px",he.style.height=D+"px";const ve=he.getContext("2d");return ve.clearRect(0,0,w,D),ve}(xe,Le);Me.drawImage(_e.image,0,0,D,ve,0,0,xe,Le);const Ce=Me.getImageData(0,0,xe,Le),Ee=[he.r/255,he.g/255,he.b/255,he.a],ke=(0,be.N2)(he);for(let w=0;w<Ce.data.length;w+=4)f(Ce.data,w,Ee,ke,Ae);Me.putImageData(Ce,0,0),w=Me.canvas.toDataURL("image/png")}else{const D=null===ve.id||void 0===ve.id?void 0:ve.id.findCredential(w);if(null!==D&&void 0!==D&&D.token){const he=w.includes("?")?"&":"?";w="".concat(w).concat(he,"token=").concat(D.token)}}return{url:w,width:xe,height:Le}})).catch((()=>({url:w,width:D,height:D})))}},51427:(w,D,he)=>{he.d(D,{d8:()=>C});var ve=he(22123),_e=he(50886),be=he(35598),Me=he(96062),Fe=he(22815),Ae=he(34120),Ce=(he(70218),he(8689));const xe="http://www.w3.org/2000/svg";let Le=0,Ee=0;const ke=(0,_e.A)("android"),Ze=(0,_e.A)("chrome")||ke&&ke>=4?"auto":"optimizeLegibility",Se={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},Re=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Pe={},Oe={};const Ne=Math.PI;let Be=1;function b(w,D){const he=w*(Ne/180);return Math.abs(D*Math.sin(he))+Math.abs(D*Math.cos(he))}function j(w){return w.map((w=>"".concat(w.command," ").concat(w.values.join(" ")))).join(" ").trim()}function v(w,D,he,ve,_e){if(w){if("circle"===w.type)return(0,Ce.K)("circle",{cx:w.cx,cy:w.cy,fill:D,"fill-rule":"evenodd",r:w.r,stroke:he.color,"stroke-dasharray":he.dashArray,"stroke-dashoffset":he.dashOffset,"stroke-linecap":he.cap,"stroke-linejoin":he.join,"stroke-miterlimit":"4","stroke-width":he.width});if("ellipse"===w.type)return(0,Ce.K)("ellipse",{cx:w.cx,cy:w.cy,fill:D,"fill-rule":"evenodd",rx:w.rx,ry:w.ry,stroke:he.color,"stroke-dasharray":he.dashArray,"stroke-linecap":he.cap,"stroke-linejoin":he.join,"stroke-miterlimit":"4","stroke-width":he.width});if("rect"===w.type)return(0,Ce.K)("rect",{fill:D,"fill-rule":"evenodd",height:w.height,stroke:he.color,"stroke-dasharray":he.dashArray,"stroke-linecap":he.cap,"stroke-linejoin":he.join,"stroke-miterlimit":"4","stroke-width":he.width,width:w.width,x:w.x,y:w.y});if("image"===w.type)return(0,Ce.K)("image",{alt:_e||"image",height:w.height,href:w.src,preserveAspectRatio:"none",width:w.width,x:w.x,y:w.y});if("path"===w.type){const ve="string"!=typeof w.path?j(w.path):w.path;return(0,Ce.K)("path",{d:ve,fill:D,"fill-rule":"evenodd",stroke:he.color,"stroke-dasharray":he.dashArray,"stroke-linecap":he.cap,"stroke-linejoin":he.join,"stroke-miterlimit":"4","stroke-width":he.width})}if("text"===w.type)return(0,be.Lw)(ve),(0,Ce.K)("text",{"dominant-baseline":ve.dominantBaseline,fill:D,"fill-rule":"evenodd","font-family":ve.font.family,"font-size":ve.font.size,"font-style":ve.font.style,"font-variant":ve.font.variant,"font-weight":ve.font.weight,kerning:ve.kerning,rotate:ve.rotate,stroke:he.color,"stroke-dasharray":he.dashArray,"stroke-linecap":he.cap,"stroke-linejoin":he.join,"stroke-miterlimit":"4","stroke-width":he.width,"text-anchor":ve.align,"text-decoration":ve.decoration,"text-rendering":Ze,x:w.x,y:w.y},w.text)}return null}function M(w){const D={fill:"none",pattern:null,linearGradient:null};if(w)if("type"in w&&"pattern"===w.type){const he="patternId-"+ ++Le;D.fill="url(#".concat(he,")"),D.pattern={id:he,x:w.x,y:w.y,width:w.width,height:w.height,image:{x:0,y:0,width:w.width,height:w.height,href:w.src}}}else if("type"in w&&"linear"===w.type){const he="linearGradientId-"+ ++Ee;D.fill="url(#".concat(he,")"),D.linearGradient={id:he,x1:w.x1,y1:w.y1,x2:w.x2,y2:w.y2,stops:w.colors.map((w=>({offset:w.offset,color:w.color&&new ve.A(w.color).toString()})))}}else if(w){const he=new ve.A(w);D.fill=he.toString()}return D}function A(w){const D={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return w&&(null!=w.width&&(D.width=w.width),w.cap&&(D.cap=w.cap),w.join&&(D.join=w.join.toString()),w.color&&(D.color=new ve.A(w.color).toString()),w.dashArray&&(D.dashArray=w.dashArray),w.dashoffset&&(D.dashOffset=w.dashoffset),w.style&&!w.dashArray&&(D.dashArray=(0,Ae.O0)(w).join(",")||"none")),D}function S(w,D){const he={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(w){const ve=w.alignBaseline,_e="baseline"===ve?"auto":"top"===ve?"text-top":"bottom"===ve?"hanging":ve;he.align=w.align,he.dominantBaseline=_e,he.decoration=w.decoration,he.kerning=w.kerning?"auto":"0",he.rotate=w.rotated?"90":"0",(0,be.Lw)(D),he.font.style=D.style||"normal",he.font.variant=D.variant||"normal",he.font.weight=D.weight||"normal",he.font.size=D.size&&D.size.toString()||"10pt",he.font.family=D.family||"serif"}return he}function $(w){const{pattern:D,linearGradient:he}=w;if(D)return(0,Ce.K)("pattern",{height:D.height,id:D.id,patternUnits:"userSpaceOnUse",width:D.width,x:D.x,y:D.y},(0,Ce.K)("image",{height:D.image.height,href:D.image.href,width:D.image.width,x:D.image.x,y:D.image.y}));if(he){const w=he.stops.map(((w,D)=>(0,Ce.K)("stop",{key:"".concat(D,"-stop"),offset:w.offset,"stop-color":w.color})));return(0,Ce.K)("linearGradient",{gradientUnits:"userSpaceOnUse",id:he.id,x1:he.x1,x2:he.x2,y1:he.y1,y2:he.y2},w)}return null}function N(w,D){if(!w||0===w.length)return null;const he=[];for(const ve of w){const{shape:w,fill:D,stroke:_e,font:be}=ve,Me=M(D),Fe=A(_e),Ae="text"===w.type?S(w,be):null,Ce=v(w,Me.fill,Fe,Ae);Ce&&he.push(Ce)}return(0,Ce.K)("mask",{id:D,maskUnits:"userSpaceOnUse"},(0,Ce.K)("g",null,he))}function G(w,D,he){return(0,Fe.Tl)(w,(0,Fe.D_)(w),[D,he])}function I(w,D,he,ve,_e){return(0,Fe.hs)(w,(0,Fe.D_)(w),[D,he]),w[4]=w[4]*D-ve*D+ve,w[5]=w[5]*he-_e*he+_e,w}function B(w,D){Pe&&"left"in Pe?(null!=Pe.left&&Pe.left>w&&(Pe.left=w),(null==Pe.right||Pe.right<w)&&(Pe.right=w),(null==Pe.top||Pe.top>D)&&(Pe.top=D),(null==Pe.bottom||Pe.bottom<D)&&(Pe.bottom=D)):Pe={left:w,bottom:D,right:w,top:D}}function U(w){const D=w.args,he=D.length;let ve;switch(w.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(ve=0;ve<he;ve+=2)B(D[ve],D[ve+1]);Oe.x=D[he-2],Oe.y=D[he-1];break;case"H":for(ve=0;ve<he;++ve)B(D[ve],Oe.y);Oe.x=D[he-1];break;case"V":for(ve=0;ve<he;++ve)B(Oe.x,D[ve]);Oe.y=D[he-1];break;case"m":{let w=0;"x"in Oe||(B(Oe.x=D[0],Oe.y=D[1]),w=2);for(ve=w;ve<he;ve+=2)B(Oe.x+=D[ve],Oe.y+=D[ve+1]);break}case"l":case"t":for(ve=0;ve<he;ve+=2)B(Oe.x+=D[ve],Oe.y+=D[ve+1]);break;case"h":for(ve=0;ve<he;++ve)B(Oe.x+=D[ve],Oe.y);break;case"v":for(ve=0;ve<he;++ve)B(Oe.x,Oe.y+=D[ve]);break;case"c":for(ve=0;ve<he;ve+=6)B(Oe.x+D[ve],Oe.y+D[ve+1]),B(Oe.x+D[ve+2],Oe.y+D[ve+3]),B(Oe.x+=D[ve+4],Oe.y+=D[ve+5]);break;case"s":case"q":for(ve=0;ve<he;ve+=4)B(Oe.x+D[ve],Oe.y+D[ve+1]),B(Oe.x+=D[ve+2],Oe.y+=D[ve+3]);break;case"A":for(ve=0;ve<he;ve+=7)B(D[ve+5],D[ve+6]);Oe.x=D[he-2],Oe.y=D[he-1];break;case"a":for(ve=0;ve<he;ve+=7)B(Oe.x+=D[ve+5],Oe.y+=D[ve+6])}}function F(w,D,he){const ve=Se[w.toLowerCase()];let _e;"number"==typeof ve&&(ve?D.length>=ve&&(_e={action:w,args:D.slice(0,D.length-D.length%ve)},he.push(_e),U(_e)):(_e={action:w,args:[]},he.push(_e),U(_e)))}function T(w){const D={x:0,y:0,width:0,height:0};if("circle"===w.type)D.x=w.cx-w.r,D.y=w.cy-w.r,D.width=2*w.r,D.height=2*w.r;else if("ellipse"===w.type)D.x=w.cx-w.rx,D.y=w.cy-w.ry,D.width=2*w.rx,D.height=2*w.ry;else if("image"===w.type||"rect"===w.type)D.x=w.x,D.y=w.y,D.width=w.width,D.height=w.height;else if("path"===w.type){const he=function O(w){const D=("string"!=typeof w.path?j(w.path):w.path).match(Re),he=[];if(Pe={},Oe={},!D)return null;let ve="",_e=[];const be=D.length;for(let Fe=0;Fe<be;++Fe){const w=D[Fe],be=parseFloat(w);isNaN(be)?(ve&&F(ve,_e,he),_e=[],ve=w):_e.push(be)}F(ve,_e,he);const Me={x:0,y:0,width:0,height:0};return Pe&&"left"in Pe&&(Me.x=Pe.left,Me.y=Pe.top,Me.width=Pe.right-Pe.left,Me.height=Pe.bottom-Pe.top),Me}(w);D.x=he.x,D.y=he.y,D.width=he.width,D.height=he.height}return D}function E(w){const D={x:0,y:0,width:0,height:0};let he=null,ve=Number.NEGATIVE_INFINITY,_e=Number.NEGATIVE_INFINITY;for(const be of w)he?(he.x=Math.min(he.x,be.x),he.y=Math.min(he.y,be.y),ve=Math.max(ve,be.x+be.width),_e=Math.max(_e,be.y+be.height)):(he=D,he.x=be.x,he.y=be.y,ve=be.x+be.width,_e=be.y+be.height);return he&&(he.width=ve-he.x,he.height=_e-he.y),he}function L(w,D,he,ve,_e,be,Ae,Ce,xe){let Le=(Ae&&be?b(be,D):D)/2,Ee=(Ae&&be?b(be,he):he)/2;if(xe){const w=xe[0],D=xe[1];Le=(Ae&&be?b(be,w):w)/2,Ee=(Ae&&be?b(be,D):D)/2}const ke=w.width+ve,Ze=w.height+ve,Se=(0,Me.vt)(),Re=(0,Me.vt)();let Pe=!1;if(_e&&0!==ke&&0!==Ze){const w=D!==he?D/he:ke/Ze,ve=D>he?D:he;let _e=1,be=1;isNaN(ve)||(w>1?(_e=ve/ke,be=ve/w/Ze):(be=ve/Ze,_e=ve*w/ke)),(0,Fe.lw)(Re,Re,I(Se,_e,be,Le,Ee)),Pe=!0}const Oe=w.x+(ke-ve)/2,Ne=w.y+(Ze-ve)/2;if((0,Fe.lw)(Re,Re,G(Se,Le-Oe,Ee-Ne)),!Pe&&(ke>D||Ze>he)){const w=ke/D>Ze/he,ve=(w?D:he)/(w?ke:Ze);(0,Fe.lw)(Re,Re,I(Se,ve,ve,Oe,Ne))}return be&&(0,Fe.lw)(Re,Re,function z(w,D,he,ve){const _e=D%360*Math.PI/180;(0,Fe.e$)(w,(0,Fe.D_)(w),_e);const be=Math.cos(_e),Me=Math.sin(_e),Ae=w[4],Ce=w[5];return w[4]=Ae*be-Ce*Me+ve*Me-he*be+he,w[5]=Ce*be+Ae*Me-he*Me-ve*be+ve,w}(Se,be,Oe,Ne)),Ce&&(0,Fe.lw)(Re,Re,G(Se,Ce[0],Ce[1])),"matrix(".concat(Re[0],",").concat(Re[1],",").concat(Re[2],",").concat(Re[3],",").concat(Re[4],",").concat(Re[5],")")}function C(w,D,he){let ve=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const _e=[],Me=[],Fe=++Be,Ae=function V(w,D,he){const ve=null===w||void 0===w?void 0:w.effects.find((w=>"bloom"===w.type));if(!ve)return null;const{strength:_e,radius:be}=ve,Me=_e>0?be:0,Fe=(_e+Me)*D,Ae=4*_e+1;return(0,Ce.K)("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:"bloom".concat(he),width:"300%",x:"-100%",y:"-100%"},(0,Ce.K)("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(_e+.5*Me)*(5**(D/100)*(.4+D/100)),result:"dilate"}),(0,Ce.K)("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:Fe/25}),(0,Ce.K)("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:Fe/50}),(0,Ce.K)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,Ce.K)("feFuncR",{slope:Ae,type:"linear"}),(0,Ce.K)("feFuncG",{slope:Ae,type:"linear"}),(0,Ce.K)("feFuncB",{slope:Ae,type:"linear"})),(0,Ce.K)("feMerge",null,(0,Ce.K)("feMergeNode",{in:"intensityBlur"}),(0,Ce.K)("feMergeNode",{in:"intensityBrightness"}),(0,Ce.K)("feGaussianBlur",{stdDeviation:_e/10})))}(ve.effectView,D,Fe);let Le=null;if(Ae){var Ee;const w=null===(Ee=ve.effectView)||void 0===Ee?void 0:Ee.effects.find((w=>"bloom"===w.type)),_e=(w.strength?w.strength+w.radius/2:0)/3,be=D+D*_e,Me=he+he*_e;Le=[Math.max(be,10),Math.max(Me,10)]}for(let be=0;be<w.length;be++){var ke,Ze;const Fe=w[be],Ae=[],xe=[];let Ee=0,Se=0,Re=0;for(const w of Fe){const{shape:D,fill:he,stroke:be,font:Me,offset:Fe}=w;ve.ignoreStrokeWidth||"text"===D.type||(Ee+=(null===be||void 0===be?void 0:be.width)||0);const Ce=M(he),Le=A(be),ke="text"===D.type?S(D,Me):null;_e.push($(Ce)),Ae.push(v(D,Ce.fill,Le,ke,ve.ariaLabel)),xe.push(T(D)),Fe&&(Se+=Fe[0],Re+=Fe[1])}const Pe=L(E(xe),D,he,Ee,null!==(ke=ve.scale)&&void 0!==ke&&ke,ve.rotation,null!==(Ze=ve.useRotationSize)&&void 0!==Ze&&Ze,[Se,Re],Le);let Oe=null;if(ve.masking){const w="mask-".concat(be),D=ve.masking[be];_e.push(N(D,w)),Oe="url(#".concat(w,")")}Me.push(Oe?(0,Ce.K)("g",{mask:Oe},(0,Ce.K)("g",{transform:Pe},Ae)):(0,Ce.K)("g",{transform:Pe},Ae))}ve.useRotationSize&&ve.rotation&&(D=b(ve.rotation,D),he=b(ve.rotation,he)),Ae&&((0,be.Lw)(Le),D=Le[0],he=Le[1]);return(0,Ce.K)("svg",{"aria-labelledby":ve.ariaLabel,focusable:!1,height:he,role:"img",style:"display: block;",width:D,xmlns:xe},Ae,(0,Ce.K)("defs",null,_e),Ae?(0,Ce.K)("g",{filter:"url(#bloom".concat(Fe,")")},Me):Me)}},32658:(w,D,he)=>{he.d(D,{I:()=>h,p:()=>j,resolveWebStyleSymbol:()=>g});var ve=he(21343),_e=he(17067),be=he(4180),Me=he(4270),Fe=he(91710),Ae=he(85173),Ce=he(34985),xe=he(89973),Le=he(48886),Ee=he(82750);function g(w,D,he,ve){const _e=w.name;return null==_e?Promise.reject(new be.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):w.styleName&&"Esri2DPointSymbolsStyle"===w.styleName?function d(w,D,he){const ve=Le.jg.replaceAll(/\{SymbolName\}/gi,w),_e=null!=D.portal?D.portal:Fe.A.getDefault();return(0,Le.yA)(ve,he).then((w=>{const D=(0,Le.bo)(w.data);return(0,Ce.rS)(D,{portal:_e,url:(0,Me.An)((0,Me.nM)(ve)),origin:"portal-item"})}))}(_e,D,ve):(0,Le.cF)(w,D,ve).then((w=>h(w,_e,D,he,Le.o5,ve)))}function j(w,D){return D.items.find((D=>D.name===w))}function h(w,D,he,ke,Ze,Se){var Re,Pe,Oe,Ne;const Be=null!=(null===he||void 0===he?void 0:he.portal)?he.portal:Fe.A.getDefault(),Ue={portal:Be,url:(0,Me.An)(w.baseUrl),origin:"portal-item"},Ve=j(D,w.data);if(!Ve){const w="The symbol name '".concat(D,"' could not be found");return Promise.reject(new be.A("symbolstyleutils:symbol-name-not-found",w,{symbolName:D}))}let De=(0,Ae.f)(Ze(Ve,ke),Ue),qe=null!==(Re=null===(Pe=Ve.thumbnail)||void 0===Pe?void 0:Pe.href)&&void 0!==Re?Re:null;const Ke=null===(Oe=Ve.thumbnail)||void 0===Oe?void 0:Oe.imageData;(0,_e.b5)()&&(De=null!==(Ne=(0,_e.EM)(De))&&void 0!==Ne?Ne:"",qe=(0,_e.EM)(qe));const ze={portal:Be,url:(0,Me.An)((0,Me.nM)(De)),origin:"portal-item"};return(0,Le.yA)(De,Se).then((_e=>{const be="cimRef"===ke?(0,Le.bo)(_e.data):_e.data,Me=(0,Ce.rS)(be,ze);if(Me&&(0,ve.wk)(Me)){if(qe){const w=(0,Ae.f)(qe,Ue);Me.thumbnail=new Ee.V({url:w})}else Ke&&(Me.thumbnail=new Ee.V({url:"data:image/png;base64,".concat(Ke)}));w.styleUrl?Me.styleOrigin=new xe.A({portal:he.portal,styleUrl:w.styleUrl,name:D}):w.styleName&&(Me.styleOrigin=new xe.A({portal:he.portal,styleName:w.styleName,name:D}))}return Me}))}},18715:(w,D,he)=>{function n(w){return w&&"function"==typeof w.highlight}function t(w,D,he){return null==w||w>he&&(0===D||w<D)}function u(w,D){return null!=w&&w>0||null!=D&&D>0}function c(w){var D,he;const ve=w.effectiveScaleRange;return{minScale:null!==(D=null===ve||void 0===ve?void 0:ve.minScale)&&void 0!==D?D:0,maxScale:null!==(he=null===ve||void 0===ve?void 0:ve.maxScale)&&void 0!==he?he:0}}he.d(D,{Cf:()=>c,JU:()=>t,Of:()=>n,WK:()=>u})},68556:(w,D,he)=>{he.d(D,{getRampStops:()=>r});var ve=he(22123),_e=he(46415);const be=new ve.A([64,64,64]);function n(w,D){const he=[],ve=w.length-1;return 5===w.length?he.push(0,2,4):he.push(0,ve),w.map(((w,be)=>he.includes(be)?(0,_e.Dd)(w,be,ve,D):null))}async function r(w,D,ve){let _e=!1,be=[],Me=[];if(w.stops){const D=w.stops;be=D.map((w=>w.value)),_e=D.some((w=>!!w.label)),_e&&(Me=D.map((w=>w.label)))}const Fe=be[0],Ae=be[be.length-1];if(null==Fe&&null==Ae)return null;const Ce=_e?null:n(be,ve);return(await Promise.all(be.map((async(ve,be)=>{var Fe;return{value:ve,color:"opacity"===w.type?await t(ve,w,D):(await Promise.resolve().then(he.bind(he,56428))).getColor(w,ve),label:_e?Me[be]:null!==(Fe=null===Ce||void 0===Ce?void 0:Ce[be])&&void 0!==Fe?Fe:""}})))).reverse()}async function t(w,D,_e){const Me=new ve.A(null!==_e&&void 0!==_e?_e:be),Fe=(await Promise.resolve().then(he.bind(he,56428))).getOpacity(D,w);return null!=Fe&&(Me.a=Fe),Me}},46415:(w,D,he)=>{he.d(D,{Dd:()=>r,Zo:()=>p,getDateFormatOptions:()=>c});he(21343);var ve=he(44952),_e=he(57022),be=he(14449),Me=he(86241),Fe=he(40943);const Ae="<",Ce=">";function r(w,D,he,ve){let _e="";return 0===D?_e="".concat(Ae," "):D===he&&(_e="".concat(Ce," ")),_e+(ve?(0,Me.i0)(w,ve):(0,be.GP)(w))}async function p(w,D){const ve=w.trailCap,_e=w.trailWidth||1,be=D||await async function u(w){var D;if(!("visualVariables"in w)||!w.visualVariables)return null;const ve=w.visualVariables.find((w=>"color"===w.type));if(!ve)return null;let _e=null,be=null;if(ve.stops){if(1===ve.stops.length)return ve.stops[0].color;_e=ve.stops[0].value,be=ve.stops[ve.stops.length-1].value}const Me=null!=_e&&null!=be?_e+(be-_e)/2:0,{getColor:Fe}=await Promise.resolve().then(he.bind(he,56428));return null!==(D=Fe(ve,Me))&&void 0!==D?D:null}(w)||w.color;return new Fe.A({cap:ve,color:be,width:_e})}function c(w,D,he){const be=function f(w,D){var he,ve;if(!D.field)return null;if("featureReduction"in w)switch(null===(he=w.featureReduction)||void 0===he?void 0:he.type){case"cluster":case"binning":{const he=w.featureReduction.fields.find((w=>{let{name:he}=w;return he.toLowerCase()===D.field.toLowerCase()}));return he&&"getField"in w?w.getField(he.onStatisticField):null}}return"getField"in w?null===(ve=w.getField)||void 0===ve?void 0:ve.call(w,D.field):null}(w,D);if(!be||!(0,Me.fs)(be)&&!(0,_e.OH)(be))return null;let Fe=function d(w,D){var he,ve;const _e="popupTemplate"in w?null===(he=w.popupTemplate)||void 0===he?void 0:he.fieldInfos:null;if(null!==_e&&void 0!==_e&&_e.length&&D)return null===(ve=_e.find((w=>{var he;return(null===(he=w.fieldName)||void 0===he?void 0:he.toLowerCase())===D.toLowerCase()})))||void 0===ve||null===(ve=ve.format)||void 0===ve?void 0:ve.dateFormat}(w,be.name);if(!Fe&&"date"===be.type){var Ae,Ce,xe,Le,Ee,ke;let w=0,he=0;D.stops?(w=null!==(Ae=null===(Ce=D.stops)||void 0===Ce||null===(Ce=Ce.at(0))||void 0===Ce?void 0:Ce.value)&&void 0!==Ae?Ae:w,he=null!==(xe=null===(Le=D.stops)||void 0===Le||null===(Le=Le.at(-1))||void 0===Le?void 0:Le.value)&&void 0!==xe?xe:he):"minDataValue"in D&&"maxDataValue"in D&&(w=null!==(Ee=D.minDataValue)&&void 0!==Ee?Ee:w,he=null!==(ke=D.maxDataValue)&&void 0!==ke?ke:he),Fe=he-w>2*ve.vf.days?"short-date":"short-date-short-time"}return{fieldType:be.type,format:Fe,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in w?w.preferredTimeZone:null,viewTimeZone:he,datesInUnknownTimezone:"datesInUnknownTimezone"in w&&w.datesInUnknownTimezone}}}},89210:(w,D,he)=>{he.r(D),he.d(D,{default:()=>$n});var ve=he(80671),_e=he(63537),be=he(89412),Me=he(63390),Fe=he(57453),Ae=(he(50886),he(76761),he(68682)),Ce=he(76116),xe=(he(55072),he(39652));function throttle_e(w,D,he,ve){let _e=null,be=1e3;"number"==typeof D?(be=D,ve=he):(_e=null!==D&&void 0!==D?D:null,be=he);let Me,Fe=0;const a=()=>{Fe=0,w.apply(ve,Me)},c=function(){for(var w=arguments.length,D=new Array(w),he=0;he<w;he++)D[he]=arguments[he];_e&&_e.apply(ve,D),Me=D,be?Fe||(Fe=setTimeout(a,be)):a()};return c.remove=()=>{Fe&&(clearTimeout(Fe),Fe=0)},c.forceUpdate=()=>{Fe&&(clearTimeout(Fe),a())},c.hasPendingUpdates=()=>!!Fe,c}he(30174),he(16906),he(84661);function geometryUtils_n(w){var D;switch(null===w||void 0===w?void 0:w.type){case"point":return w;case"extent":return w.center;case"polygon":return w.centroid;case"multipoint":case"polyline":return null===(D=w.extent)||void 0===D?void 0:D.center;default:return null}}var Le=he(61948);function actionUtils_n(w){return w?{backgroundImage:"url(".concat(w,")")}:{}}var Ee=he(91779),ke=he(79911),Ze=he(4180),Se=he(11277),Re=(he(78726),he(48237)),Pe=he(49049);function quantityUtils_l(w,D){let he=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"arithmetic";return{type:(0,Pe.t$)(D),value:w,unit:D,rotationType:he}}(function quantityUtils_i(w,D){return{type:(0,Pe.t$)(D),value:w,unit:D}})(0,"meters"),function quantityUtils_a(w,D){return{type:(0,Pe.t$)(D),value:w,unit:D}}(0,"square-meters"),quantityUtils_l(0,"radians"),quantityUtils_l(0,"degrees"),quantityUtils_l(0,"degrees","geographic");var Oe=he(4389),Ne=he(16913);new Map;const Be=["B","kB","MB","GB","TB"];var Ue=he(13812),Ve=he(18763),De=he(72466),qe=he(99524),Ke=he(87328),ze=he(57022),je=he(74629),We=he(86241),He=he(39368),Ge=he(52994);const featureUtils_y=()=>be.A.getLogger("esri.widgets.Feature.support.featureUtils"),Qe=/href=(""|'')/gi,$e=/(\{([^\{\r\n]+)\})/g,Ye=/\'/g,Je=/^\s*expression\//i,Xe=/(\n)/gi,et=/[\u00A0-\u9999<>\&]/gim,tt=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,it=/^(?:mailto:|tel:)/,nt="relationships/",ot=(0,Ke.J2)("short-date-short-time");function E(w){var D;if(null!=w)return null!==(D=w.sourceLayer||w.layer)&&void 0!==D?D:void 0}async function featureUtils_x(w,D){return"function"==typeof w?w(D):w}function C(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(w)return!it.test(w.trim().toLowerCase())}function featureUtils_M(w){return!!w&&Je.test(w)}function q(w,D){const he=function featureUtils_U(w,D){if(!featureUtils_M(D)||!w)return;const he=D.replace(Je,"").toLowerCase();return w.find((w=>{let{name:D}=w;return D.toLowerCase()===he}))}(D,null===w||void 0===w?void 0:w.fieldName);return he?he.title||null:w?w.label||w.fieldName:null}function featureUtils_v(w,D){const he=featureUtils_$(D,w);return he?he.name:w}function featureUtils_$(w,D){var he;return w&&"function"==typeof w.getField&&D&&null!==(he=w.getField(D))&&void 0!==he?he:null}function k(w){return"".concat(w).trim()}function featureUtils_D(w){let{attributes:D,globalAttributes:he,layer:ve,text:_e,expressionAttributes:be,fieldInfoMap:Me}=w;return _e?featureUtils_z({formattedAttributes:he,template:Q(_e,{...he,...be,...D},ve),fieldInfoMap:Me}):""}function featureUtils_z(w){let{formattedAttributes:D,template:he,fieldInfoMap:ve}=w;return k(function L(w){return w.replaceAll(Qe,"")}((0,Oe.HC)((0,Oe.HC)(he,(w=>function A(w,D){const he=D.get(w.toLowerCase());return"{".concat((null===he||void 0===he?void 0:he.fieldName)||w,"}")}(w,ve))),D)))}function G(w){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const he={...w};return Object.keys(he).forEach((w=>function featureUtils_O(w,D){let he=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const ve=D[w];if("string"==typeof ve){const _e="%27",be=(he?encodeURIComponent(ve):ve).replaceAll(Ye,_e);D[w]=be}}(w,he,D))),he}function P(w,D){return w.replaceAll($e,((w,he,ve)=>{const _e=featureUtils_$(D,ve);return _e?"{".concat(_e.name,"}"):he}))}function Q(w,D,he){const ve=P(w,he);return ve?ve.replaceAll(tt,((w,he,ve)=>function featureUtils_S(w,D,he){const ve=(D=k(D))&&"{"!==D[0];return(0,Oe.HC)(w,G(he,ve||!1))}(w,he||ve,D))):ve}function J(w){return function H(w){return null!=w&&"object"==typeof w&&"fieldsIndex"in w&&"geometryType"in w&&"getField"in w&&"load"in w&&"loaded"in w&&"objectIdField"in w&&"spatialReference"in w&&"type"in w&&("feature"===w.type||"scene"===w.type)&&"when"in w}(w)&&function featureUtils_B(w){return null!=w&&"object"==typeof w&&"createQuery"in w&&"queryFeatureCount"in w&&"queryObjectIds"in w&&"queryRelatedFeatures"in w&&"queryRelatedFeaturesCount"in w&&"relationships"in w}(w)}function V(w,D){const{fieldInfos:he,fieldName:ve,preventPlacesFormatting:_e,layer:be,timeZone:Me}=D,Fe=Y(he,ve),Ae=featureUtils_$(be,ve);if(Fe&&!(0,ze.JL)(ve)){var Ce;const D=null===Ae||void 0===Ae?void 0:Ae.type,he=null===(Ce=Fe.format)||void 0===Ce?void 0:Ce.dateFormat;if("date"===D||"date-only"===D||"time-only"===D||"timestamp-offset"===D||he)return(0,We.i0)(w,{format:he,fieldType:D,timeZoneOptions:{layerTimeZone:be&&"preferredTimeZone"in be?be.preferredTimeZone:null,viewTimeZone:Me,datesInUnknownTimezone:!(!be||!("datesInUnknownTimezone"in be))&&!!be.datesInUnknownTimezone}})}const xe=null===Fe||void 0===Fe?void 0:Fe.format;return"string"==typeof w&&(0,ze.JL)(ve)&&xe?function W(w,D){return w=w.trim(),/\d{2}-\d{2}/.test(w)?w:w.includes(",")?X(w,",",", ",D):w.includes(";")?X(w,";","; ",D):w.includes(" ")?X(w," "," ",D):(0,Ne.ZV)(Number(w),(0,Ne.yx)(D))}(w,xe):"string"==typeof(w=function _(w,D){if("string"==typeof w&&D&&null==D.dateFormat&&(null!=D.places||null!=D.digitSeparator)){const D=Number(w);if(!isNaN(D))return D}return w}(w,xe))||null==w||null==xe?ae(w):(0,Ne.ZV)(w,_e?{...(0,Ne.yx)(xe),minimumFractionDigits:0,maximumFractionDigits:20}:(0,Ne.yx)(xe))}function X(w,D,he,ve){return w.trim().split(D).map((w=>(0,Ne.ZV)(Number(w),(0,Ne.yx)(ve)))).join(he)}function Y(w,D){if(null!==w&&void 0!==w&&w.length&&D)return w.find((w=>{var he;return(null===(he=w.fieldName)||void 0===he?void 0:he.toLowerCase())===D.toLowerCase()}))}function ie(w){const D=[];if(!w)return D;const{fieldInfos:he,content:ve}=w;return he&&D.push(...he),ve&&Array.isArray(ve)?(ve.forEach((w=>{if("fields"===w.type){const he=null===w||void 0===w?void 0:w.fieldInfos;he&&D.push(...he)}})),D):D}function oe(w){return w.replaceAll(et,(w=>"&#".concat(w.charCodeAt(0),";")))}function ae(w){return"string"==typeof w?w.replaceAll(Xe,'<br class="esri-text-new-line" />'):w}function le(w){var D;const{value:he,fieldName:ve,fieldInfos:_e,fieldInfoMap:be,layer:Me,graphic:Fe,timeZone:Ae}=w;if(null==he)return"";const Ce=function te(w){let{fieldName:D,value:he,graphic:ve,layer:_e}=w;if(de(D))return null;if(!_e||"function"!=typeof _e.getFieldDomain)return null;const be=ve&&_e.getFieldDomain(D,{feature:ve});return be&&"coded-value"===be.type?be.getName(he):null}({fieldName:ve,value:he,graphic:Fe,layer:Me});if(Ce)return Ce;const xe=function ee(w){let{fieldName:D,graphic:he,layer:ve}=w;if(de(D))return null;if(!ve||"function"!=typeof ve.getFeatureType)return null;const{typeIdField:_e}=ve;if(!_e||D!==_e)return null;const be=ve.getFeatureType(he);return be?be.name:null}({fieldName:ve,graphic:Fe,layer:Me});if(xe)return xe;if(be.get(ve.toLowerCase()))return V(he,{fieldInfos:_e||Array.from(be.values()),fieldName:ve,layer:Me,timeZone:Ae});const Le=null===Me||void 0===Me||null===(D=Me.fieldsIndex)||void 0===D?void 0:D.get(ve);return Le&&((0,We.fs)(Le)||(0,ze.OH)(Le))?(0,We.i0)(he,{fieldType:Le.type,timeZoneOptions:{layerTimeZone:Me&&"preferredTimeZone"in Me?Me.preferredTimeZone:null,viewTimeZone:Ae,datesInUnknownTimezone:!(!Me||!("datesInUnknownTimezone"in Me))&&!!Me.datesInUnknownTimezone}}):ae(he)}function ue(w){let{fieldInfos:D,attributes:he,layer:ve,graphic:_e,fieldInfoMap:be,relatedInfos:Me,timeZone:Fe}=w;const Ae={};return null!==Me&&void 0!==Me&&Me.forEach((w=>function ye(w){var D,he;let{attributes:ve,relatedInfo:_e,fieldInfoMap:be,fieldInfos:Me,layer:Fe,timeZone:Ae}=w;ve&&_e&&(null!==(D=_e.relatedFeatures)&&void 0!==D&&D.forEach((w=>me({attributes:ve,graphic:w,relatedInfo:_e,fieldInfoMap:be,fieldInfos:Me,layer:Fe,timeZone:Ae}))),null===(he=_e.relatedStatsFeatures)||void 0===he||he.forEach((w=>me({attributes:ve,graphic:w,relatedInfo:_e,fieldInfoMap:be,fieldInfos:Me,layer:Fe,timeZone:Ae}))))}({attributes:Ae,relatedInfo:w,fieldInfoMap:be,fieldInfos:D,layer:ve,timeZone:Fe}))),he&&Object.keys(he).forEach((w=>{const Me=he[w];Ae[w]=le({fieldName:w,fieldInfos:D,fieldInfoMap:be,layer:ve,value:Me,graphic:_e,timeZone:Fe})})),Ae}async function se(w,D){var he;const{layer:ve,graphic:_e,outFields:be,objectIds:Me,returnGeometry:Fe,spatialReference:Ae}=w,Ce=Me[0];if("number"!=typeof Ce&&"string"!=typeof Ce){const w="Could not query required fields for the specified feature. The feature's ID is invalid.",D={layer:ve,graphic:_e,objectId:Ce,requiredFields:be};return featureUtils_y().warn(w,D),null}if(null===(he=(0,je.BR)(ve))||void 0===he||null===(he=he.operations)||void 0===he||!he.supportsQuery){const w="The specified layer cannot be queried. The following fields will not be available.",D={layer:ve,graphic:_e,requiredFields:be,returnGeometry:Fe};return featureUtils_y().warn(w,D),null}const xe=ve.createQuery();return xe.objectIds=Me,xe.outFields=null!==be&&void 0!==be&&be.length?be:[ve.objectIdField],xe.returnGeometry=!!Fe,xe.returnZ=!!Fe,xe.returnM=!!Fe,xe.outSpatialReference=Ae,(await ve.queryFeatures(xe,D)).features[0]}async function ce(w,D){let{graphic:he,popupTemplate:ve,layer:_e,spatialReference:be}=w;if(!_e||!ve)return;if("function"==typeof _e.load&&await _e.load(D),!he.attributes)return;const Me=he.attributes[_e.objectIdField];if(null==Me)return;const Fe=[Me],Ae=await ve.getRequiredFields(_e.fieldsIndex),Ce=(0,ze.Kl)(Ae,he),xe=Ce?[]:Ae,Le=ve.returnGeometry||await async function fe(w){var D;if(null===(D=w.expressionInfos)||void 0===D||!D.length)return!1;const he=await(0,He.lw)(),{arcadeUtils:{hasGeometryFunctions:ve}}=he;return ve(w)}(ve);if(Ce&&!Le)return;const Ee=await se({layer:_e,graphic:he,outFields:xe,objectIds:Fe,returnGeometry:Le,spatialReference:be},D);Ee&&(Ee.geometry&&(he.geometry=Ee.geometry),Ee.attributes&&(he.attributes={...he.attributes,...Ee.attributes}))}function de(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!w&&w.includes(nt)}function me(w){let{attributes:D,graphic:he,relatedInfo:ve,fieldInfos:_e,fieldInfoMap:be,layer:Me,timeZone:Fe}=w;D&&he&&ve&&Object.keys(he.attributes).forEach((w=>{const Ae=function pe(w){return w?"".concat(nt).concat(w.layerId,"/").concat(w.fieldName):""}({layerId:ve.relation.id.toString(),fieldName:w}),Ce=he.attributes[w];D[Ae]=le({fieldName:Ae,fieldInfos:_e,fieldInfoMap:be,layer:Me,value:Ce,graphic:he,timeZone:Fe})}))}const ge=w=>{if(!w)return!1;const D=w.toUpperCase();return D.includes("CURRENT_TIMESTAMP")||D.includes("CURRENT_DATE")||D.includes("CURRENT_TIME")},Ie=w=>{var D;let{layer:he,method:ve,query:_e,definitionExpression:be}=w;if(null===(D=he.capabilities)||void 0===D||null===(D=D.query)||void 0===D||!D.supportsCacheHint||"attachments"===ve)return;const Me=null!=_e.where?_e.where:null,Fe=null!=_e.geometry?_e.geometry:null;ge(be)||ge(Me)||"extent"===(null===Fe||void 0===Fe?void 0:Fe.type)||"tile"===_e.resultType||(_e.cacheHint=!0)};function we(w,D,he){let{relatedTableId:ve}=he;const _e="scene"===D.type&&D.associatedLayer?D.associatedLayer.url:D.url;return w.filter(J).find((w=>w!==D&&w.url===_e&&w.layerId===ve))}const st={editing:!1,operations:{add:!0,update:!0,delete:!0}},rt=xe.A.ofType(De.A);let lt=class extends Ve.A{constructor(w){super(w),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...st},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new rt,this.fileInfos=new xe.A,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,Me.wB)((()=>this.graphic),(()=>this._graphicChanged()),Me.Vh))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(w){return{...st,...w}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:w}=this;if(!w)return!1;const D=w.layer||w.sourceLayer;return(null===D||void 0===D?void 0:D.loaded)&&"capabilities"in D&&D.capabilities&&"operations"in D.capabilities&&"supportsResizeAttachments"in D.capabilities.operations&&D.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:w,attachmentInfos:D}=this;if(!w||"function"!=typeof w.queryAttachments)throw new Ze.A("invalid-layer","getAttachments(): A valid layer is required.");const he=this._getObjectId(),ve=new qe.A({objectIds:[he],returnMetadata:!0}),_e=[],be=w.queryAttachments(ve).then((w=>w[he]||_e)).catch((()=>_e));this._getAttachmentsPromise=be,this.notifyChange("state");const Me=await be;return D.removeAll(),Me.length&&D.addMany(Me),this._getAttachmentsPromise=null,this.notifyChange("state"),Me}async addAttachment(w){var D;let he=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:ve,attachmentInfos:_e,capabilities:be}=this;if(!he)throw new Ze.A("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:he});if(!w)throw new Ze.A("invalid-attachment","addAttachment(): An attachment is required.",{attachment:w});if(null===(D=be.operations)||void 0===D||!D.add)throw new Ze.A("invalid-capabilities","addAttachment(): add capabilities are required.");if(!ve||"function"!=typeof ve.addAttachment)throw new Ze.A("invalid-layer","addAttachment(): A valid layer is required.");const Me=ve.addAttachment(he,w).then((w=>this._queryAttachment(w.objectId,he))),Fe=await Me;return _e.add(Fe),Fe}async deleteAttachment(w){var D;const{_attachmentLayer:he,attachmentInfos:ve,graphic:_e,capabilities:be}=this;if(!w)throw new Ze.A("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:w});if(null===(D=be.operations)||void 0===D||!D.delete)throw new Ze.A("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!he||"function"!=typeof he.deleteAttachments)throw new Ze.A("invalid-layer","deleteAttachment(): A valid layer is required.");if(!_e)throw new Ze.A("invalid-graphic","deleteAttachment(): A graphic is required.");const Me=he.deleteAttachments(_e,[w.id]).then((()=>w)),Fe=await Me;return ve.remove(Fe),Fe}async updateAttachment(w){var D;let he=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:ve,attachmentInfos:_e,graphic:be,capabilities:Me}=this;if(!w)throw new Ze.A("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:w});if(!he)throw new Ze.A("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:he});if(null===(D=Me.operations)||void 0===D||!D.update)throw new Ze.A("invalid-capabilities","updateAttachment(): Update capabilities are required.");const Fe=_e.indexOf(he);if(!ve||"function"!=typeof ve.updateAttachment)throw new Ze.A("invalid-layer","updateAttachment(): A valid layer is required.");if(!be)throw new Ze.A("invalid-graphic","updateAttachment(): A graphic is required.");const Ae=ve.updateAttachment(be,he.id,w).then((w=>this._queryAttachment(w.objectId))),Ce=await Ae;return _e.splice(Fe,1,Ce),Ce}async commitFiles(){return await Promise.all(this.fileInfos.items.map((w=>this.addAttachment(w.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(w,D){if(!w||!D)return null;const he={file:w,form:D};return this.fileInfos.add(he),he}updateFile(w,D){let he=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!w||!D||!he)return null;const ve=this.fileInfos.indexOf(he);return ve>-1&&this.fileInfos.splice(ve,1,{file:w,form:D}),this.fileInfos.items[ve]}deleteFile(w){const D=this.fileInfos.find((D=>D.file===w));return D?(this.fileInfos.remove(D),D):null}async _queryAttachment(w,D){const{_attachmentLayer:he}=this;if(!w||null===he||void 0===he||!he.queryAttachments)throw new Ze.A("invalid-attachment-id","Could not query attachment.");const ve=this._getObjectId(D),_e=new qe.A({objectIds:[ve],attachmentsWhere:"AttachmentId=".concat(w),returnMetadata:!0});return he.queryAttachments(_e).then((w=>w[ve][0]))}_getObjectId(){var w;let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return null!==(w=null===D||void 0===D?void 0:D.getObjectId())&&void 0!==w?w:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:w}=this,D=E(w);this._attachmentLayer=D?"scene"===D.type&&null!=D.associatedLayer?D.associatedLayer:D:null}};(0,ve._)([(0,Fe.MZ)()],lt.prototype,"capabilities",void 0),(0,ve._)([(0,Ee.w)("capabilities")],lt.prototype,"castCapabilities",null),(0,ve._)([(0,Fe.MZ)()],lt.prototype,"activeAttachmentInfo",void 0),(0,ve._)([(0,Fe.MZ)()],lt.prototype,"activeFileInfo",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0,type:rt})],lt.prototype,"attachmentInfos",void 0),(0,ve._)([(0,Fe.MZ)()],lt.prototype,"fileInfos",void 0),(0,ve._)([(0,Fe.MZ)({type:Ue.A})],lt.prototype,"graphic",void 0),(0,ve._)([(0,Fe.MZ)()],lt.prototype,"mode",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],lt.prototype,"state",null),(0,ve._)([(0,Fe.MZ)()],lt.prototype,"filesEnabled",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],lt.prototype,"supportsResizeAttachments",null),lt=(0,ve._)([(0,Ae.$)("esri.widgets.Attachments.AttachmentsViewModel")],lt);const at=lt;var dt=he(14795);function attachmentUtils_e(w){const D=w.toLowerCase();return"image/bmp"===D||"image/emf"===D||"image/exif"===D||"image/gif"===D||"image/x-icon"===D||"image/jpeg"===D||"image/png"===D||"image/tiff"===D||"image/x-wmf"===D}var ct=he(43016),ut=he(75940),ht=he(78862),pt=he(70218),vt=he(60102),mt=he(8689);const ft={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},gt="esri-attachments",yt={base:gt,loaderContainer:"".concat(gt,"__loader-container"),loader:"".concat(gt,"__loader"),fadeIn:"".concat(gt,"--fade-in"),container:"".concat(gt,"__container"),containerList:"".concat(gt,"__container--list"),containerPreview:"".concat(gt,"__container--preview"),actions:"".concat(gt,"__actions"),deleteButton:"".concat(gt,"__delete-button"),addAttachmentButton:"".concat(gt,"__add-attachment-button"),errorMessage:"".concat(gt,"__error-message"),items:"".concat(gt,"__items"),item:"".concat(gt,"__item"),itemButton:"".concat(gt,"__item-button"),itemMask:"".concat(gt,"__item-mask"),itemMaskIcon:"".concat(gt,"__item-mask--icon"),itemImage:"".concat(gt,"__image"),itemImageResizable:"".concat(gt,"__image--resizable"),itemLabel:"".concat(gt,"__label"),itemFilename:"".concat(gt,"__filename"),itemChevronIcon:"".concat(gt,"__item-chevron-icon"),itemLink:"".concat(gt,"__item-link"),itemLinkOverlay:"".concat(gt,"__item-link-overlay"),itemLinkOverlayIcon:"".concat(gt,"__item-link-overlay-icon"),itemEditIcon:"".concat(gt,"__item-edit-icon"),itemAddIcon:"".concat(gt,"__item-add-icon"),itemAddButton:"".concat(gt,"__item-add-button"),formNode:"".concat(gt,"__form-node"),fileFieldset:"".concat(gt,"__file-fieldset"),fileLabel:"".concat(gt,"__file-label"),fileName:"".concat(gt,"__file-name"),fileInput:"".concat(gt,"__file-input"),metadata:"".concat(gt,"__metadata"),metadataFieldset:"".concat(gt,"__metadata-fieldset"),progressBar:"".concat(gt,"__progress-bar")},_t=window.CSS;let wt=class extends ke.A{constructor(w,D){super(w,D),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...ft},this._supportsImageOrientation=_t&&_t.supports&&_t.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(w){var D;return null!==(D=w)&&void 0!==D&&D.viewModel||(w={viewModel:new at,...w}),w}initialize(){this.addHandles([(0,Me.on)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.attachmentInfos}),"change",(()=>this.scheduleRender())),(0,Me.on)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.fileInfos}),"change",(()=>this.scheduleRender())),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.mode}),(()=>this._modeChanged()),Me.Vh)])}loadDependencies(){return(0,ct.W)({icon:()=>Promise.all([he.e(463),he.e(8156)]).then(he.bind(he,48156))})}get capabilities(){return this.viewModel.capabilities}set capabilities(w){this.viewModel.capabilities=w}get effectiveDisplayType(){const{displayType:w}=this;return w&&"auto"!==w?w:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(w){this.viewModel.graphic=w}get label(){var w,D;return null!==(w=null===(D=this.messages)||void 0===D?void 0:D.widgetLabel)&&void 0!==w?w:""}set label(w){this._overrideIfSome("label",w)}castVisibleElements(w){return{...ft,...w}}addAttachment(){const{_addAttachmentForm:w,viewModel:D}=this;return this._set("submitting",!0),this._set("error",null),D.addAttachment(w).then((w=>(this._set("submitting",!1),this._set("error",null),D.mode="view",w))).catch((w=>{throw this._set("submitting",!1),this._set("error",new Ze.A("attachments:add-attachment",this.messages.addErrorMessage,w)),w}))}deleteAttachment(w){const{viewModel:D}=this;return this._set("submitting",!0),this._set("error",null),D.deleteAttachment(w).then((w=>(this._set("submitting",!1),this._set("error",null),D.mode="view",w))).catch((w=>{throw this._set("submitting",!1),this._set("error",new Ze.A("attachments:delete-attachment",this.messages.deleteErrorMessage,w)),w}))}updateAttachment(){const{viewModel:w}=this,{_updateAttachmentForm:D}=this;return this._set("submitting",!0),this._set("error",null),w.updateAttachment(D).then((D=>(this._set("submitting",!1),this._set("error",null),w.mode="view",D))).catch((w=>{throw this._set("submitting",!1),this._set("error",new Ze.A("attachments:update-attachment",this.messages.updateErrorMessage,w)),w}))}addFile(){const w=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",w}updateFile(){const{viewModel:w}=this,D=w.updateFile(this.selectedFile,this._updateAttachmentForm,w.activeFileInfo);return w.mode="view",D}deleteFile(w){var D;const he=this.viewModel.deleteFile(w||(null===(D=this.viewModel.activeFileInfo)||void 0===D?void 0:D.file));return this.viewModel.mode="view",he}render(){const{submitting:w,viewModel:D}=this,{state:he}=D;return(0,mt.K)("div",{class:this.classes(yt.base,ut.D.widget)},w?this._renderProgressBar():null,"loading"===he?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:w,visibleElements:D}=this;return w&&D.errorMessage?(0,mt.K)("div",{class:yt.errorMessage,key:"error-message"},w.message):null}_renderAttachments(){const{activeFileInfo:w,mode:D,activeAttachmentInfo:he}=this.viewModel;return"add"===D?this._renderAddForm():"edit"===D?this._renderDetailsForm(he||w):this._renderAttachmentContainer()}_renderLoading(){return(0,mt.K)("div",{class:yt.loaderContainer,key:"loader"},(0,mt.K)("div",{class:yt.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,mt.K)("div",{class:yt.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:w,selectedFile:D}=this,he=w||!D,ve=this.visibleElements.cancelAddButton?(0,mt.K)("button",{bind:this,class:this.classes(ut.D.button,ut.D.buttonTertiary,ut.D.buttonSmall,ut.D.buttonHalf,w&&ut.D.buttonDisabled),disabled:w,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,_e=this.visibleElements.addSubmitButton?(0,mt.K)("button",{class:this.classes(ut.D.button,ut.D.buttonSecondary,ut.D.buttonSmall,ut.D.buttonHalf,{[ut.D.buttonDisabled]:he}),disabled:he,type:"submit"},this.messages.add):null,be=D?(0,mt.K)("span",{class:yt.fileName,key:"file-name"},D.name):null,Me=(0,mt.K)("form",{afterCreate:pt.cA,afterRemoved:pt.N_,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,mt.K)("fieldset",{class:yt.fileFieldset},be,(0,mt.K)("label",{class:this.classes(yt.fileLabel,ut.D.button,ut.D.buttonSecondary)},D?this.messages.changeFile:this.messages.selectFile,(0,mt.K)("input",{bind:this,class:yt.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),_e,ve);return(0,mt.K)("div",{class:yt.formNode,key:"add-form-container"},Me)}_renderDetailsForm(w){var D,he,ve,_e;const{visibleElements:be,viewModel:Me,selectedFile:Fe,submitting:Ae}=this,{capabilities:Ce}=Me,xe=Ae||!Fe;let Le,Ee,ke,Ze;Fe?(Le=Fe.type,Ee=Fe.name,ke=Fe.size):w&&"file"in w?(Le=w.file.type,Ee=w.file.name,ke=w.file.size):w&&"contentType"in w&&(Le=w.contentType,Ee=w.name,ke=w.size,Ze=w.url);const Pe=Ce.editing&&null!==(D=Ce.operations)&&void 0!==D&&D.delete&&be.deleteButton?(0,mt.K)("button",{bind:this,class:this.classes(ut.D.button,ut.D.buttonSmall,ut.D.buttonTertiary,yt.deleteButton,{[ut.D.buttonDisabled]:Ae}),disabled:Ae,key:"delete-button",onclick:D=>this._submitDeleteAttachment(D,w),type:"button"},this.messages.delete):void 0,Ue=Ce.editing&&null!==(he=Ce.operations)&&void 0!==he&&he.update&&be.updateButton?(0,mt.K)("button",{class:this.classes(ut.D.button,ut.D.buttonSmall,ut.D.buttonThird,{[ut.D.buttonDisabled]:xe}),disabled:xe,key:"update-button",type:"submit"},this.messages.update):void 0,Ve=this.visibleElements.cancelUpdateButton?(0,mt.K)("button",{bind:this,class:this.classes(ut.D.button,ut.D.buttonSmall,ut.D.buttonTertiary,ut.D.buttonThird,{[ut.D.buttonDisabled]:Ae}),disabled:Ae,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,De=Ce.editing&&null!==(ve=Ce.operations)&&void 0!==ve&&ve.update?(0,mt.K)("fieldset",{class:yt.fileFieldset,key:"file"},(0,mt.K)("span",{class:yt.fileName,key:"file-name"},Ee),(0,mt.K)("label",{class:this.classes(yt.fileLabel,ut.D.button,ut.D.buttonSecondary)},this.messages.changeFile,(0,mt.K)("input",{bind:this,class:yt.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,qe=(0,mt.K)("fieldset",{class:yt.metadataFieldset,key:"size"},(0,mt.K)("label",null,function O(w,D){let he=0===(D=Math.round(D))?0:Math.floor(Math.log(D)/Math.log(Se.u.KILOBYTES));he=(0,Re.qE)(he,0,Be.length-1);const ve=(0,Ne.ZV)(D/Se.u.KILOBYTES**he,{maximumFractionDigits:2});return(0,Oe.HC)(w.units.bytes[Be[he]],{fileSize:ve})}(this.messagesUnits,null!==(_e=ke)&&void 0!==_e?_e:0))),Ke=(0,mt.K)("fieldset",{class:yt.metadataFieldset,key:"content-type"},(0,mt.K)("label",null,Le)),ze=null!=Ze?(0,mt.K)("a",{class:yt.itemLink,href:Ze,rel:"noreferrer",target:"_blank"},this._renderImageMask(w,400),(0,mt.K)("div",{class:yt.itemLinkOverlay},(0,mt.K)("span",{class:yt.itemLinkOverlayIcon},(0,mt.K)("calcite-icon",{icon:"launch"})))):this._renderImageMask(w,400),je=(0,mt.K)("form",{afterCreate:pt.cA,afterRemoved:pt.N_,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:D=>this._submitUpdateAttachment(D,w)},(0,mt.K)("div",{class:yt.metadata},qe,Ke),De,(0,mt.K)("div",{class:yt.actions},Pe,Ve,Ue));return(0,mt.K)("div",{class:yt.formNode,key:"edit-form-container"},ze,je)}_renderImageMask(w,D){return w?"file"in w?this._renderGenericImageMask(w.file.name,w.file.type):this._renderImageMaskForAttachment(w,D):null}_renderGenericImageMask(w,D){const{supportsResizeAttachments:he}=this.viewModel,ve=function attachmentUtils_p(w){const D=(0,dt.s)("esri/themes/base/images/files/");return w?"text/plain"===w?"".concat(D,"text-32.svg"):"application/pdf"===w?"".concat(D,"pdf-32.svg"):"text/csv"===w?"".concat(D,"csv-32.svg"):"application/gpx+xml"===w?"".concat(D,"gpx-32.svg"):"application/x-dwf"===w?"".concat(D,"cad-32.svg"):"application/postscript"===w||"application/json"===w||"text/xml"===w||"model/vrml"===w?"".concat(D,"code-32.svg"):"application/x-zip-compressed"===w||"application/x-7z-compressed"===w||"application/x-gzip"===w||"application/x-tar"===w||"application/x-gtar"===w||"application/x-bzip2"===w||"application/gzip"===w||"application/x-compress"===w||"application/x-apple-diskimage"===w||"application/x-rar-compressed"===w||"application/zip"===w?"".concat(D,"zip-32.svg"):w.includes("image/")?"".concat(D,"image-32.svg"):w.includes("audio/")?"".concat(D,"sound-32.svg"):w.includes("video/")?"".concat(D,"video-32.svg"):w.includes("msexcel")||w.includes("ms-excel")||w.includes("spreadsheetml")?"".concat(D,"excel-32.svg"):w.includes("msword")||w.includes("ms-word")||w.includes("wordprocessingml")?"".concat(D,"word-32.svg"):w.includes("powerpoint")||w.includes("presentationml")?"".concat(D,"report-32.svg"):"".concat(D,"generic-32.svg"):"".concat(D,"generic-32.svg")}(D),_e={[yt.itemImageResizable]:he};return(0,mt.K)("div",{class:this.classes(yt.itemMaskIcon,yt.itemMask),key:ve},(0,mt.K)("img",{alt:w,class:this.classes(_e,yt.itemImage),src:ve,title:w}))}_renderImageMaskForAttachment(w,D){const{supportsResizeAttachments:he}=this.viewModel;if(!w)return null;const{contentType:ve,name:_e,url:be}=w;if(!he||!attachmentUtils_e(ve))return this._renderGenericImageMask(_e,ve);const Me=this._getCSSTransform(w),Fe=Me?{transform:Me,"image-orientation":"none"}:{},Ae="".concat(be).concat(null!==be&&void 0!==be&&be.includes("?")?"&":"?","w=").concat(D),Ce={[yt.itemImageResizable]:he};return(0,mt.K)("div",{class:this.classes(yt.itemMask),key:Ae},(0,mt.K)("img",{alt:_e,class:this.classes(Ce,yt.itemImage),src:Ae,styles:Fe,title:_e}))}_renderFile(w){const{file:D}=w;return(0,mt.K)("li",{class:yt.item,key:D},(0,mt.K)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:yt.itemButton,key:"details-button",onclick:()=>this._startEditFile(w),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(w),(0,mt.K)("label",{class:yt.itemLabel},(0,mt.K)("span",{class:yt.itemFilename},D.name||this.messages.noTitle),(0,mt.K)("span",{"aria-hidden":"true",class:this.classes(yt.itemChevronIcon,(0,pt.V8)(this.container)?ht.T.left:ht.T.right)}))))}_renderAttachmentInfo(w){let{attachmentInfo:D,displayType:he}=w;const{viewModel:ve,effectiveDisplayType:_e}=this,{capabilities:be,supportsResizeAttachments:Me}=ve,{contentType:Fe,name:Ae,url:Ce}=D,xe=this._renderImageMask(D,"list"===he?48:400),Le=be.editing?(0,mt.K)("span",{"aria-hidden":"true",class:this.classes(yt.itemChevronIcon,(0,pt.V8)(this.container)?ht.T.left:ht.T.right)}):null,Ee=[xe,"preview"===_e&&Me&&attachmentUtils_e(Fe)?null:(0,mt.K)("label",{class:yt.itemLabel},(0,mt.K)("span",{class:yt.itemFilename},Ae||this.messages.noTitle),Le)],ke=be.editing?(0,mt.K)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:yt.itemButton,"data-attachment-info-id":D.id,key:"details-button",onclick:()=>this._startEditAttachment(D),title:this.messages.attachmentDetails,type:"button"},Ee):(0,mt.K)("a",{class:yt.itemButton,href:null!==Ce&&void 0!==Ce?Ce:void 0,key:"details-link",target:"_blank"},Ee);return(0,mt.K)("li",{class:yt.item,key:D},ke)}_renderAttachmentContainer(){var w;const{effectiveDisplayType:D,viewModel:he,visibleElements:ve}=this,{attachmentInfos:_e,capabilities:be,fileInfos:Me}=he,Fe=!(null===_e||void 0===_e||!_e.length),Ae=!(null===Me||void 0===Me||!Me.length),Ce={[yt.containerList]:"preview"!==D,[yt.containerPreview]:"preview"===D},xe=be.editing&&null!==(w=be.operations)&&void 0!==w&&w.add&&ve.addButton?(0,mt.K)("button",{bind:this,class:this.classes(ut.D.button,ut.D.buttonTertiary,yt.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,mt.K)("span",{"aria-hidden":"true",class:this.classes(yt.itemAddIcon,ht.T.plus)}),this.messages.add):void 0,Le=Fe?(0,mt.K)("ul",{class:yt.items,key:"attachments-list"},_e.toArray().map((w=>this._renderAttachmentInfo({attachmentInfo:w,displayType:D})))):void 0,Ee=Ae?(0,mt.K)("ul",{class:yt.items,key:"file-list"},Me.toArray().map((w=>this._renderFile(w)))):void 0,ke=Ae||Fe?void 0:(0,mt.K)("div",{class:ut.D.empty},this.messages.noAttachments);return(0,mt.K)("div",{class:this.classes(yt.container,Ce),key:"attachments-container"},Le,Ee,ke,xe)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(w){var D;const he=null===(D=w.target.files)||void 0===D?void 0:D.item(0);this._set("selectedFile",he)}_submitDeleteAttachment(w,D){w.preventDefault(),D&&("file"in D?this.deleteFile(D.file):D&&this.deleteAttachment(D))}_submitAddAttachment(w){w.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(w,D){w.preventDefault(),D&&"file"in D?this.updateFile():this.updateAttachment()}_startEditAttachment(w){const{viewModel:D}=this;D.activeFileInfo=null,D.activeAttachmentInfo=w,D.mode="edit"}_startEditFile(w){const{viewModel:D}=this;D.activeAttachmentInfo=null,D.activeFileInfo=w,D.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(w){w.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(w){const{orientationInfo:D}=w;return!this._supportsImageOrientation&&D?[D.rotation?"rotate(".concat(D.rotation,"deg)"):"",D.mirrored?"scaleX(-1)":""].join(" "):""}};(0,ve._)([(0,Fe.MZ)()],wt.prototype,"capabilities",null),(0,ve._)([(0,Fe.MZ)()],wt.prototype,"displayType",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],wt.prototype,"effectiveDisplayType",null),(0,ve._)([(0,Fe.MZ)()],wt.prototype,"graphic",null),(0,ve._)([(0,Fe.MZ)()],wt.prototype,"label",null),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Attachments/t9n/Attachments")],wt.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/core/t9n/Units")],wt.prototype,"messagesUnits",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],wt.prototype,"selectedFile",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],wt.prototype,"submitting",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],wt.prototype,"error",void 0),(0,ve._)([(0,Fe.MZ)({type:at})],wt.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)()],wt.prototype,"visibleElements",void 0),(0,ve._)([(0,Ee.w)("visibleElements")],wt.prototype,"castVisibleElements",null),wt=(0,ve._)([(0,Ae.$)("esri.widgets.Attachments")],wt);const bt=wt;let Mt=class extends at{constructor(w){super(w),this.description=null,this.title=null}};(0,ve._)([(0,Fe.MZ)()],Mt.prototype,"description",void 0),(0,ve._)([(0,Fe.MZ)()],Mt.prototype,"title",void 0),Mt=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Mt);const Ft=Mt;function Heading_e(w,D){let{level:he,class:ve,..._e}=w;const be=Heading_s(he);return(0,mt.K)("h".concat(be),{..._e,"aria-level":String(be),class:(0,pt.Ly)(ut.D.heading,ve),role:"heading"},D)}function Heading_s(w){return(0,Re.qE)(Math.ceil(w),1,6)}const At="esri-feature-element-info",It={base:At,title:"".concat(At,"__title"),description:"".concat(At,"__description")};let Ct=class extends ke.A{constructor(w,D){super(w,D),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,mt.K)("div",{class:It.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:w}=this;return w?(0,mt.K)(Heading_e,{class:It.title,level:this.headingLevel},w):null}_renderDescription(){const{description:w}=this;return w?(0,mt.K)("div",{class:It.description,key:"description"},w):null}};(0,ve._)([(0,Fe.MZ)()],Ct.prototype,"description",void 0),(0,ve._)([(0,Fe.MZ)()],Ct.prototype,"headingLevel",void 0),(0,ve._)([(0,Fe.MZ)()],Ct.prototype,"title",void 0),Ct=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.support.FeatureElementInfo")],Ct);const xt=Ct,Lt="esri-feature-attachments";let Et=class extends ke.A{constructor(w,D){super(w,D),this._featureElementInfo=null,this.attachmentsWidget=new bt,this.headingLevel=2,this.viewModel=new Ft}initialize(){this._featureElementInfo=new xt,this.addHandles([(0,Me.wB)((()=>{var w,D;return[null===(w=this.viewModel)||void 0===w?void 0:w.description,null===(D=this.viewModel)||void 0===D?void 0:D.title,this.headingLevel]}),(()=>this._setupFeatureElementInfo()),Me.Vh),(0,Me.wB)((()=>this.viewModel),(w=>this.attachmentsWidget.viewModel=w),Me.Vh)])}destroy(){var w;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),null===(w=this._featureElementInfo)||void 0===w||w.destroy()}get description(){return this.viewModel.description}set description(w){this.viewModel.description=w}get displayType(){return this.attachmentsWidget.displayType}set displayType(w){this.attachmentsWidget.displayType=w}get graphic(){return this.viewModel.graphic}set graphic(w){this.viewModel.graphic=w}get title(){return this.viewModel.title}set title(w){this.viewModel.title=w}render(){var w;const{attachmentsWidget:D}=this;return(0,mt.K)("div",{class:Lt},null===(w=this._featureElementInfo)||void 0===w?void 0:w.render(),null===D||void 0===D?void 0:D.render())}_setupFeatureElementInfo(){var w;const{description:D,title:he,headingLevel:ve}=this;null===(w=this._featureElementInfo)||void 0===w||w.set({description:D,title:he,headingLevel:ve})}};(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Et.prototype,"attachmentsWidget",void 0),(0,ve._)([(0,Fe.MZ)()],Et.prototype,"description",null),(0,ve._)([(0,Fe.MZ)()],Et.prototype,"displayType",null),(0,ve._)([(0,Fe.MZ)()],Et.prototype,"graphic",null),(0,ve._)([(0,Fe.MZ)()],Et.prototype,"headingLevel",void 0),(0,ve._)([(0,Fe.MZ)()],Et.prototype,"title",null),(0,ve._)([(0,Fe.MZ)({type:Ft})],Et.prototype,"viewModel",void 0),Et=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureAttachments")],Et);const kt=Et;let Zt=class extends Ve.A{constructor(w){super(w),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,Me.wB)((()=>this.creator),(w=>{this._destroyContent(),this._createContent(w)}),Me.Vh))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:w,graphic:D,destroyer:he}=this;w&&D&&(featureUtils_x(he,{graphic:D}).catch((()=>null)),this._set("created",null))}async _createContent(w){const D=this.graphic;if(!D||!w)return;const he=featureUtils_x(w,{graphic:D}).catch((()=>null));this._loadingPromise=he,this.notifyChange("state");const ve=await he;he===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",ve))}};(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zt.prototype,"created",void 0),(0,ve._)([(0,Fe.MZ)()],Zt.prototype,"creator",void 0),(0,ve._)([(0,Fe.MZ)()],Zt.prototype,"destroyer",void 0),(0,ve._)([(0,Fe.MZ)({type:Ue.A})],Zt.prototype,"graphic",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zt.prototype,"state",null),Zt=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Zt);const Tt=Zt;he(43571);function widget_e(w){return w&&"function"==typeof w.render}const St="esri-feature-content",Rt={base:St,loaderContainer:"".concat(St,"__loader-container"),loader:"".concat(St,"__loader")};let Pt=class extends ke.A{constructor(w,D){super(w,D),this.viewModel=null,this._addTargetToAnchors=w=>{Array.from(w.querySelectorAll("a")).forEach((w=>{C(w.href)&&!w.hasAttribute("target")&&w.setAttribute("target","_blank")}))}}get creator(){var w;return null===(w=this.viewModel)||void 0===w?void 0:w.creator}set creator(w){this.viewModel&&(this.viewModel.creator=w)}get graphic(){var w;return null===(w=this.viewModel)||void 0===w?void 0:w.graphic}set graphic(w){this.viewModel&&(this.viewModel.graphic=w)}render(){var w;const D=null===(w=this.viewModel)||void 0===w?void 0:w.state;return(0,mt.K)("div",{class:Rt.base},"loading"===D?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,mt.K)("div",{class:Rt.loaderContainer,key:"loader"},(0,mt.K)("div",{class:Rt.loader}))}_renderCreated(){var w;const D=null===(w=this.viewModel)||void 0===w?void 0:w.created;return D?D instanceof HTMLElement?(0,mt.K)("div",{afterCreate:this._attachToNode,bind:D,key:D}):widget_e(D)?(0,mt.K)("div",{key:D},!D.destroyed&&D.render()):(0,mt.K)("div",{afterCreate:this._addTargetToAnchors,innerHTML:D,key:D}):null}_attachToNode(w){w.appendChild(this)}};(0,ve._)([(0,Fe.MZ)()],Pt.prototype,"creator",null),(0,ve._)([(0,Fe.MZ)()],Pt.prototype,"graphic",null),(0,ve._)([(0,Fe.MZ)({type:Tt})],Pt.prototype,"viewModel",void 0),Pt=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureContent")],Pt);const Ot=Pt;var Nt=he(59627),Bt=he(64145);let Ut=class extends Ve.A{constructor(w){super(w),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:w,fieldInfos:D}=this,he=[];return null!==D&&void 0!==D&&D.forEach((D=>{if(D.hasOwnProperty("visible")&&!D.visible)return;const ve=D.clone();ve.label=q(ve,w),he.push(ve)})),he}};(0,ve._)([(0,Fe.MZ)()],Ut.prototype,"attributes",void 0),(0,ve._)([(0,Fe.MZ)({type:[Nt.A]})],Ut.prototype,"expressionInfos",void 0),(0,ve._)([(0,Fe.MZ)()],Ut.prototype,"description",void 0),(0,ve._)([(0,Fe.MZ)({type:[Bt.A]})],Ut.prototype,"fieldInfos",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ut.prototype,"formattedFieldInfos",null),(0,ve._)([(0,Fe.MZ)()],Ut.prototype,"title",void 0),Ut=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ut);const Vt=Ut,Dt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];const qt="esri-feature-fields",Kt={base:qt,fieldHeader:"".concat(qt,"__field-header"),fieldData:"".concat(qt,"__field-data"),fieldDataDate:"".concat(qt,"__field-data--date")};let zt=class extends ke.A{constructor(w,D){super(w,D),this._featureElementInfo=null,this.viewModel=new Vt,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new xt,this.addHandles((0,Me.wB)((()=>{var w,D;return[null===(w=this.viewModel)||void 0===w?void 0:w.description,null===(D=this.viewModel)||void 0===D?void 0:D.title]}),(()=>this._setupFeatureElementInfo()),Me.Vh))}destroy(){var w;null===(w=this._featureElementInfo)||void 0===w||w.destroy()}get attributes(){return this.viewModel.attributes}set attributes(w){this.viewModel.attributes=w}get description(){return this.viewModel.description}set description(w){this.viewModel.description=w}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(w){this.viewModel.expressionInfos=w}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(w){this.viewModel.fieldInfos=w}get title(){return this.viewModel.title}set title(w){this.viewModel.title=w}render(){var w;return(0,mt.K)("div",{class:Kt.base},null===(w=this._featureElementInfo)||void 0===w?void 0:w.render(),this._renderFields())}_renderFieldInfo(w,D){const{attributes:he}=this.viewModel,ve=w.fieldName,_e=w.label||ve,be=he?null==he[ve]?"":he[ve]:"",Me=!(!w.format||!w.format.dateFormat),Fe="number"!=typeof be||Me?function uriUtils_a(w,D){if("string"!=typeof D||!D)return D;const he=Dt.find((w=>w.pattern.test(D)));if(!he)return D;const ve=D.match(he.pattern),_e=ve&&ve[2],be=(0,Oe.HC)((0,Oe.HC)(he.label,{messages:w,hierPart:_e}),{appName:he.appName}),Me=he.target?' target="'.concat(he.target,'"'):"",Fe="_blank"===he.target?' rel="noreferrer"':"";return D.replace(he.pattern,"<a".concat(Me,' href="$1"').concat(Fe,">").concat(be,"</a>"))}(this.messagesURIUtils,be):this._forceLTR(be),Ae={[Kt.fieldDataDate]:Me};return(0,mt.K)("tr",{key:"fields-element-info-row-".concat(ve,"-").concat(D)},(0,mt.K)("th",{class:Kt.fieldHeader,innerHTML:_e,key:"fields-element-info-row-header-".concat(ve,"-").concat(D)}),(0,mt.K)("td",{class:this.classes(Kt.fieldData,Ae),innerHTML:Fe,key:"fields-element-info-row-data-".concat(ve,"-").concat(D)}))}_renderFields(){const{formattedFieldInfos:w}=this.viewModel;return null!==w&&void 0!==w&&w.length?(0,mt.K)("table",{class:ut.D.table,summary:this.messages.fieldsSummary},(0,mt.K)("tbody",null,w.map(((w,D)=>this._renderFieldInfo(w,D))))):null}_setupFeatureElementInfo(){var w;const{description:D,title:he}=this;null===(w=this._featureElementInfo)||void 0===w||w.set({description:D,title:he})}_forceLTR(w){return"&lrm;".concat(w)}};(0,ve._)([(0,Fe.MZ)()],zt.prototype,"attributes",null),(0,ve._)([(0,Fe.MZ)()],zt.prototype,"description",null),(0,ve._)([(0,Fe.MZ)()],zt.prototype,"expressionInfos",null),(0,ve._)([(0,Fe.MZ)()],zt.prototype,"fieldInfos",null),(0,ve._)([(0,Fe.MZ)()],zt.prototype,"title",null),(0,ve._)([(0,Fe.MZ)({type:Vt,nonNullable:!0})],zt.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Feature/t9n/Feature")],zt.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/support/t9n/uriUtils")],zt.prototype,"messagesURIUtils",void 0),zt=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureFields")],zt);const jt=zt;var Wt=he(16842),Ht=he(69719),Gt=(he(14449),he(29022),he(80047)),Qt=he(68556),$t=he(36836);(0,Ke.J2)("short-date");async function utils_w(w,D,he){(0,Ht.tE)(w,D,(()=>[])).push(...he)}async function utils_x(w){var D;const he=new Map;if(!w)return he;if("visualVariables"in w&&w.visualVariables){const D=w.visualVariables.filter((w=>"color"===w.type));for(const w of D){var ve;const D=(null!==(ve=await(0,Qt.getRampStops)(w))&&void 0!==ve?ve:[]).map((w=>w.color));await utils_w(he,w.field||w.valueExpression,D)}}if("heatmap"===w.type){const D=function heatmapRampUtils_r(w){if(!w.colorStops)return[];const D=[...w.colorStops].filter((w=>{var D;return(null===(D=w.color)||void 0===D?void 0:D.a)>0}));let he=D.length-1;if(D&&D[0]){const w=D[he];w&&1!==w.ratio&&(D.push(new $t.A({ratio:1,color:w.color})),he++)}return D.map(((D,ve)=>{var _e,be;let Me="";return 0===ve?Me=(null===(_e=w.legendOptions)||void 0===_e?void 0:_e.minLabel)||"low":ve===he&&(Me=(null===(be=w.legendOptions)||void 0===be?void 0:be.maxLabel)||"high"),{color:D.color,label:Me,ratio:D.ratio}})).reverse()}(w).map((w=>w.color));await utils_w(he,w.field||w.valueExpression,D)}else if("pie-chart"===w.type){var _e;for(const D of w.attributes)await utils_w(he,D.field||D.valueExpression,[D.color]);await utils_w(he,"default",[null===w||void 0===w||null===(_e=w.othersCategory)||void 0===_e?void 0:_e.color,(0,Gt.Sx)(w.backgroundFillSymbol,null)])}else if("dot-density"===w.type){for(const D of w.attributes)await utils_w(he,D.field||D.valueExpression,[D.color]);await utils_w(he,"default",[w.backgroundColor])}else if("unique-value"===w.type)if("predominance"===(null===(D=w.authoringInfo)||void 0===D?void 0:D.type))for(const Fe of null!==(be=w.uniqueValueInfos)&&void 0!==be?be:[]){var be;await utils_w(he,Fe.value.toString(),[(0,Gt.Sx)(Fe.symbol,null)])}else{var Me;const D=(null!==(Me=w.uniqueValueInfos)&&void 0!==Me?Me:[]).map((w=>(0,Gt.Sx)(w.symbol,null))),{field:ve,field2:_e,field3:be,valueExpression:Fe}=w;(ve||Fe)&&await utils_w(he,ve||Fe,D),_e&&await utils_w(he,_e,D),be&&await utils_w(he,be,D)}else if("class-breaks"===w.type){const D=w.classBreakInfos.map((w=>(0,Gt.Sx)(w.symbol,null))),{field:ve,valueExpression:_e}=w;await utils_w(he,null!==ve&&void 0!==ve?ve:_e,D)}else"simple"===w.type&&await utils_w(he,"default",[(0,Gt.Sx)(w.symbol,null)]);return"defaultSymbol"in w&&w.defaultSymbol&&await utils_w(he,"default",[(0,Gt.Sx)(w.defaultSymbol,null)]),he.forEach(((w,D)=>{const ve=(0,Wt.Am)(w.filter(Boolean),((w,D)=>JSON.stringify(w)===JSON.stringify(D)));he.set(D,ve)})),he}var Yt=he(87863),Jt=he(53705),Xt=he(81618),ei=(he(25230),he(35761)),ti=(he(61272),he(50075),he(4270),he(78535),he(78395),he(21374),he(66445),he(22156),he(57264)),ii=(he(48343),he(60141),he(55476),he(98664),he(39572),he(40954),he(94309),he(49096)),ni=he(86745),oi=(he(44190),he(82004));const relatedFeatureUtils_m=()=>be.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),si=new Map;function relatedFeatureUtils_y(w){if(!de(w))return null;const[D,he]=w.split("/").slice(1);return{layerId:D,fieldName:he}}function relatedFeatureUtils_F(w,D){const he=function relatedFeatureUtils_j(w,D){if(!D.relationships)return null;let he=null;const{relationships:ve}=D;return ve.some((D=>D.id===parseInt(w,10)&&(he=D,!0))),he}(w,D);if(he)return{url:"".concat(D.url,"/").concat(he.relatedTableId),sourceSpatialReference:D.spatialReference,relation:he,relatedFields:[],outStatistics:[]}}async function relatedFeatureUtils_U(w,D,he,ve){const _e=he.layerId.toString(),{layerInfo:be,relation:Me,relatedFields:Fe,outStatistics:Ae,url:Ce,sourceSpatialReference:xe}=D,Le=function relatedFeatureUtils_b(w){return w?(0,Wt.Am)(w):void 0}(Fe),Ee=function relatedFeatureUtils_R(w){return w?(0,Wt.Am)(w,((w,D)=>JSON.stringify(w.toJSON())===JSON.stringify(D.toJSON()))):void 0}(Ae);if(!be||!Me)return null;const ke=function relatedFeatureUtils_g(w){var D;let{originRelationship:he,relationships:ve,layerId:_e}=w;return null!==(D=ve.find((w=>{let{relatedTableId:D,id:ve}=w;return"".concat(D)===_e&&ve===(null===he||void 0===he?void 0:he.id)})))&&void 0!==D?D:null}({originRelationship:Me,relationships:be.relationships,layerId:_e});if(null!==ke&&void 0!==ke&&ke.relationshipTableId&&ke.keyFieldInRelationshipTable){const D=(await function relatedFeatureUtils_S(w,D,he,ve){var _e,be;const Me=new ni.default;return Me.outFields=["*"],Me.relationshipId="number"==typeof D.id?D.id:parseInt(D.id,10),Me.objectIds=[w.attributes[he.objectIdField]],null!==(_e=null===(be=he.queryRelatedFeatures)||void 0===be?void 0:be.call(he,Me,ve))&&void 0!==_e?_e:Promise.resolve({})}(w,ke,he,ve))[w.attributes[he.objectIdField]];if(!D)return null;const _e=D.features.map((w=>w.attributes[be.objectIdField]));if(null!==Ee&&void 0!==Ee&&Ee.length&&be.supportsStatistics){const w=new ii.A;w.where=function relatedFeatureUtils_w(w,D,he){let ve=0;const _e=[];for(;ve<D.length;)_e.push("".concat(w," IN (").concat(D.slice(ve,he+ve),")")),ve+=he;return _e.join(" OR ")}(be.objectIdField,_e,1e3),w.outFields=Le,w.outStatistics=Ee,w.sourceSpatialReference=xe;const he={features:Promise.resolve(D),statsFeatures:(0,ei.s)(Ce,w)};return(0,Xt.Lx)(he)}}const Ze=null===ke||void 0===ke?void 0:ke.keyField;if(Ze){const D=(0,ze.WA)(function relatedFeatureUtils_v(w,D){if(null!=w){D=D.toLowerCase();for(const he of w)if(he&&he.name.toLowerCase()===D)return he}return null}(be.fields,Ze)),he=function relatedFeatureUtils_h(w,D){const he=D.toLowerCase();for(const ve in w)if(ve.toLowerCase()===he)return w[ve];return null}(w.attributes,Me.keyField),_e=D?"".concat(Ze,"=").concat(he):"".concat(Ze,"='").concat(he,"'"),Fe=(0,ei.s)(Ce,new ii.A({where:_e,outFields:Le,sourceSpatialReference:xe}),ve),Ae=null!==Ee&&void 0!==Ee&&Ee.length&&be.supportsStatistics?(0,ei.s)(Ce,new ii.A({where:_e,outFields:Le,outStatistics:Ee,sourceSpatialReference:xe}),ve):null,ke={features:Fe};return Ae&&(ke.statsFeatures=Ae),(0,Xt.Lx)(ke)}return null}function relatedFeatureUtils_N(w,D){let{relatedInfos:he,layer:ve}=w;const _e={};return he.forEach(((w,D)=>{const{relation:he}=w;if(!he){const w=new Ze.A("relation-required","A relation is required on a layer to retrieve related records.");throw relatedFeatureUtils_m().error(w),w}const{relatedTableId:be}=he;if("number"!=typeof be){const w=new Ze.A("A related table ID is required on a layer to retrieve related records.");throw relatedFeatureUtils_m().error(w),w}const Me="".concat(ve.url,"/").concat(be),Fe=si.get(Me),Ae=null!==Fe&&void 0!==Fe?Fe:function relatedFeatureUtils_$(w,D){return(0,Jt.A)(w,{query:{f:"json"},signal:null===D||void 0===D?void 0:D.signal})}(Me);Fe||si.set(Me,Ae),_e[D]=Ae})),(0,Xt.qr)((0,Xt.Lx)(_e),D)}const ri={chartAnimation:!0};let li=class extends Ve.A{constructor(w){super(w),this.abilities={...ri},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(w){return{...ri,...w}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(w){this._setContentElementMedia(w)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(w){const{formattedMediaInfoCount:D}=this,he=(w+D)%D;this.activeMediaInfoIndex=he}_pageContentElementMedia(w){const{activeMediaInfoIndex:D}=this,he=D+w;this._setContentElementMedia(he)}_formatMediaInfos(){var w,D,he,ve,_e;const{mediaInfos:be,layer:Me}=this,Fe=null!==(w=this.attributes)&&void 0!==w?w:{},Ae=null!==(D=this.formattedAttributes)&&void 0!==D?D:{},Ce=null!==(he=this.expressionAttributes)&&void 0!==he?he:{},xe=null!==(ve=this.fieldInfoMap)&&void 0!==ve?ve:new Map;return null!==(_e=null===be||void 0===be?void 0:be.map((w=>{const D=null===w||void 0===w?void 0:w.clone();if(!D)return null;if(D.title=featureUtils_D({attributes:Fe,fieldInfoMap:xe,globalAttributes:Ae,expressionAttributes:Ce,layer:Me,text:D.title}),D.caption=featureUtils_D({attributes:Fe,fieldInfoMap:xe,globalAttributes:Ae,expressionAttributes:Ce,layer:Me,text:D.caption}),D.altText=featureUtils_D({attributes:Fe,fieldInfoMap:xe,globalAttributes:Ae,expressionAttributes:Ce,layer:Me,text:D.altText}),"image"===D.type){const{value:w}=D;return this._setImageValue({value:w,formattedAttributes:Ae,layer:Me}),D.value.sourceURL?D:void 0}if("pie-chart"===D.type||"line-chart"===D.type||"column-chart"===D.type||"bar-chart"===D.type){const{value:w}=D;return this._setChartValue({value:w,chartType:D.type,attributes:Fe,formattedAttributes:Ae,layer:Me,expressionAttributes:Ce}),D}return null})).filter(Wt.Ru))&&void 0!==_e?_e:[]}_setImageValue(w){var D;const he=null!==(D=this.fieldInfoMap)&&void 0!==D?D:new Map,{value:ve,formattedAttributes:_e,layer:be}=w,{linkURL:Me,sourceURL:Fe}=ve;if(Fe){const w=P(Fe,be);ve.sourceURL=featureUtils_z({formattedAttributes:_e,template:w,fieldInfoMap:he})}if(Me){const w=P(Me,be);ve.linkURL=featureUtils_z({formattedAttributes:_e,template:w,fieldInfoMap:he})}}_setChartValue(w){var D;const{value:he,attributes:ve,formattedAttributes:_e,chartType:be,layer:Me,expressionAttributes:Fe}=w,{popupTemplate:Ae,relatedInfos:Ce}=this,{fields:xe,normalizeField:Le}=he,Ee=Me;if(he.fields=function R(w,D){return w&&w.map((w=>featureUtils_v(w,D)))}(xe,Ee),Le&&(he.normalizeField=featureUtils_v(Le,Ee)),!xe.some((w=>!!(null!=_e[w]||de(w)&&null!==Ce&&void 0!==Ce&&Ce.size))))return;const ke=null!==(D=null===Ae||void 0===Ae?void 0:Ae.fieldInfos)&&void 0!==D?D:[];xe.forEach(((w,D)=>{var Me;const Ae=null===(Me=he.colors)||void 0===Me?void 0:Me[D];if(de(w))return void(he.series=[...he.series,...this._getRelatedChartInfos({fieldInfos:ke,fieldName:w,formattedAttributes:_e,chartType:be,value:he,color:Ae})]);const Ce=this._getChartOption({value:he,attributes:ve,chartType:be,formattedAttributes:_e,expressionAttributes:Fe,fieldName:w,fieldInfos:ke,color:Ae});he.series.push(Ce)}))}_getRelatedChartInfos(w){var D;const{fieldInfos:he,fieldName:ve,formattedAttributes:_e,chartType:be,value:Me,color:Fe}=w,Ae=[],Ce=relatedFeatureUtils_y(ve),xe=Ce&&(null===(D=this.relatedInfos)||void 0===D?void 0:D.get(Ce.layerId.toString()));if(!xe)return Ae;const{relatedFeatures:Le,relation:Ee}=xe;if(!Ee||!Le)return Ae;const{cardinality:ke}=Ee;return Le.forEach((w=>{const{attributes:D}=w;D&&Object.keys(D).forEach((w=>{w===Ce.fieldName&&Ae.push(this._getChartOption({value:Me,attributes:D,formattedAttributes:_e,fieldName:ve,chartType:be,relatedFieldName:w,hasMultipleRelatedFeatures:(null===Le||void 0===Le?void 0:Le.length)>1,fieldInfos:he,color:Fe}))}))})),"one-to-many"===ke||"many-to-many"===ke?Ae:[Ae[0]]}_getTooltip(w){let{label:D,value:he,chartType:ve}=w;return"pie-chart"===ve?"".concat(D):"".concat(D,": ").concat(he)}_getChartOption(w){var D,he;const{value:ve,attributes:_e,formattedAttributes:be,expressionAttributes:Me,fieldName:Fe,relatedFieldName:Ae,fieldInfos:Ce,chartType:xe,hasMultipleRelatedFeatures:Le,color:Ee}=w,ke=this.layer,Ze=null!==(D=this.fieldInfoMap)&&void 0!==D?D:new Map,{normalizeField:Se,tooltipField:Re}=ve,Pe=Se?de(Se)?_e[relatedFeatureUtils_y(Se).fieldName]:_e[Se]:null,Oe=featureUtils_M(Fe)&&Me&&void 0!==Me[Fe]?Me[Fe]:Ae&&void 0!==_e[Ae]?_e[Ae]:void 0!==_e[Fe]?_e[Fe]:be[Fe],Ne=new Yt.A({fieldName:Fe,color:Ee,value:void 0===Oe?null:Oe&&Pe?Oe/Pe:Oe});if(de(Fe)){var Be,Ue,Ve,De,qe;const w=Ze.get(Fe.toLowerCase()),D=Re&&Ze.get(Re.toLowerCase()),he=null!==(Be=null===w||void 0===w?void 0:w.fieldName)&&void 0!==Be?Be:Fe,ve=Le&&Re?relatedFeatureUtils_y(Re).fieldName:null!==(Ue=null===D||void 0===D?void 0:D.fieldName)&&void 0!==Ue?Ue:Re,Me=Le&&ve?_e[ve]:null!==(Ve=null!==(De=null!==(qe=be[ve])&&void 0!==qe?qe:null===w||void 0===w?void 0:w.label)&&void 0!==De?De:null===w||void 0===w?void 0:w.fieldName)&&void 0!==Ve?Ve:Ae,Ce=Le&&Ae?_e[Ae]:be[he];return Ne.tooltip=this._getTooltip({label:Me,value:Ce,chartType:xe}),Ne}const Ke=Y(Ce,Fe),ze=featureUtils_v(Fe,ke),je=Re&&void 0!==be[Re]?be[Re]:q(Ke||new Bt.A({fieldName:ze}),null===(he=this.popupTemplate)||void 0===he?void 0:he.expressionInfos),We=be[ze];return Ne.tooltip=this._getTooltip({label:je,value:We,chartType:xe}),Ne}};(0,ve._)([(0,Fe.MZ)()],li.prototype,"abilities",void 0),(0,ve._)([(0,Ee.w)("abilities")],li.prototype,"castAbilities",null),(0,ve._)([(0,Fe.MZ)()],li.prototype,"activeMediaInfoIndex",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],li.prototype,"activeMediaInfo",null),(0,ve._)([(0,Fe.MZ)()],li.prototype,"attributes",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"description",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"fieldInfoMap",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"formattedAttributes",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"expressionAttributes",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],li.prototype,"formattedMediaInfos",null),(0,ve._)([(0,Fe.MZ)()],li.prototype,"isAggregate",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"layer",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],li.prototype,"formattedMediaInfoCount",null),(0,ve._)([(0,Fe.MZ)()],li.prototype,"mediaInfos",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"popupTemplate",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"relatedInfos",void 0),(0,ve._)([(0,Fe.MZ)()],li.prototype,"title",void 0),li=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],li);const ai=li;var di=he(79936);const ci="esri-feature-media",ui={base:ci,mediaContainer:"".concat(ci,"__container"),mediaItemContainer:"".concat(ci,"__item-container"),mediaItem:"".concat(ci,"__item"),mediaItemText:"".concat(ci,"__item-text"),mediaItemTitle:"".concat(ci,"__item-title"),mediaItemCaption:"".concat(ci,"__item-caption"),mediaNavigation:"".concat(ci,"__item-navigation"),mediaPagination:"".concat(ci,"__pagination"),mediaPaginationText:"".concat(ci,"__pagination-text"),mediaPrevious:"".concat(ci,"__previous"),mediaPreviousIconLTR:"".concat(ci,"__previous-icon"),mediaPreviousIconRTL:"".concat(ci,"__previous-icon--rtl"),mediaNext:"".concat(ci,"__next"),mediaNextIconLTR:"".concat(ci,"__next-icon"),mediaNextIconRTL:"".concat(ci,"__next-icon--rtl"),mediaChart:"".concat(ci,"__chart"),mediaPaginationButton:"".concat(ci,"__pagination-button"),mediaPaginationIcon:"".concat(ci,"__pagination-icon"),mediaChartRendered:"".concat(ci,"__chart--rendered")},hi="category",pi="value";let vi=class extends ke.A{constructor(w,D){super(w,D),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new ai,this.messages=null,this._disposeChart=w=>{var D;null!==(D=this._chartRootMap.get(w))&&void 0!==D&&D.dispose(),this._chartRootMap.delete(w)},this._createChart=async w=>{const{destroyed:D,viewModel:ve}=this;if(D||!ve||!w)return;const{createRoot:_e}=await Promise.all([he.e(1790),he.e(3123)]).then(he.bind(he,33123)),be=await _e(w);this._chartRootMap.set(w,be),this._renderChart({mediaInfo:ve.activeMediaInfo,root:be})}}initialize(){this._featureElementInfo=new xt,this.addHandles([(0,Me.wB)((()=>{var w,D;return[null===(w=this.viewModel)||void 0===w?void 0:w.activeMediaInfo,null===(D=this.viewModel)||void 0===D?void 0:D.activeMediaInfoIndex]}),(()=>this._setupMediaRefreshTimer()),Me.Vh),(0,Me.wB)((()=>{var w,D;return[null===(w=this.viewModel)||void 0===w?void 0:w.description,null===(D=this.viewModel)||void 0===D?void 0:D.title]}),(()=>this._setupFeatureElementInfo()),Me.Vh)])}loadDependencies(){return(0,ct.W)({icon:()=>Promise.all([he.e(463),he.e(8156)]).then(he.bind(he,48156))})}destroy(){var w;this._clearMediaRefreshTimer(),null===(w=this._featureElementInfo)||void 0===w||w.destroy()}get attributes(){return this.viewModel.attributes}set attributes(w){this.viewModel.attributes=w}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(w){this.viewModel.activeMediaInfoIndex=w}get description(){return this.viewModel.description}set description(w){this.viewModel.description=w}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(w){this.viewModel.fieldInfoMap=w}get layer(){return this.viewModel.layer}set layer(w){this.viewModel.layer=w}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(w){this.viewModel.mediaInfos=w}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(w){this.viewModel.popupTemplate=w}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(w){this.viewModel.relatedInfos=w}get title(){return this.viewModel.title}set title(w){this.viewModel.title=w}render(){var w;return(0,mt.K)("div",{bind:this,class:ui.base,onkeyup:this._handleMediaKeyup},null===(w=this._featureElementInfo)||void 0===w?void 0:w.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:w,activeMediaInfoIndex:D}=this.viewModel,he=this._renderMediaText();return w?(0,mt.K)("div",{class:ui.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,mt.K)("div",{class:ui.mediaNavigation},he,w>1?(0,mt.K)("div",{class:ui.mediaPagination},this._renderMediaPageButton("previous"),(0,mt.K)("span",{class:ui.mediaPaginationText},(0,Le.V)(this.messages.pageText,{index:D+1,total:w})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:w}=this.viewModel;if(!w)return null;const D=w&&w.title?(0,mt.K)("div",{class:ui.mediaItemTitle,innerHTML:w.title,key:"media-title"}):null,he=w&&w.caption?(0,mt.K)("div",{class:ui.mediaItemCaption,innerHTML:w.caption,key:"media-caption"}):null;return D||he?(0,mt.K)("div",{class:ui.mediaItemText,key:"media-text"},D,he):null}_renderImageMediaInfo(w){var D;const{_refreshIntervalInfo:he}=this,{activeMediaInfoIndex:ve,formattedMediaInfoCount:_e}=this.viewModel,{value:be,refreshInterval:Me,altText:Fe,title:Ae,type:Ce}=w,{sourceURL:xe,linkURL:Le}=be,Ee=C(null!==Le&&void 0!==Le?Le:void 0)?"_blank":"_self",ke="_blank"===Ee?"noreferrer":"",Ze=Me?he:null,Se=Ze?Ze.timestamp:0,Re=Ze?Ze.sourceURL:xe,Pe=(0,mt.K)("img",{alt:Fe||Ae,key:"media-".concat(Ce,"-").concat(ve,"-").concat(_e,"-").concat(Se),src:null!==Re&&void 0!==Re?Re:void 0});return null!==(D=Le?(0,mt.K)("a",{href:Le,rel:ke,target:Ee,title:Ae},Pe):null)&&void 0!==D?D:Pe}_renderChartMediaInfo(w){const{activeMediaInfoIndex:D,formattedMediaInfoCount:he}=this.viewModel;return(0,mt.K)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:ui.mediaChart,key:"media-".concat(w.type,"-").concat(D,"-").concat(he)})}_renderMediaInfoType(){const{activeMediaInfo:w}=this.viewModel;return w?"image"===w.type?this._renderImageMediaInfo(w):w.type.includes("chart")?this._renderChartMediaInfo(w):null:null}_renderMediaInfo(){const{activeMediaInfo:w}=this.viewModel;return w?(0,mt.K)("div",{class:ui.mediaItemContainer,key:"media-container"},(0,mt.K)("div",{class:ui.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(w){if(this.viewModel.formattedMediaInfoCount<2)return null;const D="previous"===w,he=D?this.messages.previous:this.messages.next,ve=D?"chevron-left":"chevron-right",_e=D?"media-previous":"media-next",be=D?this._previous:this._next;return(0,mt.K)("button",{"aria-label":he,bind:this,class:ui.mediaPaginationButton,key:_e,onclick:be,tabIndex:0,title:he,type:"button"},(0,mt.K)("calcite-icon",{class:ui.mediaPaginationIcon,icon:ve,scale:"s"}))}_setupFeatureElementInfo(){var w;const{description:D,title:he}=this;null===(w=this._featureElementInfo)||void 0===w||w.set({description:D,title:he})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:w,layer:D}=this.viewModel;return w&&null!==D&&void 0!==D&&D.featureReduction&&"renderer"in D.featureReduction?D.featureReduction.renderer:null===D||void 0===D?void 0:D.renderer}async _getSeriesColors(w){const{colorAm5:D}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),ve=new Map;return w.forEach((w=>{w.color&&ve.set(w,D(w.color.toCss(!0)))})),ve}async _getRendererColors(){const{colorAm5:w}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),D=new Map,ve=this._getRenderer();if(!ve)return D;const _e=await utils_x(ve);return _e.delete("default"),Array.from(_e.values()).every((w=>1===(null===w||void 0===w?void 0:w.length)))?(Array.from(_e.keys()).forEach((he=>{var ve;const be=null===(ve=_e.get(he))||void 0===ve||null===(ve=ve[0])||void 0===ve?void 0:ve.toCss(!0);be&&D.set(he,w(be))})),D):D}_handleMediaKeyup(w){const{key:D}=w;"ArrowLeft"===D&&(w.stopPropagation(),this.viewModel.previous()),"ArrowRight"===D&&(w.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}async _renderChart(w){const{root:D,mediaInfo:ve}=w,{value:_e,type:be}=ve,{ResponsiveThemeAm5:Me,DarkThemeAm5:Fe,AnimatedThemeAm5:Ae,ColorSetAm5:Ce,ThemeAm5:xe,esriChartColorSet:Le}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),Ee=xe.new(D);Ee.rule("ColorSet").set("colors",Le),Ee.rule("ColorSet").set("reuse",!0);const ke=[Me.new(D),Ee];(0,di.g4)()&&ke.push(Fe.new(D)),this._canAnimateChart()&&ke.push(Ae.new(D)),D.setThemes(ke);const Ze=await this._getRendererColors(),Se=await this._getSeriesColors(_e.series),Re=Ce.new(D,{}),Pe=Se.get(_e.series[0]),Oe=Pe?{lineSettings:{stroke:Pe}}:void 0,Ne=_e.series.map(((w,D)=>{const he=Se.get(w)||Ze.get(w.fieldName)||Re.getIndex(D);return{[hi]:w.tooltip,[pi]:w.value,columnSettings:{fill:he,stroke:he},...Oe}})).filter((w=>"pie-chart"!==be||null!=w.value&&w.value>0));"pie-chart"===be?this._createPieChart(w,Ne):this._createXYChart(w,Ne)}_getDirection(){return(0,pt.V8)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,pt.V8)(this.container)}async _customizeChartTooltip(w){var D;let ve=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal";const{colorAm5:_e}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471));w.setAll({pointerOrientation:ve}),null!==(D=w.get("background"))&&void 0!==D&&D.setAll({stroke:_e("rgba(50, 50, 50, 1)")}),w.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200})}async _createPieChart(w,D){const{TooltipAm5:ve}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),{PieChartAm5:_e,PieSeriesAm5:be}=await Promise.all([he.e(1790),he.e(9909),he.e(74)]).then(he.bind(he,50074)),{mediaInfo:Me,root:Fe}=w,{title:Ae}=Me,Ce=(null===Me||void 0===Me?void 0:Me.altText)||(null===Me||void 0===Me?void 0:Me.title)||"",xe=Fe.container.children.push(_e.new(Fe,{ariaLabel:Ce,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),Le="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",Ee=ve.new(Fe,{labelText:Le}),ke=xe.series.push(be.new(Fe,{name:Ae,valueField:pi,categoryField:hi,tooltip:Ee}));ke.ticks.template.set("forceHidden",!0),ke.labels.template.set("forceHidden",!0),ke.slices.template.states.create("active",{shiftRadius:5}),this._customizeChartTooltip(Ee),ke.slices.template.setAll({ariaLabel:Le,focusable:!0,templateField:"columnSettings"}),ke.data.setAll(D),ke.appear(this._getChartSeriesAnimationMS()),xe.appear(this._getChartAnimationMS()),xe.root.dom.classList.toggle(ui.mediaChartRendered,!0)}_getMinSeriesValue(w){let D=0;return w.forEach((w=>D=Math.min(w.value,D))),D}async _createColumnChart(w,D,ve){const{TooltipAm5:_e,ScrollbarAm5:be}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),{CategoryAxisAm5:Me,AxisRendererXAm5:Fe,ValueAxisAm5:Ae,AxisRendererYAm5:Ce,ColumnSeriesAm5:xe}=await Promise.all([he.e(1790),he.e(9909),he.e(2239)]).then(he.bind(he,42239)),{mediaInfo:Le,root:Ee}=D,{value:ke,title:Ze}=Le;w.setAll({wheelX:"panX",wheelY:"zoomX"});const Se=w.xAxes.push(Me.new(Ee,{renderer:Fe.new(Ee,{inversed:this._isInversed()}),categoryField:hi}));Se.get("renderer").labels.template.setAll({forceHidden:!0});const Re=w.yAxes.push(Ae.new(Ee,{renderer:Ce.new(Ee,{inside:!1}),min:this._getMinSeriesValue(ke.series)}));Re.get("renderer").labels.template.setAll({direction:this._getDirection()});const Pe="{categoryX}",Oe=_e.new(Ee,{labelText:Pe}),Ne=w.series.push(xe.new(Ee,{name:Ze,xAxis:Se,yAxis:Re,valueYField:pi,categoryXField:hi,tooltip:Oe}));this._customizeChartTooltip(Oe),Ne.columns.template.setAll({ariaLabel:Pe,focusable:!0,templateField:"columnSettings"}),ke.series.length>15&&w.set("scrollbarX",be.new(Ee,{orientation:"horizontal"})),Se.data.setAll(ve),Ne.data.setAll(ve),Ne.appear(this._getChartSeriesAnimationMS()),w.appear(this._getChartAnimationMS())}async _createBarChart(w,D,ve){const{TooltipAm5:_e,ScrollbarAm5:be}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),{CategoryAxisAm5:Me,AxisRendererXAm5:Fe,ValueAxisAm5:Ae,AxisRendererYAm5:Ce,ColumnSeriesAm5:xe}=await Promise.all([he.e(1790),he.e(9909),he.e(2239)]).then(he.bind(he,42239)),{mediaInfo:Le,root:Ee}=D,{value:ke,title:Ze}=Le;w.setAll({wheelX:"panY",wheelY:"zoomY"});const Se=w.yAxes.push(Me.new(Ee,{renderer:Ce.new(Ee,{inversed:!0}),categoryField:hi}));Se.get("renderer").labels.template.setAll({forceHidden:!0});const Re=w.xAxes.push(Ae.new(Ee,{renderer:Fe.new(Ee,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(ke.series)}));Re.get("renderer").labels.template.setAll({direction:this._getDirection()});const Pe="{categoryY}",Oe=_e.new(Ee,{labelText:Pe}),Ne=w.series.push(xe.new(Ee,{name:Ze,xAxis:Re,yAxis:Se,valueXField:pi,categoryYField:hi,tooltip:Oe}));this._customizeChartTooltip(Oe,"vertical"),Ne.columns.template.setAll({ariaLabel:Pe,focusable:!0,templateField:"columnSettings"}),ke.series.length>15&&w.set("scrollbarY",be.new(Ee,{orientation:"vertical"})),Se.data.setAll(ve),Ne.data.setAll(ve),Ne.appear(this._getChartSeriesAnimationMS()),w.appear(this._getChartAnimationMS())}async _createLineChart(w,D,ve){var _e,be;const{TooltipAm5:Me,ScrollbarAm5:Fe}=await Promise.all([he.e(1790),he.e(3471)]).then(he.bind(he,83471)),{CategoryAxisAm5:Ae,AxisRendererXAm5:Ce,ValueAxisAm5:xe,AxisRendererYAm5:Le,LineSeriesAm5:Ee}=await Promise.all([he.e(1790),he.e(9909),he.e(2239)]).then(he.bind(he,42239)),{root:ke,mediaInfo:Ze}=D,{value:Se,title:Re}=Ze;w.setAll({wheelX:"panX",wheelY:"zoomX"});const Pe=w.xAxes.push(Ae.new(ke,{renderer:Ce.new(ke,{inversed:this._isInversed()}),categoryField:hi}));Pe.get("renderer").labels.template.setAll({forceHidden:!0});const Oe=w.yAxes.push(xe.new(ke,{renderer:Le.new(ke,{inside:!1}),min:this._getMinSeriesValue(Se.series)}));Oe.get("renderer").labels.template.setAll({direction:this._getDirection()});const Ne=null===(_e=ve[0])||void 0===_e||null===(_e=_e.lineSettings)||void 0===_e?void 0:_e.stroke,Be=Me.new(ke,{getFillFromSprite:!Ne,labelText:"{categoryX}"});Ne&&(null===(be=Be.get("background"))||void 0===be||be.setAll({fill:Ne}));const Ue=w.series.push(Ee.new(ke,{name:Re,xAxis:Pe,yAxis:Oe,valueYField:pi,categoryXField:hi,tooltip:Be}));Ue.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(Be,"vertical"),Se.series.length>15&&w.set("scrollbarX",Fe.new(ke,{orientation:"horizontal"})),Pe.data.setAll(ve),Ue.data.setAll(ve),Ue.appear(this._getChartSeriesAnimationMS()),w.appear(this._getChartAnimationMS())}async _createXYChart(w,D){const{XYChartAm5:ve,XYCursorAm5:_e}=await Promise.all([he.e(1790),he.e(9909),he.e(2239)]).then(he.bind(he,42239)),{root:be,mediaInfo:Me}=w,{type:Fe}=Me,Ae=(null===Me||void 0===Me?void 0:Me.altText)||(null===Me||void 0===Me?void 0:Me.title)||"",Ce=be.container.children.push(ve.new(be,{ariaLabel:Ae,focusable:!0,panX:!0,panY:!0}));Ce.set("cursor",_e.new(be,{})),"column-chart"===Fe&&await this._createColumnChart(Ce,w,D),"bar-chart"===Fe&&await this._createBarChart(Ce,w,D),"line-chart"===Fe&&await this._createLineChart(Ce,w,D),Ce.root.dom.classList.toggle(ui.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:w}=this;w&&(clearTimeout(w),this._refreshTimer=null)}_updateMediaInfoTimestamp(w){const D=Date.now();this._refreshIntervalInfo={timestamp:D,sourceURL:w&&this._getImageSource(w,D)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:w}=this.viewModel;w&&"image"===w.type&&w.refreshInterval&&this._setRefreshTimeout(w)}_setRefreshTimeout(w){const{refreshInterval:D,value:he}=w;if(!D)return;const ve=6e4*D;this._updateMediaInfoTimestamp(he.sourceURL);const _e=setInterval((()=>{this._updateMediaInfoTimestamp(he.sourceURL)}),ve);this._refreshTimer=_e}_getImageSource(w,D){const he=w.includes("?")?"&":"?",[ve,_e=""]=w.split("#");return"".concat(ve).concat(he,"timestamp=").concat(D).concat(_e?"#":"").concat(_e)}};(0,ve._)([(0,Fe.MZ)()],vi.prototype,"_refreshIntervalInfo",void 0),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"attributes",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"activeMediaInfoIndex",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"description",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"fieldInfoMap",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"layer",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"mediaInfos",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"popupTemplate",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"relatedInfos",null),(0,ve._)([(0,Fe.MZ)()],vi.prototype,"title",null),(0,ve._)([(0,Fe.MZ)({type:ai})],vi.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Feature/t9n/Feature")],vi.prototype,"messages",void 0),vi=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureMedia")],vi);const mi=vi;he(78084),he(33746),he(69455),he(124);var fi=he(23545),gi=he(72214),yi=(he(4952),he(91771)),_i=he(2291),wi=he(9370);const arcadeFeatureUtils_s=()=>be.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function arcadeFeatureUtils_p(w){return"string"==typeof w?ae(oe(w)):Array.isArray(w)?function arcadeFeatureUtils_c(w){return'<ul class="esri-widget__list">'.concat(w.map((w=>"<li>".concat("string"==typeof w?ae(oe(w)):w,"</li>"))).join(""),"</ul>")}(w):"esri.arcade.Dictionary"===(null===w||void 0===w?void 0:w.declaredClass)?function arcadeFeatureUtils_u(w){const D=w.keys().map((D=>{const he=w.field(D);return"<tr><th>".concat(D,"</th><td>").concat("string"==typeof he?ae(oe(he)):he,"</td></tr>")})).join("");return'<table class="'.concat(ut.D.table,'">').concat(D,"</table>")}(w):w}function arcadeFeatureUtils_l(){return Promise.all([he.e(5004),he.e(4718)]).then(he.bind(he,14718))}async function arcadeFeatureUtils_f(w){let{graphic:D,view:he,options:ve}=w;const{isAggregate:_e,layer:be}=D;if(!_e||!be||"2d"!==(null===he||void 0===he?void 0:he.type))return[];const Me=await he.whenLayerView(be);if(!function arcadeFeatureUtils_d(w){return"createQuery"in w&&"queryFeatures"in w}(Me))return[];const Fe=Me.createQuery(),Ae=D.getObjectId();Fe.aggregateIds=null!=Ae?[Ae]:[];const{features:Ce}=await Me.queryFeatures(Fe,ve);return Ce}async function arcadeFeatureUtils_g(w){var D,he,ve;let{expressionInfo:_e,arcade:be,interceptor:Me,spatialReference:Fe,map:Ae,graphic:Ce,location:xe,view:Le,options:Ee}=w;if(null===_e||void 0===_e||!_e.expression)return null;const{isAggregate:ke}=Ce,Ze=null!==(D=Ce.sourceLayer||Ce.layer)&&void 0!==D?D:void 0,Se=ke?"feature-reduction-popup":"popup",Re=be.createArcadeProfile(Se),Pe=be.createArcadeExecutor(_e.expression,Re).catch((w=>arcadeFeatureUtils_s().error("arcade-executor-error",{error:w,expressionInfo:_e}))),[Oe,Ne]=await Promise.all([arcadeFeatureUtils_f({graphic:Ce,view:Le,options:Ee}),Pe]);if(!Ne)return null;const Be="feature-reduction-popup"===Se?function arcadeFeatureUtils_y(w){let{layer:D,aggregatedFeatures:he,interceptor:ve}=w;const{fields:_e,objectIdField:be,geometryType:Me,spatialReference:Fe,displayField:Ae}=D;return new wi.default({fields:_e,objectIdField:be,geometryType:Me,spatialReference:Fe,displayField:Ae,interceptor:ve,..."feature"===D.type?{templates:D.templates,typeIdField:D.typeIdField,types:D.types}:null,source:he})}({layer:Ze,aggregatedFeatures:Oe,interceptor:Me}):void 0,Ue={..."feature-reduction-popup"===Se?{$aggregatedFeatures:Be}:{$datastore:null===Ze||void 0===Ze?void 0:Ze.url,$layer:"feature"===(null===Ze||void 0===Ze?void 0:Ze.type)||"subtype-sublayer"===(null===Ze||void 0===Ze?void 0:Ze.type)?Ze:"scene"===(null===Ze||void 0===Ze?void 0:Ze.type)&&null!=Ze.associatedLayer?Ze.associatedLayer:void 0,$map:Ae,$userInput:xe,$graph:"knowledge-graph-sublayer"===(null===Ze||void 0===Ze?void 0:Ze.type)?null===Ze||void 0===Ze||null===(he=Ze.parentCompositeLayer)||void 0===he?void 0:he.knowledgeGraph:void 0},$feature:Ce},Ve={abortSignal:null!==(ve=null===Ee||void 0===Ee?void 0:Ee.signal)&&void 0!==ve?ve:void 0,interceptor:null!==Me&&void 0!==Me?Me:void 0,rawOutput:!0,spatialReference:null!==Fe&&void 0!==Fe?Fe:void 0,timeZone:null===Le||void 0===Le?void 0:Le.timeZone};return await Ne.executeAsync(Ue,Ve).catch((w=>arcadeFeatureUtils_s().error("arcade-execution-error",{error:w,graphic:Ce,expressionInfo:_e}))).finally((()=>null===Be||void 0===Be?void 0:Be.destroy()))}async function arcadeFeatureUtils_m(w){let{expressionInfos:D,spatialReference:he,graphic:ve,interceptor:_e,map:be,view:Me,location:Fe,options:Ae}=w;if(null===D||void 0===D||!D.length)return{};const Ce=await arcadeFeatureUtils_l(),xe={};for(const ke of D)xe["expression/".concat(ke.name)]=arcadeFeatureUtils_g({expressionInfo:ke,arcade:Ce,interceptor:_e,spatialReference:he,map:be,graphic:ve,location:Fe,view:Me,options:Ae});const Le=await(0,Xt.Lx)(xe),Ee={};for(const ke in Le)Ee[ke]=arcadeFeatureUtils_p(Le[ke].value);return Ee}let bi=class extends Ve.A{constructor(w){super(w),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:w}=this;w&&w.abort(),this._abortController=null},this._createVM=()=>{var w,D;const he=null===(w=this.contentElement)||void 0===w?void 0:w.type;null===(D=this.contentElementViewModel)||void 0===D||D.destroy();const ve="fields"===he?new Vt:"media"===he?new ai:"text"===he?new Tt:null;this._set("contentElementViewModel",ve)},this._compile=async()=>{this._cancelQuery();const w=new AbortController;this._abortController=w,await this._compileExpression(),this._abortController===w&&(this._abortController=null)},this._compileThrottled=throttle_e(this._compile,1,this),this._compileExpression=async()=>{const{expressionInfo:w,graphic:D,interceptor:he,spatialReference:ve,map:_e,location:be,view:Me,_abortController:Fe}=this;if(!w||!D)return void this._set("contentElement",null);const Ae=await arcadeFeatureUtils_l();if(Fe!==this._abortController)return;const Ce=await arcadeFeatureUtils_g({arcade:Ae,expressionInfo:w,graphic:D,location:be,interceptor:he,map:_e,spatialReference:ve,view:Me});if(!Ce||"esri.arcade.Dictionary"!==Ce.declaredClass)return void this._set("contentElement",null);const xe=await Ce.castAsJsonAsync(null===Fe||void 0===Fe?void 0:Fe.signal),Le=null===xe||void 0===xe?void 0:xe.type,Ee="media"===Le?gi.A.fromJSON(xe):"text"===Le?yi.A.fromJSON(xe):"fields"===Le?fi.A.fromJSON(xe):null;this._set("contentElement",Ee)},this.addHandles([(0,Me.wB)((()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view]),(()=>this._compileThrottled()),Me.Vh),(0,Me.wB)((()=>[this.contentElement]),(()=>this._createVM()),Me.Vh)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var w;this._cancelQuery(),null!==(w=this.contentElementViewModel)&&void 0!==w&&w.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var w,D;return null!==(w=null===(D=this.view)||void 0===D?void 0:D.spatialReference)&&void 0!==w?w:null}set spatialReference(w){this._override("spatialReference",w)}get state(){const{_abortController:w,contentElement:D,contentElementViewModel:he}=this;return w?"loading":D||he?"ready":"disabled"}get map(){var w,D;return null!==(w=null===(D=this.view)||void 0===D?void 0:D.map)&&void 0!==w?w:null}set map(w){this._override("map",w)}};(0,ve._)([(0,Fe.MZ)()],bi.prototype,"_abortController",void 0),(0,ve._)([(0,Fe.MZ)({type:_i.A})],bi.prototype,"expressionInfo",void 0),(0,ve._)([(0,Fe.MZ)({type:Ue.A})],bi.prototype,"graphic",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],bi.prototype,"contentElement",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],bi.prototype,"contentElementViewModel",void 0),(0,ve._)([(0,Fe.MZ)()],bi.prototype,"interceptor",void 0),(0,ve._)([(0,Fe.MZ)({type:ti.A})],bi.prototype,"location",void 0),(0,ve._)([(0,Fe.MZ)()],bi.prototype,"spatialReference",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],bi.prototype,"state",null),(0,ve._)([(0,Fe.MZ)()],bi.prototype,"map",null),(0,ve._)([(0,Fe.MZ)()],bi.prototype,"view",void 0),bi=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],bi);const Mi=bi,Fi="esri-feature",Ai={base:"".concat(Fi,"-expression"),loadingSpinnerContainer:"".concat(Fi,"__loading-container"),spinner:"".concat(Fi,"__loading-spinner")};let Ii=class extends ke.A{constructor(w,D){super(w,D),this._contentWidget=null,this.viewModel=new Mi}initialize(){this.addHandles((0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.contentElementViewModel}),(()=>this._setupExpressionWidget()),Me.Vh))}destroy(){this._destroyContentWidget()}render(){var w;const{state:D}=this.viewModel;return(0,mt.K)("div",{class:Ai.base},"loading"===D?this._renderLoading():"disabled"===D?null:null===(w=this._contentWidget)||void 0===w?void 0:w.render())}_renderLoading(){return(0,mt.K)("div",{class:Ai.loadingSpinnerContainer,key:"loading-container"},(0,mt.K)("span",{class:this.classes(ht.T.loadingIndicator,ut.D.rotating,Ai.spinner)}))}_destroyContentWidget(){const{_contentWidget:w}=this;w&&(w.viewModel=null,w.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:w,contentElement:D}=this.viewModel,he=null===D||void 0===D?void 0:D.type;this._destroyContentWidget();const ve=w?"fields"===he?new jt({viewModel:w}):"media"===he?new mi({viewModel:w}):"text"===he?new Ot({viewModel:w}):null:null;this._contentWidget=ve,this.scheduleRender()}};(0,ve._)([(0,Fe.MZ)({type:Mi})],Ii.prototype,"viewModel",void 0),Ii=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureExpression")],Ii);const Ci=Ii;var xi=he(35598),Li=he(88706),Ei=he(16904);he(188),he(7198),he(92471);var ki;!function(w){w.TOO_SHORT="length-validation-error::too-short"}(ki||(ki={}));const featureFormUtils_G=w=>{const D=[];if(w.formTemplate){var he;const{description:ve,title:_e}=w.formTemplate;null===(he=w.fields)||void 0===he||he.forEach((w=>{const he=_e&&(0,Oe.mk)(_e,w.name),be=ve&&(0,Oe.mk)(ve,w.name);(he||be)&&D.push(w.name)}))}return D};let Zi=class extends((0,Li.O)((0,Ei.sA)(Ve.A))){constructor(w){super(w),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:w}=this;w&&w.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:w}=this;w&&w.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:w}=this;w&&w.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const w=new AbortController;this._queryAbortController=w,await(0,Xt.QZ)(this._query()),this._queryAbortController===w&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const w=new AbortController;this._queryFeatureCountAbortController=w,await(0,Xt.QZ)(this._queryFeatureCount()),this._queryFeatureCountAbortController===w&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const w=new AbortController;this._queryPageAbortController=w,await(0,Xt.QZ)(this._queryPage()),this._queryPageAbortController===w&&(this._queryPageAbortController=null)},this._queryDebounced=(0,Xt.sg)(this._queryController,100),this._queryFeatureCountDebounced=(0,Xt.sg)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,Xt.sg)(this._queryPageController,100),this._query=async()=>{const{_queryAbortController:w,relatedFeatures:D}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,D.removeAll(),this.destroyed||D.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:null===w||void 0===w?void 0:w.signal}))))},this.addHandles([(0,Me.wB)((()=>{var w;return[this.displayCount,this.graphic,this.layer,null===(w=this.layer)||void 0===w?void 0:w.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount]}),(()=>this._queryDebounced()),Me.Vh),(0,Me.wB)((()=>[this.featurePage,this.showAllEnabled]),(()=>this._queryPageDebounced())),(0,Me.wB)((()=>[this.layer,this.relationshipId,this.objectId,this.canQuery]),(()=>this._queryFeatureCountDebounced()))])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(w){const{featuresPerPage:D,featureCount:he}=this,ve=Math.ceil(he/D)||1;this._set("featurePage",Math.min(Math.max(w,1),ve))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:w,relatedLayer:D}=this;return w&&null!==D&&void 0!==D&&D.loaded?w.map((w=>{const he=w.clone();return he.field=featureUtils_v(w.field,D),he})):null!==w&&void 0!==w?w:[]}get supportsCacheHint(){var w;return!(null===(w=this.layer)||void 0===w||null===(w=w.capabilities)||void 0===w||null===(w=w.queryRelated)||void 0===w||!w.supportsCacheHint)}get canLoad(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}get canQuery(){var w;const D=null===(w=this.layer)||void 0===w||null===(w=w.capabilities)||void 0===w?void 0:w.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&null!==D&&void 0!==D&&D.supportsCount&&null!==D&&void 0!==D&&D.supportsPagination)}get itemDescriptionFieldName(){var w;return(null===(w=this.orderByFieldsFixedCasing[0])||void 0===w?void 0:w.field)||null}set displayCount(w){this._set("displayCount",Math.min(Math.max(w,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var w,D;return null!==(w=this.objectIdField&&(null===(D=this.graphic)||void 0===D||null===(D=D.attributes)||void 0===D?void 0:D[this.objectIdField]))&&void 0!==w?w:null}get objectIdField(){var w;return(null===(w=this.layer)||void 0===w?void 0:w.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new xe.A}get relatedLayer(){var w;const{layer:D,map:he,relationship:ve}=this;return null!==D&&void 0!==D&&D.loaded&&he&&ve&&null!==(w=function Te(w,D,he){return w&&D&&he?we(w.allLayers,D,he)||we(w.allTables,D,he):null}(he,D,ve))&&void 0!==w?w:null}get relationship(){var w,D;const{relationshipId:he,layer:ve}=this;return"number"==typeof he&&null!==(w=null===ve||void 0===ve||null===(D=ve.relationships)||void 0===D?void 0:D.find((w=>{let{id:D}=w;return D===he})))&&void 0!==w?w:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new xe.A}get state(){const{_queryAbortController:w,_queryFeatureCountAbortController:D,_queryPageAbortController:he,canQuery:ve,_loaded:_e,canLoad:be}=this;return D||be&&!_e?"loading":w||he?"querying":ve?"ready":"disabled"}getRelatedFeatureByObjectId(w){return this.relatedFeatures.find((D=>D.getObjectId()===w))}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var w;null!==(w=this.relatedFeatureViewModels)&&void 0!==w&&w.forEach((w=>!w.destroyed&&w.destroy())),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){var w;const{layer:D,relatedLayer:he,relationshipId:ve,objectId:_e,_queryFeatureCountAbortController:be,canQuery:Me,supportsCacheHint:Fe}=this;if(await(null===D||void 0===D?void 0:D.load()),await(null===he||void 0===he?void 0:he.load()),!Me||!D||!he)return void this._set("featureCount",0);const Ae=he.createQuery(),Ce=new ni.default({cacheHint:Fe,relationshipId:ve,returnGeometry:!1,objectIds:[_e],where:null!==(w=Ae.where)&&void 0!==w?w:void 0}),xe=await D.queryRelatedFeaturesCount(Ce,{signal:null===be||void 0===be?void 0:be.signal});this._set("featureCount",xe[_e]||0)}_sliceFeatures(w){const{showAllEnabled:D,displayCount:he}=this;return D?w:he?w.slice(0,he):[]}async _queryPage(){const{relatedFeatures:w,featurePage:D,showAllEnabled:he,_queryPageAbortController:ve,featureCount:_e}=this;!he||D<2||!_e||w.addMany(await this._queryRelatedFeatures({signal:null===ve||void 0===ve?void 0:ve.signal}))}async _queryRelatedFeatures(w){var D,he;const{orderByFieldsFixedCasing:ve,showAllEnabled:_e,featuresPerPage:be,displayCount:Me,layer:Fe,relationshipId:Ae,featurePage:Ce,featureCount:xe,relatedLayer:Le,supportsCacheHint:Ee}=this,{canQuery:ke,objectId:Ze}=this;if(!ke||!Fe||!Le)return[];const Se=_e?((Ce-1)*be+xe)%xe:0,Re=_e?be:Me,Pe=Le.objectIdField,Oe=[...ve.map((w=>w.field)),...featureFormUtils_G(Le),Pe].filter(Wt.Ru),Ne=ve.map((w=>"".concat(w.field," ").concat(w.order))),Be=Le.createQuery(),Ue=new ni.default({orderByFields:Ne,start:Se,num:Re,outFields:Oe,cacheHint:Ee,relationshipId:Ae,returnGeometry:!1,objectIds:[Ze],where:null!==(D=Be.where)&&void 0!==D?D:void 0}),Ve=(null===(he=(await Fe.queryRelatedFeatures(Ue,{signal:null===w||void 0===w?void 0:w.signal}))[Ze])||void 0===he?void 0:he.features)||[];return Ve.forEach((w=>{w.sourceLayer=Le,w.layer=Le})),Ve}};(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"_loaded",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"_queryAbortController",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"_queryPageAbortController",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"_queryFeatureCountAbortController",void 0),(0,ve._)([(0,Fe.MZ)({value:1})],Zi.prototype,"featurePage",null),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"featuresPerPage",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"orderByFieldsFixedCasing",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"supportsCacheHint",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"canLoad",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"canQuery",null),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"description",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"itemDescriptionFieldName",null),(0,ve._)([(0,Fe.MZ)({value:3})],Zi.prototype,"displayCount",null),(0,ve._)([(0,Fe.MZ)({type:Ue.A})],Zi.prototype,"graphic",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"layer",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"map",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"objectId",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"objectIdField",null),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"orderByFields",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"relatedFeatures",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"relatedLayer",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"relationship",null),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"featureCount",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Zi.prototype,"relatedFeatureViewModels",null),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"relationshipId",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"showAllEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"state",null),(0,ve._)([(0,Fe.MZ)()],Zi.prototype,"title",void 0),Zi=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Zi);const Ti=Zi,Si="esri-feature",Ri="".concat(Si,"-relationship"),Pi={base:Ri,listContainer:"".concat(Ri,"__list"),listItem:"".concat(Ri,"__list-item"),listItemHidden:"".concat(Ri,"__list-item--hidden"),listContainerQuerying:"".concat(Ri,"__list--querying"),featureObserver:"".concat(Si,"__feature-observer"),stickySpinnerContainer:"".concat(Si,"__sticky-loading-container"),loadingSpinnerContainer:"".concat(Si,"__loading-container"),spinner:"".concat(Si,"__loading-spinner")},Oi={title:!0,description:!0};let Ni=class extends ke.A{constructor(w,D){super(w,D),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver((w=>{let[D]=w;(null===D||void 0===D?void 0:D.isIntersecting)&&this._increaseFeaturePage()}),{root:window.document}),this.headingLevel=2,this.viewModel=new Ti,this.messages=null,this.messagesCommon=null,this.visibleElements={...Oi},this._increaseFeaturePage=()=>{const{state:w,showAllEnabled:D,relatedFeatures:he,featuresPerPage:ve,featurePage:_e}=this.viewModel;"ready"===w&&D&&he.length>=ve*_e&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new xt,this.addHandles([(0,Me.wB)((()=>[this.viewModel.description,this.viewModel.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),Me.Vh),(0,Me.wB)((()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode]),(()=>this._handleRelatedFeatureObserverChange())),(0,Me.on)((()=>this.viewModel.relatedFeatureViewModels),"change",(()=>this._setupRelatedFeatureViewModels()))])}loadDependencies(){return(0,ct.W)({icon:()=>Promise.all([he.e(463),he.e(8156)]).then(he.bind(he,48156)),list:()=>Promise.all([he.e(463),he.e(616),he.e(1021),he.e(4946),he.e(1694)]).then(he.bind(he,91694)),"list-item":()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(1979)]).then(he.bind(he,51979)),notice:()=>Promise.all([he.e(463),he.e(616),he.e(7409)]).then(he.bind(he,77409))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,xi.pR)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:w,featureCount:D,displayCount:he,state:ve}=this.viewModel;return!w&&!!D&&"ready"===ve&&(D>he||0===he)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(w){this.viewModel.description=w}get featureCountDescription(){const{messages:w}=this,{featureCount:D}=this.viewModel;return(0,Le.V)(null===w||void 0===w?void 0:w.numberRecords,{number:D})}get title(){return this.viewModel.title}set title(w){this.viewModel.title=w}castVisibleElements(w){return{...Oi,...w}}render(){var w;const{state:D}=this.viewModel;return(0,mt.K)("div",{class:this.classes(Pi.base,ut.D.widget)},null===(w=this._featureElementInfo)||void 0===w?void 0:w.render(),"loading"===D?this._renderLoading():"disabled"===D?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,mt.K)("div",{class:Pi.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,mt.K)("span",{class:this.classes(ht.T.loadingIndicator,ut.D.rotating,Pi.spinner)})}_renderLoading(){return(0,mt.K)("div",{class:Pi.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,mt.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const w=(0,pt.V8)(this.container)?"chevron-left":"chevron-right";return(0,mt.K)("calcite-icon",{icon:w,scale:"s",slot:"content-end"})}_renderRelatedFeature(w){var D,he;const{itemDescriptionFieldName:ve}=this.viewModel,_e=w.title;w.description=ve&&(null===(D=w.formattedAttributes)||void 0===D?void 0:D.global[ve]);const be="loading"===w.state;return(0,mt.K)("calcite-list-item",{class:this.classes(Pi.listItem,{[Pi.listItemHidden]:be}),description:null!==(he=w.description)&&void 0!==he?he:"",key:w.uid,label:_e,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:w})},this._renderChevronIconNode())}_renderShowAllListItem(){var w;return this.displayShowAllButton?(0,mt.K)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:null===(w=this.messages)||void 0===w?void 0:w.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var w;return(0,mt.K)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,mt.K)("div",{slot:"message"},null===(w=this.messages)||void 0===w?void 0:w.noRelatedFeatures))}_renderFeatureObserver(){return(0,mt.K)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Pi.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:w}=this.viewModel;return(0,mt.K)("calcite-list",null,w.toArray().map((w=>this._renderRelatedFeature(w))),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:w}=this,{state:D}=this.viewModel;return(0,mt.K)("div",{class:this.classes(Pi.listContainer,{[Pi.listContainerQuerying]:"querying"===D}),key:"list-container"},w?this._renderList():"ready"===D?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var w;return(0,mt.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,mt.K)("div",{slot:"message"},null===(w=this.messages)||void 0===w?void 0:w.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:w}=this.viewModel,D="related-feature-viewmodels";this.removeHandles(D),null!==w&&void 0!==w&&w.forEach((w=>{this.addHandles((0,Me.wB)((()=>[w.title,w.state]),(()=>this.scheduleRender()),Me.Vh),D)})),this.scheduleRender()}_setupFeatureElementInfo(){var w;const{headingLevel:D,visibleElements:he}=this,ve=he.description&&this.description,_e=he.title&&this.title;null===(w=this._featureElementInfo)||void 0===w||w.set({description:ve,title:_e,headingLevel:D})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:w,showAllEnabled:D}=this.viewModel;await(0,Xt.Pl)(0),this._relatedFeatureIntersectionObserverNode&&"ready"===w&&D&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(w){this._relatedFeatureIntersectionObserverNode=w}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,ve._)([(0,Fe.MZ)()],Ni.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ni.prototype,"displayShowAllButton",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ni.prototype,"displayListItems",null),(0,ve._)([(0,Fe.MZ)()],Ni.prototype,"description",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ni.prototype,"featureCountDescription",null),(0,ve._)([(0,Fe.MZ)()],Ni.prototype,"headingLevel",void 0),(0,ve._)([(0,Fe.MZ)()],Ni.prototype,"title",null),(0,ve._)([(0,Fe.MZ)({type:Ti})],Ni.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Feature/t9n/Feature")],Ni.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/t9n/common")],Ni.prototype,"messagesCommon",void 0),(0,ve._)([(0,Fe.MZ)()],Ni.prototype,"visibleElements",void 0),(0,ve._)([(0,Ee.w)("visibleElements")],Ni.prototype,"castVisibleElements",null),Ni=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureRelationship")],Ni);const Bi=Ni;var Ui;const Vi="content-view-models",Di="relationship-view-models",qi={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Ki=Ui=class extends((0,Ei.sA)(Ve.A)){constructor(w){super(w),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=throttle_e(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...qi},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=w=>{const{abilities:D}=this;return"attachments"===w.type&&!!D.attachmentsContent||"custom"===w.type&&!!D.customContent||"fields"===w.type&&!!D.fieldsContent||"media"===w.type&&!!D.mediaContent||"text"===w.type&&!!D.textContent||"expression"===w.type&&!!D.expressionContent||"relationship"===w.type&&!!D.relationshipContent},this.addHandles((0,Me.wB)((()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone]),(()=>this._graphicChangedThrottled()),Me.Vh))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function re(w,D){const he=new Map;return w?(w.forEach((w=>{const ve=featureUtils_v(w.fieldName,D);w.fieldName=ve,he.set(ve.toLowerCase(),w)})),he):he}(ie(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return E(this.graphic)}castAbilities(w){return{...qi,...w}}get isTable(){var w;return(null===(w=this._sourceLayer)||void 0===w?void 0:w.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(w){var D;this._set("graphic",null!==(D=null===w||void 0===w?void 0:w.clone())&&void 0!==D?D:null)}get spatialReference(){var w,D;return null!==(w=null===(D=this.view)||void 0===D?void 0:D.spatialReference)&&void 0!==w?w:null}set spatialReference(w){this._override("spatialReference",w)}get timeZone(){var w,D;return null!==(w=null===(D=this.view)||void 0===D?void 0:D.timeZone)&&void 0!==w?w:Ge.qU}set timeZone(w){this._overrideIfSome("timeZone",w)}get map(){var w;return(null===(w=this.view)||void 0===w?void 0:w.map)||null}set map(w){this._override("map",w)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(w,D){const he=this.contentViewModels[w];he instanceof ai&&he.setActiveMedia(D)}nextMedia(w){const D=this.contentViewModels[w];D instanceof ai&&D.next()}previousMedia(w){const D=this.contentViewModels[w];D instanceof ai&&D.previous()}async updateGeometry(){var w;const{graphic:D,spatialReference:he,_sourceLayer:ve}=this;await(null===ve||void 0===ve?void 0:ve.load());const _e=null===ve||void 0===ve?void 0:ve.objectIdField;if(!_e||!D||!ve)return;const be=null===D||void 0===D||null===(w=D.attributes)||void 0===w?void 0:w[_e];if(null==be)return;const Me=[be];if(!D.geometry){const w=await se({layer:ve,graphic:D,outFields:[],objectIds:Me,returnGeometry:!0,spatialReference:he}),_e=null===w||void 0===w?void 0:w.geometry;_e&&(D.geometry=_e)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:w}=this;if(!w)return;const D=new AbortController;this._featureAbortController=D;try{await this._queryFeature({signal:D.signal})}catch(he){(0,Xt.zf)(he)||(this._error=he,be.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:he,graphic:w,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===D&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:w}=this;w&&w.abort(),this._featureAbortController=null}_compileContentElement(w,D){return"attachments"===w.type?this._compileAttachments(w,D):"custom"===w.type?this._compileCustom(w,D):"fields"===w.type?this._compileFields(w,D):"media"===w.type?this._compileMedia(w,D):"text"===w.type?this._compileText(w,D):"expression"===w.type?this._compileExpression(w,D):"relationship"===w.type?this._compileRelationship(w,D):void 0}_compileContent(w){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(w)?w.filter(this._isAllowedContentType).map(((w,D)=>this._compileContentElement(w,D))).filter(Wt.Ru):"string"==typeof w?this._compileText(new yi.A({text:w}),0).text:w}_destroyContentViewModels(){this.removeHandles(Di),this.removeHandles(Vi),this.contentViewModels.forEach((w=>w&&!w.destroyed&&w.destroy())),this._set("contentViewModels",[])}_matchesFeature(w,D){var he;const ve=null===w||void 0===w||null===(he=w.graphic)||void 0===he?void 0:he.getObjectId(),_e=null===D||void 0===D?void 0:D.getObjectId();return null!=ve&&null!=_e&&ve===_e}_setRelatedFeaturesViewModels(w){let{relatedFeatureViewModels:D,relatedFeatures:he,map:ve}=w;const{view:_e,spatialReference:be}=this;null!==he&&void 0!==he&&he.filter(Boolean).forEach((w=>{D.some((D=>this._matchesFeature(D,w)))||D.add(new Ui({abilities:{relationshipContent:!1},map:ve,view:_e,spatialReference:be,graphic:w}))})),D.forEach((w=>{const ve=null===he||void 0===he?void 0:he.find((D=>this._matchesFeature(w,D)));ve||D.remove(w)}))}_setExpressionContentVM(w,D){const he=this.formattedAttributes,{contentElement:ve,contentElementViewModel:_e}=w,be=null===ve||void 0===ve?void 0:ve.type;_e&&be&&("fields"===be&&(this._createFieldsFormattedAttributes({contentElement:ve,contentElementIndex:D,formattedAttributes:he}),_e.set(this._createFieldsVMParams(ve,D))),"media"===be&&(this._createMediaFormattedAttributes({contentElement:ve,contentElementIndex:D,formattedAttributes:he}),_e.set(this._createMediaVMParams(ve,D))),"text"===be&&_e.set(this._createTextVMParams(ve)))}_compileRelationship(w,D){const{displayCount:he,orderByFields:ve,relationshipId:_e,title:be,description:Fe}=w,{_sourceLayer:Ae,graphic:Ce,map:xe}=this;if(!J(Ae))return;const Le=new Ti({displayCount:he,graphic:Ce,orderByFields:ve,relationshipId:_e,layer:Ae,map:xe,...this._compileTitleAndDesc({title:be,description:Fe})});return this.contentViewModels[D]=Le,this.addHandles((0,Me.on)((()=>Le.relatedFeatures),"change",(()=>this._setRelatedFeaturesViewModels(Le))),Di),w}_compileExpression(w,D){const{expressionInfo:he}=w,{graphic:ve,map:_e,spatialReference:be,view:Fe,location:Ae}=this,Ce=new Mi({expressionInfo:he,graphic:ve,interceptor:Ui.interceptor,map:_e,spatialReference:be,view:Fe,location:Ae});return this.contentViewModels[D]=Ce,this.addHandles((0,Me.wB)((()=>Ce.contentElementViewModel),(()=>this._setExpressionContentVM(Ce,D)),Me.Vh),Vi),w}_compileAttachments(w,D){const{graphic:he}=this,{description:ve,title:_e}=w;return this.contentViewModels[D]=new Ft({graphic:he,...this._compileTitleAndDesc({title:_e,description:ve})}),w}_compileCustom(w,D){const{graphic:he}=this,{creator:ve,destroyer:_e}=w;return this.contentViewModels[D]=new Tt({graphic:he,creator:ve,destroyer:_e}),w}_compileTitleAndDesc(w){let{title:D,description:he}=w;const{_fieldInfoMap:ve,_sourceLayer:_e,graphic:be,formattedAttributes:Me}=this,Fe=null===be||void 0===be?void 0:be.attributes,Ae=this._expressionAttributes,Ce=Me.global;return{title:featureUtils_D({attributes:Fe,fieldInfoMap:ve,globalAttributes:Ce,expressionAttributes:Ae,layer:_e,text:D}),description:featureUtils_D({attributes:Fe,fieldInfoMap:ve,globalAttributes:Ce,expressionAttributes:Ae,layer:_e,text:he})}}_createFieldsVMParams(w,D){const he=this._effectivePopupTemplate,ve=this.formattedAttributes,_e={...null===ve||void 0===ve?void 0:ve.global,...null===ve||void 0===ve?void 0:ve.content[D]},be=(null===w||void 0===w?void 0:w.fieldInfos)||(null===he||void 0===he?void 0:he.fieldInfos),Me=null===be||void 0===be?void 0:be.filter((w=>{let{fieldName:D}=w;return featureUtils_M(D)||de(D)||_e.hasOwnProperty(D)})),Fe=null===he||void 0===he?void 0:he.expressionInfos,{description:Ae,title:Ce}=w;return{attributes:_e,expressionInfos:Fe,fieldInfos:Me,...this._compileTitleAndDesc({title:Ce,description:Ae})}}_compileFields(w,D){const he=w.clone(),ve=new Vt(this._createFieldsVMParams(w,D));return this.contentViewModels[D]=ve,he.fieldInfos=ve.formattedFieldInfos.slice(0),he}_createMediaVMParams(w,D){var he;const{abilities:ve,graphic:_e,_fieldInfoMap:be,_effectivePopupTemplate:Me,relatedInfos:Fe,_sourceLayer:Ae,_expressionAttributes:Ce}=this,xe=this.formattedAttributes,Le=null!==(he=null===_e||void 0===_e?void 0:_e.attributes)&&void 0!==he?he:{},{description:Ee,mediaInfos:ke,title:Ze}=w;return{abilities:{chartAnimation:ve.chartAnimation},activeMediaInfoIndex:w.activeMediaInfoIndex||0,attributes:Le,isAggregate:null===_e||void 0===_e?void 0:_e.isAggregate,layer:Ae,fieldInfoMap:be,formattedAttributes:{...null===xe||void 0===xe?void 0:xe.global,...null===xe||void 0===xe?void 0:xe.content[D]},expressionAttributes:Ce,mediaInfos:ke,popupTemplate:Me,relatedInfos:Fe,...this._compileTitleAndDesc({title:Ze,description:Ee})}}_compileMedia(w,D){const he=w.clone(),ve=new ai(this._createMediaVMParams(w,D));return he.mediaInfos=ve.formattedMediaInfos.slice(0),this.contentViewModels[D]=ve,he}_createTextVMParams(w){const{graphic:D,_fieldInfoMap:he,_sourceLayer:ve,_expressionAttributes:_e}=this;if(w&&w.text){var be,Me,Fe;const Ae=null!==(be=null===D||void 0===D?void 0:D.attributes)&&void 0!==be?be:{},Ce=null!==(Me=null===(Fe=this.formattedAttributes)||void 0===Fe?void 0:Fe.global)&&void 0!==Me?Me:{};w.text=featureUtils_D({attributes:Ae,fieldInfoMap:he,globalAttributes:Ce,expressionAttributes:_e,layer:ve,text:w.text})}return{graphic:D,creator:w.text}}_compileText(w,D){const he=w.clone();return this.contentViewModels[D]=new Tt(this._createTextVMParams(he)),he}_compileLastEditInfo(){const{_effectivePopupTemplate:w,_sourceLayer:D,graphic:he,timeZone:ve}=this;if(!w)return;const{lastEditInfoEnabled:_e}=w,be=null===D||void 0===D?void 0:D.editFieldsInfo;return _e&&be?function ne(w,D,he,ve){const{creatorField:_e,creationDateField:be,editorField:Me,editDateField:Fe}=w;if(!D)return;const Ae=(0,Ge.hv)(ve&&"preferredTimeZone"in ve?ve.preferredTimeZone:null,!(!ve||!("datesInUnknownTimezone"in ve))&&!!ve.datesInUnknownTimezone,he,ot,"date"),Ce={...ot,...Ae},xe=D[Fe];if("number"==typeof xe){const w=D[Me];return{type:"edit",date:(0,Ke.Yq)(xe,Ce),user:w}}const Le=D[be];if("number"==typeof Le){const w=D[_e];return{type:"create",date:(0,Ke.Yq)(Le,Ce),user:w}}return null}(be,null===he||void 0===he?void 0:he.attributes,ve,D):void 0}_compileTitle(w){var D,he,ve;const{_fieldInfoMap:_e,_sourceLayer:be,graphic:Me,_expressionAttributes:Fe}=this;return featureUtils_D({attributes:null!==(D=null===Me||void 0===Me?void 0:Me.attributes)&&void 0!==D?D:{},fieldInfoMap:_e,globalAttributes:null!==(he=null===(ve=this.formattedAttributes)||void 0===ve?void 0:ve.global)&&void 0!==he?he:{},expressionAttributes:Fe,layer:be,text:w})}async _getTitle(){const{_effectivePopupTemplate:w,graphic:D}=this;if(!D)return null;return featureUtils_x(null===w||void 0===w?void 0:w.title,{graphic:D})}async _getContent(){const{_effectivePopupTemplate:w,graphic:D}=this;if(!D)return null;return featureUtils_x(null===w||void 0===w?void 0:w.content,{graphic:D})}async _queryFeature(w){const{_featureAbortController:D,_sourceLayer:he,graphic:ve,_effectivePopupTemplate:_e}=this,be=this.map,Me=this.view,Fe=this.spatialReference,Ae=this.location;if(D!==this._featureAbortController||!ve)return;await ce({graphic:ve,popupTemplate:_e,layer:he,spatialReference:Fe},w);const{content:{value:Ce},title:{value:xe}}=await(0,Xt.Lx)({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:Le}}=await(0,Xt.Lx)({checkForRelatedFeatures:this._checkForRelatedFeatures(w),expressionAttributes:arcadeFeatureUtils_m({expressionInfos:null===_e||void 0===_e?void 0:_e.expressionInfos,spatialReference:Fe,graphic:ve,map:be,interceptor:Ui.interceptor,view:Me,options:w,location:Ae})});D===this._featureAbortController&&ve&&(this._expressionAttributes=Le,this._graphicExpressionAttributes={...ve.attributes,...Le},this._set("formattedAttributes",this._createFormattedAttributes(Ce)),this._set("title",this._compileTitle(xe)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(Ce)||null))}_createMediaFormattedAttributes(w){let{contentElement:D,contentElementIndex:he,formattedAttributes:ve}=w;const{_effectivePopupTemplate:_e,graphic:be,relatedInfos:Me,_sourceLayer:Fe,_fieldInfoMap:Ae,_graphicExpressionAttributes:Ce,timeZone:xe}=this;ve.content[he]=ue({fieldInfos:null===_e||void 0===_e?void 0:_e.fieldInfos,graphic:be,attributes:{...Ce,...D.attributes},layer:Fe,fieldInfoMap:Ae,relatedInfos:Me,timeZone:xe})}_createFieldsFormattedAttributes(w){let{contentElement:D,contentElementIndex:he,formattedAttributes:ve}=w;if(D.fieldInfos){const{graphic:w,relatedInfos:_e,_sourceLayer:be,_fieldInfoMap:Me,_graphicExpressionAttributes:Fe,timeZone:Ae}=this;ve.content[he]=ue({fieldInfos:D.fieldInfos,graphic:w,attributes:{...Fe,...D.attributes},layer:be,fieldInfoMap:Me,relatedInfos:_e,timeZone:Ae})}}_createFormattedAttributes(w){const{_effectivePopupTemplate:D,graphic:he,relatedInfos:ve,_sourceLayer:_e,_fieldInfoMap:be,_graphicExpressionAttributes:Me,timeZone:Fe}=this,Ae={global:ue({fieldInfos:null===D||void 0===D?void 0:D.fieldInfos,graphic:he,attributes:Me,layer:_e,fieldInfoMap:be,relatedInfos:ve,timeZone:Fe}),content:[]};return Array.isArray(w)&&w.forEach(((w,D)=>{"fields"===w.type&&this._createFieldsFormattedAttributes({contentElement:w,contentElementIndex:D,formattedAttributes:Ae}),"media"===w.type&&this._createMediaFormattedAttributes({contentElement:w,contentElementIndex:D,formattedAttributes:Ae})})),Ae}_checkForRelatedFeatures(w){const{graphic:D,_effectivePopupTemplate:he}=this;return this._queryRelatedInfos(D,ie(he),w)}async _queryRelatedInfos(w,D,he){const{relatedInfos:ve,_sourceLayer:_e}=this;ve.clear();const be=null!=(null===_e||void 0===_e?void 0:_e.associatedLayer)?await(null===_e||void 0===_e?void 0:_e.associatedLayer.load(he)):_e;if(!be||!w)return;const Me=D.filter((w=>w&&de(w.fieldName)));if(null===Me||void 0===Me||!Me.length)return;D.forEach((w=>this._configureRelatedInfo(w,be)));const Fe=await relatedFeatureUtils_N({relatedInfos:ve,layer:be},he);Object.keys(Fe).forEach((w=>{var D;const he=ve.get(w.toString()),_e=null===(D=Fe[w])||void 0===D?void 0:D.value;he&&_e&&(he.layerInfo=_e.data)}));const Ae=await function relatedFeatureUtils_T(w,D){let{graphic:he,relatedInfos:ve,layer:_e}=w;const be={};return ve.forEach(((w,ve)=>{w.layerInfo&&(be[ve]=relatedFeatureUtils_U(he,w,_e,D))})),(0,Xt.Lx)(be)}({graphic:w,relatedInfos:ve,layer:be},he);Object.keys(Ae).forEach((w=>{var D;!function relatedFeatureUtils_I(w,D){if(!D)return;if(!w)return;const{features:he,statsFeatures:ve}=w,_e=null===he||void 0===he?void 0:he.value;D.relatedFeatures=_e?_e.features:[];const be=null===ve||void 0===ve?void 0:ve.value;D.relatedStatsFeatures=be?be.features:[]}(null===(D=Ae[w])||void 0===D?void 0:D.value,ve.get(w.toString()))}))}_configureRelatedInfo(w,D){const{relatedInfos:he}=this,ve=relatedFeatureUtils_y(w.fieldName);if(!ve)return;const{layerId:_e,fieldName:be}=ve;if(!_e)return;const Me=he.get(_e.toString())||relatedFeatureUtils_F(_e,D);Me&&(function relatedFeatureUtils_q(w){var D;let{relatedInfo:he,fieldName:ve,fieldInfo:_e}=w;if(null!==(D=he.relatedFields)&&void 0!==D&&D.push(ve),_e.statisticType){var be;const w=new oi.A({statisticType:_e.statisticType,onStatisticField:ve,outStatisticFieldName:ve});null===(be=he.outStatistics)||void 0===be||be.push(w)}}({relatedInfo:Me,fieldName:be,fieldInfo:w}),this.relatedInfos.set(_e,Me))}};Ki.interceptor=new class FeatureSetQueryInterceptor_e{constructor(w,D){this.preLayerQueryCallback=w,this.preRequestCallback=D,this.preLayerQueryCallback||(this.preLayerQueryCallback=w=>{}),this.preRequestCallback||(this.preLayerQueryCallback=w=>{})}}((w=>{let{query:D,layer:he,method:ve}=w;Ie({layer:he,method:ve,query:D,definitionExpression:"".concat(he.definitionExpression," ").concat(he.serviceDefinitionExpression)})}),(w=>{let{queryPayload:D,layer:he,method:ve}=w;Ie({layer:he,method:ve,query:D,definitionExpression:"".concat(he.definitionExpression," ").concat(he.serviceDefinitionExpression)})})),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"_error",void 0),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"_featureAbortController",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"_effectivePopupTemplate",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"_fieldInfoMap",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"_sourceLayer",null),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"abilities",void 0),(0,ve._)([(0,Ee.w)("abilities")],Ki.prototype,"castAbilities",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"content",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"contentViewModels",void 0),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"description",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean})],Ki.prototype,"defaultPopupTemplateEnabled",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"isTable",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"state",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"formattedAttributes",void 0),(0,ve._)([(0,Fe.MZ)({type:Ue.A,value:null})],Ki.prototype,"graphic",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"lastEditInfo",void 0),(0,ve._)([(0,Fe.MZ)({type:ti.A})],Ki.prototype,"location",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"relatedInfos",void 0),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"spatialReference",null),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"timeZone",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"title",void 0),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"map",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Ki.prototype,"waitingForContent",null),(0,ve._)([(0,Fe.MZ)()],Ki.prototype,"view",void 0),Ki=Ui=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.FeatureViewModel")],Ki);const zi=Ki,ji="esri-feature",Wi={base:ji,container:"".concat(ji,"__size-container"),title:"".concat(ji,"__title"),main:"".concat(ji,"__main-container"),btn:"".concat(ji,"__button"),icon:"".concat(ji,"__icon"),content:"".concat(ji,"__content"),contentNode:"".concat(ji,"__content-node"),contentNodeText:"".concat(ji,"__content-node--text"),contentElement:"".concat(ji,"__content-element"),text:"".concat(ji,"__text"),lastEditedInfo:"".concat(ji,"__last-edited-info"),fields:"".concat(ji,"__fields"),fieldHeader:"".concat(ji,"__field-header"),fieldData:"".concat(ji,"__field-data"),fieldDataDate:"".concat(ji,"__field-data--date"),loadingSpinnerContainer:"".concat(ji,"__loading-container"),spinner:"".concat(ji,"__loading-spinner")},FeatureContentMixin_n=w=>{let D=class extends w{constructor(){super(...arguments),this.renderNodeContent=w=>widget_e(w)&&!w.destroyed?(0,mt.K)("div",{class:Wi.contentNode,key:w},w.render()):w instanceof HTMLElement?(0,mt.K)("div",{afterCreate:this._attachToNode,bind:w,class:Wi.contentNode,key:w}):function widget_t(w){return w&&"function"==typeof w.postMixInProperties&&"function"==typeof w.buildRendering&&"function"==typeof w.postCreate&&"function"==typeof w.startup}(w)?(0,mt.K)("div",{afterCreate:this._attachToNode,bind:w.domNode,class:Wi.contentNode,key:w}):null}_attachToNode(w){w.appendChild(this)}};return D=(0,ve._)([(0,Ae.$)("esri.widgets.Feature.ContentMixin")],D),D};var Hi;const Gi={title:!0,content:!0,lastEditedInfo:!0},Qi="relationship-handles";let $i=Hi=class extends(FeatureContentMixin_n(ke.A)){constructor(w,D){super(w,D),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Gi},this.viewModel=new zi}initialize(){this.addHandles((0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.contentViewModels}),(()=>this._setupContentWidgets()),Me.Vh))}loadDependencies(){return(0,ct.W)({notice:()=>Promise.all([he.e(463),he.e(616),he.e(7409)]).then(he.bind(he,77409))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(w){this.viewModel.graphic=w}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(w){this.viewModel.defaultPopupTemplateEnabled=w}get isTable(){return this.viewModel.isTable}get label(){var w,D;return null!==(w=null===(D=this.messages)||void 0===D?void 0:D.widgetLabel)&&void 0!==w?w:""}set label(w){this._overrideIfSome("label",w)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(w){this.viewModel.spatialReference=w}get timeZone(){return this.viewModel.timeZone}set timeZone(w){this.viewModel.timeZone=w}get title(){return this.viewModel.title}castVisibleElements(w){return{...Gi,...w}}get map(){return this.viewModel.map}set map(w){this.viewModel.map=w}get view(){return this.viewModel.view}set view(w){this.viewModel.view=w}setActiveMedia(w,D){return this.viewModel.setActiveMedia(w,D)}nextMedia(w){return this.viewModel.nextMedia(w)}previousMedia(w){return this.viewModel.previousMedia(w)}render(){const{state:w}=this.viewModel,D=(0,mt.K)("div",{class:Wi.container,key:"container"},this._renderTitle(),"error"===w?this._renderError():"loading"===w?this._renderLoading():this._renderContentContainer());return(0,mt.K)("div",{class:this.classes(Wi.base,ut.D.widget)},D)}_renderError(){const{messagesCommon:w,messages:D,visibleElements:he}=this;return(0,mt.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},he.title?(0,mt.K)("div",{key:"error-title",slot:"title"},w.errorMessage):null,(0,mt.K)("div",{key:"error-message",slot:"message"},D.loadingError))}_renderLoading(){return(0,mt.K)("div",{class:Wi.loadingSpinnerContainer,key:"loading-container"},(0,mt.K)("span",{class:this.classes(ht.T.loadingIndicator,ut.D.rotating,Wi.spinner)}))}_renderContentContainer(){const{visibleElements:w}=this;return w.content?(0,mt.K)("div",{class:Wi.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:w,title:D}=this;return w.title?(0,mt.K)(Heading_e,{class:Wi.title,innerHTML:D,level:this.headingLevel}):null}_renderContent(){const w=this.viewModel.content,D="content";if(!w)return null;if(Array.isArray(w))return w.length?(0,mt.K)("div",{class:Wi.contentNode,key:"".concat(D,"-content-elements")},w.map(this._renderContentElement,this)):null;if("string"==typeof w){const w=this._contentWidgets[0];return!w||w.destroyed?null:(0,mt.K)("div",{class:this.classes(Wi.contentNode,Wi.contentNodeText),key:"".concat(D,"-content")},w.render())}return this.renderNodeContent(w)}_renderContentElement(w,D){var he;const{visibleElements:ve}=this;if("boolean"!=typeof ve.content&&(null===(he=ve.content)||void 0===he||!he[w.type]))return null;switch(w.type){case"attachments":return this._renderAttachments(D);case"custom":return this._renderCustom(w,D);case"fields":return this._renderFields(D);case"media":return this._renderMedia(D);case"text":return this._renderText(w,D);case"expression":return this._renderExpression(D);case"relationship":return this._renderRelationship(D);default:return null}}_renderAttachments(w){const D=this._contentWidgets[w];if(!D||D.destroyed)return null;const{state:he,attachmentInfos:ve}=D.viewModel;return"loading"===he||ve.length>0?(0,mt.K)("div",{class:this.classes(Wi.contentElement),key:this._buildKey("attachments-element",w)},D.render()):null}_renderRelationship(w){const D=this._contentWidgets[w];return D&&!D.destroyed&&this.flowItems?(0,mt.K)("div",{class:Wi.contentElement,key:this._buildKey("relationship-element",w)},D.render()):null}_renderExpression(w){const D=this._contentWidgets[w];return!D||D.destroyed?null:(0,mt.K)("div",{class:Wi.contentElement,key:this._buildKey("expression-element",w)},D.render())}_renderCustom(w,D){const{creator:he}=w,ve=this._contentWidgets[D];return!ve||ve.destroyed?null:he?(0,mt.K)("div",{class:Wi.contentElement,key:this._buildKey("custom-element",D)},ve.render()):null}_renderFields(w){const D=this._contentWidgets[w];return!D||D.destroyed?null:(0,mt.K)("div",{class:Wi.contentElement,key:this._buildKey("fields-element",w)},D.render())}_renderMedia(w){const D=this._contentWidgets[w];return!D||D.destroyed?null:(0,mt.K)("div",{class:Wi.contentElement,key:this._buildKey("media-element",w)},D.render())}_renderLastEditInfo(){const{visibleElements:w,messages:D}=this,{lastEditInfo:he}=this.viewModel;if(!he||!w.lastEditedInfo)return null;const{date:ve,user:_e}=he,be="edit"===he.type?_e?D.lastEditedByUser:D.lastEdited:_e?D.lastCreatedByUser:D.lastCreated,Me=(0,Le.V)(be,{date:ve,user:_e});return(0,mt.K)("div",{class:this.classes(Wi.lastEditedInfo,Wi.contentElement),key:"edit-info-element"},Me)}_renderText(w,D){const he=w.text,ve=this._contentWidgets[D];return!ve||ve.destroyed?null:he?(0,mt.K)("div",{class:this.classes(Wi.contentElement,Wi.text),key:this._buildKey("text-element",D)},ve.render()):null}_buildKey(w){for(var D,he=arguments.length,ve=new Array(he>1?he-1:0),_e=1;_e<he;_e++)ve[_e-1]=arguments[_e];return"".concat(w,"__").concat((null===(D=this.viewModel)||void 0===D||null===(D=D.graphic)||void 0===D?void 0:D.uid)||"0","-").concat(ve.join("-"))}_destroyContentWidget(w){w&&(w.viewModel=null,!w.destroyed&&w.destroy())}_destroyContentWidgets(){this.removeHandles(Qi),this._contentWidgets.forEach((w=>this._destroyContentWidget(w))),this._contentWidgets=[]}_addFeatureRelationshipHandles(w){const{flowItems:D,visibleElements:he}=this;this.addHandles([(0,Me.on)((()=>w),"select-record",(w=>{let{featureViewModel:ve}=w;D&&(ve.abilities={relationshipContent:!0},D.push(new Hi({flowItems:D,viewModel:ve,visibleElements:he})))})),(0,Me.on)((()=>w),"show-all-records",(()=>{if(!D)return;const{viewModel:he}=w;he.showAllEnabled=!0;const ve=new Bi({visibleElements:{title:!1,description:!1},viewModel:he});this._addFeatureRelationshipHandles(ve),D.push(ve)}))],Qi)}_setupContentWidgets(){var w;this._destroyContentWidgets();const{headingLevel:D,visibleElements:he}=this,ve=null===(w=this.viewModel)||void 0===w?void 0:w.content,{contentViewModels:_e}=this.viewModel;if(Array.isArray(ve))ve.forEach(((w,ve)=>{if("attachments"===w.type&&(this._contentWidgets[ve]=new kt({displayType:w.displayType,headingLevel:he.title?D+1:D,viewModel:_e[ve]})),"fields"===w.type&&(this._contentWidgets[ve]=new jt({viewModel:_e[ve]})),"media"===w.type&&(this._contentWidgets[ve]=new mi({viewModel:_e[ve]})),"text"===w.type&&(this._contentWidgets[ve]=new Ot({viewModel:_e[ve]})),"custom"===w.type&&(this._contentWidgets[ve]=new Ot({viewModel:_e[ve]})),"expression"===w.type&&(this._contentWidgets[ve]=new Ci({viewModel:_e[ve]})),"relationship"===w.type){const w=new Bi({viewModel:_e[ve]});this._addFeatureRelationshipHandles(w),this._contentWidgets[ve]=w}}),this);else{const w=_e[0];w&&!w.destroyed&&(this._contentWidgets[0]=new Ot({viewModel:w}))}this.scheduleRender()}};(0,ve._)([(0,Fe.MZ)()],$i.prototype,"graphic",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"defaultPopupTemplateEnabled",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"flowItems",void 0),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"headingLevel",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],$i.prototype,"isTable",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"label",null),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Feature/t9n/Feature")],$i.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/t9n/common")],$i.prototype,"messagesCommon",void 0),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"spatialReference",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"timeZone",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],$i.prototype,"title",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"visibleElements",void 0),(0,ve._)([(0,Ee.w)("visibleElements")],$i.prototype,"castVisibleElements",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"map",null),(0,ve._)([(0,Fe.MZ)()],$i.prototype,"view",null),(0,ve._)([(0,Fe.MZ)({type:zi})],$i.prototype,"viewModel",void 0),$i=Hi=(0,ve._)([(0,Ae.$)("esri.widgets.Feature")],$i);const Yi=$i;var Ji=he(73067),Xi=he(54208);let en=class extends Ji.A.EventedAccessor{constructor(w){super(w),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,Me.z7)((()=>{const w=this.screenLocationEnabled?this.view:null;return w?[w.size,"3d"===w.type?w.camera:w.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),(0,Me.wB)((()=>this.screenLocation),((w,D)=>{null!=w&&null!=D&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:w,view:D,screenLocationEnabled:he}=this,ve=null===D||void 0===D?void 0:D.spatialReference,_e=ve?(0,Xi.projectOrLoad)(w,ve).geometry:null;return he&&_e&&null!==D&&void 0!==D&&D.ready?D.toScreen(_e):null}};(0,ve._)([(0,Fe.MZ)()],en.prototype,"location",void 0),(0,ve._)([(0,Fe.MZ)()],en.prototype,"screenLocation",null),(0,ve._)([(0,Fe.MZ)()],en.prototype,"screenLocationEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],en.prototype,"view",void 0),en=(0,ve._)([(0,Ae.$)("esri.widgets.support.AnchorElementViewModel")],en);const tn=en;let nn=class extends tn{constructor(w){super(w),this.visible=!1}};(0,ve._)([(0,Fe.MZ)()],nn.prototype,"visible",void 0),nn=(0,ve._)([(0,Ae.$)("esri.widgets.CompassViewModel")],nn);const on=nn,sn="esri-spinner",rn=sn,ln="".concat(sn,"--start"),an="".concat(sn,"--finish");let dn=class extends ke.A{constructor(w,D){super(w,D),this._animationDelay=500,this._animationPromise=null,this.viewModel=new on}initialize(){this.addHandles((0,Me.wB)((()=>this.visible),(w=>this._visibleChange(w))))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(w){this.viewModel.location=w}get view(){return this.viewModel.view}set view(w){this.viewModel.view=w}get visible(){return this.viewModel.visible}set visible(w){this.viewModel.visible=w}show(w){const{location:D,promise:he}=null!==w&&void 0!==w?w:{};D&&(this.viewModel.location=D),this.visible=!0;he&&he.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:w}=this,{screenLocation:D}=this.viewModel,he=!!D,ve={[ln]:w&&he,[an]:!w&&he},_e=this._getPositionStyles();return(0,mt.K)("div",{class:this.classes(rn,ve),styles:_e})}_visibleChange(w){if(w)return void(this.viewModel.screenLocationEnabled=!0);const D=(0,Xt.Pl)(this._animationDelay);this._animationPromise=D,D.catch((()=>{})).then((()=>{this._animationPromise===D&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:w,view:D}=this.viewModel;if(null==D||null==w)return{};const{padding:he}=D;return{left:w.x-he.left+"px",top:w.y-he.top+"px"}}};(0,ve._)([(0,Fe.MZ)()],dn.prototype,"location",null),(0,ve._)([(0,Fe.MZ)()],dn.prototype,"view",null),(0,ve._)([(0,Fe.MZ)({type:on})],dn.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)()],dn.prototype,"visible",null),dn=(0,ve._)([(0,Ae.$)("esri.widgets.Spinner")],dn);const cn=dn,un="esri-features",hn={icon:"".concat(un,"__icon"),actionImage:"".concat(un,"__action-image"),base:un,container:"".concat(un,"__container"),contentContainer:"".concat(un,"__content-container"),contentFeature:"".concat(un,"__content-feature"),flowItemCollapsed:"".concat(un,"__flow-item--collapsed"),header:"".concat(un,"__header"),footer:"".concat(un,"__footer"),featureMenuObserver:"".concat(un,"__feature-menu-observer"),actionExit:"".concat(un,"__action--exit"),loader:"".concat(un,"__loader"),featuresHeading:"".concat(un,"__heading"),paginationActionBar:"".concat(un,"__pagination-action-bar"),paginationPrevious:"".concat(un,"__pagination-previous"),paginationNext:"".concat(un,"__pagination-next")};let pn=class extends ke.A{constructor(w,D){super(w,D),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=w=>{this.emit("open-related-feature",{feature:w})}}loadDependencies(){return(0,ct.W)({action:()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(1991)]).then(he.bind(he,1991)),"flow-item":()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(9872),he.e(4098),he.e(6135)]).then(he.bind(he,36135))})}render(){const{flowItems:w}=this,D=null===w||void 0===w?void 0:w.toArray();return(0,mt.K)(mt.w,null,null===D||void 0===D?void 0:D.map((w=>this._renderRelatedRecordsFlowItem(w))))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){var w;const D=null===(w=this.flowItems)||void 0===w?void 0:w.pop();D&&("showAllEnabled"in D.viewModel&&(D.viewModel.showAllEnabled=!1),D&&(D.viewModel=null,D.destroy()))}_renderRelatedRecordsFlowItem(w){var D;const{messages:he,closable:ve,closed:_e}=this,be="graphic"in w&&!w.isTable;return(0,mt.K)("calcite-flow-item",{bind:this,closable:ve,closed:_e,description:this._getRelatedRecordsFlowItemDescription(w),heading:null!==(D=w.title)&&void 0!==D?D:"",key:"flow-item-".concat(w.viewModel.uid),onCalciteFlowItemBack:w=>{w.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,mt.K)("calcite-action",{appearance:"transparent",bind:this,class:hn.actionExit,icon:"move-up",key:"exit-related-records-action",label:he.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:he.exitRelatedRecords,title:he.exitRelatedRecords}),be?(0,mt.K)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:he.selectFeature,onclick:()=>this._handleOpenRelatedFeature(w),scale:"m",slot:"header-actions-end",text:he.selectFeature,title:he.selectFeature}):null,(0,mt.K)("div",{class:hn.container},w.render()))}_getRelatedRecordsFlowItemDescription(w){var D;return"featureCountDescription"in w?w.featureCountDescription:null!==(D=w.viewModel.description)&&void 0!==D?D:""}};(0,ve._)([(0,Fe.MZ)()],pn.prototype,"flowItems",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Features/t9n/Features")],pn.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)()],pn.prototype,"closed",void 0),(0,ve._)([(0,Fe.MZ)()],pn.prototype,"closable",void 0),pn=(0,ve._)([(0,Ae.$)("esri.widgets.Features.FeaturesRelatedRecords")],pn);const vn=pn;he(21343);var mn=he(83255),fn=he(80417),gn=he(78658);const yn="OBJECTID";he(34120),he(65141),he(15947),he(51427);const _n="esri-relationship-ramp",wn="".concat(_n,"--diamond"),bn="".concat(_n,"--square");"".concat(wn,"__container"),"".concat(wn,"__left-column"),"".concat(wn,"__right-column"),"".concat(wn,"__middle-column"),"".concat(wn,"__middle-column--label"),"".concat(wn,"__middle-column--ramp"),"".concat(bn,"__table"),"".concat(bn,"__table-row"),"".concat(bn,"__table-cell"),"".concat(bn,"__table-label"),"".concat(bn,"__table-label--left-bottom"),"".concat(bn,"__table-label--right-bottom"),"".concat(bn,"__table-label--left-top"),"".concat(bn,"__table-label--right-top");he(66004),he(72365);function symbolUtils_k(w){return w&&"opacity"in w?w.opacity*symbolUtils_k(w.parent):1}async function symbolUtils_L(w,D){var ve,_e,be,Me,Fe;if(!w)return;const Ae=w.sourceLayer,Ce=null!==(ve=null!=D&&D.useSourceLayer?Ae:w.layer)&&void 0!==ve?ve:Ae,xe=symbolUtils_k(Ce);if(null!=w.symbol&&(null==D||!0!==D.ignoreGraphicSymbol)){const he="web-style"===w.symbol.type?await(0,Gt.yG)(w.symbol,{...D,cache:null!=D?D.webStyleCache:null}):w.symbol.clone();return(0,Gt.dt)(he,null,xe),he}const Le=null!==(_e=null===(be=D)||void 0===be?void 0:be.renderer)&&void 0!==_e?_e:symbolUtils_C(Ce);let Ee=Le&&"getSymbolAsync"in Le?await Le.getSymbolAsync(w,D):null;if(!Ee)return;if(Ee="web-style"===Ee.type?await Ee.fetchSymbol({...D,cache:null!=D?D.webStyleCache:null}):Ee.clone(),!Le||!("visualVariables"in Le)||null===(Me=Le.visualVariables)||void 0===Me||!Me.length)return(0,Gt.dt)(Ee,null,xe),Ee;if("arcadeRequiredForVisualVariables"in Le&&Le.arcadeRequiredForVisualVariables&&null==(null===(Fe=D)||void 0===Fe?void 0:Fe.arcade)){const w={...D};w.arcade=await(0,He.lw)(),D=w}const{getColor:ke,getOpacity:Ze,getAllSizes:Se,getRotationAngle:Re}=await Promise.resolve().then(he.bind(he,56428)),Pe=[],Oe=[],Ne=[],Be=[];for(const he of Le.visualVariables)switch(he.type){case"color":Pe.push(he);break;case"opacity":Oe.push(he);break;case"rotation":Be.push(he);break;case"size":he.target||Ne.push(he)}const Ue=!!Pe.length&&Pe[Pe.length-1],Ve=Ue?ke(Ue,w,D):null,De=!!Oe.length&&Oe[Oe.length-1];let qe=De?Ze(De,w,D):null;if(null!=xe&&(qe=null!=qe?qe*xe:xe),(0,Gt.dt)(Ee,Ve,qe),Ne.length){const he=Se(Ne,w,D);await(0,Gt.UQ)(Ee,he)}for(const he of Be)(0,Gt.GG)(Ee,Re(he,w,D),he.axis);return Ee}function symbolUtils_C(w){if(w)return"renderer"in w?w.renderer:void 0}var Mn=he(18715),Fn=he(36973),An=he(7608);const In=xe.A.ofType({key:"type",defaultKeyValue:"button",base:Fn.A,typeMap:{button:Ce.A,toggle:An.A}}),Cn=new Ce.A({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:ht.T.zoomInMagnifyingGlass}),xn=new Ce.A({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:ht.T.trash}),Ln=new Ce.A({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ht.T.zoomInMagnifyingGlass}),En=new An.A({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:ht.T.table,value:!1}),actionUtils_c=()=>be.A.getLogger("esri.widgets.Popup.PopupViewModel"),actionUtils_u=w=>{const{event:D,view:he,viewModel:ve}=w,{action:_e}=D;if(!_e)return Promise.reject(new Ze.A("trigger-action:missing-arguments","Event has no action"));const{disabled:be,id:Me}=_e;if(!Me)return Promise.reject(new Ze.A("trigger-action:invalid-action","action.id is missing"));if(be)return Promise.reject(new Ze.A("trigger-action:invalid-action","Action is disabled"));if(Me===Cn.id)return async function actionUtils_w(w){var D;const{location:he,selectedFeature:ve,view:_e,zoomFactor:be}=w,Me=actionUtils_l(w);if(!_e||!Me){const w=new Ze.A("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:Me,view:_e});throw actionUtils_c().error(w),w}const Fe=_e.scale/be,Ae=null===(D=w.selectedFeature)||void 0===D?void 0:D.geometry,Ce=null!==Ae&&void 0!==Ae?Ae:he,xe=null!=Ce&&"point"===Ce.type&&await async function actionUtils_g(w,D){if("3d"!==(null===D||void 0===D?void 0:D.type)||!w||"esri.Graphic"!==w.declaredClass)return!0;const he=D.getViewForGraphic(w);if(he&&"whenGraphicBounds"in he){let D=null;try{D=await he.whenGraphicBounds(w,{useViewElevation:!0})}catch(ve){}return!D||!D.boundingBox||D.boundingBox[0]===D.boundingBox[3]&&D.boundingBox[1]===D.boundingBox[4]&&D.boundingBox[2]===D.boundingBox[5]}return!0}(ve,_e);Cn.active=!0,Cn.disabled=!0;try{await w.zoomTo({target:{target:Me,scale:xe?Fe:void 0}})}catch(Le){const w=new Ze.A("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:ve});actionUtils_c().error(w)}finally{Cn.active=!1,Cn.disabled=!1,w.zoomToLocation=null,xe&&(w.location=Ce)}}(ve).catch(Xt.jH);if(Me===Ln.id)return async function actionUtils_f(w){const{selectedFeature:D,view:he}=w;if("2d"!==(null===he||void 0===he?void 0:he.type)){const w=new Ze.A("zoomToCluster:invalid-view","View must be 2d MapView.",{view:he});throw actionUtils_c().error(w),w}if(!D||!actionUtils_d(D)){const w=new Ze.A("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:D});throw actionUtils_c().error(w),w}const[ve,_e]=await actionUtils_p(he,D);Ln.active=!0,Ln.disabled=!0;const{extent:be}=await ve.queryExtent(_e);be&&await w.zoomTo({target:be}),Ln.active=!1,Ln.disabled=!1}(ve);if(Me===En.id)return ve.browseClusterEnabled=!ve.browseClusterEnabled,ve.featureMenuOpen=ve.browseClusterEnabled,Promise.resolve();if(Me===xn.id){ve.visible=!1;const{selectedFeature:w}=ve;if(!w)return Promise.reject(new Ze.A("trigger-action:".concat(xn.id),"selectedFeature is required",{selectedFeature:w}));const{sourceLayer:D}=w;return D?D.remove(w):null===he||void 0===he||he.graphics.remove(w),Promise.resolve()}return Promise.resolve()};function actionUtils_l(w){var D;const{selectedFeature:he,location:ve,view:_e}=w;return _e&&null!==(D=null!==he&&void 0!==he?he:ve)&&void 0!==D?D:null}function actionUtils_d(w){var D;return!!w&&w.isAggregate&&"cluster"===(null===(D=w.sourceLayer)||void 0===D||null===(D=D.featureReduction)||void 0===D?void 0:D.type)}async function actionUtils_p(w,D){const he=await w.whenLayerView(D.sourceLayer),ve=he.createQuery(),_e=D.getObjectId();return ve.aggregateIds=null!=_e?[_e]:[],[he,ve]}var kn=he(24183),Zn=he(6835);let Tn=null;let Sn=class extends((0,kn.R)(tn)){constructor(w){super(w),this._pendingPromises=new mn.A,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this._locationScaleHandle=null,this.actions=new In,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ue.A({symbol:new Zn.A({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,Xt.sg)((async w=>{var D,ve,_e;const{view:Me}=this,Fe=null===(D=this.selectedFeature)||void 0===D||null===(D=D.geometry)||void 0===D?void 0:D.type,Ae=null!==(ve=this.location)&&void 0!==ve?ve:w;if("mesh"!==Fe&&Me&&Ae&&this.selectedFeature)if("point"!==Fe)try{var Ce,xe,Le;const{pendingFeatures:w}=await this._fetchFeaturesWithController({mapPoint:Ae}),D=(await Promise.all(w)).flat().filter(Boolean);if(!D.length)return;if(D.length!==this.features.length){const w=this._getHighlightLayer(this.selectedFeature),he="imagery"===(null===w||void 0===w?void 0:w.type)?void 0:w&&"objectIdField"in w?w.objectIdField||yn:null;if(he){const ve=this.selectedFeature.getObjectId(),_e=D.findIndex((D=>{const _e=this._getHighlightLayer(D);return(null===_e||void 0===_e?void 0:_e.uid)===(null===w||void 0===w?void 0:w.uid)&&D.attributes[he]===ve}));this.features=D,this.selectedFeatureIndex=_e}}const ve=null===(Ce=D[this.selectedFeatureIndex])||void 0===Ce?void 0:Ce.geometry,_e=null!==(xe="mesh"!==(null===ve||void 0===ve?void 0:ve.type)?ve:null)&&void 0!==xe?xe:this.selectedFeature.geometry,be=_e?(0,Xi.project)(_e,Me.spatialReference):null;if(!be)return;Tn||(Tn=await he.e(6211).then(he.bind(he,76211))),await Tn.intersects(be,Ae)||(this.location=null!==(Le=(await Tn.nearestCoordinate(be,Ae)).coordinate)&&void 0!==Le?Le:Ae)}catch(Ee){(0,Xt.zf)(Ee)||be.A.getLogger(this).error(Ee)}else this.location=null!==(_e=geometryUtils_n(this.selectedFeature.geometry))&&void 0!==_e?_e:Ae}))}initialize(){this.addHandles([this.on("view-change",(()=>this._autoClose())),(0,Me.wB)((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),(0,Me.wB)((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),(0,Me.wB)((()=>{var w;return null===(w=this.view)||void 0===w||null===(w=w.animation)||void 0===w?void 0:w.state}),(w=>this._animationStateChange(w))),(0,Me.wB)((()=>this.location),(w=>this._locationChange(w))),(0,Me.wB)((()=>this.selectedFeature),(w=>this._selectedFeatureChange(w))),(0,Me.wB)((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),(0,Me.wB)((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),(0,Me.wB)((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(w=>actionUtils_u({event:w,viewModel:this,view:this.view}))),(0,Me.z7)((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),Me.OH),(0,Me.wB)((()=>{var w,D,he;return[this.features,null===(w=this.view)||void 0===w?void 0:w.map,null===(D=this.view)||void 0===D?void 0:D.spatialReference,null===(he=this.view)||void 0===he?void 0:he.timeZone]}),(()=>this._updateFeatureVMs())),(0,Me.wB)((()=>{var w;return null===(w=this.view)||void 0===w?void 0:w.scale}),(()=>this._viewScaleChange())),(0,Me.z7)((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),(0,Me.wB)((()=>this.browseClusterEnabled),(w=>w?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){var w;this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,null!==(w=this._locationScaleHandle)&&void 0!==w&&w.remove(),this._locationScaleHandle=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){var w;const D=this._get("allActions")||new In;D.removeAll();const{actions:he,defaultActions:ve,defaultPopupTemplateEnabled:_e,includeDefaultActions:be,selectedFeature:Me}=this,Fe=be?ve.concat(he):he,Ae=Me&&("function"==typeof Me.getEffectivePopupTemplate&&Me.getEffectivePopupTemplate(_e)||Me.popupTemplate),Ce=null===Ae||void 0===Ae?void 0:Ae.actions,xe=null!==Ae&&void 0!==Ae&&Ae.overwriteActions?Ce:null!==(w=null===Ce||void 0===Ce?void 0:Ce.concat(Fe))&&void 0!==w?w:Fe;return null!==xe&&void 0!==xe&&xe.filter(Boolean).forEach((w=>D.add(w))),D}get defaultActions(){const w=this._get("defaultActions")||new In;return w.removeAll(),w.addMany(actionUtils_d(this.selectedFeature)?[Ln.clone(),En.clone()]:[Cn.clone()]),w}get featureCount(){return this.features.length}set features(w){const D=w||[];this._set("features",D);const{pendingPromisesCount:he,promiseCount:ve,selectedFeatureIndex:_e}=this,be=ve&&D.length;be&&he&&-1===_e?this.selectedFeatureIndex=0:be&&-1!==_e||(this.selectedFeatureIndex=D.length?0:-1)}set location(w){var D,he;let ve=w;const _e=null===(D=this.view)||void 0===D||null===(D=D.spatialReference)||void 0===D?void 0:D.isWebMercator;(null===w||void 0===w||null===(he=w.spatialReference)||void 0===he?void 0:he.isWGS84)&&_e&&(ve=(0,fn.Gh)(w)),this._set("location",ve)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(w){this._pendingPromises.clear(),this.features=[],Array.isArray(w)&&w.length?(this._set("promises",w),(w=w.slice(0)).forEach((w=>this._pendingPromises.add(w))),w.reduce(((w,D)=>w.finally((()=>D.then((w=>{this._pendingPromises.has(D)&&this._updateFeatures(w)})).finally((()=>this._pendingPromises.delete(D))).catch((()=>{}))))),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:w,selectedFeatureIndex:D}=this;return-1===D?null:w[D]||null}get selectedFeatureIndex(){const w=this._get("selectedFeatureIndex");return"number"==typeof w?w:-1}set selectedFeatureIndex(w){const{featureCount:D}=this;w=isNaN(w)||w<-1||!D?-1:(w+D)%D,this.activeFeature=null,this._set("selectedFeatureIndex",w)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){var w;return null!==(w=this.view)&&void 0!==w&&w.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some((w=>w.waitingForContent))}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:w}=this,D=actionUtils_l(this);return D&&w?this.callGoTo({target:{target:D,scale:w.scale}}):Promise.reject(new Ze.A("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:D,view:w}))}zoomTo(w){return this.callGoTo(w)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(w,D){var he;const{view:ve}=this;if(!ve||!w)throw new Ze.A("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:w,view:ve});return ve.fetchPopupFeatures(w,{pointerType:null===D||void 0===D||null===(he=D.event)||void 0===he?void 0:he.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:null===D||void 0===D?void 0:D.signal})}open(w){const D={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...w,visible:!0},{fetchFeatures:he}=D;delete D.fetchFeatures,he&&this._setFetchFeaturesPromises(D.location);const ve=["actionsMenuOpen","collapsed"];for(const _e of ve)delete D[_e];this.set(D)}triggerAction(w){const D=this.allActions.at(w);D&&!D.disabled&&this.emit("trigger-action",{action:D})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function actionUtils_y(w){En.value=!1;const D=w.features.filter((w=>actionUtils_d(w)));D.length&&(w.features=D)})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:w,selectedFeature:D}=this;"2d"===(null===w||void 0===w?void 0:w.type)?actionUtils_d(D)?(await async function actionUtils_v(w){const{view:D,selectedFeature:he}=w;if(!D||!he)return;const[ve,_e]=await actionUtils_p(D,he),{extent:be}=await ve.queryExtent(_e);w.selectedClusterBoundaryFeature.geometry=be,D.graphics.add(w.selectedClusterBoundaryFeature)}(this),await async function actionUtils_m(w){const{selectedFeature:D,view:he}=w;if(!he||!D)return;const[ve,_e]=await actionUtils_p(he,D);En.active=!0,En.disabled=!0;const{features:be}=await ve.queryFeatures(_e);En.active=!1,En.disabled=!1,En.value=!0,null===w||void 0===w||w.open({features:[D].concat(be),featureMenuOpen:!0})}(this)):be.A.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",D):be.A.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",D)}handleViewClick(w){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(w)}_animationStateChange(w){this.zoomToLocation||(Cn.disabled="waiting-for-target"===w)}_clearBrowsedClusterGraphics(){var w;const D=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(Wt.Ru);null!==(w=this.view)&&void 0!==w&&null!==(w=w.graphics)&&void 0!==w&&w.removeMany(D),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(actionUtils_d(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(w){const{selectedFeature:D,updateLocationEnabled:he}=this;he&&w&&(!D||D.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:w,featureCount:D,featurePage:he,featuresPerPage:ve,featureViewModels:_e}=this;if(null===he)return;const be=((he-1)*ve+D)%D,Me=be+ve;_e.slice(be,Me).forEach(((D,he)=>{var ve;D&&(null!==(ve=D.graphic)&&void 0!==ve||(D.graphic=w[be+he]))}))}async _selectedFeatureChange(w){const{location:D,updateLocationEnabled:he,view:ve}=this;if(w&&ve){if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(ve.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),actionUtils_d(w))return;return w.symbol=await symbolUtils_L(w),this._selectedClusterFeature=w,void ve.graphics.add(this._selectedClusterFeature)}if(w.symbol=await symbolUtils_L(w),!he&&D||!w.geometry){if(he&&!w.geometry){var _e;await this.centerAtLocation();const w=null===(_e=ve.center)||void 0===_e?void 0:_e.clone();w&&(this.location=w)}}else this.location=geometryUtils_n(w.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(w){const{pendingFeatures:D}=await this._fetchFeaturesWithController({mapPoint:w});this.promises=D}_destroyFeatureVMs(){this.featureViewModels.forEach((w=>w&&!w.destroyed&&w.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:w,features:D,featureViewModels:he,view:ve}=this;if(actionUtils_d(w)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),null===D||void 0===D||!D.length)return;const _e=he.slice(0),be=[];D.forEach(((D,he)=>{if(!D)return;let Me=null;if(_e.some(((w,he)=>(w&&w.graphic===D&&(Me=w,_e.splice(he,1)),!!Me))),Me)be[he]=Me;else{const _e=new zi({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null===ve||void 0===ve?void 0:ve.spatialReference,graphic:D===w?D:null,location:this.location,map:null===ve||void 0===ve?void 0:ve.map,view:ve});be[he]=_e}})),_e.forEach((w=>w&&!w.destroyed&&w.destroy())),this._set("featureViewModels",be)}async _getScreenPoint(w,D){const{view:he}=this;await(null===he||void 0===he?void 0:he.when());const ve=null===w||void 0===w?void 0:w.spatialReference,_e=null===he||void 0===he?void 0:he.spatialReference;return ve&&_e?(await(0,Xi.initializeProjection)(ve,_e,null,D),he.toScreen(w)):null}_cancelFetchingFeatures(){const w=this._fetchFeaturesController;w&&w.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures(w){let{mapPoint:D,screenPoint:he,event:ve,signal:_e}=w;return this.fetchFeatures(null!==he&&void 0!==he?he:await this._getScreenPoint(null!==D&&void 0!==D?D:this.location,{signal:_e}),{signal:_e,event:ve})}_fetchFeaturesWithController(w){let{mapPoint:D,screenPoint:he,event:ve}=w;this._cancelFetchingFeatures();const _e=new AbortController,{signal:be}=_e;this._fetchFeaturesController=_e;const Me=this._projectScreenPointAndFetchFeatures({mapPoint:D,screenPoint:he,signal:be,event:ve});return Me.catch((()=>{})).then((()=>{this._fetchFeaturesController=null})),Me}async _fetchFeaturesAndOpen(w){var D;const{mapPoint:he,screenPoint:ve}=w,{view:_e}=this;null!==(D=this._locationScaleHandle)&&void 0!==D&&D.remove(),this._locationScaleHandle=(0,Me.wB)((()=>{var w;return null===(w=this.view)||void 0===w?void 0:w.scale}),(()=>this._debouncedLocationUpdate(he).catch((w=>{(0,Xt.zf)(w)||be.A.getLogger(this).error(w)}))));const{pendingFeatures:Fe}=await this._fetchFeaturesWithController({mapPoint:he,screenPoint:ve,event:w});(null===_e||void 0===_e?void 0:_e.popup)&&"open"in _e.popup&&_e.popup.open({location:null!==he&&void 0!==he?he:void 0,promises:Fe})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(w,D){return await w.when(),w.whenLayerView(D)}_getHighlightLayer(w){const{layer:D,sourceLayer:he}=w;return he&&"layer"in he&&he.layer?he.layer:"map-notes"===(null===he||void 0===he?void 0:he.type)||"subtype-group"===(null===he||void 0===he?void 0:he.type)?he:D}_getHighlightTarget(w,D,he){if(function FeaturesViewModel_U(w,D){return"building-scene"===w||"2d"===D&&("map-image"===w||"tile"===w||"imagery"===w||"imagery-tile"===w)}(D.type,he))return w;const ve=w.getObjectId();if(null!=ve)return ve;const _e="imagery"===D.type?void 0:"objectIdField"in D?D.objectIdField||yn:null,be=w.attributes;return be&&_e&&be[_e]||w}_mapIncludesLayer(w){var D;return!(null===(D=this.view)||void 0===D||null===(D=D.map)||void 0===D||null===(D=D.allLayers)||void 0===D||!D.includes(w))}async _highlightActiveFeature(){const w="highlight-active-feature";this.removeHandles(w);const{highlightEnabled:D,view:he,activeFeature:ve,visible:_e}=this;if(!(ve&&he&&D&&_e))return;const be=this._getHighlightLayer(ve);if(!(be&&be instanceof gn.A&&this._mapIncludesLayer(be)))return;const Me=this._getLayerView(he,be);this._highlightActiveFeaturePromise=Me;const Fe=await Me;if(!(Fe&&(0,Mn.Of)(Fe)&&this._highlightActiveFeaturePromise===Me&&this.activeFeature&&this.highlightEnabled))return;const Ae=Fe.highlight(this._getHighlightTarget(ve,be,he.type));this.addHandles(Ae,w)}async _highlightSelectedFeature(){const w="highlight-selected-feature";this.removeHandles(w);const{selectedFeature:D,highlightEnabled:he,view:ve,visible:_e}=this;if(!(D&&ve&&he&&_e))return;const be=this._getHighlightLayer(D);if(!(be&&be instanceof gn.A&&this._mapIncludesLayer(be)))return;const Me=this._getLayerView(ve,be);this._highlightSelectedFeaturePromise=Me;const Fe=await Me;if(!(Fe&&(0,Mn.Of)(Fe)&&this._highlightSelectedFeaturePromise===Me&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const Ae=Fe.highlight(this._getHighlightTarget(D,be,ve.type));this.addHandles(Ae,w)}_updateFeatures(w){const{features:D}=this,he=w.filter((w=>!D.includes(w)));(null===he||void 0===he?void 0:he.length)&&(this.features=D.concat(he))}};(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"_fetchFeaturesController",void 0),(0,ve._)([(0,Fe.MZ)({type:In})],Sn.prototype,"actions",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"active",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"activeFeature",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"allActions",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"autoCloseEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"autoOpenEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"browseClusterEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"content",void 0),(0,ve._)([(0,Fe.MZ)({type:In,readOnly:!0})],Sn.prototype,"defaultActions",null),(0,ve._)([(0,Fe.MZ)({type:Boolean})],Sn.prototype,"defaultPopupTemplateEnabled",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"featureCount",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"featurePage",void 0),(0,ve._)([(0,Fe.MZ)({value:[]})],Sn.prototype,"features",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"featuresPerPage",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"featureMenuOpen",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"featureViewModelAbilities",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"featureViewModels",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"highlightEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"includeDefaultActions",void 0),(0,ve._)([(0,Fe.MZ)({type:ti.A})],Sn.prototype,"location",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"pendingPromisesCount",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"promiseCount",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"promises",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"selectedClusterBoundaryFeature",void 0),(0,ve._)([(0,Fe.MZ)({value:null,readOnly:!0})],Sn.prototype,"selectedFeature",null),(0,ve._)([(0,Fe.MZ)({value:-1})],Sn.prototype,"selectedFeatureIndex",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"selectedFeatureViewModel",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"state",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"title",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"updateLocationEnabled",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"view",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"visible",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"waitingForContents",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Sn.prototype,"waitingForResult",null),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"zoomFactor",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"zoomToLocation",void 0),(0,ve._)([(0,Fe.MZ)()],Sn.prototype,"centerAtLocation",null),Sn=(0,ve._)([(0,Ae.$)("esri.widgets.Features.FeaturesViewModel")],Sn);const Rn=Sn;let Pn=class extends Ve.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"actionBar",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"closeButton",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"collapseButton",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"featureNavigation",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"flow",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"heading",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Pn.prototype,"spinner",void 0),Pn=(0,ve._)([(0,Ae.$)("esri.widgets.Features.FeaturesVisibleElements")],Pn);const On=Pn;function vmEvent_e(w){return D=>{D.hasOwnProperty("_delegatedEventNames")||(D._delegatedEventNames=D._delegatedEventNames?D._delegatedEventNames.slice():[]);const he=D._delegatedEventNames,ve=Array.isArray(w)?w:function vmEvent_t(w){return w.split(",").map((w=>w.trim()))}(w);he.push(...ve)}}const Nn="selected-index",Bn="features-spinner";let Un=class extends(FeatureContentMixin_n(ke.A)){constructor(w,D){super(w,D),this._featureMenuIntersectionObserverCallback=w=>{let[D]=w;(null===D||void 0===D?void 0:D.isIntersecting)&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new xe.A,this._relatedRecordsWidget=new vn({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new In,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Rn,this.visibleElements=new On,this._renderAction=(w,D)=>{const he=this._getActionTitle(w),{type:ve,active:_e,uid:be,disabled:Me,indicator:Fe}=w;return w.visible?(0,mt.K)("calcite-action",{active:"toggle"===ve&&w.value,appearance:"solid",bind:this,"data-action-uid":be,disabled:Me,icon:this._getActionIcon(w),indicator:Fe,key:"action-".concat(D),loading:_e,onclick:this._triggerAction,scale:"s",text:he,title:this._hideActionText?he:void 0},this._getFallbackIcon(w)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=w=>{this._focusOn===w&&requestAnimationFrame((async()=>{var D,he;switch(w){case"menu-flow-item":await(null===(D=this._featureMenuViewportNode)||void 0===D?void 0:D.setFocus());break;case"root-flow-item":await(null===(he=this._rootFlowItemNode)||void 0===he?void 0:he.setFocus())}this._focusOn=null}))},this._focusFlowItemNodeThrottled=throttle_e(this._focusFlowItemNode,50),this._displaySpinnerThrottled=throttle_e((()=>this._displaySpinner()),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.active}),(()=>this._toggleScreenLocationEnabled())),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.active}),(w=>this._relatedRecordsWidget.closed=!w)),(0,Me.wB)((()=>{var w;return null===(w=this.visibleElements)||void 0===w?void 0:w.closeButton}),(w=>this._relatedRecordsWidget.closable=w)),(0,Me.wB)((()=>{var w;return null===(w=this.visibleElements)||void 0===w?void 0:w.spinner}),(w=>this._spinnerEnabledChange(w))),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.view}),((w,D)=>this._viewChange(w,D))),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w||null===(w=w.view)||void 0===w?void 0:w.ready}),((w,D)=>this._viewReadyChange(null!==w&&void 0!==w&&w,null!==D&&void 0!==D&&D))),(0,Me.wB)((()=>{var w,D;return[null===(w=this.viewModel)||void 0===w?void 0:w.waitingForResult,null===(D=this.viewModel)||void 0===D?void 0:D.location]}),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.screenLocation}),(()=>this._closeOpenActionMenu())),(0,Me.wB)((()=>this.selectedFeatureWidget),(()=>this._destroyRelatedRecordsFlowItemWidgets())),(0,Me.wB)((()=>{var w;const D=null===(w=this.selectedFeatureWidget)||void 0===w?void 0:w.viewModel;return[null===D||void 0===D?void 0:D.title,null===D||void 0===D?void 0:D.state]}),(()=>this._setTitleFromFeatureWidget())),(0,Me.wB)((()=>{var w;const D=null===(w=this.selectedFeatureWidget)||void 0===w?void 0:w.viewModel;return[null===D||void 0===D?void 0:D.content,null===D||void 0===D?void 0:D.state]}),(()=>this._setContentFromFeatureWidget())),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.featureViewModels}),(()=>this._featureMenuViewportScrollTop())),this._relatedRecordsWidget.on("close",(()=>this.close())),this._relatedRecordsWidget.on("exit",(()=>this._destroyRelatedRecordsFlowItemWidgets())),this._relatedRecordsWidget.on("open-related-feature",(w=>{let{feature:D}=w;return this._openRelatedFeature(D)}))])}loadDependencies(){return(0,ct.W)({action:()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(1991)]).then(he.bind(he,1991)),"action-bar":()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(9872),he.e(4098),he.e(350)]).then(he.bind(he,20350)),"action-group":()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(9872),he.e(4098),he.e(2449)]).then(he.bind(he,72449)),button:()=>Promise.all([he.e(463),he.e(616),he.e(1021),he.e(4035)]).then(he.bind(he,94035)),flow:()=>he.e(9529).then(he.bind(he,29529)),"flow-item":()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(9872),he.e(4098),he.e(6135)]).then(he.bind(he,36135)),list:()=>Promise.all([he.e(463),he.e(616),he.e(1021),he.e(4946),he.e(1694)]).then(he.bind(he,91694)),"list-item":()=>Promise.all([he.e(463),he.e(616),he.e(6745),he.e(1979)]).then(he.bind(he,51979)),"list-item-group":()=>he.e(3747).then(he.bind(he,83747)),loader:()=>he.e(7598).then(he.bind(he,47598))})}destroy(){var w,D;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),null!==(w=this._featureMenuIntersectionObserver)&&void 0!==w&&w.disconnect(),null===(D=this._relatedRecordsWidget)||void 0===D||D.destroy()}get _hideActionText(){var w;if(!this.responsiveActionsEnabled)return!1;const D=null===(w=this.view)||void 0===w?void 0:w.widthBreakpoint;return"xsmall"===D||"small"===D||"medium"===D}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(w){this.viewModel.content=w}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(w){this.viewModel.featureMenuOpen=w}get features(){return this.viewModel.features}set features(w){this.viewModel.features=w}get location(){return this.viewModel.location}set location(w){this.viewModel.location=w}get label(){var w,D;return null!==(w=null===(D=this.messages)||void 0===D?void 0:D.widgetLabel)&&void 0!==w?w:""}set label(w){this._overrideIfSome("label",w)}get promises(){return this.viewModel.promises}set promises(w){this.viewModel.promises=w}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(w){this.viewModel.selectedFeatureIndex=w}get selectedFeatureWidget(){const{_feature:w,headingLevel:D,_relatedRecordsFlowItems:he}=this,{selectedFeatureViewModel:ve}=this.viewModel,_e={title:!1};return ve?(w?(w.viewModel=ve,w.visibleElements=_e):this._feature=new Yi({flowItems:he,headingLevel:D+1,viewModel:ve,visibleElements:_e}),this._feature):null}get title(){return this.viewModel.title}set title(w){this.viewModel.title=w}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(w){this.viewModel.updateLocationEnabled=w}get view(){return this.viewModel.view}set view(w){this.viewModel.view=w}get visible(){return this.viewModel.visible}set visible(w){this.viewModel.visible=w}blur(){var w;const{active:D}=this.viewModel;D?null===(w=this._rootFlowItemNode)||void 0===w||w.blur():be.A.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(w,D){return this.viewModel.fetchFeatures(w,D)}focus(){const{active:w}=this.viewModel;w?this._setFocusOn():be.A.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(w){var D;this.removeHandles(Nn);const he={collapsed:null!==(D=null===w||void 0===w?void 0:w.collapsed)&&void 0!==D&&D};this.set(he),this.viewModel.open(w),this.addHandles((0,Me.z7)((()=>!this.viewModel.waitingForResult),(()=>this._addSelectedFeatureIndexHandle()),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(w){return this.viewModel.triggerAction(w)}render(){return(0,mt.K)("div",{bind:this,class:this.classes(hn.base,ut.D.widget,ut.D.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,mt.K)("div",{class:hn.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,mt.K)("div",{class:hn.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:w,viewModel:D}=this,{featureCount:he,selectedFeatureIndex:ve,pendingPromisesCount:_e}=D;return(0,mt.K)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:w.selectFeature,loading:_e>0,onclick:this._openFeatureMenu,scale:"s",text:(0,Le.V)(w.pageText,{index:(0,Ne.ZV)(ve+1),total:(0,Ne.ZV)(he)}),textEnabled:!0,title:w.selectFeature})}_renderPagination(){const{previous:w,next:D}=this.messagesCommon.pagination;return(0,mt.K)("calcite-action-bar",{class:hn.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,mt.K)("calcite-action-group",{scale:"s"},(0,mt.K)("calcite-action",{appearance:"solid",class:hn.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:w,onclick:this._previousFeature,scale:"s",text:w,title:w}),(0,mt.K)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:D,onclick:this._nextFeature,scale:"s",text:D,title:D})))}_renderFeatureMenuItem(w){const{selectedFeatureViewModel:D,featureViewModels:he}=this.viewModel,ve=w===D,_e=he.indexOf(w);return(0,mt.K)("calcite-list-item",{bind:this,"data-feature-index":_e,key:"feature-menu-item-".concat(w.uid),onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:ve,onCalciteListItemSelect:this._selectFeature},(0,mt.K)("span",{innerHTML:w.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:w}=this.viewModel,D=new Map;return w.forEach((w=>{var he,ve;const _e=null===w||void 0===w?void 0:w.graphic;if(!_e)return;const be=null!==(he=_e.sourceLayer)&&void 0!==he?he:_e.layer,Me=null!==(ve=D.get(be))&&void 0!==ve?ve:[];D.set(be,[...Me,w])})),D}_renderFeatureMenu(){const{featureViewModels:w}=this.viewModel,D=this._groupResultsByLayer();return w.length?(0,mt.K)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(D.keys()).map((w=>{var he,ve;return(0,mt.K)("calcite-list-item-group",{heading:null!==(he=null===w||void 0===w?void 0:w.title)&&void 0!==he?he:this.messagesCommon.untitled,key:(null===w||void 0===w?void 0:w.uid)||"untitled"},null===(ve=D.get(w))||void 0===ve?void 0:ve.map((w=>this._renderFeatureMenuItem(w))))}))):null}_renderHeaderAction(w,D){return w.visible?(0,mt.K)("calcite-action",{active:"toggle"===w.type&&w.value,appearance:"solid",bind:this,"data-action-uid":w.uid,disabled:w.disabled,icon:w.icon||"",indicator:w.indicator,key:"header-action-".concat(D),loading:w.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:w.title||"",title:w.title||""}):null}_renderHeaderActions(){return this.headerActions.map(((w,D)=>this._renderHeaderAction(w,D))).toArray()}_renderContentFeature(){const{headingLevel:w,visibleElements:D,_isCollapsed:he,_collapseEnabled:ve,featureNavigationTop:_e}=this,{title:be,active:Me}=this.viewModel,Fe=D.heading&&be?be:"";return(0,mt.K)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[hn.contentFeature]:!0,[hn.flowItemCollapsed]:he}),closable:D.closeButton,closed:!Me,collapsed:he,collapseDirection:_e?"down":"up",collapsible:ve,headingLevel:w,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},Fe?(0,mt.K)(Heading_e,{class:this.classes(hn.featuresHeading,ut.D.heading),innerHTML:Fe,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),he?null:(0,mt.K)("div",{class:this.classes(hn.container,hn.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:w,featureMenuOpen:D,messages:he,messagesCommon:ve}=this,{active:_e,featureViewModels:be,pendingPromisesCount:Me}=w;return D?(0,mt.K)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!_e,description:(0,Le.V)(he.total,{total:be.length}),heading:he.selectFeature,key:"feature-menu",loading:w.waitingForContents,onCalciteFlowItemBack:w=>{w.preventDefault(),this._handleFeatureMenuBack()}},Me>0?(0,mt.K)("calcite-loader",{class:hn.loader,inline:!0,key:"feature-menu-loader",label:ve.loading,scale:"m",slot:"header-actions-end"}):null,(0,mt.K)("div",{class:hn.container},this._renderFeatureMenu()),(0,mt.K)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:hn.featureMenuObserver}),(0,mt.K)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},ve.back)):null}_renderContentContainer(){const w=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,mt.K)("calcite-flow",{key:"content-container"},w):w}_getFallbackIcon(w){const{className:D,icon:he}=w;if(he)return null;const ve=function actionUtils_e(w){let{action:D,feature:he}=w;const ve=null===he||void 0===he?void 0:he.attributes,_e="image"in D?D.image:void 0;return _e&&ve?(0,Le.V)(_e,ve):null!==_e&&void 0!==_e?_e:""}({action:w,feature:this.selectedFeature}),_e={[hn.icon]:!!D,[hn.actionImage]:!!ve};return D&&(_e[D]=!0),ve||D?(0,mt.K)("span",{"aria-hidden":"true",class:this.classes(hn.icon,_e),key:"icon",styles:actionUtils_n(ve)}):null}_renderActionBar(){var w;return!this._isCollapsed&&this.visibleElements.actionBar&&null!==(w=this.viewModel.allActions)&&void 0!==w&&w.length?(0,mt.K)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,mt.K)("calcite-action-group",{afterCreate:w=>this._actionBarMenuNode=w,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var w;const D=null===(w=this.viewModel)||void 0===w?void 0:w.content;return D?"string"==typeof D?(0,mt.K)("div",{class:Wi.contentNode,innerHTML:D,key:D}):this.renderNodeContent(D):null}_setFocusOn(){this.renderNow(),requestAnimationFrame((()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"}))}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(w){await w.viewModel.updateGeometry();const D=w.graphic,he=null===D||void 0===D?void 0:D.geometry;if(null==he||null==D)return;this._destroyRelatedRecordsFlowItemWidgets(),await this.viewModel.zoomTo({target:he});const ve=geometryUtils_n(he);this.open({features:[D],location:null!=ve?ve:void 0})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(w){this._rootFlowItemNode=w,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(w){this._featureMenuViewportNode=w,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(w){var D;const{viewModel:he}=this,ve=w.currentTarget["data-feature-index"];he.activeFeature=(null===(D=he.features)||void 0===D?void 0:D[ve])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(w){const D=w.currentTarget["data-feature-index"];isNaN(D)||(this.viewModel.selectedFeatureIndex=D),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(w){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(w),this._featureMenuIntersectionObserverNode=w}_getActionIcon(w){return w.icon?w.icon:w.image||w.className?void 0:"question"}_getActionTitle(w){var D;const{messages:he,selectedFeature:ve,messagesCommon:_e}=this,{id:be}=w,Me=null===ve||void 0===ve?void 0:ve.attributes,Fe=null!==(D=w.title)&&void 0!==D?D:"",Ae="zoom-to-feature"===be?(0,Le.V)(Fe,{messages:he}):"remove-selected-feature"===be?(0,Le.V)(Fe,{messages:_e}):"zoom-to-clustered-features"===be||"browse-clustered-features"===be?(0,Le.V)(Fe,{messages:he}):w.title;return Ae&&Me?(0,Le.V)(Ae,Me):null!==Ae&&void 0!==Ae?Ae:""}_onMainKeydown(w){const{key:D}=w;"ArrowLeft"===D&&(w.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===D&&(w.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:w}=this;w&&(this.viewModel.content=w)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:w,messagesCommon:D}=this,he=null===w||void 0===w?void 0:w.viewModel;w&&(this.viewModel.title="error"===(null===he||void 0===he?void 0:he.state)?null===D||void 0===D?void 0:D.errorMessage:(null===he||void 0===he?void 0:he.title)||"")}_addSelectedFeatureIndexHandle(){const w=(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.selectedFeatureIndex}),((w,D)=>this._selectedFeatureIndexUpdated(w,D)));this.addHandles(w,Nn)}_selectedFeatureIndexUpdated(w,D){const{featureCount:he}=this.viewModel;he&&w!==D&&-1!==w&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(w){const D=w.currentTarget;if(D.disabled)return;const he=D.dataset.actionUid,ve=this.headerActions.find((w=>{let{uid:D}=w;return D===he}));ve&&!ve.disabled&&("toggle"===(null===ve||void 0===ve?void 0:ve.type)&&(ve.value=!ve.value),this.emit("trigger-header-action",{action:ve}))}_triggerAction(w){const D=w.currentTarget;if(D.disabled)return;const he=D.dataset.actionUid,{allActions:ve}=this.viewModel,_e=ve.findIndex((w=>w.uid===he)),be=ve.at(_e);be&&"toggle"===be.type&&(be.value=!be.value),this.viewModel.triggerAction(_e)}_createSpinner(w){w&&(this._spinner=new cn({view:w}),w.ui.add(this._spinner,{key:Bn,position:"manual",internal:!0}))}_wireUpView(w){var D;this._destroySpinner(),w&&(null===(D=this.visibleElements)||void 0===D?void 0:D.spinner)&&this._createSpinner(w)}_hideSpinner(){const{_spinner:w}=this;w&&(w.location=null,w.hide())}_viewReadyChange(w,D){var he;w?this._wireUpView(null===(he=this.viewModel)||void 0===he?void 0:he.view):D&&this.viewModel.clear()}_viewChange(w,D){w&&D&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:w}=this;w&&(w.viewModel=null,!w.destroyed&&w.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:w}=this;w&&(w.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach((w=>{"showAllEnabled"in w.viewModel&&(w.viewModel.showAllEnabled=!1),w.viewModel=null,w.destroy()}))}_toggleScreenLocationEnabled(){const{viewModel:w}=this;w&&(w.screenLocationEnabled=w.active)}_displaySpinner(){const{_spinner:w}=this;if(!w)return;const{location:D,waitingForResult:he}=this.viewModel;he&&D?w.show({location:D}):w.hide()}_destroySpinner(){var w;const{_spinner:D,view:he}=this;D&&(null!==he&&void 0!==he&&null!==(w=he.ui)&&void 0!==w&&w.remove(D,Bn),D.destroy(),this._spinner=null)}_spinnerEnabledChange(w){var D;this._destroySpinner(),w&&this._createSpinner(null===(D=this.viewModel)||void 0===D?void 0:D.view)}};(0,ve._)([(0,Fe.MZ)()],Un.prototype,"_focusOn",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"_relatedRecordsFlowItems",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"_hideActionText",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"_featureNavigationVisible",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"_isCollapsed",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"_collapseEnabled",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"collapsed",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"content",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"icon",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"featureMenuOpen",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"featureNavigationTop",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"features",null),(0,ve._)([(0,Fe.MZ)({type:In})],Un.prototype,"headerActions",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"headingLevel",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"location",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"label",null),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Features/t9n/Features")],Un.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/t9n/common")],Un.prototype,"messagesCommon",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"promises",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"responsiveActionsEnabled",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Un.prototype,"selectedFeature",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"selectedFeatureIndex",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Un.prototype,"selectedFeatureWidget",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"title",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"updateLocationEnabled",null),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"view",null),(0,ve._)([(0,Fe.MZ)({type:Rn}),vmEvent_e(["triggerAction","trigger-action"])],Un.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)({type:On,nonNullable:!0})],Un.prototype,"visibleElements",void 0),(0,ve._)([(0,Fe.MZ)()],Un.prototype,"visible",null),Un=(0,ve._)([(0,Ae.$)("esri.widgets.Features")],Un);const Vn=Un,Dn="esri-popup",qn="".concat(Dn,"--is-docked"),Kn={base:Dn,main:"".concat(Dn,"__main-container"),shadow:"".concat(Dn,"--shadow"),isDocked:qn,isDockedTopLeft:"".concat(qn,"-top-left"),isDockedTopCenter:"".concat(qn,"-top-center"),isDockedTopRight:"".concat(qn,"-top-right"),isDockedBottomLeft:"".concat(qn,"-bottom-left"),isDockedBottomCenter:"".concat(qn,"-bottom-center"),isDockedBottomRight:"".concat(qn,"-bottom-right"),alignTopCenter:"".concat(Dn,"--aligned-top-center"),alignBottomCenter:"".concat(Dn,"--aligned-bottom-center"),alignTopLeft:"".concat(Dn,"--aligned-top-left"),alignBottomLeft:"".concat(Dn,"--aligned-bottom-left"),alignTopRight:"".concat(Dn,"--aligned-top-right"),alignBottomRight:"".concat(Dn,"--aligned-bottom-right"),pointer:"".concat(Dn,"__pointer"),pointerDirection:"".concat(Dn,"__pointer-direction")};let zn=class extends Rn{constructor(w){super(w)}};zn=(0,ve._)([(0,Ae.$)("esri.widgets.Popup.PopupViewModel")],zn);const jn=zn;let Wn=class extends Ve.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Wn.prototype,"actionBar",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Wn.prototype,"closeButton",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Wn.prototype,"collapseButton",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Wn.prototype,"featureNavigation",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Wn.prototype,"heading",void 0),(0,ve._)([(0,Fe.MZ)({type:Boolean,nonNullable:!0})],Wn.prototype,"spinner",void 0),Wn=(0,ve._)([(0,Ae.$)("esri.widgets.Features.PopupVisibleElements")],Wn);const Hn=Wn,Gn={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let Qn=class extends ke.A{constructor(w,D){super(w,D),this._dockAction=new Ce.A({id:"popup-dock-action"}),this._featuresWidget=new Vn({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new jn,this.visibleElements=new Hn}initialize(){this.addHandles([(0,Me.wB)((()=>{var w;return[null===(w=this.viewModel)||void 0===w||null===(w=w.view)||void 0===w?void 0:w.widthBreakpoint,this.dockEnabled]}),(()=>this._handleDockIcon()),Me.Vh),(0,Me.wB)((()=>{var w,D;return[this.dockEnabled,null===(w=this.messages)||void 0===w?void 0:w.undock,null===(D=this.messages)||void 0===D?void 0:D.dock]}),(()=>this._handleDockEnabled()),Me.Vh),(0,Me.wB)((()=>this.dockOptions),(w=>{const{_dockAction:D}=this,he=this._featuresWidget.headerActions;he.remove(D),w.buttonEnabled&&he.add(D)}),Me.Vh),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.screenLocation}),(()=>this._positionContainer())),(0,Me.wB)((()=>{var w;return[null===(w=this.viewModel)||void 0===w?void 0:w.active,this.dockEnabled]}),(()=>this._toggleScreenLocationEnabled())),(0,Me.wB)((()=>{var w,D,he,ve,_e;return[null===(w=this.viewModel)||void 0===w?void 0:w.screenLocation,null===(D=this.viewModel)||void 0===D||null===(D=D.view)||void 0===D?void 0:D.padding,null===(he=this.viewModel)||void 0===he||null===(he=he.view)||void 0===he?void 0:he.size,null===(ve=this.viewModel)||void 0===ve?void 0:ve.active,null===(_e=this.viewModel)||void 0===_e?void 0:_e.location,this.alignment]}),(()=>this.reposition())),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w||null===(w=w.view)||void 0===w?void 0:w.size}),((w,D)=>this._updateDockEnabledForViewSize(w,D))),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w?void 0:w.view}),((w,D)=>this._viewChange(w,D))),(0,Me.wB)((()=>{var w;return null===(w=this.viewModel)||void 0===w||null===(w=w.view)||void 0===w?void 0:w.ready}),((w,D)=>this._viewReadyChange(null!==w&&void 0!==w&&w,null!==D&&void 0!==D&&D))),(0,Me.wB)((()=>this.viewModel),(()=>this._featuresWidget.viewModel=this.viewModel),Me.Vh),(0,Me.wB)((()=>this._featureNavigationTop),(w=>this._featuresWidget.featureNavigationTop=w),Me.Vh),(0,Me.wB)((()=>this.headingLevel),(w=>this._featuresWidget.headingLevel=w),Me.Vh),(0,Me.wB)((()=>this.collapsed),(w=>this._featuresWidget.collapsed=w),Me.Vh),(0,Me.wB)((()=>this.visibleElements.actionBar),(w=>this._featuresWidget.visibleElements.actionBar=!!w),Me.Vh),(0,Me.wB)((()=>this.visibleElements.closeButton),(w=>this._featuresWidget.visibleElements.closeButton=!!w),Me.Vh),(0,Me.wB)((()=>this.visibleElements.collapseButton),(w=>this._featuresWidget.visibleElements.collapseButton=!!w),Me.Vh),(0,Me.wB)((()=>this.visibleElements.heading),(w=>this._featuresWidget.visibleElements.heading=!!w),Me.Vh),(0,Me.wB)((()=>this.visibleElements.spinner),(w=>this._featuresWidget.visibleElements.spinner=!!w),Me.Vh),(0,Me.wB)((()=>this.visibleElements.featureNavigation),(w=>this._featuresWidget.visibleElements.featureNavigation=!!w),Me.Vh),(0,Me.on)((()=>this._featuresWidget),"trigger-header-action",(w=>{w.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)}))])}normalizeCtorArgs(w){const D={...w};return null!=(null===w||void 0===w?void 0:w.visibleElements)&&(D.visibleElements=new Hn(w.visibleElements),null!=w.collapseEnabled&&(D.visibleElements.collapseButton=w.collapseEnabled),null!=w.spinnerEnabled&&(D.visibleElements.spinner=w.spinnerEnabled)),D}destroy(){var w;this._dockAction.destroy(),null===(w=this._featuresWidget)||void 0===w||w.destroy()}get _featureNavigationTop(){const{currentAlignment:w,currentDockPosition:D}=this;return"bottom-left"===w||"bottom-center"===w||"bottom-right"===w||"top-left"===D||"top-center"===D||"top-right"===D}get actions(){return this.viewModel.actions}set actions(w){this.viewModel.actions=w}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(w){this.viewModel.autoCloseEnabled=w}get autoOpenEnabled(){return(0,_e.Lx)(be.A.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(w){(0,_e.Lx)(be.A.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=w}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(w){this.viewModel.defaultPopupTemplateEnabled=w}get content(){return this.viewModel.content}set content(w){this.viewModel.content=w}get collapseEnabled(){return(0,_e.Lx)(be.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(w){(0,_e.Lx)(be.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=w}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Gn}set dockOptions(w){var D;const he={...Gn},ve=null===(D=this.viewModel)||void 0===D||null===(D=D.view)||void 0===D?void 0:D.breakpoints,_e={};ve&&(_e.width=ve.xsmall,_e.height=ve.xsmall);const be={...he,...w},Me={...he.breakpoint,..._e},{breakpoint:Fe}=be;"object"==typeof Fe?be.breakpoint={...Me,...Fe}:Fe&&(be.breakpoint=Me),this._set("dockOptions",be),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(w){this.viewModel.featureMenuOpen=w}get features(){return this.viewModel.features}set features(w){this.viewModel.features=w}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(w){this.viewModel.goToOverride=w}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(w){this.viewModel.highlightEnabled=w}get location(){return this.viewModel.location}set location(w){this.viewModel.location=w}get label(){var w,D;return null!==(w=null===(D=this.messages)||void 0===D?void 0:D.widgetLabel)&&void 0!==w?w:""}set label(w){this._overrideIfSome("label",w)}get promises(){return this.viewModel.promises}set promises(w){this.viewModel.promises=w}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(w){this.viewModel.selectedFeatureIndex=w}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,_e.Lx)(be.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(w){(0,_e.Lx)(be.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=w}get title(){return this.viewModel.title}set title(w){this.viewModel.title=w}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(w){this.viewModel.updateLocationEnabled=w}get view(){return this.viewModel.view}set view(w){this.viewModel.view=w}get visible(){return this.viewModel.visible}set visible(w){this.viewModel.visible=w}blur(){const{active:w}=this.viewModel;w||be.A.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(w,D){return this.viewModel.fetchFeatures(w,D)}focus(){const{active:w}=this.viewModel;w||be.A.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame((()=>{this._featuresWidget.focus()}))}next(){return this.viewModel.next()}open(w){const D=!!w&&!!w.featureMenuOpen,he={collapsed:!!w&&!!w.collapsed,featureMenuOpen:D};this.set(he),this.viewModel.open(w),this._shouldFocus(w)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(w){return this.viewModel.triggerAction(w)}render(){var w,D;const{dockEnabled:he,currentAlignment:ve,currentDockPosition:_e}=this,{active:be}=this.viewModel,Me=be&&he,Fe=be&&!he,Ae=null===(w=this.selectedFeature)||void 0===w||null===(w=w.layer)||void 0===w?void 0:w.title,Ce=null===(D=this.selectedFeature)||void 0===D||null===(D=D.layer)||void 0===D?void 0:D.id,xe={[Kn.alignTopCenter]:"top-center"===ve,[Kn.alignBottomCenter]:"bottom-center"===ve,[Kn.alignTopLeft]:"top-left"===ve,[Kn.alignBottomLeft]:"bottom-left"===ve,[Kn.alignTopRight]:"top-right"===ve,[Kn.alignBottomRight]:"bottom-right"===ve,[Kn.isDocked]:Me,[Kn.shadow]:Fe,[Kn.isDockedTopLeft]:"top-left"===_e,[Kn.isDockedTopCenter]:"top-center"===_e,[Kn.isDockedTopRight]:"top-right"===_e,[Kn.isDockedBottomLeft]:"bottom-left"===_e,[Kn.isDockedBottomCenter]:"bottom-center"===_e,[Kn.isDockedBottomRight]:"bottom-right"===_e};return(0,mt.K)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(Kn.base,xe),"data-layer-id":Ce,"data-layer-title":Ae,role:"presentation"},be?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,mt.K)("div",{class:Kn.pointer,key:"popup-pointer",role:"presentation"},(0,mt.K)("div",{class:this.classes(Kn.pointerDirection,Kn.shadow)}))}_renderMainContainer(){const{dockEnabled:w}=this,D={[Kn.shadow]:w};return(0,mt.K)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(Kn.main,ut.D.widget,D)},this._featuresWidget.render())}async _shouldFocus(w){(null===w||void 0===w?void 0:w.shouldFocus)&&(await(0,Me.C_)((()=>{var w;return!0===(null===(w=this.viewModel)||void 0===w?void 0:w.active)})),this.focus())}_isOutsideView(w){const{popupHeight:D,popupWidth:he,screenLocation:ve,side:_e,view:be}=w;if(isNaN(he)||isNaN(D)||!be||!ve)return!1;const Me=be.padding;return"right"===_e&&ve.x+he/2>be.width-Me.right||"left"===_e&&ve.x-he/2<Me.left||"top"===_e&&ve.y-D<Me.top||"bottom"===_e&&ve.y+D>be.height-Me.bottom}_calculateAutoAlignment(w){if("auto"!==w)return w;const{_pointerOffsetInPx:D,_containerNode:he,_mainContainerNode:ve,viewModel:_e}=this,{screenLocation:be,view:Me}=_e;if(null==be||!Me||!he)return"top-center";function l(w){return parseInt(w.replaceAll(/[^-\d\.]/g,""),10)}const Fe=ve?window.getComputedStyle(ve,null):null,Ae=Fe?l(Fe.getPropertyValue("max-height")):0,Ce=Fe?l(Fe.getPropertyValue("height")):0,{height:xe,width:Le}=he.getBoundingClientRect(),Ee=Le+D,ke=Math.max(xe,Ae,Ce)+D,Ze=this._isOutsideView({popupHeight:ke,popupWidth:Ee,screenLocation:be,side:"right",view:Me}),Se=this._isOutsideView({popupHeight:ke,popupWidth:Ee,screenLocation:be,side:"left",view:Me}),Re=this._isOutsideView({popupHeight:ke,popupWidth:Ee,screenLocation:be,side:"top",view:Me}),Pe=this._isOutsideView({popupHeight:ke,popupWidth:Ee,screenLocation:be,side:"bottom",view:Me});return Se?Re?"bottom-right":"top-right":Ze?Re?"bottom-left":"top-left":Re?Pe?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(w){return"function"==typeof w?w.call(this):w}_getCurrentAlignment(){const{alignment:w,dockEnabled:D}=this;return D||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(w)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(w){const D=["left","right"];return(0,pt.V8)(this.container)&&D.reverse(),null===w||void 0===w?void 0:w.replace(/leading/gi,D[0]).replaceAll(/trailing/gi,D[1])}_callDockPosition(w){return"function"==typeof w?w.call(this):w}_getDockPosition(){var w;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null===(w=this.dockOptions)||void 0===w?void 0:w.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(w){var D;if("auto"!==w)return w;const he=null===(D=this.viewModel)||void 0===D?void 0:D.view,ve=(0,pt.V8)(this.container)?"top-left":"top-right";if(!he)return ve;const _e=he.padding||{left:0,right:0,top:0,bottom:0},be=he.width-_e.left-_e.right,{breakpoints:Me}=he;return Me&&be<=Me.xsmall?"bottom-center":ve}_getDockIcon(){const w=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(w){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var w,D;this._dockAction.title=this.dockEnabled?null===(w=this.messages)||void 0===w?void 0:w.undock:null===(D=this.messages)||void 0===D?void 0:D.dock}_setMainContainerNode(w){this._mainContainerNode=w}_positionContainer(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(w&&(this._containerNode=w),!this._containerNode)return;const{screenLocation:D}=this.viewModel,{width:he}=this._containerNode.getBoundingClientRect(),ve=this._calculatePositionStyle(D,he);ve&&Object.assign(this._containerNode.style,ve)}_calculateFullWidth(w){const{currentAlignment:D,_pointerOffsetInPx:he}=this;return"top-left"===D||"bottom-left"===D||"top-right"===D||"bottom-right"===D?w+he:w}_calculateAlignmentPosition(w,D,he,ve){const{currentAlignment:_e,_pointerOffsetInPx:be}=this;if(!he)return;const{padding:Me}=he,Fe=ve/2,Ae=he.height-D,Ce=he.width-w;return"bottom-center"===_e?{top:D+be-Me.top,left:w-Fe-Me.left}:"top-left"===_e?{bottom:Ae+be-Me.bottom,right:Ce+be-Me.right}:"bottom-left"===_e?{top:D+be-Me.top,right:Ce+be-Me.right}:"top-right"===_e?{bottom:Ae+be-Me.bottom,left:w+be-Me.left}:"bottom-right"===_e?{top:D+be-Me.top,left:w+be-Me.left}:"top-center"===_e?{bottom:Ae+be-Me.bottom,left:w-Fe-Me.left}:void 0}_calculatePositionStyle(w,D){const{dockEnabled:he,view:ve}=this;if(!ve)return;if(he)return{left:"",top:"",right:"",bottom:""};if(null==w||!D)return;const _e=this._calculateFullWidth(D),be=this._calculateAlignmentPosition(w.x,w.y,ve,_e);return be?{top:void 0!==be.top?"".concat(be.top,"px"):"auto",left:void 0!==be.left?"".concat(be.left,"px"):"auto",bottom:void 0!==be.bottom?"".concat(be.bottom,"px"):"auto",right:void 0!==be.right?"".concat(be.right,"px"):"auto"}:void 0}_viewChange(w,D){w&&D&&(this.close(),this.clear())}_viewReadyChange(w,D){w?this._wireUpView():D&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(w,D,he){const[ve,_e]=w,[be,Me]=D,{width:Fe=0,height:Ae=0}=null!==he&&void 0!==he?he:{};return ve<=Fe&&be>Fe||ve>Fe&&be<=Fe||_e<=Ae&&Me>Ae||_e>Ae&&Me<=Ae}_updateDockEnabledForViewSize(w,D){var he;if(!w||!D)return;const ve=(null===(he=this.viewModel)||void 0===he||null===(he=he.view)||void 0===he?void 0:he.padding)||{left:0,right:0,top:0,bottom:0},_e=ve.left+ve.right,be=ve.top+ve.bottom,Me=[],Fe=[];Me[0]=w[0]-_e,Me[1]=w[1]-be,Fe[0]=D[0]-_e,Fe[1]=D[1]-be;const{dockOptions:Ae}=this,Ce=Ae.breakpoint;this._dockingThresholdCrossed(Me,Fe,Ce)&&this._setDockEnabledForViewSize(Ae),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:w,viewModel:D}=this;if(!D)return;const he=D.active&&!w;D.screenLocationEnabled=he}_shouldDockAtCurrentViewSize(w){var D,he,ve;const _e=w.breakpoint,be=null===(D=this.viewModel)||void 0===D||null===(D=D.view)||void 0===D?void 0:D.ui;if(!be)return!1;const{width:Me,height:Fe}=be;if(isNaN(Me)||isNaN(Fe))return!1;if(!_e)return!1;const Ae=_e.hasOwnProperty("width")&&Me<=(null!==(he=_e.width)&&void 0!==he?he:0),Ce=_e.hasOwnProperty("height")&&Fe<=(null!==(ve=_e.height)&&void 0!==ve?ve:0);return Ae||Ce}_setDockEnabledForViewSize(w){w.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(w))}};(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Qn.prototype,"_featureNavigationTop",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"actions",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"alignment",void 0),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"autoCloseEnabled",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"autoOpenEnabled",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"defaultPopupTemplateEnabled",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"content",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"collapsed",void 0),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"collapseEnabled",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Qn.prototype,"currentAlignment",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Qn.prototype,"currentDockPosition",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"dockOptions",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"dockEnabled",void 0),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Qn.prototype,"featureCount",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"featureMenuOpen",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"features",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"goToOverride",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"headingLevel",void 0),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"highlightEnabled",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"location",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"label",null),(0,ve._)([(0,Fe.MZ)(),(0,vt.G)("esri/widgets/Popup/t9n/Popup")],Qn.prototype,"messages",void 0),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"promises",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Qn.prototype,"selectedFeature",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"selectedFeatureIndex",null),(0,ve._)([(0,Fe.MZ)({readOnly:!0})],Qn.prototype,"selectedFeatureWidget",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"spinnerEnabled",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"title",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"updateLocationEnabled",null),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"view",null),(0,ve._)([(0,Fe.MZ)({type:jn}),vmEvent_e(["triggerAction","trigger-action"])],Qn.prototype,"viewModel",void 0),(0,ve._)([(0,Fe.MZ)()],Qn.prototype,"visible",null),(0,ve._)([(0,Fe.MZ)({type:Hn,nonNullable:!0})],Qn.prototype,"visibleElements",void 0),Qn=(0,ve._)([(0,Ae.$)("esri.widgets.Popup")],Qn);const $n=Qn}}]);
//# sourceMappingURL=798.a7377ba2.chunk.js.map