"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[223],{16906:(w,P,S)=>{S.d(P,{X_:()=>i,i1:()=>o,zx:()=>d});var R=S(48237),M=S(49049);const C=96;function i(w,P){const S=P||w.extent,R=w.width,I=(0,M.GA)(null===S||void 0===S?void 0:S.spatialReference);return S&&R?S.width/R*I*M.dy*C:0}function o(w,P){return w/((0,M.GA)(P)*M.dy*C)}function d(w,P,S){return function a(w,P){return 0===P||(0,R.Sp)(w,P)||w<P}(w,P)&&function p(w,P){return 0===P||(0,R.Sp)(w,P)||w>P}(w,S)}},9607:(w,P,S)=>{S.d(P,{A:()=>B});var R,M=S(80671),C=S(83375),I=S(66004),U=S(57453),V=S(6493),z=S(68682);let k=R=class extends C.oY{constructor(w){super(w),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new R({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,I.o8)(this.values),isSlice:this.isSlice})}};(0,M._)([(0,U.MZ)({type:String,json:{write:!0}})],k.prototype,"variableName",void 0),(0,M._)([(0,U.MZ)({type:String,json:{write:!0}})],k.prototype,"dimensionName",void 0),(0,M._)([(0,U.MZ)({type:V.gK.array(V.gK.oneOf([V.gK.native(Number),V.gK.array(V.gK.native(Number))])),json:{write:!0}})],k.prototype,"values",void 0),(0,M._)([(0,U.MZ)({type:Boolean,json:{write:!0}})],k.prototype,"isSlice",void 0),k=R=(0,M._)([(0,z.$)("esri.layers.support.DimensionalDefinition")],k);const B=k},63741:(w,P,S)=>{S.d(P,{jX:()=>s,zo:()=>h,gd:()=>m,ph:()=>i,no:()=>x,kz:()=>u,ht:()=>a,yo:()=>g});S(30174);var R=S(13804),M=S(57264);const C=new Map,I=new class t{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=w,this._interval=Math.min(w,P)}decreaseRefCount(w,P){const S=w+"/"+P,R=this._cachedBlocks;if(R.has(S)){const w=R.get(S);return w.refCount--,w.refCount<=0&&(R.delete(S),w.controller&&w.controller.abort()),w.refCount}return 0}getBlock(w,P){const S=w+"/"+P,R=this._cachedBlocks;if(R.has(S)){const w=R.get(S);return w.ts=Date.now(),w.refCount++,R.delete(S),R.set(S,w),w.block}return null}putBlock(w,P,S,R){const M=this._cachedBlocks,C=w+"/"+P;if(M.has(C)){const w=M.get(C);w.ts=Date.now(),w.refCount++}else M.set(C,{block:S,ts:Date.now(),refCount:1,controller:R});this._trim(),this._updateTimer()}deleteBlock(w,P){const S=this._cachedBlocks,R=w+"/"+P;S.has(R)&&S.delete(R)}updateMaxSize(w){this._size=w,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const w=this._cachedBlocks;this._timer=setInterval((()=>{const P=Array.from(w),S=Date.now();for(let R=0;R<P.length&&P[R][1].ts<=S-this._duration;R++)w.delete(P[R][0]);0===w.size&&this._clearTimer()}),this._interval)}_trim(){const w=this._cachedBlocks;if(-1===this._size||this._size>=w.size)return;const P=Array.from(w);for(let S=0;S<P.length-this._size;S++)w.delete(P[S][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function i(w,P){return null==P?w:"".concat(w,"?sliceId=").concat(P)}function u(w,P){const S={extent:null,rasterInfo:P,cache:new Map},R=C.get(w);return R?(R.push(S),R.length-1):(C.set(w,[S]),0)}function a(w,P){const S=C.get(w);S&&(S[P]=null,S.some((w=>null!=w))||C.delete(w))}function s(w,P,S){var R;const M=C.get(w);if(!M)return null==P?I.decreaseRefCount(w,S):0;if(null==P||null==M[P])return I.decreaseRefCount(w,S);const U=null===(R=M[P])||void 0===R?void 0:R.cache,V=null===U||void 0===U?void 0:U.get(S);if(U&&V){if(V.refCount--,0===V.refCount){U.delete(S);for(let w=0;w<M.length;w++){var z;null===(z=M[w])||void 0===z||z.cache.delete(S)}V.controller&&V.controller.abort()}return V.refCount}return 0}function m(w,P,S){var R;const M=C.get(w);if(!M)return null==P?I.getBlock(w,S):null;if(null==P||null==M[P]){for(let w=0;w<M.length;w++){var U;const P=null===(U=M[w])||void 0===U?void 0:U.cache.get(S);if(P)return P.refCount++,P.block}return I.getBlock(w,S)}const V=null===(R=M[P])||void 0===R?void 0:R.cache.get(S);if(V)return V.refCount++,V.block;for(let C=0;C<M.length;C++){var z;if(C===P||!M[C])continue;const w=null===(z=M[C])||void 0===z?void 0:z.cache,R=null===w||void 0===w?void 0:w.get(S);if(w&&R)return R.refCount++,w.set(S,R),R.block}return null}function x(w,P,S,R){var M;let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const V=C.get(w);if(!V)return void(null==P&&I.putBlock(w,S,R,U));if(null==P||null==V[P])return void I.putBlock(w,S,R,U);const z={refCount:1,block:R,isResolved:!1,isRejected:!1,controller:U};R.then((()=>z.isResolved=!0)).catch((()=>z.isRejected=!0)),null===(M=V[P])||void 0===M||M.cache.set(S,z)}function h(w,P,S){var R;const M=C.get(w);M?null!=P&&null!=M[P]?null===(R=M[P])||void 0===R||R.cache.delete(S):I.deleteBlock(w,S):null==P&&I.deleteBlock(w,S)}function d(w,P){var S;const R=C.get(w);return R&&null!==(S=R[P])&&void 0!==S?S:null}function g(w,P,S,C,I,U){var V;let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const k=d(w,P);if(!k)return;const B=k.extent,{cache:L,rasterInfo:G}=k;if(B&&B.xmin===S.xmin&&B.xmax===S.xmax&&B.ymin===S.ymin&&B.ymax===S.ymax)return;C=null!==(V=C)&&void 0!==V?V:0;const N=S.clone().normalize(),{spatialReference:j,transform:Z}=G,q=new Set;for(let W=0;W<N.length;W++){const w=N[W];if(w.xmax-w.xmin<=C||w.ymax-w.ymin<=C)continue;let P=(0,R._l)(w,j,z);null!=Z&&(P=Z.inverseTransform(P));const S=new M.A({x:C,y:C,spatialReference:w.spatialReference});if(null==I&&!(I=(0,R.Wo)(S,j,w,z)))return;const{pyramidLevel:V,pyramidResolution:k,excessiveReading:B}=(0,R.t$)(I,G,U||"closest");if(B)return;const{storageInfo:L}=G,{origin:H}=L,Q={x:Math.max(0,Math.floor((P.xmin-H.x)/k.x)),y:Math.max(0,Math.floor((H.y-P.ymax)/k.y))},Y=Math.ceil((P.xmax-P.xmin)/k.x-.1),$=Math.ceil((P.ymax-P.ymin)/k.y-.1),K=V>0?L.pyramidBlockWidth:L.blockWidth,J=V>0?L.pyramidBlockHeight:L.blockHeight,X=1,ee=Math.max(0,Math.floor(Q.x/K)-X),te=Math.max(0,Math.floor(Q.y/J)-X),se=Math.floor((Q.x+Y-1)/K)+X,re=Math.floor((Q.y+$-1)/J)+X;for(let R=te;R<=re;R++)for(let w=ee;w<=se;w++)q.add("".concat(V,"/").concat(R,"/").concat(w))}L.forEach(((w,P)=>{if(!q.has(P)){const w=L.get(P);(null==w||w.isResolved||w.isRejected)&&L.delete(P)}})),k.extent={xmin:S.xmin,ymin:S.ymin,xmax:S.xmax,ymax:S.ymax}}},67667:(w,P,S)=>{S.d(P,{DY:()=>h,NG:()=>D,QW:()=>i,Rp:()=>m,ct:()=>f,fy:()=>d,sx:()=>o,xx:()=>a,z2:()=>g});var R=S(16842),M=S(9607);function t(w,P,S){const R=P.shift();if(0===S.length){const w=[];S.push({sliceId:-1,multidimensionalDefinition:w})}const M=S.length;for(let I=0;I<M;I++){var C;const P=S.shift().multidimensionalDefinition;null===(C=R.values)||void 0===C||C.forEach((M=>{S.push({sliceId:-1,multidimensionalDefinition:[...P,{variableName:w,dimensionName:R.name,values:[M]}]})}))}P.length&&t(w,P,S)}function i(w,P){const S=[];let R=0;return(P?w.variables.filter((w=>w.name.toLowerCase()===P.toLowerCase())):[...w.variables].sort(((w,P)=>w.name>P.name?1:-1))).forEach((w=>{const P=[],M=[...w.dimensions].sort(((w,P)=>w.name>P.name?-1:1));t(w.name,M,P),P.forEach((w=>{S.push({...w,sliceId:R++})}))})),S}function a(w,P,S){let R=w;if(P&&(P=[...P].sort(((w,P)=>w.dimensionName<P.dimensionName?-1:1))).forEach((w=>{let{dimensionName:P,values:S,isSlice:M}=w;S.length&&(R=R.filter((w=>{const R=w.multidimensionalDefinition.find((w=>w.dimensionName===P));if(null==R)return!1;const C=R.values[0];return"number"==typeof C?"number"==typeof S[0]?S.includes(C):S.some((w=>w[0]<=C&&w[1]>=C)):"number"==typeof S[0]?S.some((w=>C[0]<=w&&C[1]>=w)):M?S.some((w=>w[0]===C[0]&&w[0]===C[1])):S.some((w=>w[0]>=C[0]&&w[0]<=C[1]||w[1]>=C[0]&&w[1]<=C[1]||w[0]<C[0]&&w[1]>C[1]))})))})),R.length&&null!=(null===S||void 0===S?void 0:S.start)&&null!=S.end){const w=S.start.getTime(),P=S.end.getTime(),M=R[0].multidimensionalDefinition.findIndex((w=>"StdTime"===w.dimensionName));M>-1&&(R=R.filter((S=>{const R=S.multidimensionalDefinition[M].values[0];return w<=R&&P>=R})))}return R.map((w=>w.sliceId))}function s(w,P){return Array.isArray(w)?P[0]===P[1]?w[0]===P[0]||w[1]===P[0]:w[0]>=P[0]&&w[0]<=P[1]&&w[1]>=P[0]&&w[1]<=P[1]:w>=P[0]&&w<=P[1]}function r(w,P){return w[0]<=P[0]&&w[1]>=P[0]||w[0]<=P[1]&&w[1]>=P[1]||w[0]>=P[0]&&w[1]<=P[1]}function l(w){return 1===w.length?[w[0],w[0]]:[w[0],w[w.length-1]]}function u(w,P,S){var R;if(null===P||void 0===P||null===(R=P.subsetDefinitions)||void 0===R||!R.length)return w;let M;if(S){var C;const{variables:R}=P;if(R.length&&!R.includes(S))return null;const I=P.subsetDefinitions.find((P=>P.dimensionName===w.name&&P.variableName===S));if(null===I||void 0===I||null===(C=I.values)||void 0===C||!C.length)return w;M=l(I.values)}else{const S=P.dimensions.find((P=>{let{name:S}=P;return S===w.name}));M=null===S||void 0===S?void 0:S.extent}const I=M;if(null===I||void 0===I||!I.length)return w;const U=w.values.filter((w=>s(w,I)));return{...w,extent:[...I],values:U}}function o(w,P,S){var R;if(null===P||void 0===P||null===(R=P.subsetDefinitions)||void 0===R||!R.length)return!1;const{variables:M}=P;if(M.length&&w.some((w=>{let{variableName:P}=w;return P&&!M.includes(P)})))return!0;for(let C=0;C<w.length;C++){const R=w[C],M=P.subsetDefinitions.find((w=>(""===R.variableName||w.variableName===R.variableName)&&w.dimensionName===R.dimensionName));if(null!==M&&void 0!==M&&M.values.length){const w=l(M.values);if(R.isSlice||2!==R.values.length||Array.isArray(R.values[0])||R.values[0]===R.values[1]||!S){if(R.values.some((P=>!s(P,w))))return!0}else if(!r(R.values,w))return!0}}return!1}function m(w,P){if(null==w)return{isOutside:!1};const{geometry:S,timeExtent:R,multidimensionalDefinition:C}=P;let I=null;if(null!=R&&(I=function c(w,P){var S,R;const C=w.dimensions.find((w=>{let{name:P}=w;return"StdTime"===P}));if(null==C||null==P.start&&null==P.end)return P;P=P.clone();const{start:I,end:U}=P.toJSON(),V=I===U?[I]:null!=I&&null!=U?[I,U]:[null!==I&&void 0!==I?I:U];return 2===V.length&&null!==C&&void 0!==C&&C.extent.length&&(V[0]=Math.max(V[0],C.extent[0]),V[1]=Math.min(V[1],null!==(S=C.extent[1])&&void 0!==S?S:C.extent[0]),V[1]<V[0])||o([new M.A({variableName:"",dimensionName:"StdTime",isSlice:1===V.length,values:V})],w,!0)?null:(P.start=new Date(V[0]),P.end=new Date(null!==(R=V[1])&&void 0!==R?R:V[0]),P)}(w,R),null==I))return{isOutside:!0};const{areaOfInterest:U}=w;if(U&&S){const w="point"===S.type?S:"extent"===S.type?S.center:"polygon"===S.type?S.centroid:null;if(w&&!U.contains(w))return{isOutside:!0}}return null!=C&&C.length&&o(C,w,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:S,timeExtent:I,multidimensionalDefinition:C}}}function f(w){var P,S,R;let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{multidimensionalInfo:C,keyProperties:I}=w;if(null==C)return null;const{variableName:U,multidimensionalSubset:V,multidimensionalDefinition:z}=M,k=null!=z?null===(P=z[0])||void 0===P?void 0:P.variableName:null,B=U||k||(null===I||void 0===I?void 0:I.DefaultVariable);let{variables:L}=C;return(null===V||void 0===V||null===(S=V.variables)||void 0===S?void 0:S.length)&&(L=L.filter((w=>{let{name:P}=w;return V.variables.includes(P)}))),B&&null!==(R=L.find((w=>{let{name:P}=w;return P===B})))&&void 0!==R?R:L[0]}function d(w){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=f(w,P);if(!S)return null;const R=[],{dimensions:C,name:I}=S;if(0===C.length)return[new M.A({variableName:I,dimensionName:"",values:[],isSlice:!0})];for(let V=0;V<C.length;V++){var U;const w=u(C[V],P.multidimensionalSubset,I);if(!w)return null;const{values:S,extent:z}=w;let k=null!==(U=null===S||void 0===S?void 0:S[0])&&void 0!==U?U:z[0];"stdz"===w.name.toLowerCase()&&!w.hasRanges&&Math.abs(z[1])<=Math.abs(z[0])&&(k=null!==S&&void 0!==S&&S.length?S[S.length-1]:z[1]),R.push(new M.A({variableName:I,dimensionName:w.name,values:[k],isSlice:!P.useRangeForRangedDimensionInfo||!!w.hasRanges}))}return R}function h(w){return!(null===w||void 0===w||!w.length)&&w.some((w=>{if(null==w.values)return!0;const P=w.values.length;return 0===P||P>1||!w.isSlice&&Array.isArray(w.values[0])}))}function g(w,P){var S;if(null==P||null==w)return null;let M=P.variables.map((w=>({...w})));return null!==w&&void 0!==w&&null!==(S=w.variables)&&void 0!==S&&S.length&&(M=M.filter((P=>{let{name:S}=P;return w.variables.includes(S)})),M.forEach((P=>{P.dimensions=P.dimensions.map((S=>u(S,w,P.name))).filter(R.Ru)}))),M}function v(w,P){var S;const{values:R}=P;if(null!==R&&void 0!==R&&R.length){const P=Array.isArray(R[0]),S=Array.isArray(w);return P!==S?-1:P&&S?R.findIndex((P=>P[0]===w[0]&&P[1]===w[1])):R.indexOf(w)}const{extent:M}=P;if(Array.isArray(w)||w<M[0]||w>M[1])return-1;const C=P.interval||1;if("ISO8601"!==P.unit)return Math.round((w-M[0])/C);const I=M[0];let U=-1;switch((null===(S=P.intervalUnit)||void 0===S?void 0:S.toLowerCase())||"seconds"){case"seconds":U=Math.round((w-I)/1e3/C);break;case"minutes":U=Math.round((w-I)/6e4/C);break;case"hours":U=Math.round((w-I)/36e5/C);break;case"days":U=Math.round((w-I)/864e5/C);break;case"months":{const P=new Date(w).getUTCFullYear()-new Date(I).getUTCFullYear(),S=new Date(I).getUTCMonth(),R=new Date(w).getUTCMonth();U=0===P?R-S:R+11-S+12*(P-1)}break;case"years":U=Math.round((new Date(w).getUTCFullYear()-new Date(I).getUTCFullYear())/C);break;case"decades":U=Math.round((new Date(w).getUTCFullYear()-new Date(I).getUTCFullYear())/10/C)}return U}function b(w){var P,S,R;let M=null===(P=w.values)||void 0===P?void 0:P.length;if(M)return M;const{extent:C,unit:I}=w,U=w.interval||1,V=C?C[1]-C[0]:0;if("ISO8601"!==I)return Math.round(V/U);switch(null!==(S=null===(R=w.intervalUnit)||void 0===R?void 0:R.toLowerCase())&&void 0!==S?S:"seconds"){case"seconds":M=Math.round(V/1e3/U);break;case"minutes":M=Math.round(V/6e4/U);break;case"hours":M=Math.round(V/36e5/U);break;case"days":M=Math.round(V/864e5/U);break;case"months":{const w=new Date(C[1]).getUTCFullYear()-new Date(C[0]).getUTCFullYear(),P=new Date(C[0]).getUTCMonth(),S=new Date(C[1]).getUTCMonth();M=0===w?S-P+1:S+11-P+12*(w-1)+1}break;case"years":M=Math.round((new Date(C[1]).getUTCFullYear()-new Date(C[0]).getUTCFullYear())/U);break;case"decades":M=Math.round((new Date(C[1]).getUTCFullYear()-new Date(C[0]).getUTCFullYear())/10/U);break;default:M=0}return M}function D(w,P){let S=0;const R=w[0].variableName,M=[...P.variables].sort(((w,P)=>w.name>P.name?1:-1));for(let C=0;C<M.length;C++){const P=M[C],I=[...P.dimensions].sort(((w,P)=>w.name>P.name?-1:1));if(P.name!==R){S+=I.map((w=>b(w))).reduce(((w,P)=>w*P));continue}const U=I.map((w=>b(w))),V=I.length;for(let R=0;R<V;R++){const P=w.find((w=>w.dimensionName===I[R].name));if(null==P)return null;const M=v(P.values[0],I[R]);if(-1===M)return null;U.shift(),S+=R===V-1?M:M*U.reduce(((w,P)=>w*P))}break}return S}},49214:(w,P,S)=>{S.d(P,{A:()=>i});var R=S(50886),M=S(21847),C=S(231),I=S(72492),U=S(78443);const n=(w,P)=>w.key.level-P.key.level!=0?w.key.level-P.key.level:w.key.row-P.key.row!=0?w.key.row-P.key.row:w.key.col-P.key.col;class i extends C.A{constructor(w){super(),this._tileInfoView=w}renderChildren(w){this.sortChildren(n),this.setStencilReference(w),super.renderChildren(w)}createRenderParams(w){const{state:P}=w,S=super.createRenderParams(w);return S.requiredLevel=this._tileInfoView.getClosestInfoForScale(P.scale).level,S.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(P.scale),S}prepareRenderPasses(w){const P=super.prepareRenderPasses(w);return P.push(w.registerRenderPass({name:"stencil",brushes:[I.A],drawPhase:M.S5.DEBUG|M.S5.MAP|M.S5.HIGHLIGHT|M.S5.LABEL,target:()=>this.getStencilTarget()})),(0,R.A)("esri-tiles-debug")&&P.push(w.registerRenderPass({name:"tileInfo",brushes:[U.A],drawPhase:M.S5.DEBUG,target:()=>this.children})),P}getStencilTarget(){return this.children}setStencilReference(w){let P=1;for(const S of this.children)S.stencilRef=P++}}},70223:(w,P,S)=>{S.r(P),S.d(P,{default:()=>Pt});var R=S(80671),M=S(89412),C=S(81618),I=S(63390),U=S(57453),V=(S(50886),S(76761),S(68682)),z=S(67667),k=S(48988),B=S(86083),L=S(88965),G=S(33344),N=S(35598),j=S(68052),Z=S(46427),q=S(40102),W=S(93170),H=S(60985),Q=S(95493);const Y={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class _ extends W.q{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,this._colormapTexture=null,this._colormap=null,this._supportsBilinearTexture=!0,this._processedTexture=null,this.functionTextures=[],this.projected=!1,this.stencilRef=0,this.coordScale=[1,1],this._processed=!1,this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=w,this.transformGrid=P,this.interpolation=S}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(w){this._processedTexture!==w&&(this._disposeTextures(!0),this._processedTexture=w)}get rasterTexture(){return this._rasterTexture}set rasterTexture(w){var P;this._rasterTexture!==w&&(null!==(P=this._rasterTexture)&&void 0!==P&&P.dispose(),this._rasterTexture=w),null==w&&(this.projected=!1)}get processed(){return this._processed}set processed(w){this._processed=w,w||((0,N.WD)(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||Y}set symbolizerParameters(w){this._symbolizerParameters!==w&&(this._symbolizerParameters=w,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}get source(){return this._source}set source(w){this._source!==w&&(this._source=w,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}get suspended(){return this._suspended}set suspended(w){this._suspended&&!w&&this.stage&&(this.ready(),this.requestRender()),this._suspended=w}get bandIds(){return this._bandIds}set bandIds(w){this._bandIds=w,this._isBandIdsChanged(w)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(w){this._interpolation=w,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(w||"nearest")?H.Cj.LINEAR:H.Cj.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(w){this._transformGrid!==w&&(this._transformGrid=w,this._transformGridTexture=(0,N.WD)(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(){var w,P;const S=arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.projected;return[S?this.width:(null===(w=this.source)||void 0===w?void 0:w.width)||this.width,S?this.height:(null===(P=this.source)||void 0===P?void 0:P.height)||this.height]}getRasterCellSize(){var w;const P=null===(w=this.rawPixelData)||void 0===w?void 0:w.srcPixelSize,{projected:S,resolution:R}=this;return P&&!S?[P.x,P.y]:[R,R]}_createTransforms(){return{displayViewScreenMat3:(0,Z.vt)()}}setTransform(w){const P=(0,j.D_)(this.transforms.displayViewScreenMat3),[S,R]=w.toScreenNoRotation([0,0],[this.x,this.y]),M=this.resolution/this.pixelRatio/w.resolution,C=M*this.width,I=M*this.height,U=Math.PI*this.rotation/180;(0,j.Tl)(P,P,(0,q.fA)(S,R)),(0,j.Tl)(P,P,(0,q.fA)(C/2,I/2)),(0,j.e$)(P,P,-U),(0,j.Tl)(P,P,(0,q.fA)(-C/2,-I/2)),(0,j.Oe)(P,P,(0,q.fA)(C,I)),(0,j.lw)(this.transforms.displayViewScreenMat3,w.displayViewMat3,P)}getTextures(){var w;let{forProcessing:P=!1,useProcessedTexture:S=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const R=S&&null!==(w=this._processedTexture)&&void 0!==w?w:this._rasterTexture,M=[],C=[];return R?(this._transformGridTexture&&!this.projected&&(C.push(this._transformGridTexture),M.push("u_transformGrid")),S?(C.push(R),M.push("u_image"),this._colormapTexture&&(C.push(this._colormapTexture),M.push("u_colormap")),{names:M,textures:C}):(C.push(R),M.push("u_image"),this._colormapTexture&&!P&&(C.push(this._colormapTexture),M.push("u_colormap")),{names:M,textures:C})):{names:M,textures:C}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture(w){let{context:P}=w;if(!this.stage)return void this._disposeTextures();const S=this._isValidSource(this.source);S&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(P)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(P),this._rasterTexture&&(S?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,Q.kc)(P,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}updateProcessedTexture(){const{functionTextures:w}=this;0!==w.length&&(this.processedTexture=w.shift(),w.forEach((w=>null===w||void 0===w?void 0:w.dispose())),w.length=0)}_createOrDestroyRasterTexture(w){var P,S;const R=null===(P=this.source)||void 0===P?void 0:P.extractBands(this.bandIds);if(!this._isValidSource(R))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null));const M=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(M)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=!(null===(S=w.capabilities.textureFloat)||void 0===S||!S.textureFloatLinear);const C=this._getTextureSamplingMethod(this.interpolation),I=this.isRendereredSource;this._rasterTexture=(0,Q.b4)(w,R,C,I),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdsChanged(w){const P=this._rasterTextureBandIds;return!(null==P&&null==w||P&&w&&P.join("")===w.join(""))}_isValidSource(w){var P;return null!=w&&(null===(P=w.pixels)||void 0===P?void 0:P.length)>0}_getTextureSamplingMethod(w){const{type:P}=this.symbolizerParameters,S="lut"===P||"hillshade"===P||"stretch"===P&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||S||"bilinear"!==w&&"cubic"!==w?"nearest":"bilinear"}_updateColormapTexture(w){const P=this._colormap,S=this.symbolizerParameters.colormap;return S?P?S.length!==P.length||S.some(((w,S)=>w!==P[S]))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,Q.hE)(w,S),void(this._colormap=S)):void 0:(this._colormapTexture=(0,Q.hE)(w,S),void(this._colormap=S)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}_disposeTextures(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this._transformGridTexture||w&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null),!w&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null,this._colormap=null,this._colormapTextureInvalidated=!0),!w&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}function utils_i(w){const P=[];return w&&(P.push("applyProjection"),1===w.spacing[0]&&P.push("lookupProjection")),P}function n(w,P,S){var R;const M=!(null!==(R=S.capabilities.textureFloat)&&void 0!==R&&R.textureFloatLinear),C=[];return"cubic"===w?C.push("bicubic"):"bilinear"===w&&(P?(C.push("bilinear"),C.push("nnedge")):M&&C.push("bilinear")),C}const $={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};const K={createProgram:function a(w,P,S){const R=S?[]:utils_i(P.transformGrid);return{defines:R,program:w.painter.materialManager.getProgram($,R)}},bindTextureAndUniforms:function lut_n(w,P,S,R){let M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{names:C,textures:I}=S.getTextures({useProcessedTexture:M});(0,Q.hB)(w.context,P,C,I),(0,Q.EO)(P,R,S.commonUniforms),P.setUniformMatrix3fv("u_dvsMat3",S.transforms.displayViewScreenMat3);const{colormap:U,colormapOffset:V}=S.symbolizerParameters,z=(0,Q.Pp)(U,V);(0,Q.EO)(P,R,z)}},J={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};const X={createProgram:function i(w,P,S){const{colormap:R}=P.symbolizerParameters,M=[...S?[]:utils_i(P.transformGrid),...n(P.interpolation,!0,w.context)];return null!=R&&M.push("applyColormap"),{defines:M,program:w.painter.materialManager.getProgram(J,M)}},bindTextureAndUniforms:function shadedrelief_m(w,P,S,R){let M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{names:C,textures:I}=S.getTextures({useProcessedTexture:M});(0,Q.hB)(w.context,P,C,I),(0,Q.EO)(P,R,S.commonUniforms),P.setUniformMatrix3fv("u_dvsMat3",S.transforms.displayViewScreenMat3);const U=S.symbolizerParameters,{colormap:V,colormapOffset:z}=U;if(null!=V){const w=(0,Q.Pp)(V,z);(0,Q.EO)(P,R,w)}const k=(0,Q.OI)(U);(0,Q.EO)(P,R,k)}},ee={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};const te={createProgram:function stretch_i(w,P,S){const{colormap:R,bandCount:M}=P.symbolizerParameters,C=[...S?[]:utils_i(P.transformGrid),...n(P.interpolation,1===M,w.context)];return P.isRendereredSource&&!S?C.push("noop"):null!=R&&C.push("applyColormap"),{defines:C,program:w.painter.materialManager.getProgram(ee,C)}},bindTextureAndUniforms:function stretch_m(w,P,S,R){let M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{names:C,textures:I}=S.getTextures({useProcessedTexture:M});(0,Q.hB)(w.context,P,C,I),(0,Q.EO)(P,R,S.commonUniforms),P.setUniformMatrix3fv("u_dvsMat3",S.transforms.displayViewScreenMat3);const U=S.symbolizerParameters,{colormap:V,colormapOffset:z}=U;if(null!=V){const w=(0,Q.Pp)(V,z);(0,Q.EO)(P,R,w)}const k=(0,Q.VC)(U);(0,Q.EO)(P,R,k)}},se=new Map;se.set("lut",K),se.set("hillshade",X),se.set("stretch",te);const re=[1,1],ie=[2,0,0,0,2,0,-1,-1,0];function utils_a(w,P,S){var R,M;const{context:C,rasterFunction:I,hasBranches:U}=w,{raster:V}=I.parameters,z=U?null!==(R=null===V||void 0===V?void 0:V.id)&&void 0!==R?R:-1:0,k=null!==(M=S.functionTextures[z])&&void 0!==M?M:S.rasterTexture;(0,Q.hB)(C,P,["u_image"],[k])}function utils_r(w,P,S){const{rasters:R}=w.rasterFunction.parameters;if(!R)return;if(R.length<2)return utils_a(w,P,S);const M=R.filter((w=>"Constant"!==w.name)).map((w=>null!=w.id&&"Identity"!==w.name?S.functionTextures[w.id]:S.rasterTexture));if((0,Q.hB)(w.context,P,["u_image","u_image1","u_image2"].slice(0,M.length),M),M.length!==R.length)if(2===R.length){const w=R.findIndex((w=>"Constant"===w.name)),S=0===w?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:M}=R[w].parameters;P.setUniform1f("u_image1Const",M),P.setUniformMatrix3fv("u_imageSwap",S)}else if(3===R.length){const w=[];if(R.forEach(((P,S)=>"Constant"===P.name&&w.push(S))),1===w.length){const{value:S}=R[w[0]].parameters;P.setUniform1f("u_image1Const",S);const M=0===w[0]?[0,1,0,0,0,1,1,0,0]:1===w[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1];P.setUniformMatrix3fv("u_imageSwap",M)}else if(2===w.length){const{value:S}=R[w[0]].parameters;P.setUniform1f("u_image1Const",S);const{value:M}=R[w[1]].parameters;P.setUniform1f("u_image2Const",M);const C=R.findIndex((w=>"Constant"!==w.name)),I=0===C?[1,0,0,0,1,0,0,0,1]:1===C?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0];P.setUniformMatrix3fv("u_imageSwap",I)}}}function utils_s(w){w.setUniform2fv("u_coordScale",re),w.setUniformMatrix3fv("u_dvsMat3",ie)}const ne={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};const ae={createProgram:function aspectProcessor_a(w,P){return w.painter.materialManager.getProgram(ne,[])},bindTextureAndUniforms:function aspectProcessor_s(w,P,S){utils_a(w,P,S),utils_s(P);const R=S.getRasterTextureSize();P.setUniform2fv("u_srcImageSize",R);const M=S.getRasterCellSize();P.setUniform2fv("u_cellSize",M)}},oe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};const le={createProgram:function e(w,P){const{painter:S,rasterFunction:R}=w,{indexType:M}=R.parameters;return S.materialManager.getProgram(oe,[M])},bindTextureAndUniforms:function bandArithmeticProcessor_n(w,P,S){utils_a(w,P,S),utils_s(P);const{bandIndexMat3:R}=w.rasterFunction.parameters;P.setUniformMatrix3fv("u_bandIndexMat3",R)}},ue={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};const ce={createProgram:function compositeBandProcessor_a(w,P){const S=w.rasterFunction.parameters.rasters.filter((w=>"Constant"===w.name)),R=[];return S.length&&(R.push("oneConstant"),2===S.length&&R.push("twoConstant")),w.painter.materialManager.getProgram(ue,R)},bindTextureAndUniforms:function compositeBandProcessor_e(w,P,S){utils_r(w,P,S),utils_s(P)}},he={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])};const de={createProgram:function contrastProcessor_e(w,P){return w.painter.materialManager.getProgram(he,[])},bindTextureAndUniforms:function contrastProcessor_a(w,P,S){utils_a(w,P,S),utils_s(P);const{contrastOffset:R,brightnessOffset:M}=w.rasterFunction.parameters;P.setUniform1f("u_contrastOffset",R),P.setUniform1f("u_brightnessOffset",M)}},pe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};const me={createProgram:function convolutionProcessor_a(w,P){const{painter:S,rasterFunction:R}=w,{kernelRows:M,kernelCols:C}=R.parameters,I=[{name:"rows",value:M},{name:"cols",value:C}];return S.materialManager.getProgram(pe,I)},bindTextureAndUniforms:function convolutionProcessor_n(w,P,S){utils_a(w,P,S),utils_s(P),P.setUniform2fv("u_srcImageSize",[S.width,S.height]);const{kernel:R,clampRange:M}=w.rasterFunction.parameters;P.setUniform1fv("u_kernel",R),P.setUniform2fv("u_clampRange",M)}},fe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])};const ge={createProgram:function curvatureProcessor_a(w,P){const{painter:S,rasterFunction:R}=w,{curvatureType:M}=R.parameters,C=[M];return S.materialManager.getProgram(fe,C)},bindTextureAndUniforms:function curvatureProcessor_s(w,P,S){utils_a(w,P,S),utils_s(P);const R=S.getRasterTextureSize();P.setUniform2fv("u_srcImageSize",R);const{zFactor:M}=w.rasterFunction.parameters,C=S.getRasterCellSize();P.setUniform1f("u_zlFactor",200*M/C[0]/C[1])}},ve={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};const _e={createProgram:function extractBandProcessor_e(w,P){return w.painter.materialManager.getProgram(ve,[])},bindTextureAndUniforms:function extractBandProcessor_n(w,P,S){utils_a(w,P,S),utils_s(P);const{bandIndexMat3:R}=w.rasterFunction.parameters;P.setUniformMatrix3fv("u_bandIndexMat3",R)}},ye={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])};const xe={createProgram:function focalStatisticsProcessor_r(w,P){const{painter:S,rasterFunction:R}=w,{kernelRows:M,kernelCols:C,fillNoDataOnly:I,statisticsType:U}=R.parameters,V=[{name:"rows",value:M},{name:"cols",value:C},U];return I&&V.push("fill"),S.materialManager.getProgram(ye,V)},bindTextureAndUniforms:function focalStatisticsProcessor_s(w,P,S){utils_a(w,P,S),utils_s(P),P.setUniform2fv("u_srcImageSize",[S.width,S.height]);const{clampRange:R}=w.rasterFunction.parameters;P.setUniform2fv("u_clampRange",R)}},be={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/grayscale",attributes:new Map([["a_position",0],["a_texcoord",1]])};const we={createProgram:function grayscaleProcessor_e(w,P){return w.painter.materialManager.getProgram(be,[])},bindTextureAndUniforms:function grayscaleProcessor_s(w,P,S){utils_a(w,P,S),utils_s(P);const{weights:R}=w.rasterFunction.parameters;P.setUniform3fv("u_weights",R)}},Te={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])};const Pe={createProgram:function localProcessor_e(w){const{painter:P,rasterFunction:S}=w,{imageCount:R,operationName:M,rasters:C,isOutputRounded:I}=S.parameters,U=[M.toLowerCase()];2===R&&U.push("twoImages");const V=C.filter((w=>"Constant"===w.name));return V.length&&(U.push("oneConstant"),2===V.length&&U.push("twoConstant")),I&&U.push("roundOutput"),P.materialManager.getProgram(Te,U)},bindTextureAndUniforms:function localProcessor_r(w,P,S){utils_r(w,P,S),utils_s(P);const{domainRange:R}=w.rasterFunction.parameters;P.setUniform2fv("u_domainRange",R)}},Se={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};const Re={createProgram:function maskProcessor_n(w,P){const{painter:S,rasterFunction:R}=w,M=R.parameters.bandCount>1?["multiBand"]:[];return S.materialManager.getProgram(Se,M)},bindTextureAndUniforms:function maskProcessor_e(w,P,S){utils_a(w,P,S),utils_s(P);const{includedRanges:R,noDataValues:M}=w.rasterFunction.parameters;P.setUniform1fv("u_includedRanges",R),P.setUniform1fv("u_noDataValues",M)}},Me={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};const Ce={createProgram:function ndviProcessor_e(w,P){const{painter:S,rasterFunction:R}=w,M=R.parameters.scaled?["scaled"]:[];return S.materialManager.getProgram(Me,M)},bindTextureAndUniforms:function ndviProcessor_n(w,P,S){utils_a(w,P,S),utils_s(P);const{bandIndexMat3:R}=w.rasterFunction.parameters;P.setUniformMatrix3fv("u_bandIndexMat3",R)}},Ie={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};const Ue={createProgram:function remapProcessor_e(w,P){return w.painter.materialManager.getProgram(Ie,[])},bindTextureAndUniforms:function remapProcessor_n(w,P,S){utils_a(w,P,S),utils_s(P);const{noDataRanges:R,rangeMaps:M,allowUnmatched:C,clampRange:I}=w.rasterFunction.parameters;P.setUniform1fv("u_noDataRanges",R),P.setUniform1fv("u_rangeMaps",M),P.setUniform1f("u_unmatchMask",C?1:0),P.setUniform2fv("u_clampRange",I)}};var Fe=S(52273);const Ae={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};const Ve={createProgram:function reprojectProcessor_i(w,P){var S;const{painter:R}=w,M=[],{interpolation:C,transformGrid:I}=P,U=null===(S=w.rasterFunction)||void 0===S?void 0:S.parameters;return"cubic"===C?M.push("bicubic"):"bilinear"===C&&(M.push("bilinear"),(null===U||void 0===U?void 0:U.requireNNEdge)&&M.push("nnedge")),I&&(M.push("applyProjection"),1===I.spacing[0]&&M.push("lookupProjection")),R.materialManager.getProgram(Ae,M)},bindTextureAndUniforms:function reprojectProcessor_o(w,P,S){const{names:R,textures:M}=S.getTextures({forProcessing:!0});(0,Q.hB)(w.context,P,R,M),P.setUniform1f("u_scale",1),P.setUniform2fv("u_offset",[0,0]),P.setUniform2fv("u_coordScale",[1,1]),P.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]),P.setUniform1i("u_flipY",0),P.setUniform1f("u_opacity",1);const{width:C,height:I,source:U,transformGrid:V}=S;P.setUniform2fv("u_srcImageSize",[U.width,U.height]),P.setUniform2fv("u_targetImageSize",[C,I]),P.setUniform2fv("u_transformSpacing",V?V.spacing:Fe.uY),P.setUniform2fv("u_transformGridSize",V?V.size:Fe.uY)}},ze={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};const ke={createProgram:function slopeProcessor_s(w,P){const{painter:S,rasterFunction:R}=w,{slopeType:M}=R.parameters,C="percent-rise"===M?["percentRise"]:[];return S.materialManager.getProgram(ze,C)},bindTextureAndUniforms:function slopeProcessor_o(w,P,S){utils_a(w,P,S),utils_s(P);const R=S.getRasterTextureSize();P.setUniform2fv("u_srcImageSize",R);const M=S.getRasterCellSize();P.setUniform2fv("u_cellSize",M);const{zFactor:C,slopeType:I,pixelSizePower:U,pixelSizeFactor:V}=w.rasterFunction.parameters;P.setUniform1f("u_zFactor",C),P.setUniform1f("u_pixelSizePower","adjusted"===I?U:0),P.setUniform1f("u_pixelSizeFactor","adjusted"===I?V:0)}},Be={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};const Oe={createProgram:function u(w,P){const{useGamma:S,bandCount:R,isOutputRounded:M}=w.rasterFunction.parameters,C=[];return S&&C.push("useGamma"),R>1&&C.push("multiBand"),M&&C.push("roundOutput"),w.painter.materialManager.getProgram(Be,C)},bindTextureAndUniforms:function stretchProcessor_e(w,P,S){utils_a(w,P,S),utils_s(P);const{width:R,height:M}=S,C=w.rasterFunction.parameters;P.setUniform2fv("u_srcImageSize",[R,M]),P.setUniform1f("u_minOutput",C.outMin),P.setUniform1f("u_maxOutput",C.outMax),P.setUniform1fv("u_factor",C.factor),P.setUniform1fv("u_minCutOff",C.minCutOff),P.setUniform1fv("u_maxCutOff",C.maxCutOff),P.setUniform1fv("u_gamma",C.gamma),P.setUniform1fv("u_gammaCorrection",C.gammaCorrection)}};var De=S(83663),Ee=S(83881);const Le=new Map;function v(w,P){const S=new Ee.R;return S.width=w,S.height=P,S.internalFormat=H.H0.RGBA32F,S.samplingMode=H.Cj.NEAREST,S.dataType=H.ld.FLOAT,S.isImmutable=!0,S.wrapMode=H.pF.CLAMP_TO_EDGE,S}function y(w,P,S,R){const M=w.rasterFunction.name.toLowerCase(),C="reproject"===M?Ve:function F(w){return Le.get(w.toLowerCase())}(M);if(null==C)return;const I=function A(w,P,S,R){const{context:M,requestRender:C,allowDelayedRender:I}=w,U=R.createProgram(w,S);return I&&null!=C&&!U.compiled?(C(),null):(M.bindFramebuffer(P),M.setViewport(0,0,P.width,P.height),M.useProgram(U),U)}(w,S,R,C);if(!I)return;C.bindTextureAndUniforms(w,I,R);const{interpolation:U}=R;"reproject"===M&&(R.interpolation="nearest"),P.draw();const[V,z]=R.getRasterTextureSize("reproject"===M),k=v(V,z),B=new De.g(w.context,k);if(S.copyToTexture(0,0,V,z,0,0,B),"reproject"===M)R.rasterTexture=B,R.projected=!0,R.interpolation=U;else{const P=w.hasBranches?w.rasterFunction.id:0;R.functionTextures[P]=B}}Le.set("arithmetic",Pe),Le.set("aspect",ae),Le.set("bandarithmetic",le),Le.set("compositeband",ce),Le.set("convolution",me),Le.set("contrastbrightness",de),Le.set("curvature",ge),Le.set("extractband",_e),Le.set("statistics",xe),Le.set("grayscale",we),Le.set("local",Pe),Le.set("mask",Re),Le.set("ndvi",Ce),Le.set("remap",Ue),Le.set("slope",ke),Le.set("stretch",Oe);var Ge=S(80271),Ne=S(3623),je=S(77322),Ze=S(50707);class h extends je.A{constructor(){super(...arguments),this.name="raster",this._quad=null,this._rendererUniformInfos=new Map,this._fbo=null}dispose(){(0,N.WD)(this._quad),(0,N.WD)(this._fbo)}prepareState(w){const{context:P,renderPass:S}=w,R="raster"===S;P.setBlendingEnabled(!R),P.setBlendFunctionSeparate(H.dn.ONE,H.dn.ONE_MINUS_SRC_ALPHA,H.dn.ONE,H.dn.ONE_MINUS_SRC_ALPHA),P.setColorMask(!0,!0,!0,!0),P.setStencilWriteMask(0),P.setStencilTestEnabled(!R)}draw(w,P){if(!function m(w){return null!=w.source}(P)||P.suspended)return;const{renderPass:S}=w;if("raster-bitmap"!==S)return"raster"===S?this._process(w,P):void this._drawBitmap(w,P,!0);this._drawBitmap(w,P)}_process(w,P){const{rasterFunction:S}=w,R="Reproject"===S.name;if(!(R?!P.rasterTexture||!P.projected:!P.processed))return;const{timeline:M,context:C}=w;M.begin(this.name);const I=C.getBoundFramebufferObject(),U=C.getViewport();R||(P.processedTexture=(0,N.WD)(P.processedTexture)),C.setStencilFunction(H.MT.EQUAL,P.stencilRef,255),P.updateTexture(w),this._initQuad(C);const[V,z]=P.getRasterTextureSize(R),{isStandardRasterTileSize:k,fbo:B}=this._getRasterFBO(C,V,z);y(w,this._quad,B,P),k||B.dispose(),C.bindFramebuffer(I),C.setViewport(U.x,U.y,U.width,U.height),M.end(this.name)}_drawBitmap(w,P){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{timeline:R,context:M}=w;if(R.begin(this.name),M.setStencilFunction(H.MT.EQUAL,P.stencilRef,255),P.updateTexture(w),S&&!P.processedTexture){if(P.updateProcessedTexture(),!P.processedTexture)return void R.end(this.name);P.processed=!0}this._initBitmapCommonUniforms(P);const C=P.symbolizerParameters.type,I=function rasterColorizer_o(w){return se.get(w)}(C),{requestRender:U,allowDelayedRender:V}=w,{defines:z,program:k}=I.createProgram(w,P,P.projected&&S);if(V&&null!=U&&!k.compiled)return void U();M.useProgram(k);const B=this._getUniformInfos(C,M,k,z);this._quad||(this._quad=new Ne.A(M,[0,0,1,0,0,1,1,1])),I.bindTextureAndUniforms(w,k,P,B,S),this._quad.draw(),R.end(this.name)}_initBitmapCommonUniforms(w){if(!w.commonUniforms){const P=(0,Q.Qg)(1,[0,0]),{transformGrid:S,width:R,height:M}=w,C=(0,Q.xV)(S,[R,M],[w.source.width,w.source.height],1,!1);w.commonUniforms={...P,...C,u_coordScale:w.coordScale}}}_getRasterFBO(w,P,S){const R=P===Ge.CQ&&S===Ge.CQ;return R?(this._fbo||(this._fbo=this._createNewFBO(w,P,S)),{isStandardRasterTileSize:R,fbo:this._fbo}):{isStandardRasterTileSize:R,fbo:this._createNewFBO(w,P,S)}}_createNewFBO(w,P,S){const R=v(P,S);return new Ze.H(w,R)}_initQuad(w){this._quad||(this._quad=new Ne.A(w,[0,0,1,0,0,1,1,1]))}_getUniformInfos(w,P,S,R){const M=R.length>0?w+"-"+R.join("-"):w;if(this._rendererUniformInfos.has(M))return this._rendererUniformInfos.get(M);const C=(0,Q.z)(P,S);return this._rendererUniformInfos.set(M,C),C}}var qe=S(84624);class RasterTile_i extends qe.Y{constructor(w,P,S,R,M,C){let I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(w,P,S,R,M,C),this.bitmap=null,this.bitmap=new _(I,null,null),this.bitmap.coordScale=[M,C],this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(w){this.bitmap.stencilRef=w}get stencilRef(){return this.bitmap.stencilRef}setTransform(w){super.setTransform(w),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:(0,Z.vt)(),tileMat3:(0,Z.vt)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var We=S(21847),He=S(49214);class RasterTileContainer_o extends He.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(w){const P=this._getTileBounds(w),[S,R]=this._tileInfoView.tileInfo.size,M=this._tileInfoView.getTileResolution(w.level);return new RasterTile_i(w,M,P[0],P[3],S,R)}prepareRenderPasses(w){const P=w.registerRenderPass({name:"imagery (tile)",brushes:[h],target:()=>this.children.map((w=>w.bitmap)),drawPhase:We.S5.MAP});return[...super.prepareRenderPasses(w),P]}doRender(w){if(!this.visible||w.drawPhase!==We.S5.MAP)return;const{rasterFunctionChain:P}=this;if(!P)return w.renderPass="raster-bitmap",void super.doRender(w);if(!P.hasFocalFunction){const[S,R]=this._tileInfoView.tileInfo.size;w.renderPass="raster",w.rasterFunction={name:"Reproject",parameters:{targetImageSize:[S,R],requireNNEdge:P.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1},super.doRender(w)}if(null!==P&&void 0!==P&&P.functions.length){const{functions:S,hasBranches:R}=P;for(let P=0;P<S.length;P++){const M=S[P];"Constant"!==M.name&&"Identity"!==M.name&&(w.renderPass="raster",w.rasterFunction=M,w.hasBranches=R,super.doRender(w))}}w.rasterFunction=null,w.renderPass="bitmap",super.doRender(w)}_getTileBounds(w){const P=this._tileInfoView.getTileBounds((0,L.vt)(),w);if(this.isCustomTilingScheme&&w.world){const{tileInfo:S}=this._tileInfoView,R=(0,G.FT)(S.spatialReference);if(R){const M=S.lodAt(w.level);if(!M)return P;const{resolution:C}=M,I=R/C%S.size[0],U=I?(S.size[0]-I)*C:0;P[0]-=U*w.world,P[2]-=U*w.world}}return P}}S(30174);var Qe=S(18763),Ye=S(31059),$e=S(57264),Ke=S(68854),Je=S(22179),Xe=S(63741),et=S(13804),tt=S(63801),st=(S(67685),S(54869)),rt=S(11808),it=S(35965),nt=S(84661);const at=[0,0];let ot=class extends Qe.A{constructor(){var w;super(...arguments),w=this,this._updatingHandles=new Ye.U,this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._maxIndexedColormapSize=0,this._rasterFunctionState="na",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=(0,C.sg)((async function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const S=w._rasterFunctionState;if(P.reprocess&&(await w._updatingHandles.addPromise(w.layer.updateRasterFunction()),w.updateRasterFunctionParameters()),!w.previousLOD||w.layerView.suspended)return;const R=w._rasterFunctionState,{type:M}=w;return P.refetch||"raster"!==M&&P.reprocess||"cpu"===R||"cpu"===S?w._updatingHandles.addPromise(w.doRefresh()):w._updatingHandles.addPromise(w._redrawImage(P.signal))}))}destroy(){this._updatingHandles.destroy()}get useWebGLForProcessing(){var w;return null===(w=this._get("useWebGLForProcessing"))||void 0===w||w}set useWebGLForProcessing(w){this._set("useWebGLForProcessing",w)}get useProgressiveUpdate(){var w;return null===(w=this._get("useProgressiveUpdate"))||void 0===w||w}set useProgressiveUpdate(w){if(this._tileStrategy&&this.useProgressiveUpdate!==w){this._tileStrategy.destroy(),this.container.removeAllChildren();const P=this._getCacheSize(w);this._tileStrategy=new rt.A({cachePolicy:"purge",acquireTile:w=>this.acquireTile(w),releaseTile:w=>this.releaseTile(w),cacheSize:P,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",w),this.layerView.requestUpdate()}}update(w){this._fetchQueue.pause(),this._fetchQueue.state=w.state,this._tileStrategy.update(w),this._fetchQueue.resume();const{extent:P,resolution:S,scale:R}=w.state,M=this._tileInfoView.getClosestInfoForScale(R);if(this.layer.raster){var C;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const w=this._srcResolutions[M.level],R=P.toJSON?P:nt.A.fromJSON(P);(0,Xe.yo)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,R,S,w,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null===(C=this.previousLOD)||void 0===C?void 0:C.level)!==M.level&&(this.previousLOD=M,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const w=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(w),this.layerView.requestUpdate()}get updating(){var w;return this._globalUpdateRequested||(null===(w=this._updatingHandles)||void 0===w?void 0:w.updating)}attach(){const w=(0,it.C)();this._maxIndexedColormapSize=4*(w.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new tt.A(this.layerView.tileInfo,this.layerView.fullExtent);const P=this._computeFetchConcurrency();this._fetchQueue=new st.A({tileInfoView:this._tileInfoView,concurrency:P,process:(w,P)=>this._fetchTile(w,P)});const S=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new rt.A({cachePolicy:"purge",acquireTile:w=>this.acquireTile(w),releaseTile:w=>this.releaseTile(w),cacheSize:S,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,Xe.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(w){const P=this.container.createTile(w);return this._updatingHandles.addPromise(this._enqueueTileFetch(P)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,P}releaseTile(w){this._fetchQueue.abort(w.key.id),this.container.removeChild(w),w.once("detach",(()=>{w.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const P=null==w||w.join(",")===this._tileInfoView.tileInfo.size.join(",");if(P&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;w=w||this._tileInfoView.tileInfo.size;const[S,R]=w,M=new Ke.A({width:S,height:R,pixels:[new Uint8Array(S*R)],mask:new Uint8Array(S*R),pixelType:"u8"});return P&&(this._emptyTilePixelBlock=M),M}_getBandIds(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;const{bandIds:w,raster:P}=this.layer,S="rasterFunction"in P?P.rasterFunction.rawInputBandIds:null;return null!==w&&void 0!==w&&w.length&&null!==S&&void 0!==S&&S.length&&1!==P.rasterInfo.bandCount?w.map((w=>S[Math.min(w,S.length-1)])):w||S}updateRasterFunctionParameters(){}_fetchTile(w,P){const S=null!=P?P.signal:null,R=this.canUseWebGLForProcessing(),{layerView:M}=this,{tileInfo:C}=M,I=!C.isWrappable&&null!=(0,et.FT)(M.view.spatialReference),U=R&&this.layer.raster.hasUniqueSourceStorageInfo,V={allowPartialFill:!0,datumTransformation:M.datumTransformation,interpolation:R?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:U,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:S,srcResolution:this._srcResolutions[w.level],timeExtent:M.timeExtent,tileInfo:C,disableWrapAround:I};return this.fetchTile(w,V)}_getCacheSize(w){return w?40:0}_initializeTileInfo(){const{layerView:w}=this,P=w.view.spatialReference;if(this._canUseLayerLODs()){const{origin:S,lods:R}=this.layer.tileInfo,M=R.map((w=>{let{scale:P}=w;return P})),C=Je.A.create({spatialReference:P,size:Ge.CQ,scales:M,origin:S});return w.set("tileInfo",C),void(this._srcResolutions=R.map((w=>{let{resolution:P}=w;return{x:P,y:P}})))}const{scales:S,srcResolutions:R,isCustomTilingScheme:M}=(0,et.dK)(this.layer.serviceRasterInfo,P,{tileSize:Ge.CQ,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),C=Je.A.create({spatialReference:P,size:Ge.CQ,scales:S}),I=0===C.origin.x,{xmin:U,ymax:V}=w.fullExtent;(I||M&&C.origin.x>U)&&(C.origin=new $e.A({x:U,y:V,spatialReference:P})),this._isCustomTilingScheme=M,w.set("tileInfo",C),this._srcResolutions=null!==R&&void 0!==R?R:[]}_canUseLayerLODs(){var w;const{layer:P,layerView:S}=this;if("Map"!==P.raster.tileType)return!1;const{lods:R}=P.tileInfo,M=null===(w=S.view.constraints)||void 0===w?void 0:w.effectiveLODs;return(null===M||void 0===M?void 0:M.length)===R.length&&M.every(((w,P)=>{let{scale:S}=w;return Math.abs(S-R[P].scale)<.001}))}_computeFetchConcurrency(){const{blockBoundary:w}=this.layer.serviceRasterInfo.storageInfo,P=w[w.length-1];return(P.maxCol-P.minCol+1)*(P.maxRow-P.minRow+1)>64?2:10}async _enqueueTileFetch(w,P){if(!this._fetchQueue.has(w.key.id)){try{const P=await this._fetchQueue.push(w.key),R=this._getBandIds();let I=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){I=!1;try{var S;await this._redrawImage(null===(S=this._abortController)||void 0===S?void 0:S.signal)}catch($){(0,C.zf)($)&&M.A.getLogger(this).error($)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const U=this._tileInfoView.getTileCoords(at,w.key),V=this._tileInfoView.getTileResolution(w.key);await this.updateTileSource(w,{source:P,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:I,bandIds:R,coords:U,resolution:V}),w.once("attach",(()=>this.layerView.requestUpdate())),this.container.addChild(w)}catch($){(0,C.zf)($)||M.A.getLogger(this).error($)}this.layerView.requestUpdate()}}async _redrawImage(w){if(0===this.container.children.length)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(w):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const P=this.container.children.map((async w=>this.updateTileSymbolizerParameters(w,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await Promise.allSettled(P),this.container.requestRender()}async _updateGlobalSymbolizerParams(w){const P={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:w},S=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,P);if(null===S||void 0===S||!S.pixelBlock)return;const{resolution:R}=this.previousLOD,M=this._getBandIds(),C=this.layer.symbolizer.generateWebGLParameters({pixelBlock:S.pixelBlock.extractBands(M),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:R,y:R},bandIds:M});!this.canUseWebGLForProcessing()&&C&&"stretch"===C.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(C.factor=C.factor.map((w=>255*w)),C.outMin=Math.round(255*C.outMin),C.outMax=Math.round(255*C.outMax)),this._globalSymbolizerParams=C}_updateSymbolizerParams(){const{resolution:w}=this.previousLOD,P=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:w,y:w},bandIds:P})}_updateBlockCacheRegistry(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{layer:P,layerView:S}=this,{raster:R}=P,{multidimensionalDefinition:M}=P.normalizeRasterFetchOptions({multidimensionalDefinition:P.multidimensionalDefinition,timeExtent:S.timeExtent}),C=R.rasterInfo.multidimensionalInfo?R.getSliceIndex(M):null,I=(0,Xe.ph)(R.rasterId,C);if(I!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,Xe.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,Xe.kz)(I,R.rasterInfo),w){const{view:w}=S,P=this._tileInfoView.getClosestInfoForScale(w.scale),M=this._srcResolutions[P.level];(0,Xe.yo)(I,this._blockCacheRegistryId,w.extent,w.resolution,M,R.ioConfig.sampling)}this._blockCacheRegistryUrl=I}}async doRefresh(){if(!this.attached||!this.previousLOD||this.layerView.suspended)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const w=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.refresh((P=>w.push(this._enqueueTileFetch(P)))),await this._updatingHandles.addPromise(Promise.allSettled(w))}};(0,R._)([(0,U.MZ)()],ot.prototype,"_globalUpdateRequested",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"attached",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"container",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"layer",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"layerView",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"type",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"useWebGLForProcessing",null),(0,R._)([(0,U.MZ)()],ot.prototype,"useProgressiveUpdate",null),(0,R._)([(0,U.MZ)()],ot.prototype,"timeExtent",void 0),(0,R._)([(0,U.MZ)()],ot.prototype,"updating",null),ot=(0,R._)([(0,V.$)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],ot);var lt=S(23133),ut=S(90874);let ct=class extends ot{constructor(){super(...arguments),this.type="raster"}attach(){super.attach(),this.container=new RasterTileContainer_o(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}canUseWebGLForProcessing(){var w;const{symbolizer:P}=this.layer,S=null===(w=P.lookup)||void 0===w||null===(w=w.colormapLut)||void 0===w?void 0:w.indexedColormap,R=S&&S.length>this._maxIndexedColormapSize;return this.useWebGLForProcessing&&P.canRenderInWebGL&&!R&&!("majority"===this.layer.interpolation&&(0,lt.H_)(this.layer))}fetchTile(w,P){return this.layer.fetchTile(w.level,w.row,w.col,P)}updateRasterFunctionParameters(){const{clips:w,view:P}=this.layerView;null!=this._geometry&&w.remove(this._geometry);const{raster:S,type:R}=this.layer;if("Function"===S.datasetFormat){const R=S.getClippingGeometry(P.spatialReference);if(R){const P=new ut.A({geometry:R});w.add(P),this._geometry=P}}const{container:M}=this;if("Function"!==S.datasetFormat||"wcs"===R)return M.rasterFunctionChain=null,M.children.forEach((w=>{const{bitmap:P}=w;P&&(P.suspended=!0,P.processed=!1,P.projected&&(P.invalidateTexture(),P.rasterTexture=null))})),void(this._rasterFunctionState="na");const C=this._rasterFunctionState,{rasterFunction:I,primaryRasters:U}=S,V=I.supportsGPU&&(!U||U.rasters.length<=1),z=V?I.flatWebGLFunctionChain:null,{renderer:k}=this.layer,B=!V||!(null!==z&&void 0!==z&&z.functions.length)||"raster-stretch"===(null===k||void 0===k?void 0:k.type)&&k.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();M.rasterFunctionChain=B?null:z;const L=null==I?"na":M.rasterFunctionChain?"gpu":"cpu";M.children.forEach((w=>{const{bitmap:P}=w;P&&(P.suspended=C!==L,P.processed=!1,P.processedTexture=null)})),this._rasterFunctionState=L}async updateTileSource(w,P){const S=this._getBandIds(),R=this._getLayerInterpolation(),M=this.canUseWebGLForProcessing(),{source:C,globalSymbolizerParams:I,suspended:U,coords:V,resolution:z}=P,k=this.layerView.hasTilingEffects?I:P.symbolizerParams,{bitmap:B}=w;if([B.x,B.y]=V,B.resolution=z,null!=(null===C||void 0===C?void 0:C.pixelBlock)){const w={extent:C.extent,pixelBlock:C.pixelBlock,srcPixelSize:C.srcTilePixelSize};if(B.rawPixelData=w,M)B.source=C.pixelBlock,B.isRendereredSource=!1;else{const P=await this.layer.applyRenderer(w,"stretch"===(null===I||void 0===I?void 0:I.type)?I:void 0);B.source=P,B.isRendereredSource=!0}B.symbolizerParameters=M?k:null,B.transformGrid=M?C.transformGrid:null}else{const w=this.createEmptyTilePixelBlock();B.source=w,B.symbolizerParameters=M?k:null,B.transformGrid=null}B.bandIds=M?S:null,B.width=this._tileInfoView.tileInfo.size[0],B.height=this._tileInfoView.tileInfo.size[1],B.interpolation=R,B.suspended=U,B.invalidateTexture()}async updateTileSymbolizerParameters(w,P){const{local:S,global:R}=P,M=this._getBandIds(),C=this._getLayerInterpolation(),I=this.canUseWebGLForProcessing(),{bitmap:U}=w,{rawPixelData:V}=U;I||null==V?(U.isRendereredSource&&null!=V&&(U.source=V.pixelBlock),U.isRendereredSource=!1):(U.source=await this.layer.applyRenderer(V,"stretch"===(null===R||void 0===R?void 0:R.type)?R:void 0),U.isRendereredSource=!0),U.symbolizerParameters=I?this.layerView.hasTilingEffects?R:S:null,U.bandIds=I?M:null,U.interpolation=C,U.suspended=!1}_getLayerInterpolation(){const{interpolation:w,renderer:P}=this.layer;if(!P)return w;const S=P.type;return"raster-colormap"===S||"unique-value"===S||"class-breaks"===S?"nearest":"raster-stretch"===P.type&&null!=P.colorRamp?"bilinear"===w||"cubic"===w?"bilinear":"nearest":w}};(0,R._)([(0,U.MZ)()],ct.prototype,"container",void 0),(0,R._)([(0,U.MZ)()],ct.prototype,"layer",void 0),(0,R._)([(0,U.MZ)()],ct.prototype,"type",void 0),ct=(0,R._)([(0,V.$)("esri.views.2d.layers.imagery.ImageryTileView2D")],ct);const ht=ct;var dt=S(60782),pt=S(12747),mt=S(78282);class RasterVFTile_r extends qe.Y{constructor(w,P,S,R,M,C){let I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(w,P,S,R,M,C),this.tileData=new mt.X(I),this.tileData.coordScale=[M,C],this.tileData.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(w){this.tileData.stencilRef=w}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,Z.vt)(),tileMat3:(0,Z.vt)()}}setTransform(w){super.setTransform(w);const P=this.resolution/(w.resolution*w.pixelRatio),S=this.transforms.tileMat3,[R,M]=this.tileData.offset,C=[this.x+R*this.resolution,this.y-M*this.resolution],[I,U]=w.toScreenNoRotation([0,0],C),{symbolTileSize:V}=this.tileData.symbolizerParameters,z=Math.round((this.width-this.tileData.offset[0])/V)*V,k=Math.round((this.height-this.tileData.offset[1])/V)*V,B=z/this.rangeX*P,L=k/this.rangeY*P;(0,j.hZ)(S,B,0,0,0,L,0,I,U,1),(0,j.lw)(this.transforms.displayViewScreenMat3,w.displayViewMat3,S),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}class RasterVFTileContainer_o extends He.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(w){const P=this._tileInfoView.getTileBounds((0,L.vt)(),w),[S,R]=this._tileInfoView.tileInfo.size,M=this._tileInfoView.getTileResolution(w.level);return new RasterVFTile_r(w,M,P[0],P[3],S,R)}prepareRenderPasses(w){const P=w.registerRenderPass({name:"imagery (vf tile)",brushes:[pt.A],target:()=>this.children.map((w=>w.tileData)),drawPhase:We.S5.MAP});return[...super.prepareRenderPasses(w),P]}doRender(w){this.visible&&w.drawPhase===We.S5.MAP&&this.symbolTypes.forEach((P=>{w.renderPass=P,super.doRender(w)}))}}let ft=class extends ot{constructor(){super(...arguments),this._handle=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(w,P){P={...P,interpolation:"nearest",requestProjectedLocalDirections:!0};const S=await this.layer.fetchTile(w.level,w.row,w.col,P);return"vector-magdir"===this.layer.serviceRasterInfo.dataType&&null!==S&&void 0!==S&&S.pixelBlock&&(S.pixelBlock=await this.layer.convertVectorFieldData(S.pixelBlock,P)),S}updateTileSource(w,P){const S=P.symbolizerParams,{tileData:R}=w;R.key=w.key,R.width=this._tileInfoView.tileInfo.size[0],R.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:M}=S,{source:C}=P;if(R.offset=this._getTileSymbolOffset(R.key,M),null!=(null===C||void 0===C?void 0:C.pixelBlock)){const w={extent:C.extent,pixelBlock:C.pixelBlock};R.rawPixelData=w,R.symbolizerParameters=S,R.source=this._sampleVectorFieldData(C.pixelBlock,S,R.offset)}else{const w=[Math.round((this._tileInfoView.tileInfo.size[0]-R.offset[0])/M),Math.round((this._tileInfoView.tileInfo.size[1]-R.offset[1])/M)],P=this.createEmptyTilePixelBlock(w);R.source=P,R.symbolizerParameters=S}return R.invalidateVAO(),Promise.resolve()}updateTileSymbolizerParameters(w,P){var S;const R=P.local,{symbolTileSize:M}=R,{tileData:C}=w;C.offset=this._getTileSymbolOffset(C.key,M);const I=C.symbolizerParameters.symbolTileSize;C.symbolizerParameters=R;const U=null===(S=C.rawPixelData)||void 0===S?void 0:S.pixelBlock;return null!=U&&I!==M&&(C.source=this._sampleVectorFieldData(U,C.symbolizerParameters,C.offset)),Promise.resolve()}attach(){super.attach(),this.container=new RasterVFTileContainer_o(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,I.wB)((()=>this.layer.renderer),(w=>this._updateSymbolType(w)))}detach(){var w;super.detach(),this.container.removeAllChildren(),null!==(w=this._handle)&&void 0!==w&&w.remove(),this._handle=null,this.container=null}_getTileSymbolOffset(w,P){const S=w.col*this._tileInfoView.tileInfo.size[0]%P,R=w.row*this._tileInfoView.tileInfo.size[1]%P;return[S>P/2?P-S:-S,R>P/2?P-R:-R]}_sampleVectorFieldData(w,P,S){const{symbolTileSize:R}=P;return(0,dt.Wu)(w,"vector-uv",R,S)}_updateSymbolType(w){"vector-field"===w.type&&(this.container.symbolTypes="wind-barb"===w.style?["scalar","triangle"]:"simple-scalar"===w.style?["scalar"]:["triangle"])}};(0,R._)([(0,U.MZ)()],ft.prototype,"container",void 0),(0,R._)([(0,U.MZ)()],ft.prototype,"layer",void 0),(0,R._)([(0,U.MZ)()],ft.prototype,"type",void 0),ft=(0,R._)([(0,V.$)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],ft);const gt=ft;var vt=S(13812),_t=S(4180),yt=S(32277),xt=S(54217);const ImageryTileLayerView_p=w=>{let P=class extends w{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return(0,et.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return(0,et.vI)(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(w){return!!(0,et.eh)(this.layer.serviceRasterInfo,w)}async fetchPopupFeaturesAtLocation(w,P){const{layer:S}=this;if(!w)throw new _t.A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:S});const{popupEnabled:R}=S,M=(0,xt.D8)(S,P);if(!R||null==M)throw new _t.A("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:R,popupTemplate:M});const C=[],{value:I,magdirValue:U,processedValue:V}=await S.identify(w,{timeExtent:this.timeExtent,signal:null===P||void 0===P?void 0:P.signal});let z="";if(I&&I.length){z="imagery-tile"===S.type&&S.hasStandardTime()&&null!=I[0]?I.map((w=>S.getStandardTimeValue(w))).join(", "):I.join(", ");const w={ObjectId:0},P="Raster.ServicePixelValue";w[P]="imagery-tile"===S.type&&"Function"===S.raster.datasetFormat?null===V||void 0===V?void 0:V.join(", "):z,w[P+".Raw"]=z;const R=S.serviceRasterInfo.attributeTable;if(null!=R){const{fields:P,features:S}=R,M=P.find((w=>{let{name:P}=w;return"value"===P.toLowerCase()})),C=M?S.find((w=>String(w.attributes[M.name])===z)):null;if(C)for(const R in C.attributes)C.attributes.hasOwnProperty(R)&&(w[this._rasterFieldPrefix+R]=C.attributes[R])}const M=S.serviceRasterInfo.dataType;"vector-magdir"!==M&&"vector-uv"!==M||(w["Raster.Magnitude"]=null===U||void 0===U?void 0:U[0],w["Raster.Direction"]=null===U||void 0===U?void 0:U[1]);const k=new vt.A(this.fullExtent.clone(),null,w);k.layer=S,k.sourceLayer=k.layer,C.push(k)}return C}};return(0,R._)([(0,U.MZ)()],P.prototype,"layer",void 0),(0,R._)([(0,U.MZ)(yt.ui)],P.prototype,"timeExtent",void 0),(0,R._)([(0,U.MZ)()],P.prototype,"view",void 0),(0,R._)([(0,U.MZ)()],P.prototype,"fullExtent",null),(0,R._)([(0,U.MZ)()],P.prototype,"tileInfo",void 0),(0,R._)([(0,U.MZ)({readOnly:!0})],P.prototype,"hasTilingEffects",null),(0,R._)([(0,U.MZ)()],P.prototype,"datumTransformation",null),P=(0,R._)([(0,V.$)("esri.views.layers.ImageryTileLayerView")],P),P};var bt=S(27012),wt=S(59995);let Tt=class extends(ImageryTileLayerView_p((0,wt.A)((0,B.e)(bt.A)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(w){this._useWebGLForProcessing=w,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=w)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(w){this._useProgressiveUpdate=w,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=w)}get displayParameters(){const{layer:w}=this,P=this._get("displayParameters");return w.renderer?{bandIds:w.bandIds,renderer:w.renderer,interpolation:w.interpolation,multidimensionalDefinition:w.multidimensionalDefinition,rasterFunction:"imagery-tile"===w.type?w.rasterFunction:null}:P}update(w){var P;null!==(P=this.subview)&&void 0!==P&&P.update(w),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,I.wB)((()=>this.displayParameters),((w,P)=>{const S=w.interpolation!==(null===P||void 0===P?void 0:P.interpolation)&&("majority"===w.interpolation||"majority"===(null===P||void 0===P?void 0:P.interpolation))&&(0,lt.H_)(this.layer),R=w.renderer!==(null===P||void 0===P?void 0:P.renderer)&&this._getSubviewType(null===P||void 0===P?void 0:P.renderer)!==this._getSubviewType(w.renderer);R&&this._updateSubview();const I=w.multidimensionalDefinition!==(null===P||void 0===P?void 0:P.multidimensionalDefinition),U=w.rasterFunction!==(null===P||void 0===P?void 0:P.rasterFunction),V=U&&!this._useWebGLForProcessing,z=I||S||R||V;this.subview.redrawOrRefetch({refetch:z,reprocess:U}).catch((w=>{(0,C.zf)(w)||M.A.getLogger(this).error(w)})),this.notifyChange("updating")})),(0,I.wB)((()=>{var w;return null!==(w=this.layer.multidimensionalSubset)&&void 0!==w?w:null}),((w,P)=>{const{multidimensionalDefinition:S}=this.layer;null!=S&&(0,z.sx)(S,w)!==(0,z.sx)(S,P)&&(this.subview.redrawOrRefetch({refetch:!0}).catch((w=>{(0,C.zf)(w)||M.A.getLogger(this).error(w)})),this.notifyChange("updating"))}),I.OH),(0,I.wB)((()=>this.timeExtent),(()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch({refetch:!0}).catch((w=>{(0,C.zf)(w)||M.A.getLogger(this).error(w)}))}),I.Vh)])}detach(){var w;this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null!==(w=this.subview)&&void 0!==w&&w.destroy(),this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){const{renderer:w}=this.layer;if(!w)return;const P=this._getSubviewType(w);if(this.subview){var S;if(this.subview.type===P)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null!==(S=this.subview)&&void 0!==S&&S.destroy(),this.subview=null}const{layer:R}=this;let M;if(M="rasterVF"===P?new gt({layer:R,layerView:this}):"flow"===P?new k.A({layer:R,layerView:this}):new ht({layer:R,layerView:this}),"useWebGLForProcessing"in M&&(M.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in M&&(M.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in M){const{subview:w}=this;M.previousLOD=w&&"previousLOD"in w?w.previousLOD:null}this._attachSubview(M),this.subview=M,this.requestUpdate()}_attachSubview(w){w&&!w.attached&&(w.attach(),w.attached=!0,this.container.addChildAt(w.container,0))}_detachSubview(w){(null===w||void 0===w?void 0:w.attached)&&(this.container.removeChild(w.container),w.detach(),w.attached=!1)}_getSubviewType(w){const P=null===w||void 0===w?void 0:w.type;return"vector-field"===P?"rasterVF":"flow"===P?"flow":"raster"}};(0,R._)([(0,U.MZ)()],Tt.prototype,"subview",void 0),(0,R._)([(0,U.MZ)()],Tt.prototype,"useWebGLForProcessing",null),(0,R._)([(0,U.MZ)()],Tt.prototype,"useProgressiveUpdate",null),(0,R._)([(0,U.MZ)({readOnly:!0})],Tt.prototype,"displayParameters",null),Tt=(0,R._)([(0,V.$)("esri.views.2d.layers.ImageryTileLayerView2D")],Tt);const Pt=Tt},86083:(w,P,S)=>{S.d(P,{e:()=>m});var R,M=S(80671),C=S(39652),I=S(86479),U=S(4180),V=S(63390),z=S(57453),k=(S(50886),S(89412),S(76761),S(68682)),B=S(16906),L=S(5528),G=S(45104),N=S(6673);let j=R=class extends N.A{constructor(w){super(w),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new R({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,M._)([(0,z.MZ)({type:[Number,String],json:{write:!0}})],j.prototype,"left",void 0),(0,M._)([(0,z.MZ)({type:[Number,String],json:{write:!0}})],j.prototype,"right",void 0),(0,M._)([(0,z.MZ)({type:[Number,String],json:{write:!0}})],j.prototype,"top",void 0),(0,M._)([(0,z.MZ)({type:[Number,String],json:{write:!0}})],j.prototype,"bottom",void 0),j=R=(0,M._)([(0,k.$)("esri.views.layers.support.ClipRect")],j);const Z=j;var q=S(90874);let W=class extends N.A{constructor(w){super(w),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,M._)([(0,z.MZ)({type:[[[Number]]],json:{write:!0}})],W.prototype,"path",void 0),W=(0,M._)([(0,k.$)("esri.views.layers.support.Path")],W);const H=W,Q=C.A.ofType({key:"type",base:null,typeMap:{rect:Z,path:H,geometry:q.A}}),m=w=>{let P=class extends w{constructor(){super(...arguments),this.attached=!1,this.clips=new Q,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1,this.highlightOptions=null}initialize(){var w,P,S,R;const M=null===(w=null===(P=this.view)||void 0===P?void 0:P.spatialReferenceLocked)||void 0===w||w;(null===(S=this.view)||void 0===S?void 0:S.spatialReference)&&M&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new U.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new L.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,V.wB)((()=>this.suspended),(w=>{this.container&&(this.container.visible=!w)}),V.pc),(0,V.wB)((()=>this.updateSuspended),(w=>{this.view&&!w&&this.updateRequested&&this.view.requestUpdate()}),V.pc),(0,V.wB)((()=>{var w,P;return null!==(w=null===(P=this.layer)||void 0===P?void 0:P.opacity)&&void 0!==w?w:1}),(w=>{this.container&&(this.container.opacity=w)}),V.pc),(0,V.wB)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(w=>{this.container&&(this.container.blendMode=w)}),V.pc),(0,V.wB)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(w=>{this.container&&(this.container.effect=w)}),V.pc),(0,V.wB)((()=>this.highlightOptions),(w=>this.container.highlightOptions=w),V.pc),(0,V.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),V.pc),(0,V.wB)((()=>{var w;return{scale:null===(w=this.view)||void 0===w?void 0:w.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}}),(w=>{let{scale:P}=w;const S=null!=P&&this.isVisibleAtScale(P);S!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",S)}),V.pc)],"constructor"),null!==(R=this.view)&&void 0!==R&&R.whenLayerView?this.view.whenLayerView(this.layer).then((w=>{w===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var w;const P=null===(w=this.view)||void 0===w?void 0:w.spatialReference;return null==P||this.supportsSpatialReference(P)}get updateSuspended(){return this.suspended}get updating(){var w;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(w=this._updatingHandles)||void 0===w||!w.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(w){const P=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!P)return!0;const{minScale:S,maxScale:R}=P;return(0,B.zx)(w,S,R)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(w){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",w),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(w))):this.updateRequested=!1}hitTest(w,P){return Promise.resolve(null)}supportsSpatialReference(w){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const w=super.getSuspendInfo(),P=!this.spatialReferenceSupported,S=this.visibleAtCurrentScale;return P&&(w.spatialReferenceNotSupported=P),S&&(w.outsideScaleRange=S),w}addAttachHandles(w){this.addHandles(w,"attach")}};return(0,M._)([(0,z.MZ)()],P.prototype,"attached",void 0),(0,M._)([(0,z.MZ)({type:Q,set(w){const P=(0,I.V)(w,this._get("clips"),Q);this._set("clips",P)}})],P.prototype,"clips",void 0),(0,M._)([(0,z.MZ)()],P.prototype,"container",void 0),(0,M._)([(0,z.MZ)()],P.prototype,"moving",void 0),(0,M._)([(0,z.MZ)({readOnly:!0})],P.prototype,"spatialReferenceSupported",null),(0,M._)([(0,z.MZ)({readOnly:!0})],P.prototype,"updateParameters",void 0),(0,M._)([(0,z.MZ)()],P.prototype,"updateRequested",void 0),(0,M._)([(0,z.MZ)()],P.prototype,"updateSuspended",null),(0,M._)([(0,z.MZ)()],P.prototype,"updating",null),(0,M._)([(0,z.MZ)()],P.prototype,"view",void 0),(0,M._)([(0,z.MZ)({readOnly:!0})],P.prototype,"visibleAtCurrentScale",void 0),(0,M._)([(0,z.MZ)({type:G.A})],P.prototype,"highlightOptions",void 0),P=(0,M._)([(0,k.$)("esri.views.2d.layers.LayerView2D")],P),P}},27012:(w,P,S)=>{S.d(P,{A:()=>N});var R=S(80671),M=S(18763),C=S(73067),I=S(16904),U=S(89412),V=S(35598),z=S(5203),k=S(57453),B=(S(50886),S(76761),S(68682)),L=S(31059);let G=class extends((0,I.sA)((0,z.g)(C.A.EventedMixin(M.A)))){constructor(w){super(w),this._updatingHandles=new L.U,this.layer=null,this.parent=null}initialize(){this.when().catch((w=>{if("layerview:create-error"!==w.name){var P;const S=this.layer&&this.layer.id||"no id",R=(null===(P=this.layer)||void 0===P?void 0:P.title)||"no title";U.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(R,"', id: '").concat(S,"')"),w)}}))}destroy(){this._updatingHandles=(0,V.pR)(this._updatingHandles)}get fullOpacity(){var w,P,S,R;return(null!==(w=null===(P=this.layer)||void 0===P?void 0:P.opacity)&&void 0!==w?w:1)*(null!==(S=null===(R=this.parent)||void 0===R?void 0:R.fullOpacity)&&void 0!==S?S:1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var w;return!this.suspended&&!0===(null===(w=this.layer)||void 0===w?void 0:w.legendEnabled)}get updating(){var w;return!((null===(w=this._updatingHandles)||void 0===w||!w.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var w;return!0===(null===(w=this.layer)||void 0===w?void 0:w.visible)}set visible(w){this._overrideIfSome("visible",w)}canResume(){var w,P,S;return this.visible&&(null===(w=this.layer)||void 0===w?void 0:w.loaded)&&!(null!==(P=this.parent)&&void 0!==P&&P.suspended)&&(null===(S=this.view)||void 0===S?void 0:S.ready)||!1}getSuspendInfo(){var w,P;const S=null!==(w=this.parent)&&void 0!==w&&w.suspended?this.parent.suspendInfo:{};return null!==(P=this.view)&&void 0!==P&&P.ready||(S.viewNotReady=!0),this.layer&&this.layer.loaded||(S.layerNotLoaded=!0),this.visible||(S.layerInvisible=!0),S}isUpdating(){return!1}};(0,R._)([(0,k.MZ)()],G.prototype,"fullOpacity",null),(0,R._)([(0,k.MZ)()],G.prototype,"layer",void 0),(0,R._)([(0,k.MZ)()],G.prototype,"parent",void 0),(0,R._)([(0,k.MZ)({readOnly:!0})],G.prototype,"suspended",null),(0,R._)([(0,k.MZ)({readOnly:!0})],G.prototype,"suspendInfo",null),(0,R._)([(0,k.MZ)({readOnly:!0})],G.prototype,"legendEnabled",null),(0,R._)([(0,k.MZ)({type:Boolean,readOnly:!0})],G.prototype,"updating",null),(0,R._)([(0,k.MZ)({readOnly:!0})],G.prototype,"updatingProgress",null),(0,R._)([(0,k.MZ)()],G.prototype,"visible",null),(0,R._)([(0,k.MZ)()],G.prototype,"view",void 0),G=(0,R._)([(0,B.$)("esri.views.layers.LayerView")],G);const N=G},6673:(w,P,S)=>{S.d(P,{A:()=>V});var R=S(80671),M=S(83375),C=S(57453),I=(S(50886),S(89412),S(76761),S(68682));let U=class extends M.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,R._)([(0,C.MZ)({readOnly:!0})],U.prototype,"version",null),U=(0,R._)([(0,I.$)("esri.views.layers.support.ClipArea")],U);const V=U},90874:(w,P,S)=>{S.d(P,{A:()=>N});var R,M=S(80671),C=(S(30174),S(57453)),I=(S(50886),S(89412),S(76761),S(68682)),U=S(66445),V=S(31670),z=S(6673),k=S(84661),B=S(48343);const L={base:U.A,key:"type",typeMap:{extent:k.A,polygon:B.A}};let G=R=class extends z.A{constructor(w){super(w),this.type="geometry",this.geometry=null}clone(){var w,P;return new R({geometry:null!==(w=null===(P=this.geometry)||void 0===P?void 0:P.clone())&&void 0!==w?w:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,M._)([(0,C.MZ)({types:L,json:{read:V.rS,write:!0}})],G.prototype,"geometry",void 0),G=R=(0,M._)([(0,I.$)("esri.views.layers.support.Geometry")],G);const N=G},95493:(w,P,S)=>{S.d(P,{EO:()=>h,OI:()=>A,Pp:()=>_,Qg:()=>g,VC:()=>p,b4:()=>f,hB:()=>O,hE:()=>m,kc:()=>c,xV:()=>l,z:()=>T});var R=S(52273),M=S(60985),C=S(83663),I=S(83881);function f(w,P){var S;let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest";const U=!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&"u8"===P.pixelType),V=U?M.ld.FLOAT:M.ld.UNSIGNED_BYTE,z=null==P.pixels||0===P.pixels.length?null:U?P.getAsRGBAFloat():P.getAsRGBA(),k=null===(S=w.capabilities.textureFloat)||void 0===S?void 0:S.textureFloatLinear,B=new I.R;return B.width=P.width,B.height=P.height,B.internalFormat=U?M.H0.RGBA32F:M.Ab.RGBA,B.samplingMode=!k||"bilinear"!==R&&"cubic"!==R?M.Cj.NEAREST:M.Cj.LINEAR,B.dataType=V,B.wrapMode=M.pF.CLAMP_TO_EDGE,new C.g(w,B,z)}function c(w,P){const{spacing:S,offsets:R,coefficients:U,size:[V,z]}=P,k=S[0]>1,B=new I.R;B.width=k?4*V:V,B.height=z,B.internalFormat=M.H0.RGBA32F,B.dataType=M.ld.FLOAT,B.samplingMode=M.Cj.NEAREST,B.wrapMode=M.pF.CLAMP_TO_EDGE;const L=new Float32Array(k?V*z*16:2*R.length);if(k&&null!=U)for(let M=0,C=0;M<U.length;M++)L[C++]=U[M],M%3==2&&(L[C++]=1);else for(let M=0;M<z;M++)for(let w=0;w<V;w++){const P=4*(M*V+w),S=2*(w*z+M);L[P]=R[S],L[P+1]=R[S+1],L[P+3]=-1===R[S]?0:1}return new C.g(w,B,L)}function m(w,P){const S=new I.R;return S.internalFormat=M.Ab.RGBA,S.width=P.length/4,S.height=1,S.samplingMode=M.Cj.NEAREST,S.wrapMode=M.pF.CLAMP_TO_EDGE,new C.g(w,S,P)}function l(w,P,S){return{u_flipY:!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u_applyTransform:!!w,u_opacity:arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u_transformSpacing:w?w.spacing:R.uY,u_transformGridSize:w?w.size:R.uY,u_targetImageSize:P,u_srcImageSize:S}}function _(w,P){return{u_colormapOffset:P||0,u_colormapMaxIndex:w?w.length/4-1:0}}function g(w,P){return{u_scale:w,u_offset:P}}function p(w){return{u_bandCount:w.bandCount,u_minOutput:w.outMin,u_maxOutput:w.outMax,u_minCutOff:w.minCutOff,u_maxCutOff:w.maxCutOff,u_factor:w.factor,u_useGamma:w.useGamma,u_gamma:w.gamma,u_gammaCorrection:w.gammaCorrection}}function A(w){return{u_hillshadeType:w.hillshadeType,u_sinZcosAs:w.sinZcosAs,u_sinZsinAs:w.sinZsinAs,u_cosZs:w.cosZs,u_weights:w.weights,u_factor:w.factor,u_minValue:w.minValue,u_maxValue:w.maxValue}}function T(w,P){const S=w.gl,R=P.glName,M=new Map;if(null==R)return M;const C=S.getProgramParameter(R,S.ACTIVE_UNIFORMS);let I;for(let U=0;U<C;U++)I=S.getActiveUniform(R,U),I&&M.set(I.name,{location:S.getUniformLocation(R,I.name),info:I});return M}function h(w,P,S){Object.keys(S).forEach((R=>{const C=P.get(R)||P.get(R+"[0]");C&&function E(w,P,S,R){if(null===R||null==S)return!1;const{info:C}=R;switch(C.type){case M.xV.FLOAT:C.size>1?w.setUniform1fv(P,S):w.setUniform1f(P,S);break;case M.xV.FLOAT_VEC2:w.setUniform2fv(P,S);break;case M.xV.FLOAT_VEC3:w.setUniform3fv(P,S);break;case M.xV.FLOAT_VEC4:w.setUniform4fv(P,S);break;case M.xV.FLOAT_MAT3:w.setUniformMatrix3fv(P,S);break;case M.xV.FLOAT_MAT4:w.setUniformMatrix4fv(P,S);break;case M.xV.INT:C.size>1?w.setUniform1iv(P,S):w.setUniform1i(P,S);break;case M.xV.BOOL:w.setUniform1i(P,S?1:0);break;case M.xV.INT_VEC2:case M.xV.BOOL_VEC2:w.setUniform2iv(P,S);break;case M.xV.INT_VEC3:case M.xV.BOOL_VEC3:w.setUniform3iv(P,S);break;case M.xV.INT_VEC4:case M.xV.BOOL_VEC4:w.setUniform4iv(P,S);break;default:return!1}return!0}(w,R,S[R],C)}))}function O(w,P,S,R){S.length===R.length&&(R.some((w=>null==w))||S.some((w=>null==w))||S.forEach(((S,M)=>{P.setUniform1i(S,M),w.bindTexture(R[M],M)})))}}}]);
//# sourceMappingURL=223.d7fb522f.chunk.js.map