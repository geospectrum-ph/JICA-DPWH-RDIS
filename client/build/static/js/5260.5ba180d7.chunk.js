"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[5260],{11277:(T,R,M)=>{var A;M.d(R,{u:()=>A}),function(T){T[T.KILOBYTES=1024]="KILOBYTES",T[T.MEGABYTES=1048576]="MEGABYTES",T[T.GIGABYTES=1073741824]="GIGABYTES"}(A||(A={}))},30925:(T,R,M)=>{M.d(R,{w:()=>s});var A=M(16842),O=M(17244),z=M(60964);class s{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,R=arguments.length>1?arguments[1]:void 0;this._compareMinX=o,this._compareMinY=l,this._toBBox=T=>T,this._maxEntries=Math.max(4,T||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),R&&("function"==typeof R?this._toBBox=R:this._initFormat(R)),this.clear()}destroy(){this.clear(),N.prune(),H.prune(),Z.prune(),D.prune()}all(T){this._all(this._data,T)}search(T,R){let M=this._data;const A=this._toBBox;if(x(T,M))for(N.clear();M;){for(let O=0,z=M.children.length;O<z;O++){const z=M.children[O],H=M.leaf?A(z):z;x(T,H)&&(M.leaf?R(z):_(T,H)?this._all(z,R):N.push(z))}M=N.pop()}}collides(T){let R=this._data;const M=this._toBBox;if(!x(T,R))return!1;for(N.clear();R;){for(let A=0,O=R.children.length;A<O;A++){const O=R.children[A],z=R.leaf?M(O):O;if(x(T,z)){if(R.leaf||_(T,z))return!0;N.push(O)}}R=N.pop()}return!1}load(T){if(!T.length)return this;if(T.length<this._minEntries){for(let R=0,M=T.length;R<M;R++)this.insert(T[R]);return this}let R=this._build(T.slice(0,T.length),0,T.length-1,0);if(this._data.children.length)if(this._data.height===R.height)this._splitRoot(this._data,R);else{if(this._data.height<R.height){const T=this._data;this._data=R,R=T}this._insert(R,this._data.height-R.height-1,!0)}else this._data=R;return this}insert(T){return T&&this._insert(T,this._data.height-1),this}clear(){return this._data=new w([]),this}remove(T){if(!T)return this;let R,M=this._data,O=null,z=0,N=!1;const H=this._toBBox(T);for(Z.clear(),D.clear();M||Z.length>0;){var q;if(M||(M=Z.pop(),O=Z.data[Z.length-1],z=null!==(q=D.pop())&&void 0!==q?q:0,N=!0),M.leaf&&(R=(0,A.qh)(M.children,T,M.children.length,M.indexHint),-1!==R))return M.children.splice(R,1),Z.push(M),this._condense(Z),this;N||M.leaf||!_(M,H)?O?(z++,M=O.children[z],N=!1):M=null:(Z.push(M),D.push(z),z=0,O=M,M=M.children[0])}return this}toJSON(){return this._data}fromJSON(T){return this._data=T,this}_all(T,R){let M=T;for(H.clear();M;){var A;if(!0===M.leaf)for(const T of M.children)R(T);else H.pushArray(M.children);M=null!==(A=H.pop())&&void 0!==A?A:null}}_build(T,R,M,A){const O=M-R+1;let z=this._maxEntries;if(O<=z){const A=new w(T.slice(R,M+1));return h(A,this._toBBox),A}A||(A=Math.ceil(Math.log(O)/Math.log(z)),z=Math.ceil(O/z**(A-1)));const N=new b([]);N.height=A;const H=Math.ceil(O/z),Z=H*Math.ceil(Math.sqrt(z));f(T,R,M,Z,this._compareMinX);for(let D=R;D<=M;D+=Z){const R=Math.min(D+Z-1,M);f(T,D,R,H,this._compareMinY);for(let M=D;M<=R;M+=H){const O=Math.min(M+H-1,R);N.children.push(this._build(T,M,O,A-1))}}return h(N,this._toBBox),N}_chooseSubtree(T,R,M,A){for(;A.push(R),!0!==R.leaf&&A.length-1!==M;){let M,A=1/0,O=1/0;for(let z=0,N=R.children.length;z<N;z++){const N=R.children[z],H=c(N),Z=d(T,N)-H;Z<O?(O=Z,A=H<A?H:A,M=N):Z===O&&H<A&&(A=H,M=N)}R=M||R.children[0]}return R}_insert(T,R,M){const A=this._toBBox,O=M?T:A(T);Z.clear();const z=this._chooseSubtree(O,this._data,R,Z);for(z.children.push(T),r(z,O);R>=0&&Z.data[R].children.length>this._maxEntries;)this._split(Z,R),R--;this._adjustParentBBoxes(O,Z,R)}_split(T,R){const M=T.data[R],A=M.children.length,O=this._minEntries;this._chooseSplitAxis(M,O,A);const z=this._chooseSplitIndex(M,O,A);if(!z)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const N=M.children.splice(z,M.children.length-z),H=M.leaf?new w(N):new b(N);H.height=M.height,h(M,this._toBBox),h(H,this._toBBox),R?T.data[R-1].children.push(H):this._splitRoot(M,H)}_splitRoot(T,R){this._data=new b([T,R]),this._data.height=T.height+1,h(this._data,this._toBBox)}_chooseSplitIndex(T,R,M){let A,O,z;A=O=1/0;for(let N=R;N<=M-R;N++){const R=a(T,0,N,this._toBBox),H=a(T,N,M,this._toBBox),Z=u(R,H),D=c(R)+c(H);Z<A?(A=Z,z=N,O=D<O?D:O):Z===A&&D<O&&(O=D,z=N)}return z}_chooseSplitAxis(T,R,M){const A=T.leaf?this._compareMinX:o,O=T.leaf?this._compareMinY:l;this._allDistMargin(T,R,M,A)<this._allDistMargin(T,R,M,O)&&T.children.sort(A)}_allDistMargin(T,R,M,A){T.children.sort(A);const O=this._toBBox,z=a(T,0,R,O),N=a(T,M-R,M,O);let H=m(z)+m(N);for(let Z=R;Z<M-R;Z++){const R=T.children[Z];r(z,T.leaf?O(R):R),H+=m(z)}for(let Z=M-R-1;Z>=R;Z--){const R=T.children[Z];r(N,T.leaf?O(R):R),H+=m(N)}return H}_adjustParentBBoxes(T,R,M){for(let A=M;A>=0;A--)r(R.data[A],T)}_condense(T){for(let R=T.length-1;R>=0;R--){const M=T.data[R];if(0===M.children.length)if(R>0){const O=T.data[R-1],z=O.children;z.splice((0,A.qh)(z,M,z.length,O.indexHint),1)}else this.clear();else h(M,this._toBBox)}}_initFormat(T){const R=["return a"," - b",";"];this._compareMinX=new Function("a","b",R.join(T[0])),this._compareMinY=new Function("a","b",R.join(T[1])),this._toBBox=new Function("a","return {minX: a"+T[0]+", minY: a"+T[1]+", maxX: a"+T[2]+", maxY: a"+T[3]+"};")}}function h(T,R){a(T,0,T.children.length,R,T)}function a(T,R,M,A,O){O||(O=new w([])),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(let z,N=R;N<M;N++)z=T.children[N],r(O,T.leaf?A(z):z);return O}function r(T,R){T.minX=Math.min(T.minX,R.minX),T.minY=Math.min(T.minY,R.minY),T.maxX=Math.max(T.maxX,R.maxX),T.maxY=Math.max(T.maxY,R.maxY)}function o(T,R){return T.minX-R.minX}function l(T,R){return T.minY-R.minY}function c(T){return(T.maxX-T.minX)*(T.maxY-T.minY)}function m(T){return T.maxX-T.minX+(T.maxY-T.minY)}function d(T,R){return(Math.max(R.maxX,T.maxX)-Math.min(R.minX,T.minX))*(Math.max(R.maxY,T.maxY)-Math.min(R.minY,T.minY))}function u(T,R){const M=Math.max(T.minX,R.minX),A=Math.max(T.minY,R.minY),O=Math.min(T.maxX,R.maxX),z=Math.min(T.maxY,R.maxY);return Math.max(0,O-M)*Math.max(0,z-A)}function _(T,R){return T.minX<=R.minX&&T.minY<=R.minY&&R.maxX<=T.maxX&&R.maxY<=T.maxY}function x(T,R){return R.minX<=T.maxX&&R.minY<=T.maxY&&R.maxX>=T.minX&&R.maxY>=T.minY}function f(T,R,M,A,O){const N=[R,M];for(;N.length;){const R=N.pop(),M=N.pop();if(R-M<=A)continue;const H=M+Math.ceil((R-M)/A/2)*A;(0,z.q)(T,H,M,R,O),N.push(M,H,H,R)}}const N=new O.A,H=new O.A,Z=new O.A,D=new O.A({deallocator:void 0});class Y{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class B extends Y{constructor(){super(...arguments),this.height=1,this.indexHint=new A.vW}}class w extends B{constructor(T){super(),this.children=T,this.leaf=!0}}class b extends B{constructor(T){super(),this.children=T,this.leaf=!1}}},77026:(T,R,M)=>{M.d(R,{g:()=>A});const A={convertToGEGeometry:function s(T,R){return null==R?null:T.convertJSONToGeometry(R)},exportPoint:function n(T,R,M){const A=new i(T.getPointX(R),T.getPointY(R),M),O=T.hasZ(R),z=T.hasM(R);return O&&(A.z=T.getPointZ(R)),z&&(A.m=T.getPointM(R)),A},exportPolygon:function o(T,R,M){return new e(T.exportPaths(R),M,T.hasZ(R),T.hasM(R))},exportPolyline:function a(T,R,M){return new h(T.exportPaths(R),M,T.hasZ(R),T.hasM(R))},exportMultipoint:function c(T,R,M){return new r(T.exportPoints(R),M,T.hasZ(R),T.hasM(R))},exportExtent:function m(T,R,M){const A=T.hasZ(R),O=T.hasM(R),z=new x(T.getXMin(R),T.getYMin(R),T.getXMax(R),T.getYMax(R),M);if(A){const M=T.getZExtent(R);z.zmin=M.vmin,z.zmax=M.vmax}if(O){const M=T.getMExtent(R);z.mmin=M.vmin,z.mmax=M.vmax}return z}};class i{constructor(T,R,M){this.x=T,this.y=R,this.spatialReference=M,this.z=void 0,this.m=void 0}}class e{constructor(T,R,M,A){this.rings=T,this.spatialReference=R,this.hasZ=void 0,this.hasM=void 0,M&&(this.hasZ=M),A&&(this.hasM=A)}}class h{constructor(T,R,M,A){this.paths=T,this.spatialReference=R,this.hasZ=void 0,this.hasM=void 0,M&&(this.hasZ=M),A&&(this.hasM=A)}}class r{constructor(T,R,M,A){this.points=T,this.spatialReference=R,this.hasZ=void 0,this.hasM=void 0,M&&(this.hasZ=M),A&&(this.hasM=A)}}class x{constructor(T,R,M,A,O){this.xmin=T,this.ymin=R,this.xmax=M,this.ymax=A,this.spatialReference=O,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},61816:(T,R,M)=>{M.d(R,{F:()=>o});var A=M(50886),O=M(30925),z=M(88965);const N={minX:0,minY:0,maxX:0,maxY:0};function e(T,R,M){(function t(T){N.minX=T[0],N.minY=T[1],N.maxX=T[2],N.maxY=T[3]})(R),T.search(N,M)}class o{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new O.w(9,(0,A.A)("esri-csp-restrictions")?T=>({minX:T[0],minY:T[1],maxX:T[2],maxY:T[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const T=new Array(this._idByBounds.size);let R=0;this._idByBounds.forEach(((M,A)=>{T[R++]=A})),this._indexInvalid=!1,this._index.clear(),this._index.load(T)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((T=>this._idByBounds.has(T)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const T=(0,z.Ie)();for(const R of this._boundsById.values())R&&(T[0]=Math.min(R[0],T[0]),T[1]=Math.min(R[1],T[1]),T[2]=Math.max(R[2],T[2]),T[3]=Math.max(R[3],T[3]));return T}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(T){const R=this._boundsById.get(T);this._boundsById.delete(T),R&&(this._idByBounds.delete(R),this._indexInvalid||this._index.remove(R))}forEachInBounds(T,R){this._loadIndex(),e(this._index,T,(T=>R(this._idByBounds.get(T))))}get(T){return this._boundsById.get(T)}has(T){return this._boundsById.has(T)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(T,R){if(!this._indexInvalid){const R=this._boundsById.get(T);R&&(this._index.remove(R),this._idByBounds.delete(R))}this._boundsById.set(T,R),R&&(this._idByBounds.set(R,T),this._indexInvalid||(this._boundsToLoad.push(R),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},45691:(T,R,M)=>{M.d(R,{A:()=>m});var A=M(16842),O=M(4180),z=M(73067),N=M(89412),H=M(21374),Z=M(88965),D=M(32050),q=M(61816),X=M(23047),k=M(19464);const J=(0,H.vt)();class m{constructor(T){this.geometryInfo=T,this._boundsStore=new q.F,this._featuresById=new Map,this._markedIds=new Set,this.events=new z.A,this.featureAdapter=k.T}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let T=0;return this._featuresById.forEach((R=>{null!=R.geometry&&R.geometry.coords&&(T+=R.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:T/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(T){if(null==this.fullBounds)return null;const[R,M,A,O]=this.fullBounds;return{xmin:R,ymin:M,xmax:A,ymax:O,spatialReference:(0,X.ag)(T)}}add(T){this._add(T),this._emitChanged()}addMany(T){for(const R of T)this._add(R);this._emitChanged()}upsertMany(T){const R=T.map((T=>this._upsert(T)));return this._emitChanged(),R.filter(A.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(T){const R=this._featuresById.get(T);return R?(this._remove(R),this._emitChanged(),R):null}removeManyById(T){this._boundsStore.invalidateIndex();for(const R of T){const T=this._featuresById.get(R);T&&this._remove(T)}this._emitChanged()}forEachBounds(T,R){for(const M of T){const T=this._boundsStore.get(M.objectId);T&&R((0,H.Jt)(J,T))}}getFeature(T){return this._featuresById.get(T)}has(T){return this._featuresById.has(T)}forEach(T){this._featuresById.forEach((R=>T(R)))}forEachInBounds(T,R){this._boundsStore.forEachInBounds(T,(T=>{R(this._featuresById.get(T))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let T=!1;this._featuresById.forEach(((R,M)=>{this._markedIds.has(M)||(T=!0,this._remove(R))})),this._markedIds.clear(),T&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(T){var R;if(!T)return;const M=T.objectId;if(null==M)return void N.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new O.A("featurestore:invalid-feature","feature id is missing",{feature:T}));const A=this._featuresById.get(M);let z;if(this._markedIds.add(M),A?(T.displayId=A.displayId,z=this._boundsStore.get(M),this._boundsStore.delete(M)):null!=this.onFeatureAdd&&this.onFeatureAdd(T),null===(R=T.geometry)||void 0===R||null===(R=R.coords)||void 0===R||!R.length)return this._boundsStore.set(M,null),void this._featuresById.set(M,T);z=(0,D.jQ)(null!=z?z:(0,Z.vt)(),T.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=z&&this._boundsStore.set(M,z),this._featuresById.set(M,T)}_upsert(T){var R;const M=null===T||void 0===T?void 0:T.objectId;if(null==M)return N.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new O.A("featurestore:invalid-feature","feature id is missing",{feature:T})),null;const A=this._featuresById.get(M);if(!A)return this._add(T),T;this._markedIds.add(M);const{geometry:z,attributes:H}=T;for(const O in H)A.attributes[O]=H[O];return z&&(A.geometry=z,this._boundsStore.set(M,null!==(R=(0,D.jQ)((0,Z.vt)(),z,this.geometryInfo.hasZ,this.geometryInfo.hasM))&&void 0!==R?R:null)),A}_remove(T){null!=this.onFeatureRemove&&this.onFeatureRemove(T);const R=T.objectId;return this._markedIds.delete(R),this._boundsStore.delete(R),this._featuresById.delete(R),T}}},23047:(T,R,M)=>{M.d(R,{LQ:()=>y,ag:()=>h,pL:()=>a});var A=M(32050),O=M(41156);const z=new O.A,N=new O.A,H=new O.A,Z={esriGeometryPoint:A.DF,esriGeometryPolyline:A.BW,esriGeometryPolygon:A.z5,esriGeometryMultipoint:A.qK};function y(T,R,M){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.hasZ,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:T.hasM;if(null==R)return null;const N=T.hasZ&&O,Z=T.hasM&&z;if(M){const D=(0,A.Nl)(H,R,T.hasZ,T.hasM,"esriGeometryPoint",M,O,z);return(0,A.DF)(D,N,Z)}return(0,A.DF)(R,N,Z)}function a(T,R,M,O,D,q){var X,k;let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:R,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:M;const V=R&&J,W=M&&L,Q=null!=O?"coords"in O?O:O.geometry:null;if(null==Q)return null;if(D){var K,$;let O=(0,A.kz)(N,Q,R,M,T,D,J,L);return q&&(O=(0,A.Nl)(H,O,V,W,T,q)),null!==(K=null===($=Z[T])||void 0===$?void 0:$.call(Z,O,V,W))&&void 0!==K?K:null}if(q){var ee,te;const O=(0,A.Nl)(H,Q,R,M,T,q,J,L);return null!==(ee=null===(te=Z[T])||void 0===te?void 0:te.call(Z,O,V,W))&&void 0!==ee?ee:null}return(0,A.Q4)(z,Q,R,M,J,L),null!==(X=null===(k=Z[T])||void 0===k?void 0:k.call(Z,z,V,W))&&void 0!==X?X:null}function h(T){return T&&D in T?JSON.parse(JSON.stringify(T,G)):T}const D="_geVersion",G=(T,R)=>T!==D?R:void 0},22786:(T,R,M)=>{M.d(R,{Cv:()=>j,Nk:()=>x,lK:()=>b});var A=M(16842),O=M(81618),z=M(54208),N=M(77026),H=M(78395),Z=M(80417);const D=[0,0];function h(T,R){if(!R)return null;if("x"in R){const M={x:0,y:0};return[M.x,M.y]=T(R.x,R.y,D),null!=R.z&&(M.z=R.z),null!=R.m&&(M.m=R.m),M}if("xmin"in R){const M={xmin:0,ymin:0,xmax:0,ymax:0};return[M.xmin,M.ymin]=T(R.xmin,R.ymin,D),[M.xmax,M.ymax]=T(R.xmax,R.ymax,D),R.hasZ&&(M.zmin=R.zmin,M.zmax=R.zmax,M.hasZ=!0),R.hasM&&(M.mmin=R.mmin,M.mmax=R.mmax,M.hasM=!0),M}return"rings"in R?{rings:l(R.rings,T),hasM:R.hasM,hasZ:R.hasZ}:"paths"in R?{paths:l(R.paths,T),hasM:R.hasM,hasZ:R.hasZ}:"points"in R?{points:f(R.points,T),hasM:R.hasM,hasZ:R.hasZ}:null}function l(T,R){const M=[];for(const A of T)M.push(f(A,R));return M}function f(T,R){const M=[];for(const A of T){const T=R(A[0],A[1],[0,0]);M.push(T),A.length>2&&T.push(A[2]),A.length>3&&T.push(A[3])}return M}async function x(T,R){if(!T||!R)return;const M=Array.isArray(T)?T.map((T=>null!=T.geometry?T.geometry.spatialReference:null)).filter(A.Ru):[T];await(0,z.initializeProjection)(M.map((T=>({source:T,dest:R}))))}const q=h.bind(null,Z.je),X=h.bind(null,Z.tD);function j(T,R,M,A){if(!T)return T;if(M||(M=R,R=T.spatialReference),!(0,H.fn)(R)||!(0,H.fn)(M)||(0,H.aI)(R,M))return T;if((0,Z.y7)(R,M)){const R=(0,H.K8)(M)?q(T):X(T);return R.spatialReference=M,R}return(0,z.projectMany)(N.g,[T],R,M,null,A)[0]}const k=new class _{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(T,R,M,A){var z;if(null===T||void 0===T||!T.length||!R||!M||(0,H.aI)(R,M))return T;const N={geometries:T,inSpatialReference:R,outSpatialReference:M,geographicTransformation:A,resolve:(0,O.Tw)()};return this._jobs.push(N),null!==(z=this._timer)&&void 0!==z||(this._timer=setTimeout(this._process,10)),N.resolve.promise}_process(){this._timer=null;const T=this._jobs.shift();if(!T)return;const{geometries:R,inSpatialReference:M,outSpatialReference:A,resolve:O,geographicTransformation:D}=T;(0,Z.y7)(M,A)?(0,H.K8)(A)?O(R.map(q)):O(R.map(X)):O((0,z.projectMany)(N.g,R,M,A,D,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function b(T,R,M,A){return k.push(T,R,M,A)}},70857:(T,R,M)=>{M.d(R,{GC:()=>S,T2:()=>j,v8:()=>k});var A=M(40530),O=M(49049),z=M(54208),N=M(25076),H=M(31670),Z=M(30172),D=M(78395),q=M(22786);const X=new A.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),k=Object.freeze({});async function S(T,R,M){const{outFields:A,orderByFields:O,groupByFieldsForStatistics:z,outStatistics:N}=T;if(A)for(let H=0;H<A.length;H++)A[H]=A[H].trim();if(O)for(let H=0;H<O.length;H++)O[H]=O[H].trim();if(z)for(let H=0;H<z.length;H++)z[H]=z[H].trim();if(N)for(let H=0;H<N.length;H++)N[H].onStatisticField&&(N[H].onStatisticField=N[H].onStatisticField.trim());return T.geometry&&!T.outSR&&(T.outSR=T.geometry.spatialReference),j(T,R,M)}async function j(T,R,A){var z;if(!T)return null;let{where:J}=T;if(T.where=J=null===(z=J)||void 0===z?void 0:z.trim(),(!J||/^1 *= *1$/.test(J)||R&&R===J)&&(T.where=null),!T.geometry)return T;let L=await async function d(T){const{distance:R,units:A}=T,z=T.geometry;if(null==R||"vertexAttributes"in z)return z;const N=z.spatialReference,H=A?X.fromJSON(A):(0,O.Ij)(N),Z=N&&((0,D.EA)(N)||(0,D.K8)(N))?z:await(0,q.Nk)(N,D.KK).then((()=>(0,q.Cv)(z,D.KK)));return(await async function U(){return(await Promise.all([M.e(8300),M.e(6282)]).then(M.bind(M,93901))).geodesicBuffer}())(Z.spatialReference,Z,R,H)}(T);if(T.distance=0,T.units=null,"esriSpatialRelEnvelopeIntersects"===T.spatialRel){const{spatialReference:R}=T.geometry;L=(0,N.HA)(L),L.spatialReference=R}if(L){var V;await(0,q.Nk)(L.spatialReference,A),L=function x(T,R){const M=T.spatialReference;return w(T,R)&&(0,H.ZC)(T)?{spatialReference:M,rings:[[[T.xmin,T.ymin],[T.xmin,T.ymax],[T.xmax,T.ymax],[T.xmax,T.ymin],[T.xmin,T.ymin]]]}:T}(L,A);const R=(await(0,Z.el)((0,H.rS)(L)))[0];if(null==R)throw k;const M="quantizationParameters"in T&&(null===(V=T.quantizationParameters)||void 0===V?void 0:V.tolerance)||"maxAllowableOffset"in T&&T.maxAllowableOffset||0,O=M&&w(L,A)?{densificationStep:8*M}:void 0,z=R.toJSON(),N=(0,q.Cv)(z,z.spatialReference,A,O);if(!N)throw k;N.spatialReference=A,T.geometry=N}return T}function w(T,R){if(!T)return!1;const M=T.spatialReference;return((0,H.ZC)(T)||(0,H.Bi)(T)||(0,H.Rg)(T))&&!(0,D.aI)(M,R)&&!(0,z.canProjectWithoutEngine)(M,R)}},70564:(T,R,M)=>{M.d(R,{tC:()=>I,c0:()=>P,xt:()=>v});var A=M(4180),O=M(94224),z=M(5522);var N=M(31670),H=M(78395);function n(T,R){return T?R?4:3:R?3:2}function contains_r(T,R,M,A,O,z){const N=n(O,z),{coords:H,lengths:Z}=A;if(!Z)return!1;for(let D=0,q=0;D<Z.length;D++,q+=N)if(!o(T,R,M,H[q],H[q+1]))return!1;return!0}function o(T,R,M,A,O){if(!T)return!1;const z=n(R,M),{coords:N,lengths:H}=T;let Z=!1,D=0;for(const q of H)Z=e(Z,N,z,D,q,A,O),D+=q*z;return Z}function e(T,R,M,A,O,z,N){let H=T,Z=A;for(let D=A,q=A+O*M;D<q;D+=M){Z=D+M,Z===q&&(Z=A);const T=R[D],O=R[D+1],X=R[Z],k=R[Z+1];(O<N&&k>=N||k<N&&O>=N)&&T+(N-O)/(k-O)*(X-T)<z&&(H=!H)}return H}var Z=M(32050),D=M(41156),q=M(23047),X=M(22786);const k="unsupported-query",J={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},L={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function v(T,R,A,H,X){if((0,N.Bi)(R)&&"esriGeometryPoint"===A&&("esriSpatialRelIntersects"===T||"esriSpatialRelContains"===T)){const T=(0,Z.Ye)(new D.A,R,!1,!1);return Promise.resolve((R=>function t(T,R,M,A){return o(T,R,M,A.coords[0],A.coords[1])}(T,!1,!1,R)))}if((0,N.Bi)(R)&&"esriGeometryMultipoint"===A){const M=(0,Z.Ye)(new D.A,R,!1,!1);if("esriSpatialRelContains"===T)return Promise.resolve((T=>contains_r(M,!1,!1,T,H,X)))}if((0,N.ZC)(R)&&"esriGeometryPoint"===A&&("esriSpatialRelIntersects"===T||"esriSpatialRelContains"===T))return Promise.resolve((T=>(0,O.qz)(R,(0,q.pL)(A,H,X,T))));if((0,N.ZC)(R)&&"esriGeometryMultipoint"===A&&"esriSpatialRelContains"===T)return Promise.resolve((T=>(0,O.rL)(R,(0,q.pL)(A,H,X,T))));if((0,N.ZC)(R)&&"esriSpatialRelIntersects"===T){const T=function s(T){return"mesh"===T?z.xB:(0,z.xK)(T)}(A);return Promise.resolve((M=>T(R,(0,q.pL)(A,H,X,M))))}return function h(){return Promise.all([M.e(8300),M.e(6282)]).then(M.bind(M,93901))}().then((M=>{const O=M[J[T]].bind(null,R.spatialReference,R);return T=>O((0,q.pL)(A,H,X,T))}))}async function P(T,R,M){const{spatialRel:O,geometry:z}=T;if(z){if(!function G(T){return null!=T&&!0===L.spatialRelationship[T]}(O))throw new A.A(k,"Unsupported query spatial relationship",{query:T});if((0,H.fn)(z.spatialReference)&&(0,H.fn)(M)){var Z;if(!function g(T){return null!=T&&!0===L.queryGeometry[(0,N.$B)(T)]}(z))throw new A.A(k,"Unsupported query geometry type",{query:T});if(!function j(T){return null!=T&&!0===L.layerGeometry[T]}(R))throw new A.A(k,"Unsupported layer geometry type",{query:T});if(T.outSR)return(0,X.Nk)(null===(Z=T.geometry)||void 0===Z?void 0:Z.spatialReference,T.outSR)}}}function I(T){if((0,N.ZC)(T))return!0;if((0,N.Bi)(T)){for(const R of T.rings){if(5!==R.length)return!1;if(R[0][0]!==R[1][0]||R[0][0]!==R[4][0]||R[2][0]!==R[3][0]||R[0][1]!==R[3][1]||R[0][1]!==R[4][1]||R[1][1]!==R[2][1])return!1}return!0}return!1}},66174:(T,R,M)=>{async function n(T,R){if(!T)return null;const M=R.featureAdapter,{startTimeField:A,endTimeField:O}=T;let z=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY;if(A&&O)await R.forEach((T=>{const R=M.getAttribute(T,A),H=M.getAttribute(T,O);null==R||isNaN(R)||(z=Math.min(z,R)),null==H||isNaN(H)||(N=Math.max(N,H))}));else{const T=A||O;await R.forEach((R=>{const A=M.getAttribute(R,T);null==A||isNaN(A)||(z=Math.min(z,A),N=Math.max(N,A))}))}return{start:z,end:N}}function t(T,R,M){var A,O;if(!R||!T)return null;const{startTimeField:z,endTimeField:N}=T;if(!z&&!N)return null;const{start:H,end:Z}=R;if(null===H&&null===Z)return null;if(void 0===H&&void 0===Z)return()=>!1;const D=null!==(A=null===(O=M.getAttributeAsTimestamp)||void 0===O?void 0:O.bind(M))&&void 0!==A?A:M.getAttribute.bind(M);return z&&N?function l(T,R,M,A,O){return null!=A&&null!=O?z=>{const N=T(z,R),H=T(z,M);return(null==N||N<=O)&&(null==H||H>=A)}:null!=A?R=>{const O=T(R,M);return null==O||O>=A}:null!=O?M=>{const A=T(M,R);return null==A||A<=O}:void 0}(D,z,N,H,Z):function u(T,R,M,A){return null!=M&&null!=A&&M===A?A=>T(A,R)===M:null!=M&&null!=A?O=>{const z=T(O,R);return null!=z&&z>=M&&z<=A}:null!=M?A=>{const O=T(A,R);return null!=O&&O>=M}:null!=A?M=>{const O=T(M,R);return null!=O&&O<=A}:void 0}(D,z||N,H,Z)}M.d(R,{I:()=>t,W:()=>n})},19766:(T,R,M)=>{function t(T){const R={};for(const M in T){if("declaredClass"===M)continue;const A=T[M];if(null!=A&&"function"!=typeof A)if(Array.isArray(A)){R[M]=[];for(let T=0;T<A.length;T++)R[M][T]=t(A[T])}else"object"==typeof A?A.toJSON&&(R[M]=JSON.stringify(A)):R[M]=A}return R}M.d(R,{z:()=>t})},83947:(T,R,M)=>{M.d(R,{GB:()=>E,IJ:()=>f,Jf:()=>x,Pk:()=>p,eW:()=>c,gW:()=>S,kS:()=>d});var A=M(53705),O=M(4270),z=M(31670),N=M(30172),H=M(78395),Z=M(19766),D=M(84714),q=M(34127);const X="Layer does not support extent calculation.";function y(T,R){var M;const A=T.geometry,O=T.toJSON();delete O.compactGeometryEnabled,delete O.defaultSpatialReferenceEnabled;const N=O;let Z,D,q;if(null!=A&&(D=A.spatialReference,q=(0,H.YX)(D),N.geometryType=(0,z.$B)(A),N.geometry=function m(T,R){if(R&&"extent"===T.type)return"".concat(T.xmin,",").concat(T.ymin,",").concat(T.xmax,",").concat(T.ymax);if(R&&"point"===T.type)return"".concat(T.x,",").concat(T.y);const M=T.toJSON();return delete M.spatialReference,JSON.stringify(M)}(A,T.compactGeometryEnabled),N.inSR=q),O.groupByFieldsForStatistics&&(N.groupByFieldsForStatistics=O.groupByFieldsForStatistics.join(",")),O.objectIds&&(N.objectIds=O.objectIds.join(",")),O.orderByFields&&(N.orderByFields=O.orderByFields.join(",")),!O.outFields||!O.returnDistinctValues&&(null!==R&&void 0!==R&&R.returnCountOnly||null!==R&&void 0!==R&&R.returnExtentOnly||null!==R&&void 0!==R&&R.returnIdsOnly)?delete N.outFields:O.outFields.includes("*")?N.outFields="*":N.outFields=O.outFields.join(","),O.outSR?(N.outSR=(0,H.YX)(O.outSR),Z=T.outSpatialReference):A&&(O.returnGeometry||O.returnCentroid)&&(N.outSR=N.inSR,Z=D),O.returnGeometry&&delete O.returnGeometry,O.outStatistics&&(N.outStatistics=JSON.stringify(O.outStatistics)),O.fullText&&(N.fullText=JSON.stringify(O.fullText)),O.pixelSize&&(N.pixelSize=JSON.stringify(O.pixelSize)),O.quantizationParameters&&(T.defaultSpatialReferenceEnabled&&null!=D&&null!=(null===(M=T.quantizationParameters)||void 0===M?void 0:M.extent)&&D.equals(T.quantizationParameters.extent.spatialReference)&&delete O.quantizationParameters.extent.spatialReference,N.quantizationParameters=JSON.stringify(O.quantizationParameters)),O.parameterValues&&(N.parameterValues=JSON.stringify(O.parameterValues)),O.rangeValues&&(N.rangeValues=JSON.stringify(O.rangeValues)),O.dynamicDataSource&&(N.layer=JSON.stringify({source:O.dynamicDataSource}),delete O.dynamicDataSource),O.timeExtent){const T=O.timeExtent,{start:R,end:M}=T;null==R&&null==M||(N.time=R===M?R:"".concat(null!==R&&void 0!==R?R:"null",",").concat(null!==M&&void 0!==M?M:"null")),delete O.timeExtent}return T.defaultSpatialReferenceEnabled&&null!=D&&null!=Z&&D.equals(Z)&&(N.defaultSR=N.inSR,delete N.inSR,delete N.outSR),N}async function c(T,R,M,A){const O=null!=R.timeExtent&&R.timeExtent.isEmpty?{data:{features:[]}}:await E(T,R,"json",A);return(0,q.q)(R,M,O.data),O}async function f(T,R,M,A){if(null!=R.timeExtent&&R.timeExtent.isEmpty)return{data:M.createFeatureResult()};const O=await d(T,R,A),z=O;return z.data=(0,D.m)(O.data,M),z}function d(T,R,M){return E(T,R,"pbf",M)}function p(T,R,M){return null!=R.timeExtent&&R.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(T,R,"json",M,{returnIdsOnly:!0})}function S(T,R,M){return null!=R.timeExtent&&R.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(T,R,"json",M,{returnIdsOnly:!0,returnCountOnly:!0})}async function x(T,R,M){if(null!=R.timeExtent&&R.timeExtent.isEmpty)return{data:{count:0,extent:null}};const A=await E(T,R,"json",M,{returnExtentOnly:!0,returnCountOnly:!0}),O=A.data;if(O.hasOwnProperty("extent"))return A;if(O.features)throw new Error(X);if(O.hasOwnProperty("count"))throw new Error(X);return A}async function E(T,R,M){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const D="string"==typeof T?(0,O.An)(T):T,q=R.geometry?[R.geometry]:[],X=await(0,N.el)(q,null,{signal:z.signal}),k=null===X||void 0===X?void 0:X[0];null!=k&&((R=R.clone()).geometry=k);const J=(0,Z.z)({...D.query,f:M,...H,...y(R,H)});return(0,A.A)((0,O.fj)(D.path,function g(T,R){return null!=T.formatOf3DObjects&&!(R.returnCountOnly||R.returnExtentOnly||R.returnIdsOnly)}(R,H)?"query3d":"query"),{...z,responseType:"pbf"===M?"array-buffer":"json",query:{...J,...z.query}})}},34127:(T,R,M)=>{M.d(R,{q:()=>t});var A=M(8641);function t(T,R,M){if(null===M||void 0===M||!M.features||!M.hasZ)return;const O=(0,A.N)(M.geometryType,R,T.outSpatialReference);if(null!=O)for(const A of M.features)O(A.geometry)}},91206:(T,R,M)=>{M.r(R),M.d(R,{default:()=>Be});var A=M(80671),O=(M(30174),M(73067)),z=M(81618),N=M(63390),H=M(57453),Z=(M(50886),M(89412)),D=(M(76761),M(68682)),q=M(31059),X=M(98664),k=M(45691),J=M(56103),L=M(22179),V=M(49096),W=M(99533),Q=M(20585),K=M(69719),$=M(49049),ee=M(2001);function snappingCandidateElevationAlignment_i(){let T=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:R,alignPointsInFeatures:M}=T;return new c(R,M)}return new a}class a{async alignCandidates(T,R,M){return T}notifyElevationSourceChange(){}}class c{constructor(T,R){this._elevationInfo=T,this._alignPointsInFeatures=R,this._alignmentsCache=new Q.q(1024),this._cacheVersion=0}async alignCandidates(T,R,M){const A=this._elevationInfo;return null==A||"absolute-height"!==A.mode||A.featureExpressionInfo?this._alignComputedElevationCandidates(T,R,M):(this._alignAbsoluteElevationCandidates(T,R,A),T)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(T,R,M){const{offset:A,unit:O}=M;if(null==A)return;const z=(0,$.G9)(R),N=A*((0,ee.Ao)(null!==O&&void 0!==O?O:"meters")/z);for(const H of T)switch(H.type){case"edge":H.start.z+=N,H.end.z+=N;continue;case"vertex":H.target.z+=N;continue}}async _alignComputedElevationCandidates(T,R,M){const A=new Map;for(const z of T)(0,K.tE)(A,z.objectId,d).push(z);const[O,N,H]=this._prepareQuery(A,R),Z=await this._alignPointsInFeatures(O,M);if((0,z.Te)(M),H!==this._cacheVersion)return this._alignComputedElevationCandidates(T,R,M);this._applyCacheAndResponse(O,Z,N);const{drapedObjectIds:D,failedObjectIds:q}=Z,X=[];for(const z of T){const{objectId:T}=z;D.has(T)&&"edge"===z.type&&(z.draped=!0),q.has(T)||X.push(z)}return X}_prepareQuery(T,R){const M=[],A=[];for(const[O,z]of T){const T=[];for(const R of z)this._addToQueriesOrCachedResult(O,R.target,T,A),"edge"===R.type&&(this._addToQueriesOrCachedResult(O,R.start,T,A),this._addToQueriesOrCachedResult(O,R.end,T,A));0!==T.length&&M.push({objectId:O,points:T})}return[{spatialReference:R.toJSON(),pointsInFeatures:M},A,this._cacheVersion]}_addToQueriesOrCachedResult(T,R,M,A){const O=h(T,R),z=this._alignmentsCache.get(O);null==z?M.push(R):A.push(new l(R,z))}_applyCacheAndResponse(T,R,M){let{elevations:A,drapedObjectIds:O,failedObjectIds:z}=R;for(const Z of M)Z.apply();let N=0;const H=this._alignmentsCache;for(const{objectId:Z,points:D}of T.pointsInFeatures){if(z.has(Z)){N+=D.length;continue}const T=!O.has(Z);for(const R of D){const M=h(Z,R),O=A[N++];R.z=O,T&&H.put(M,O,1)}}}}class l{constructor(T,R){this.point=T,this.z=R}apply(){this.point.z=this.z}}function h(T,R){let{x:M,y:A,z:O,spatialReference:z}=R;return"".concat(T,"-").concat(M,"-").concat(A,"-").concat(null!==O&&void 0!==O?O:0,"}-wkid:").concat(null===z||void 0===z?void 0:z.wkid)}function d(){return[]}class t{filter(T,R){return R}notifyElevationSourceChange(){}}class n{filter(T,R){const{point:M,distance:A}=T,{z:O}=M;if(null==O)return R;if(0===R.length)return R;const z=function s(T){return"number"==typeof T?{x:T,y:T,z:T}:T}(A),N=this._updateCandidatesTo3D(R,M,z).filter(e);return N.sort(snappingCandidateElevationFilter_a),N}_updateCandidatesTo3D(T,R,M){for(const A of T)switch(A.type){case"edge":snappingCandidateElevationFilter_c(A,R,M);continue;case"vertex":o(A,R,M);continue}return T}}function e(T){return T.distance<=1}function snappingCandidateElevationFilter_r(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new n:new t}function snappingCandidateElevationFilter_c(T,R,M){let{x:A,y:O,z:z}=M;const{start:N,end:H,target:Z}=T;T.draped||function i(T,R,M,A){const O=A.x-M.x,z=A.y-M.y,N=A.z-M.z,H=O*O+z*z+N*N,Z=(R.x-M.x)*O+(R.y-M.y)*z+N*(R.z-M.z),D=Math.min(1,Math.max(0,Z/H)),q=M.x+O*D,X=M.y+z*D,k=M.z+N*D;T.x=q,T.y=X,T.z=k}(Z,R,N,H);const D=(R.x-Z.x)/A,q=(R.y-Z.y)/O,X=(R.z-Z.z)/z;T.distance=Math.sqrt(D*D+q*q+X*X)}function o(T,R,M){let{x:A,y:O,z:z}=M;const{target:N}=T,H=(R.x-N.x)/A,Z=(R.y-N.y)/O,D=(R.z-N.z)/z,q=Math.sqrt(H*H+Z*Z+D*D);T.distance=q}function snappingCandidateElevationFilter_a(T,R){return T.distance-R.distance}var te=M(66004),ie=M(4389);function symbologySnappingCandidates_n(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new symbologySnappingCandidates_i(arguments.length>1?arguments[1]:void 0):new symbologySnappingCandidates_c}class symbologySnappingCandidates_c{async fetch(){return[]}notifySymbologyChange(){}}class symbologySnappingCandidates_i{constructor(T){this._getSymbologyCandidates=T,this._candidatesCache=new Q.q(1024),this._cacheVersion=0}async fetch(T,R){if(0===T.length)return[];const M=[],A=[],O=this._candidatesCache;for(const z of T){const T=symbologySnappingCandidates_a(z),R=O.get(T);if(R)for(const M of R)A.push((0,te.o8)(M));else M.push(z),O.put(T,[],1)}if(0===M.length)return A;const N=this._cacheVersion,{candidates:H,sourceCandidateIndices:Z}=await this._getSymbologyCandidates(M,R);if((0,z.Te)(R),N!==this._cacheVersion)return this.fetch(T,R);const D=[],{length:q}=H;for(let z=0;z<q;++z){const T=H[z],R=symbologySnappingCandidates_a(M[Z[z]]),A=O.get(R);A.push(T),O.put(R,A,A.length),D.push((0,te.o8)(T))}return A.concat(D)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function symbologySnappingCandidates_a(T){switch(T.type){case"vertex":{var R;const{objectId:M,target:A}=T,O="".concat(M,"-vertex-").concat(A.x,"-").concat(A.y,"-").concat(null!==(R=A.z)&&void 0!==R?R:0);return(0,ie.Wm)(O).toString()}case"edge":{var M,A;const{objectId:R,start:O,end:z}=T,N="".concat(R,"-edge-").concat(O.x,"-").concat(O.y,"-").concat(null!==(M=O.z)&&void 0!==M?M:0,"-to-").concat(z.x,"-").concat(z.y,"-").concat(null!==(A=z.z)&&void 0!==A?A:0);return(0,ie.Wm)(N).toString()}default:return""}}var ne=M(18763),se=M(16842);let re=class extends ne.A{constructor(){super(...arguments),this.updating=!1,this._pending=[]}push(T,R){this._pending.push({promise:T,callback:R}),1===this._pending.length&&this._process()}_process(){if(!this._pending.length)return void(this.updating=!1);this.updating=!0;const T=this._pending[0];T.promise.then((R=>T.callback(R))).catch((()=>{})).then((()=>{this._pending.shift(),this._process()}))}};(0,A._)([(0,H.MZ)()],re.prototype,"updating",void 0),re=(0,A._)([(0,D.$)("esri.core.AsyncSequence")],re);var oe,ae=M(87149),le=M(58285),ue=M(43713),he=M(84661),ce=M(88965),de=M(32050),fe=M(26128),pe=M(93420),_e=M(83947);class PendingFeatureTile_r{constructor(T,R){this.data=T,this.resolution=R,this.state={type:oe.CREATED},this.alive=!0}process(T){switch(this.state.type){case oe.CREATED:return this.state=this._gotoFetchCount(this.state,T),this.state.task.promise.then(T.resume,T.resume);case oe.FETCH_COUNT:break;case oe.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,T),this.state.task.promise.then(T.resume,T.resume);case oe.FETCH_FEATURES:break;case oe.FETCHED_FEATURES:this.state=this._goToDone(this.state,T);case oe.DONE:}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case oe.CREATED:case oe.FETCH_COUNT:return 0;case oe.FETCHED_COUNT:return this.state.featureCount;case oe.FETCH_FEATURES:return this.state.previous.featureCount;case oe.FETCHED_FEATURES:return this.state.features.length;case oe.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case oe.CREATED:return"created";case oe.FETCH_COUNT:return"fetch-count";case oe.FETCHED_COUNT:return"fetched-count";case oe.FETCH_FEATURES:return"fetch-features";case oe.FETCHED_FEATURES:return"fetched-features";case oe.DONE:return"done"}}_gotoFetchCount(T,R){return{type:oe.FETCH_COUNT,previous:T,task:(0,ae.UT)((async T=>{const M=await(0,ae.DZ)(R.fetchCount(this,T));this.state.type===oe.FETCH_COUNT&&(this.state=this._gotoFetchedCount(this.state,M.ok?M.value:1/0))}))}}_gotoFetchedCount(T,R){return{type:oe.FETCHED_COUNT,featureCount:R,previous:T}}_gotoFetchFeatures(T,R){return{type:oe.FETCH_FEATURES,previous:T,task:(0,ae.UT)((async M=>{const A=await(0,ae.DZ)(R.fetchFeatures(this,T.featureCount,M));this.state.type===oe.FETCH_FEATURES&&(this.state=this._gotoFetchedFeatures(this.state,A.ok?A.value:[]))}))}}_gotoFetchedFeatures(T,R){return{type:oe.FETCHED_FEATURES,previous:T,features:R}}_goToDone(T,R){return R.finish(this,T.features),{type:oe.DONE,previous:T}}reset(){const T=this.state;switch(this.state={type:oe.CREATED},T.type){case oe.CREATED:case oe.FETCHED_COUNT:case oe.FETCHED_FEATURES:case oe.DONE:break;case oe.FETCH_COUNT:case oe.FETCH_FEATURES:T.task.abort()}}intersects(T){return null==T||!this.data.extent||((0,ce.VY)(T,ge),(0,ce.HY)(this.data.extent,ge))}}!function(T){T[T.CREATED=0]="CREATED",T[T.FETCH_COUNT=1]="FETCH_COUNT",T[T.FETCHED_COUNT=2]="FETCHED_COUNT",T[T.FETCH_FEATURES=3]="FETCH_FEATURES",T[T.FETCHED_FEATURES=4]="FETCHED_FEATURES",T[T.DONE=5]="DONE"}(oe||(oe={}));const ge=(0,ce.vt)();let me=class extends ne.A{get _minimumVerticesPerFeature(){var T;switch(null===(T=this.store)||void 0===T?void 0:T.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}get _mandatoryOutFields(){const T=new Set;return this.objectIdField&&T.add(this.objectIdField),this.globalIdField&&T.add(this.globalIdField),T}set outFields(T){const R=this._get("outFields"),M=(0,ue.KC)(T,this._mandatoryOutFields);(0,ue.aI)(M,R)||(this._set("outFields",M),(0,ue.Yy)(M,R)||this.refresh())}get outFields(){var T;return null!==(T=this._get("outFields"))&&void 0!==T?T:this._mandatoryOutFields}set filter(T){const R=this._get("filter"),M=this._filterProperties(T);JSON.stringify(R)!==JSON.stringify(M)&&this._set("filter",M)}set customParameters(T){const R=this._get("customParameters");JSON.stringify(R)!==JSON.stringify(T)&&this._set("customParameters",T)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(T){const R=this._get("tileInfo");R!==T&&(null!=T&&null!=R&&JSON.stringify(T)===JSON.stringify(R)||(this._set("tileInfo",T),this.store.tileInfo=T))}set tileSize(T){this._get("tileSize")!==T&&this._set("tileSize",T)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this._updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(T){super(T),this.suspended=!0,this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._updatingHandles=new q.U,this._pendingEdits=new re,this._pendingEditsAbortController=new AbortController}initialize(){this._initializeFetchExtent(),this._updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this._updatingHandles.add((()=>this.tilesOfInterest),((T,R)=>{(0,se.aI)(T,R,((T,R)=>{let{id:M}=T,{id:A}=R;return M===A}))||this._process()}),N.OH),this.addHandles((0,N.z7)((()=>!this.suspended),(()=>this._process())))}destroy(){this._pendingTiles.forEach((T=>this._deletePendingTile(T))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null,this._updatingHandles.destroy()}refresh(){this.store.refresh(),this._pendingTiles.forEach((T=>this._deletePendingTile(T))),this._process()}applyEdits(T){this._pendingEdits.push(T,(async T=>{if(0===T.addedFeatures.length&&0===T.updatedFeatures.length&&0===T.deletedFeatures.length)return;for(const[,M]of this._pendingTiles)M.reset();const R={...T,deletedFeatures:T.deletedFeatures.map((T=>{let{objectId:R,globalId:M}=T;return R&&-1!==R?R:this._lookupObjectIdByGlobalId(M)}))};await this._updatingHandles.addPromise(this.store.processEdits(R,((T,R)=>this._queryFeaturesById(T,R)),this._pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!(0,fe.Wo)(this.url))return;const T=(0,ae.UT)((async T=>{try{var R,M;const A=await(0,_e.Jf)(this.url,new V.A({where:"1=1",outSpatialReference:this.spatialReference,cacheHint:null!==(R=this.capabilities.query.supportsCacheHint)&&void 0!==R?R:void 0}),{query:this._configuration.customParameters,signal:T});this.store.extent=he.A.fromJSON(null===(M=A.data)||void 0===M?void 0:M.extent)}catch(t){(0,z.QP)(t),Z.A.getLogger(this).warn("Failed to fetch data extent",t)}}));this._updatingHandles.addPromise(T.promise.then((()=>this._process()))),this.addHandles((0,le.hA)((()=>T.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((T=>T.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,T]of this._pendingTiles)T.alive=!1}_createPendingTiles(){if(this.suspended)return;const T=this._collectMissingTilesInfo();if(this._setAvailability(null==T?1:T.coveredArea/T.fullArea),null!=T)for(const{data:R,resolution:M}of T.missingTiles){const T=this._pendingTiles.get(R.id);T?(T.resolution=M,T.alive=!0):this._createPendingTile(R,M)}}_collectMissingTilesInfo(){let T=null;for(let R=this.tilesOfInterest.length-1;R>=0;R--){const M=this.tilesOfInterest[R],A=this.store.process(M,((T,R)=>this._verifyTileComplexity(T,R)),this.outFields);null==T?T=A:T.prepend(A)}return T}_deletePendingTiles(){for(const[,T]of this._pendingTiles)T.alive||this._deletePendingTile(T)}_processPendingTiles(){const T={fetchCount:(T,R)=>this._fetchCount(T,R),fetchFeatures:(T,R,M)=>this._fetchFeatures(T,R,M),finish:(T,R)=>this._finishPendingTile(T,R),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(T))for(const[,R]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(R.data),R.resolution)&&this._updatingHandles.addPromise(R.process(T))}_verifyTileComplexity(T,R){return this._verifyVertexComplexity(T)&&this._verifyFeatureDensity(T,R)}_verifyVertexComplexity(T){return T*this._minimumVerticesPerFeature<xe}_verifyFeatureDensity(T,R){if(null==this.tileInfo)return!1;const M=this.tileSize*R;return T*(Se/(M*M))<Ee}_ensureFetchAllCounts(T){let R=!0;for(const[,M]of this._pendingTiles)M.state.type<oe.FETCHED_COUNT&&this._updatingHandles.addPromise(M.process(T)),M.state.type<=oe.FETCH_COUNT&&(R=!1);return R}_finishPendingTile(T,R){this.store.add(T.data,R),this._deletePendingTile(T),this._updateAvailability()}_updateAvailability(){const T=this._collectMissingTilesInfo();this._setAvailability(null==T?1:T.coveredArea/T.fullArea)}_setAvailability(T){this._set("availability",T)}_createPendingTile(T,R){const M=new PendingFeatureTile_r(T,R);return this._pendingTiles.set(T.id,M),M}_deletePendingTile(T){T.reset(),this._pendingTiles.delete(T.data.id)}async _fetchCount(T,R){return this.store.fetchCount(T.data,this.url,this._createCountQuery(T),{query:this.customParameters,timeout:ve,signal:R})}async _fetchFeatures(T,R,M){let A=0;const O=[];let z=0,N=R;for(;;){const H=this._createFeaturesQuery(T),Z=this._setPagingParameters(H,A,N),{features:D,exceededTransferLimit:q}=await this._queryFeatures(H,M);Z&&(A+=H.num),z+=D.length;for(const T of D)O.push(T);if(N=R-z,!Z||!q||N<=0)return O}}_filterProperties(T){return null==T?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:T.where||"1=1",timeExtent:T.timeExtent,gdbVersion:T.gdbVersion}}_lookupObjectIdByGlobalId(T){const R=this.globalIdField,M=this.objectIdField;if(null==R)throw new Error("Expected globalIdField to be defined");let A=null;if(this.store.featureStore.forEach((O=>{var z;T===O.attributes[R]&&(A=null!==(z=O.objectId)&&void 0!==z?z:O.attributes[M])})),null==A)throw new Error("Expected to find a feature with globalId ".concat(T));return A}_queryFeaturesById(T,R){const M=this._createFeaturesQuery();return M.objectIds=T,this._queryFeatures(M,R)}_queryFeatures(T,R){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(T,R):this._queryFeaturesJSON(T,R)}async _queryFeaturesPBF(T,R){const{sourceSpatialReference:M}=this,{data:A}=await(0,_e.IJ)(this.url,T,new pe.S({sourceSpatialReference:M}),{query:this._configuration.customParameters,timeout:ve,signal:R});return(0,de.eY)(A)}async _queryFeaturesJSON(T,R){const{sourceSpatialReference:M}=this,{data:A}=await(0,_e.eW)(this.url,T,M,{query:this._configuration.customParameters,timeout:ve,signal:R});return(0,de.q3)(A,this.objectIdField)}_createCountQuery(T){const R=this._createBaseQuery(T);return this.capabilities.query.supportsCacheHint&&(R.cacheHint=!0),R}_createFeaturesQuery(){var T;let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const M=this._createBaseQuery(R),A=null!=(null===R||void 0===R?void 0:R.data)?this.store.getAttributesForTile(null===R||void 0===R||null===(T=R.data)||void 0===T?void 0:T.id):null,O=(0,ue.KC)((0,ue.iv)(this.outFields,null!==A&&void 0!==A?A:new Set),this._mandatoryOutFields);return M.outFields=Array.from(O),M.returnGeometry=!0,null!=R&&(this.capabilities.query.supportsResultType?M.resultType="tile":this.capabilities.query.supportsCacheHint&&(M.cacheHint=!0)),M}_createBaseQuery(T){const R=new V.A({returnZ:this.hasZ,returnM:!1,geometry:null!=this.tileInfo&&null!=T?(0,ce.w1)(T.data.extent,this.tileInfo.spatialReference):void 0}),M=this._configuration.filter;return null!=M&&(R.where=M.where,R.gdbVersion=M.gdbVersion,R.timeExtent=M.timeExtent),R.outSpatialReference=this.spatialReference,R}_setPagingParameters(T,R,M){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:A,supportsCacheHint:O,tileMaxRecordCount:z,maxRecordCount:N,supportsResultType:H}=this.capabilities.query,Z=A?V.A.MAX_MAX_RECORD_COUNT_FACTOR:1,D=Z*((H||O)&&z?z:N||ye);return T.start=R,A?(T.maxRecordCountFactor=Math.min(Z,Math.ceil(M/D)),T.num=Math.min(M,T.maxRecordCountFactor*D)):T.num=Math.min(M,D),!0}};(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"url",void 0),(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"objectIdField",void 0),(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"globalIdField",void 0),(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"capabilities",void 0),(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"sourceSpatialReference",void 0),(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"spatialReference",void 0),(0,A._)([(0,H.MZ)({constructOnly:!0})],me.prototype,"store",void 0),(0,A._)([(0,H.MZ)({readOnly:!0})],me.prototype,"_minimumVerticesPerFeature",null),(0,A._)([(0,H.MZ)()],me.prototype,"_mandatoryOutFields",null),(0,A._)([(0,H.MZ)()],me.prototype,"outFields",null),(0,A._)([(0,H.MZ)()],me.prototype,"suspended",void 0),(0,A._)([(0,H.MZ)()],me.prototype,"filter",null),(0,A._)([(0,H.MZ)()],me.prototype,"customParameters",null),(0,A._)([(0,H.MZ)({readOnly:!0})],me.prototype,"_configuration",null),(0,A._)([(0,H.MZ)()],me.prototype,"tileInfo",null),(0,A._)([(0,H.MZ)()],me.prototype,"tileSize",null),(0,A._)([(0,H.MZ)()],me.prototype,"tilesOfInterest",void 0),(0,A._)([(0,H.MZ)({readOnly:!0})],me.prototype,"updating",null),(0,A._)([(0,H.MZ)({readOnly:!0})],me.prototype,"updatingExcludingEdits",null),(0,A._)([(0,H.MZ)({readOnly:!0})],me.prototype,"availability",void 0),(0,A._)([(0,H.MZ)()],me.prototype,"hasZ",null),me=(0,A._)([(0,D.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],me);const ye=2e3,ve=6e5,xe=1e6,Se=25,Ee=1;var Fe=M(39587),Ce=M(11277),be=M(61816),Ie=M(19156);class FeatureServiceTileCache_t{constructor(){this._store=new Map,this._byteSize=0}set(T,R){this.delete(T),this._store.set(T,R),this._byteSize+=R.byteSize}delete(T){const R=this._store.get(T);return!!this._store.delete(T)&&(null!=R&&(this._byteSize-=R.byteSize),!0)}get(T){return this._used(T),this._store.get(T)}has(T){return this._used(T),this._store.has(T)}clear(){this._store.clear()}applyByteSizeLimit(T,R){for(const[M,A]of this._store){if(this._byteSize<=T)break;this.delete(M),R(A)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}_used(T){const R=this._store.get(T);R&&(this._store.delete(T),this._store.set(T,R))}}let Te=class extends ne.A{constructor(T){super(T),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*Ce.u.MEGABYTES,this._tileBounds=new be.F,this._tiles=new FeatureServiceTileCache_t,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=(0,ce.vt)()}add(T,R){var M,A;for(const N of R)this._referenceFeature(N.objectId);const O=this.featureStore.upsertMany(R),z=O.map((T=>new Set(Object.keys(T.attributes)))).reduce(((T,R)=>(0,ue.E$)(T,R)),new Set(Object.keys(null!==(M=null===(A=O[0])||void 0===A?void 0:A.attributes)&&void 0!==M?M:[])));this._addTileStorage(T,new Set(O.map((T=>T.objectId))),function C(T){return T.reduce(((T,R)=>T+function S(T){return 32+function E(T){if(null==T)return 0;const R=(0,Fe.zd)(T.lengths,4);return 32+(0,Fe.zd)(T.coords,8)+R}(T.geometry)+(0,Fe.eY)(T.attributes)}(R)),0)}(O),z),this._tiles.applyByteSizeLimit(this.maximumByteSize,(T=>this._removeTileStorage(T)))}getAttributesForTile(T){var R;return T?null===(R=this._tiles.get(T))||void 0===R?void 0:R.attributeKeys:null}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(T,R,M){return this._processEditsDelete(T.deletedFeatures.concat(T.updatedFeatures)),this._processEditsRefetch(T.addedFeatures.concat(T.updatedFeatures),R,M)}_addTileStorage(T,R,M,A){const O=T.id;this._tiles.set(O,new FeatureServiceTileStore_T(T,R,M,A)),this._tileBounds.set(O,T.extent),this._tileFeatureCounts.set(O,R.size)}_remove(T){let{id:R}=T;const M=this._tiles.get(R);M&&this._removeTileStorage(M)}_removeTileStorage(T){const R=[];for(const A of T.objectIds)this._unreferenceFeature(A)===Re.REMOVED&&R.push(A);this.featureStore.removeManyById(R);const M=T.data.id;this._tiles.delete(M),this._tileBounds.delete(M)}_processEditsDelete(T){this.featureStore.removeManyById(T);for(const[,R]of this._tiles){for(const M of T)R.objectIds.delete(M);this._tileFeatureCounts.set(R.data.id,R.objectIds.size)}for(const R of T)this._refCounts.delete(R)}async _processEditsRefetch(T,R,M){const A=(await R(T,M)).features,{hasZ:O,hasM:z}=this.featureStore;for(const N of A){const T=(0,de.jQ)(this._tmpBoundingRect,N.geometry,O,z);null!=T&&this._tileBounds.forEachInBounds(T,(T=>{const R=this._tiles.get(T);this.featureStore.add(N);const M=N.objectId;R.objectIds.has(M)||(R.objectIds.add(M),this._referenceFeature(M),this._tileFeatureCounts.set(R.data.id,R.objectIds.size))}))}}process(T){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0,M=arguments.length>2?arguments[2]:void 0;if(null==this.tileInfo||!T.extent||null!=this.extent&&!(0,ce.HY)((0,ce.VY)(this.extent,this._tmpBoundingRect),T.extent))return new F(T);const A=this.getAttributesForTile(T.id);if((0,ue.Yy)(M,A))return new F(T);const O=this._createTileTree(T,this.tileInfo);return this._simplify(O,R,null,0,1),this._collectMissingTiles(T,O,this.tileInfo,M)}get debugInfo(){return Array.from(this._tiles.values()).map((T=>{let{data:R}=T;return{data:R,featureCount:this._tileFeatureCounts.get(R.id)||0}}))}getFeatureCount(T){var R;return null!==(R=this._tileFeatureCounts.get(T.id))&&void 0!==R?R:0}async fetchCount(T,R,M,A){const O=this._tileFeatureCounts.get(T.id);if(null!=O)return O;const z=await(0,_e.gW)(R,M,A);return this._tileFeatureCounts.set(T.id,z.data.count),z.data.count}_createTileTree(T,R){const M=new FeatureServiceTileStore_w(T.level,T.row,T.col);return R.updateTileInfo(M,L.A.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(T.extent,(A=>{var O;const z=null===(O=this._tiles.get(A))||void 0===O?void 0:O.data;z&&this._tilesAreRelated(T,z)&&this._populateChildren(M,z,R,this._tileFeatureCounts.get(z.id)||0)})),M}_tilesAreRelated(T,R){if(!T||!R)return!1;if(T.level===R.level)return T.row===R.row&&T.col===R.col;const M=T.level<R.level,A=M?T:R,O=M?R:T,z=1<<O.level-A.level;return Math.floor(O.row/z)===A.row&&Math.floor(O.col/z)===A.col}_populateChildren(T,R,M,A){const O=R.level-T.level-1;if(O<0)return void(T.isLeaf=!0);const z=R.row>>O,N=R.col>>O,H=T.row<<1,Z=N-(T.col<<1)+(z-H<<1),D=T.children[Z];if(null!=D)this._populateChildren(D,R,M,A);else{const O=new FeatureServiceTileStore_w(T.level+1,z,N);M.updateTileInfo(O,L.A.ExtrapolateOptions.POWER_OF_TWO),T.children[Z]=O,this._populateChildren(O,R,M,A)}}_simplify(T,R,M,A,O){const z=O*O;if(T.isLeaf)return R(this.getFeatureCount(T),O)?0:(this._remove(T),null!=M&&(M.children[A]=null),z);const N=O/2,H=N*N;let Z=0;for(let D=0;D<T.children.length;D++){const M=T.children[D];Z+=null!=M?this._simplify(M,R,T,D,N):H}return 0===Z?this._mergeChildren(T):1-Z/z<we&&(this._purge(T),null!=M&&(M.children[A]=null),Z=z),Z}_mergeChildren(T){var R;const M=new Set;let A,O=0;this._forEachLeaf(T,(T=>{const R=this._tiles.get(T.id);if(R){A=A?(0,ue.E$)(A,R.attributeKeys):new Set(R.attributeKeys),O+=R.byteSize;for(const T of R.objectIds)M.has(T)||(M.add(T),this._referenceFeature(T));this._remove(T)}})),this._addTileStorage(T,M,O,null!==(R=A)&&void 0!==R?R:new Set),T.isLeaf=!0,T.children[0]=T.children[1]=T.children[2]=T.children[3]=null,this._tileFeatureCounts.set(T.id,M.size)}_forEachLeaf(T,R){for(const M of T.children)null!=M&&(M.isLeaf?R(M):this._forEachLeaf(M,R))}_purge(T){if(null!=T)if(T.isLeaf)this._remove(T);else for(let R=0;R<T.children.length;R++){const M=T.children[R];this._purge(M),T.children[R]=null}}_collectMissingTiles(T,R,M,A){const O=new FeatureServiceTileStore_j(M,T,this.extent);return this._collectMissingTilesRecurse(R,O,1,A),O.info}_collectMissingTilesRecurse(T,R,M,A){const O=this.getAttributesForTile(T.id),z=O&&!(0,ue.Yy)(A,O);if(z&&R.addMissing(T.level,T.row,T.col,M),T.isLeaf)return;if(!T.hasChildren)return void(z||R.addMissing(T.level,T.row,T.col,M));const N=M/2;for(let H=0;H<T.children.length;H++){const M=T.children[H];null==M?R.addMissing(T.level+1,(T.row<<1)+((2&H)>>1),(T.col<<1)+(1&H),N):this._collectMissingTilesRecurse(M,R,N,A)}}_referenceFeature(T){const R=(this._refCounts.get(T)||0)+1;return this._refCounts.set(T,R),1===R?Re.ADDED:Re.UNCHANGED}_unreferenceFeature(T){const R=(this._refCounts.get(T)||0)-1;return 0===R?(this._refCounts.delete(T),Re.REMOVED):(R>0&&this._refCounts.set(T,R),Re.UNCHANGED)}get test(){return{tiles:Array.from(this._tiles.values()).map((T=>"".concat(T.data.id,":[").concat(Array.from(T.objectIds),"]"))),featureReferences:Array.from(this._refCounts.keys()).map((T=>"".concat(T,":").concat(this._refCounts.get(T))))}}};(0,A._)([(0,H.MZ)({constructOnly:!0})],Te.prototype,"featureStore",void 0),(0,A._)([(0,H.MZ)()],Te.prototype,"tileInfo",void 0),(0,A._)([(0,H.MZ)()],Te.prototype,"extent",void 0),(0,A._)([(0,H.MZ)()],Te.prototype,"maximumByteSize",void 0),Te=(0,A._)([(0,D.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],Te);class FeatureServiceTileStore_T{constructor(T,R,M,A){this.data=T,this.objectIds=R,this.byteSize=M,this.attributeKeys=A}}class FeatureServiceTileStore_w{constructor(T,R,M){this.level=T,this.row=R,this.col=M,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(null!=this.children[0]||null!=this.children[1]||null!=this.children[2]||null!=this.children[3])}}class F{constructor(T){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.missingTiles=R,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,ce.Wc)(T.extent),this.coveredArea=this.fullArea}prepend(T){this.missingTiles=T.missingTiles.concat(this.missingTiles),this.coveredArea+=T.coveredArea,this.fullArea+=T.fullArea}}class FeatureServiceTileStore_j{constructor(T,R,M){this._tileInfo=T,this._extent=null,this.info=new F(R),null!=M&&(this._extent=(0,ce.VY)(M))}addMissing(T,R,M,A){const O=new Ie.U(null,T,R,M);this._tileInfo.updateTileInfo(O,L.A.ExtrapolateOptions.POWER_OF_TWO),null==O.extent||null!=this._extent&&!(0,ce.HY)(this._extent,O.extent)||(this.info.missingTiles.push({data:O,resolution:A}),this.info.coveredArea-=(0,ce.Wc)(O.extent))}}const we=.18751;var Re;!function(T){T[T.ADDED=0]="ADDED",T[T.REMOVED=1]="REMOVED",T[T.UNCHANGED=2]="UNCHANGED"}(Re||(Re={}));var Me=M(31670);let Ae=class extends O.A.EventedAccessor{constructor(){super(...arguments),this._isInitializing=!0,this.remoteClient=null,this._whenSetup=(0,z.Tw)(),this._elevationAligner=snappingCandidateElevationAlignment_i(),this._elevationFilter=snappingCandidateElevationFilter_r(),this._symbologyCandidatesFetcher=symbologySnappingCandidates_n(),this._updatingHandles=new q.U,this._editsUpdatingHandles=new q.U,this._pendingApplyEdits=new Map,this._alignPointsInFeatures=async(T,R)=>{const M={query:T},A=await this.remoteClient.invoke("alignElevation",M,{signal:R});return(0,z.Te)(R),A},this._getSymbologyCandidates=async(T,R)=>{const M={candidates:T,spatialReference:this._spatialReference.toJSON()},A=await this.remoteClient.invoke("getSymbologyCandidates",M,{signal:R});return(0,z.Te)(R),A}}get updating(){return this.updatingExcludingEdits||this._editsUpdatingHandles.updating||this._featureFetcher.updating}get updatingExcludingEdits(){return this._featureFetcher.updatingExcludingEdits||this._isInitializing||this._updatingHandles.updating}destroy(){var T,R,M;null!==(T=this._featureFetcher)&&void 0!==T&&T.destroy(),null!==(R=this._queryEngine)&&void 0!==R&&R.destroy(),null===(M=this._featureStore)||void 0===M||M.clear()}async setup(T){if(this.destroyed)return{result:{}};const{geometryType:R,objectIdField:M,timeInfo:A,fieldsIndex:O}=T.serviceInfo,{hasZ:z}=T,H=X.A.fromJSON(T.spatialReference);this._spatialReference=H,this._featureStore=new k.A({...T.serviceInfo,hasZ:z,hasM:!1}),this._queryEngine=new J.d({spatialReference:T.spatialReference,featureStore:this._featureStore,geometryType:R,fieldsIndex:O,hasZ:z,hasM:!1,objectIdField:M,timeInfo:A}),this._featureFetcher=new me({store:new Te({featureStore:this._featureStore}),url:T.serviceInfo.url,objectIdField:T.serviceInfo.objectIdField,globalIdField:T.serviceInfo.globalIdField,capabilities:T.serviceInfo.capabilities,spatialReference:H,sourceSpatialReference:X.A.fromJSON(T.serviceInfo.spatialReference),customParameters:T.configuration.customParameters});const Z="3d"===T.configuration.viewType;return this._elevationAligner=snappingCandidateElevationAlignment_i(Z,{elevationInfo:null!=T.elevationInfo?W.A.fromJSON(T.elevationInfo):null,alignPointsInFeatures:this._alignPointsInFeatures}),this._elevationFilter=snappingCandidateElevationFilter_r(Z),this.addHandles([(0,N.wB)((()=>this._featureFetcher.availability),(T=>this.emit("notify-availability",{availability:T})),N.OH),(0,N.wB)((()=>this.updating),(()=>this._notifyUpdating()))]),this._whenSetup.resolve(),this._isInitializing=!1,this.configure(T.configuration)}async configure(T){return await this._updatingHandles.addPromise(this._whenSetup.promise),this._updateFeatureFetcherConfiguration(T),Oe}async setSuspended(T,R){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,z.Te)(R),this._featureFetcher.suspended=T,Oe}async updateOutFields(T,R){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,z.Te)(R),this._featureFetcher.outFields=new Set(null!==T&&void 0!==T?T:[]),Oe}async fetchCandidates(T,R){var M;await this._whenSetup.promise,(0,z.Te)(R);const A=function FeatureServiceSnappingSourceWorker_b(T){if(!T.filter)return{...T,query:{where:"1=1"}};const{distance:R,units:M,spatialRel:A,where:O,timeExtent:z,objectIds:N}=T.filter,H={geometry:T.filter.geometry?(0,Me.rS)(T.filter.geometry):void 0,distance:R,units:M,spatialRel:A,timeExtent:z,objectIds:N,where:null!==O&&void 0!==O?O:"1=1"};return{...T,query:H}}(T),O=null===R||void 0===R?void 0:R.signal,N=await this._queryEngine.executeQueryForSnapping(A,O);(0,z.Te)(O);const H=await this._elevationAligner.alignCandidates(N.candidates,null!==(M=X.A.fromJSON(T.point.spatialReference))&&void 0!==M?M:X.A.WGS84,O);(0,z.Te)(O);const Z=await this._symbologyCandidatesFetcher.fetch(H,O);(0,z.Te)(O);const D=0===Z.length?H:H.concat(Z);return{result:{candidates:this._elevationFilter.filter(A,D)}}}async updateTiles(T,R){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,z.Te)(R),this._featureFetcher.tileSize=T.tileSize,this._featureFetcher.tilesOfInterest=T.tiles,this._featureFetcher.tileInfo=null!=T.tileInfo?L.A.fromJSON(T.tileInfo):null,Oe}async refresh(T,R){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,z.Te)(R),this._featureFetcher.refresh(),Oe}async whenNotUpdating(T,R){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,z.Te)(R),await(0,N.C_)((()=>!this.updatingExcludingEdits),R),(0,z.Te)(R),Oe}async getDebugInfo(T,R){return(0,z.Te)(R),{result:this._featureFetcher.debugInfo}}async beginApplyEdits(T,R){this._updatingHandles.addPromise(this._whenSetup.promise),(0,z.Te)(R);const M=(0,z.Tw)();return this._pendingApplyEdits.set(T.id,M),this._featureFetcher.applyEdits(M.promise),this._editsUpdatingHandles.addPromise(M.promise),Oe}async endApplyEdits(T,R){const M=this._pendingApplyEdits.get(T.id);return M&&M.resolve(T.edits),(0,z.Te)(R),Oe}async notifyElevationSourceChange(T,R){return this._elevationAligner.notifyElevationSourceChange(),Oe}async notifySymbologyChange(T,R){return this._symbologyCandidatesFetcher.notifySymbologyChange(),Oe}async setSymbologySnappingSupported(T){return this._symbologyCandidatesFetcher=symbologySnappingCandidates_n(T,this._getSymbologyCandidates),Oe}_updateFeatureFetcherConfiguration(T){this._featureFetcher.filter=null!=T.filter?V.A.fromJSON(T.filter):null,this._featureFetcher.customParameters=T.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};(0,A._)([(0,H.MZ)({readOnly:!0})],Ae.prototype,"updating",null),(0,A._)([(0,H.MZ)({readOnly:!0})],Ae.prototype,"updatingExcludingEdits",null),(0,A._)([(0,H.MZ)()],Ae.prototype,"_isInitializing",void 0),Ae=(0,A._)([(0,D.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],Ae);const Be=Ae;const Oe={result:{}}}}]);
//# sourceMappingURL=5260.5ba180d7.chunk.js.map