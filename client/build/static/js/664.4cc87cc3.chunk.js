"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[664],{51961:(u,d,h)=>{h.d(d,{OP:()=>t,V4:()=>r,rZ:()=>n});h(50886);var y=h(89412);function r(u,d,h){var v;if(null==u)return null;const I=d.readArcadeFeature();d.contextTimeZone=null===(v=h.$view)||void 0===v?void 0:v.timeZone;try{return u.evaluate({...h,$feature:I},u.services)}catch(x){return y.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",x),null}}function n(u){return null==u||u===1/0||u===-1/0||"number"==typeof u&&isNaN(u)}function t(u,d,h,y){var v;if(null==u)return null!=y?y:null;const I=d.readArcadeFeature();d.contextTimeZone=null===(v=h.$view)||void 0===v?void 0:v.timeZone;const x=u.evaluate({...h,$feature:I},u.services);return n(x)?null!=y?y:null:x}},98824:(u,d,h)=>{h.d(d,{A:()=>o,J:()=>e});var y=h(4389);function e(u,d){let h;if("string"==typeof u)h=(0,y.Wm)(u+"-seed(".concat(d,")"));else{let y=12;h=u^d;do{h=107*(h>>8^h)+y|0}while(0!=--y)}return(1+h/(1<<31))/2}function o(u){return Math.floor(e(u,v)*I)}const v=53290320,I=10},50386:(u,d,h)=>{h.d(d,{U:()=>n});var y=h(7856),v=h(52702);class Writer_r{get length(){return this._pos}constructor(u,d){this._pos=0;const h=d?this._roundToNearest(d,u.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(h),this._buffer=new u(this._array),this._ctor=u,this._i16View=new Int16Array(this._array)}_roundToNearest(u,d){const h=Math.round(u);return 1===d?h:h+(d-h%d)}_ensureSize(u){if(this._pos+u>=this._buffer.length){const d=this._roundToNearest(1.25*(this._array.byteLength+u*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),h=new ArrayBuffer(d),y=new this._ctor(h);y.set(this._buffer,0),this._array=h,this._buffer=y,this._i16View=new Int16Array(this._array)}}ensureSize(u){this._ensureSize(u)}writeF32(u){this._ensureSize(1);const d=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=u,this._pos++,d}push(u){this._ensureSize(1);const d=this._pos;return this._buffer[this._pos++]=u,d}writeFixed(u){this._buffer[this._pos++]=u}setValue(u,d){this._buffer[u]=d}i1616Add(u,d,h){this._i16View[2*u]+=d,this._i16View[2*u+1]+=h}getValue(u){return this._buffer[u]}getValueF32(u){return new Float32Array(this._array,4*u,1)[0]}incr(u){if(this._buffer.length<u)throw new Error("Increment index overflows the target buffer");this._buffer[u]++}decr(u){this._buffer[u]--}writeRegion(u){this._ensureSize(u.length);const d=this._pos;return this._buffer.set(u,this._pos),this._pos+=u.length,d}writeManyFrom(u,d,h){this._ensureSize(h-d);for(let y=d;y!==h;y++)this.writeFixed(u._buffer[y])}buffer(){const u=this._array.slice(0,4*this._pos);return this.destroy(),u}toArray(){return[...this._buffer]}seek(u){this._pos=u}destroy(){this._array=null,this._buffer=null}}class r{constructor(u,d,h){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const v=6*y*Uint32Array.BYTES_PER_ELEMENT,I=4*y*h,x=h/4,w=d.attributes.find((u=>"pos"===u.name||"position"===u.name));if(!w)throw new Error("InternalError: Unable to find position attribute");this.layout={...d,position:w},this._indices=new Writer_r(Uint32Array,v),this._vertices=new Writer_r(Uint32Array,I),this._metrics=new Writer_r(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=x,this._instanceId=u}serialize(u){const d=this._indices.buffer(),h=this._vertices.buffer(),y=this._metrics.length?this._metrics.buffer():null;return u.push(d,h),{instanceId:this._instanceId,layout:this.layout,indices:d,vertices:h,metrics:y}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(u){this._vertices.ensureSize(u)}indexEnsureSize(u){this._indices.ensureSize(u)}writeIndex(u){this._indices.push(u)}writeVertex(u){this._vertices.push(u)}writeVertexRegion(u){this._vertices.writeRegion(u)}writeVertexF32(u){this._vertices.writeF32(u)}writeMetric(u){this._metrics.incr(this._metricCountOffset),u.serialize(this._metrics)}}class n{constructor(u){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._id=u,this._sizeHint=d,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._instanceIdToVertexData=new Map,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new Writer_r(Uint32Array,this._sizeHint*y.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const u=new Array,d=[],h=this._entities.buffer();for(const y of this._instanceIdToVertexData.values())d.push(y.serialize(u));return{message:{data:d,entities:h},transferList:u}}vertexCount(){var u,d;return null!==(u=null===(d=this._current.writer)||void 0===d?void 0:d.vertexCount)&&void 0!==u?u:0}indexCount(){var u,d;return null!==(u=null===(d=this._current.writer)||void 0===d?void 0:d.indexCount)&&void 0!==u?u:0}vertexEnsureSize(u){this._current.writer.vertexEnsureSize(u)}indexEnsureSize(u){this._current.writer.indexEnsureSize(u)}vertexWrite(u){this._current.writer.writeVertex(u)}vertexWriteRegion(u){this._current.writer.writeVertexRegion(u)}vertexWriteF32(u){this._current.writer.writeVertexF32(u)}recordBounds(u,d,h,y){}indexWrite(u){this._current.writer.writeIndex(u)}metricStart(u){this._current.metric=u}metricEnd(){const u=this._current.writer;this._current.metric.bounds.length&&u.writeMetric(this._current.metric)}metricBoxWrite(u){this._current.metric.bounds.push(u)}entityStart(u){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;this._entityIdIndex=this._entities.push(u),this._entitySortKeyIndex=this._entities.writeF32(d),this._entityRecordCountOffset=this._entities.push(0)}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(u,d){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._current.writer=this._getVertexWriter(u,d),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=u,this._current.layoutHash=d.hash,this._current.textureKey=h}recordEnd(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const d=this._current.vertexStart,h=this._current.writer.vertexCount-d;if(!h)return!1;const y=this._current.indexStart,I=this._current.writer.indexCount-y;return this._entities.incr(this._entityRecordCountOffset),v.A.write(this._entities,this._current.instanceId,this._current.textureKey,y,I,d,h,u),!0}copyLastFrom(u,d,h){var y;const v=u._entities.getValue(u._entityIdIndex);if(v!==this._entities.getValue(this._entityIdIndex)){const d=u._entities.getValueF32(u._entitySortKeyIndex);this.entityStart(v,d)}this.recordStart(u._current.instanceId,u._current.writer.layout,u._current.textureKey);const I=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,x=this._current.vertexStart,w=u._current.vertexStart-x,S=this._current.writer.indexWriter,A=this._current.writer.vertexWriter,T=u._current.writer.indexWriter,E=u._current.writer.vertexWriter;for(let D=u._current.indexStart;D!==T.length;D++){const u=T.getValue(D);S.push(u-w)}for(let D=u._current.vertexStart*I;D!==E.length;D++){const u=E.getValue(D);A.push(u)}const z=this._current.writer.layout.position,F=null!==(y=z.packPrecisionFactor)&&void 0!==y?y:1,M=z.offset/Uint32Array.BYTES_PER_ELEMENT,C=d*F,R=h*F;for(let D=x*I;D<=A.length;D+=I)A.i1616Add(D+M,C,R);this.recordEnd()}_getVertexWriter(u,d){const{stride:h}=d,y=this._instanceIdToVertexData;return y.has(u)||y.set(u,new r(u,d,h,this._sizeHint)),y.get(u)}}},74771:(u,d,h)=>{h.d(d,{J:()=>s});var y=h(4389),v=h(82380);class AResourceProxy_s{}class s extends AResourceProxy_s{constructor(u){super(),this._fetcher=u,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destory(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(u){const d=(0,v.IF)(u.resource),h=(0,y.Wm)(JSON.stringify(d));return this._pendingIds.has(h)||(this._pendingIds.add(h),this._pendingRequests.push({...u,resourceId:h})),h}async fetchEnqueuedResources(){const u=this._pendingRequests;this._pendingIds.clear(),this._pendingRequests=[];const d=await this._fetcher.fetch(u,this._abortOptions);for(let h=0;h<d.length;h++){const y=u[h].resourceId;this._resourceIdToResource.set(y,d[h])}}async fetchResourceImmediate(u){const d=await this._fetcher.fetch([u],this._abortOptions);if(1!==d.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return d[0]}async fetchDictionaryResourceImmediate(u){const d=await this._fetcher.fetchDictionary([u],this._abortOptions);if(1!==d.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return d[0]}getResource(u){return this._resourceIdToResource.get(u)}}},75224:(u,d,h)=>{h.d(d,{hZ:()=>createMeshWriter_n,PZ:()=>i});var y=h(84792),v=h(16842),I=h(4180),x=h(66004),w=h(89412),S=h(98824),A=h(26838),T=h(14454);async function c(u,d){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{defaultValue:y,valueExpressionInfo:v,value:I}=d;if(v){const{expression:I}=v,x=await u.createComputedField({expression:I},h);return x?{...d,computed:x,defaultValue:y}:null}return{...d,computed:new T.G(I),defaultValue:y}}async function m(u,d){const{defaultValue:h,valueExpressionInfo:y}=d,{expression:v}=y,I=await u.createComputedField({expression:v});return I?{...d,computed:I,defaultValue:h}:null}const p=u=>"boolean"!=typeof u&&"number"!=typeof u&&"valueExpressionInfo"in u,f=u=>u.some((u=>{for(const d in u){const h=u[d];if(p(h))return!0}return!1}));class l{static async create(u,d,h){const y={},I=new Map,x=new Map,w=new Map,S=new Map,A=new Map;for(const z in h.params){const F=h.params[z];if(null!=F&&"object"==typeof F)if(Array.isArray(F)){if("object"==typeof F[0])throw new Error("InternalError: Cannot handle ".concat(z,". Nested array params are not supported"));y[z]=F}else if("valueExpressionInfo"in F){if(F.value){y[z]=F.value;continue}const d=await m(u,F);if(!d){y[z]=F.defaultValue;continue}I.set(z,d),y[z]=null}else switch(F.type){case"cim-effect-infos":if(F.effectInfos.some((u=>u.overrides.length))){x.set(z,{effects:await Promise.all(F.effectInfos.map((async d=>{const h=d.overrides.map((d=>c(u,d)));return{effect:d.effect,compiledOverrides:(await Promise.all(h)).filter(v.Ru)}})))});break}y[z]=F.effectInfos.map((u=>u.effect));break;case"cim-marker-placement-info":F.overrides.length&&w.set(z,{placementInfo:F,compiledOverrides:(await Promise.all(F.overrides.map((d=>c(u,d))))).filter(v.Ru)}),y[z]=F.placement;break;case"text-rasterization-param":{var T;if(F.overrides.length){const d=F.overrides.map((d=>c(u,d,F.useLegacyLabelEvaluationRules)));S.set(z,{compiledOverrides:(await Promise.all(d)).filter(v.Ru),rasterizationParam:F,objectIdToResourceId:new Map});continue}const h={type:"cim-rasterization-info",resource:F.resource};y[z]=null!==(T=await d.fetchResourceImmediate(h))&&void 0!==T?T:null;break}case"sprite-rasterization-param":{var E;if(F.overrides.length){const d=F.overrides.map((d=>c(u,d)));S.set(z,{compiledOverrides:(await Promise.all(d)).filter(v.Ru),rasterizationParam:F,objectIdToResourceId:new Map});continue}if("animated"===F.resource.type){S.set(z,{compiledOverrides:[],rasterizationParam:F,objectIdToResourceId:new Map});continue}const h={type:"cim-rasterization-info",resource:F.resource};y[z]=null!==(E=await d.fetchResourceImmediate(h))&&void 0!==E?E:null;break}case"cim-marker-transform-param":{const{params:d}=F;if(f(d)){const h={compiledMarkerInfos:[]};await Promise.all(d.map((async d=>{const y={props:{}};for(const h in d)if(p(d[h])){const v=await m(u,d[h]);y.compiledExpressionMap||(y.compiledExpressionMap=new Map);const I=y.compiledExpressionMap;v&&I.set(h,v)}else y.props[h]=d[h];h.compiledMarkerInfos.push(y)}))),A.set(z,h)}else y[z]={type:"cim-marker-transform-info",infos:d};break}default:y[z]=F}else y[z]=F}return new l(h,y,I,x,w,S,A)}constructor(u,d,h,y,v,I,x){this.inputMeshParams=u,this._resolvedMeshParams=d,this._dynamicProperties=h,this._dynamicEffectProperties=y,this._dynamicPlacementProperties=v,this._dynamicAsyncProperties=I,this._dynamicTransformProperties=x,this.evaluator=u=>u}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(u,d,h){for(const y of this._dynamicAsyncProperties.values()){const v=(0,x.o8)(y.rasterizationParam.resource);"animated"===y.rasterizationParam.resource.type&&y.rasterizationParam.resource.randomizeStartTime&&(v.primitiveName="__RESERVED__PRIMITIVE__NAME__",v.startGroup=(0,S.A)(d.getObjectId()||0));for(const{primitiveName:u,propertyName:x,computed:S,defaultValue:E,valueExpressionInfo:z}of y.compiledOverrides)try{const I="animated"===y.rasterizationParam.resource.type?v.primitiveName:u;(0,A.P)(v,I,x,S,d,h,E)}catch(c){w.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new I.A("invalid-arcade-expression","Encountered an error when evaluating the arcade expression '".concat(null===z||void 0===z?void 0:z.expression,"' (primitive: '").concat(u,"', property: '").concat(x,"')"),c))}const T=u.enqueueRequest({type:"cim-rasterization-info",resource:v});y.objectIdToResourceId.set(d.getObjectId(),T)}}evaluateMeshParams(u,d,h){for(const[y,v]of this._dynamicProperties.entries())this._resolvedMeshParams[y]=v.computed.readWithDefault(d,h,v.defaultValue);for(const[y,v]of this._dynamicPlacementProperties.entries())for(const{computed:u,defaultValue:I,propertyName:x}of v.compiledOverrides){const w=u.readWithDefault(d,h,I);v.placementInfo.placement[x]=w,this._resolvedMeshParams[y]=v.placementInfo.placement}for(const[y,v]of this._dynamicEffectProperties.entries())for(const u of v.effects){for(const{computed:y,defaultValue:v,propertyName:I}of u.compiledOverrides){const x=y.readWithDefault(d,h,v);u.effect[I]=x}this._resolvedMeshParams[y]=v.effects.map((u=>u.effect))}for(const[y,v]of this._dynamicTransformProperties.entries()){const u={type:"cim-marker-transform-info",infos:[]};for(const y of v.compiledMarkerInfos){const v={...y.props};if(y.compiledExpressionMap)for(const[u,I]of y.compiledExpressionMap){const y=I.computed.readWithDefault(d,h,I.defaultValue);v[u]="number"==typeof y||"boolean"==typeof y?y:I.defaultValue}u.infos.push(v)}this._resolvedMeshParams[y]=u}for(const[y,v]of this._dynamicAsyncProperties.entries()){const h=v.objectIdToResourceId.get(d.getObjectId());if(null==h)continue;const I=u.getResource(h);this._resolvedMeshParams[y]=I}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var E=h(14149);async function createMeshWriter_n(u,d,h,y,v,I,x){const w=E.Y[h],S=await l.create(u,d,v),A=new w.constructor(y,S,I,x);return await A.loadDependencies(),A}async function i(u,d,h,v){return Promise.all(h.map((h=>createMeshWriter_n(u,d,h.meshWriterName,(0,y.P)(h.id),h.options,v,h.optionalAttributes))))}},9099:(u,d,h)=>{h.d(d,{Z:()=>t});class t{getObjectId(u){return u.getObjectId()}getAttributes(u){return u.readAttributes()}getAttribute(u,d){return u.readAttribute(d)}getAttributeAsTimestamp(u,d){return u.readAttributeAsTimestamp(d)}cloneWithGeometry(u,d){return u}getGeometry(u){return u.readGeometryWorldSpace()}getCentroid(u,d){return u.readCentroidForDisplay()}}t.Shared=new t},56491:(u,d,h)=>{h.d(d,{L:()=>s});class s{destroy(){}}},13869:(u,d,h)=>{h.d(d,{K:()=>b});var y=h(4180),v=h(50886),I=h(89412),x=h(61163),w=h(80050),S=h(80271),A=h(60950),T=h(82380),E=h(11865);class t{constructor(u){this.data=u,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class r{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(u){let d=this._objectIdToDisplayId.get(u);return d?d.increment():(d=new t((0,A.Ss)(this._getFreeId(),!1)),d.increment(),this._objectIdToDisplayId.set(u,d)),d.data}releaseIdForObjectId(u){const d=this._objectIdToDisplayId.get(u);d&&(d.decrement(),d.empty()&&(this._objectIdToDisplayId.delete(u),this._freeIds.push(d.data)))}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var z=h(70535),F=h(60985);const _=()=>I.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),M=((u,d)=>u&&function(){for(var u=arguments.length,h=new Array(u),y=0;y<u;y++)h[y]=arguments[y];return d.warn("DEBUG:",...h)}||(()=>null))(!1,_()),C=(0,v.A)("esri-shared-array-buffer");(0,v.A)("esri-atomics");class m{constructor(u,d,h){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:y,layout:v,textureOnly:I}=d;this.textureOnly=I||!1,this.pixelType=y,this.layout=v,this._resetRange(),this.size=u,this.isLocal=h,I||(this.data=this._initData(y,u))}get buffer(){var u;return null===(u=this.data)||void 0===u?void 0:u.buffer}unsetComponentAllTexels(u,d){const h=this.data;for(let y=0;y<this.size*this.size;y++)h[y*this.texelSize+u]&=~d;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(u,d){const h=this.data;for(let y=0;y<this.size*this.size;y++)h[y*this.texelSize+u]|=255&d;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(u,d,h){const y=this.data;for(const v of h)y[v*this.texelSize+u]|=d,this.dirtyStart=Math.min(this.dirtyStart,v),this.dirtyEnd=Math.max(this.dirtyEnd,v)}setComponentTexel(u,d,h){this.data[h*this.texelSize+u]|=d,this.dirtyStart=Math.min(this.dirtyStart,h),this.dirtyEnd=Math.max(this.dirtyEnd,h)}unsetComponentTexel(u,d,h){this.data[h*this.texelSize+u]&=~d,this.dirtyStart=Math.min(this.dirtyStart,h),this.dirtyEnd=Math.max(this.dirtyEnd,h)}getData(u,d){const h=(0,A.Q4)(u);return this.data[h*this.texelSize+d]}setData(u,d,h){const y=(0,A.Q4)(u),v=1<<d;0!=(this.layout&v)?null!=this.data&&(this.data[y*this.texelSize+d]=h,this.dirtyStart=Math.min(this.dirtyStart,y),this.dirtyEnd=Math.max(this.dirtyEnd,y)):_().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(u){if(this.size=u,!this.textureOnly){const d=this._initData(this.pixelType,u),h=this.data;d.set(h),this.data=d}}toMessage(){const u=this.dirtyStart,d=this.dirtyEnd,h=this.texelSize;if(u>d)return null;this._resetRange();const y=!this.isLocal,v=this.pixelType,I=this.layout,x=this.data;return{start:u,end:d,data:y&&x.slice(u*h,(d+1)*h)||null,pixelType:v,layout:I}}_initData(u,d){const h=ArrayBuffer,y=(0,T.Qz)(u),v=new y(new h(d*d*4*y.BYTES_PER_ELEMENT));for(let I=0;I<v.length;I+=4)v[I+1]=255;return v}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class b{constructor(u){this._client=u,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=S.TB,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new r,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const u=F.ld.FLOAT;M("Creating AttributeStore ".concat(C?"with":"without"," shared memory")),this._blockDescriptors=[{pixelType:F.ld.UNSIGNED_BYTE,layout:1},{pixelType:F.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:F.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:u,layout:15},{pixelType:u,layout:15},{pixelType:u,layout:15},{pixelType:u,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(u){return this._idGenerator.createIdForObjectId(u)}releaseDisplayIdForObjectId(u){return this._idGenerator.releaseIdForObjectId(u)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}async update(u,d,h,y){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const w=(0,x.Ui)(this._schema,u);if(this.version=I,w&&((0,v.A)("esri-2d-update-debug")&&console.debug("Version[".concat(I,"] AttributeStore.update"),{changed:w}),this._schema=u,this._attributeComputeInfo=null,this._initialize(),null!=u))if(h&&(this._filters=await Promise.all(u.filters.map((u=>u?z.A.create({geometryType:h.geometryType,hasM:!1,hasZ:!1,timeInfo:h.timeInfo,fieldsIndex:h.fieldsIndex,spatialReference:null!==y&&void 0!==y?y:h.spatialReference,filterJSON:u}):null)))),"subtype"!==u.type)this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(u.bindings.map((async u=>{var h,y;const v=await this._bind(d,u);this._referencesGeometry=this._referencesGeometry||null!==(h=null===v||void 0===v?void 0:v.referencesGeometry())&&void 0!==h&&h,this._referencesScale=this._referencesScale||null!==(y=null===v||void 0===v?void 0:v.referencesScale())&&void 0!==y&&y})));else{this._attributeComputeInfo={isSubtype:!0,subtypeField:u.subtypeField,map:new Map},this._referencesScale=!1,this._referencesGeometry=!1;for(const h in u.bindings){const y=u.bindings[h];await Promise.all(y.map((async u=>{var y,v;const I=await this._bind(d,u,parseInt(h,10));this._referencesGeometry=this._referencesGeometry||null!==(y=null===I||void 0===I?void 0:I.referencesGeometry())&&void 0!==y&&y,this._referencesScale=this._referencesScale||null!==(v=null===I||void 0===I?void 0:I.referencesScale())&&void 0!==v&&v})))}}}setHighlight(u,d){const h=this._getBlock(0);h.unsetComponentAllTexels(0,(1<<w.M$.length)-1);for(const{displayId:y,highlightFlags:v}of u){if(null==y)continue;const u=(0,A.Q4)(y);h.setComponent(0,v,[u])}this._idsToHighlight.clear();for(const{objectId:y,highlightFlags:v}of u)this._idsToHighlight.set(y,v);for(const{objectId:y,highlightFlags:v}of d)this._idsToHighlight.set(y,v)}setData(u,d,h,y){const v=(0,A.Q4)(u);this._ensureSizeForTexel(v),this._getBlock(d).setData(u,h,y)}getData(u,d,h){return this._getBlock(d).getData(u,h)}getHighlightFlags(u){return this._idsToHighlight.get(u)||0}unsetAttributeData(u){const d=(0,A.Q4)(u);this._getBlock(0).setData(d,0,0)}setAttributeData(u,d,h){var y;const v=(0,A.Q4)(u);this._ensureSizeForTexel(v),this._getBlock(0).setData(v,0,this.getFilterFlags(d));const I=this._attributeComputeInfo;let x=null;I&&(x=I.isSubtype?I.map.get(d.readAttribute(I.subtypeField)):I.map,(null===(y=x)||void 0===y?void 0:y.size)&&x.forEach(((u,y)=>{var I;const x=1*y%4,w=Math.floor(1*y/4),A=this._getBlock(w+S.dV.VV);let T=null===(I=u.field)||void 0===I?void 0:I.read(d,h);u.valueRepresentation&&(T=function g(u,d){if(!u||!d)return u;switch(d){case"radius":case"distance":return 2*u;case"diameter":case"width":return u;case"area":return Math.sqrt(u)}return u}(T,u.valueRepresentation)),(null===T||isNaN(T)||T===1/0||T===-1/0)&&(T=E.qM),A.setData(v,x,T)})))}get epoch(){return this._epoch}async sendUpdates(){const u=this._blocks.map((u=>null!=u?u.toMessage():null)),d=this._getInitArgs();(0,v.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),await this._client.update({initArgs:d,blockData:u,version:this.version,sendUpdateEpoch:this._epoch},this._signal),this._epoch+=1,(0,v.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(u){for(;u>=this._size*this._size;)if(this._expand())return}async _bind(u,d,h){const y=await u.createComputedField(d),{valueRepresentation:v}=d,I=this._attributeComputeInfo;if(I.isSubtype){var x;const u=null!==(x=I.map.get(h))&&void 0!==x?x:new Map;u.set(d.binding,{field:y,valueRepresentation:v}),I.map.set(h,u)}else I.map.set(d.binding,{field:y,valueRepresentation:v});return y}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(S.dV.Animation),this._getBlock(S.dV.GPGPU),{blockSize:this._size,blockDescriptors:this._blocks.map((u=>null!=u?{textureOnly:u.textureOnly,buffer:u.buffer,pixelType:u.pixelType}:null))})}_getBlock(u){const d=this._blocks[u];if(null!=d)return d;M("Initializing AttributeBlock at index ".concat(u));const h=new m(this._size,this._blockDescriptors[u],this._client.isLocal);return this._blocks[u]=h,this._initialized=!1,h}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const u=this._size<<=1;M("Expanding block size to",u,this._blocks);for(const d of this._blocks)null===d||void 0===d||d.expand(u);return this._initialized=!1,this._size=u,0}return _().error(new y.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(u){return!!(this._getBlock(0).getData(u,0)&1<<w.M$.length)}getFilterFlags(u){let d=0;for(let y=0;y<this._filters.length;y++){const h=!!(1<<y),v=this._filters[y];d|=(!h||null==v||v.check(u)?1:0)<<y}let h=0;if(this._idsToHighlight.size){const d=u.getObjectId();h=this.getHighlightFlags(d)}return d<<w.M$.length|h}}},29170:(u,d,h)=>{h.d(d,{l:()=>p});var y=h(4180),v=h(89412),I=h(21374),x=h(60950),w=h(56491);class r extends w.L{constructor(u){super(),this._field=u}resize(u){throw new Error("Method not implemented.")}read(u,d){return u.readAttribute(this._field)}readWithDefault(u,d){return u.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var S=h(39368),A=h(51961);class c extends w.L{static async create(u,d){const h=await(0,S.Ad)(u,d.spatialReference,d.fields);return new c(h)}constructor(u){super(),this._compiled=u}resize(u){}read(u,d){return(0,A.V4)(this._compiled,u,d)}readWithDefault(u,d,h){return(0,A.OP)(this._compiled,u,d,h)}referencesScale(){var u,d;return null!==(u=null===(d=this._compiled)||void 0===d?void 0:d.referencesScale())&&void 0!==u&&u}referencesGeometry(){var u,d;return null!==(u=null===(d=this._compiled)||void 0===d?void 0:d.referencesGeometry())&&void 0!==u&&u}}var T=h(19549),E=h(97468);class a extends w.L{static async create(u,d){const h=(0,E.lc)(u);return new a((u=>h.replaceAll(/{[^}]*}/g,(d=>{const h=d.slice(1,-1),y=u.metadata.fieldsIndex.get(h);if(null==y)return d;const v=u.readAttribute(h);return null==v?"":(0,T.W)(v,y)}))))}constructor(u){super(),this._evaluator=u}resize(u){}read(u,d){return this._evaluator(u)}readWithDefault(u,d,h){const y=this._evaluator(u);return(0,A.rZ)(y)?h:y}referencesScale(){return!1}referencesGeometry(){return!1}}class NormalizedField_r extends w.L{constructor(u,d){super(),this._field=u,this._normalizationInfo=d}resize(u){throw new Error("Method not implemented.")}read(u,d){return this._readNormalized(u)}readWithDefault(u,d){return this._readNormalized(u)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(u){const d=u.readAttribute(this._field);if(null==d)return null;const{normalizationField:h,normalizationTotal:y,normalizationType:v}=this._normalizationInfo,I=u.readAttribute(h);switch(null!==v&&void 0!==v?v:"esriNormalizeByField"){case"esriNormalizeByField":return I?I?d/I:void 0:null;case"esriNormalizeByLog":return Math.log(d)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return y?d/y*100:null}}}var z=h(92748),F=h(87867);const ComputedAttributeStorage_a=()=>v.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),M=4294967295;function m(u,d,h){if(!(u.length>d))for(;u.length<=d;)u.push(h)}class p{constructor(u){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=u}createBitset(){const u=this._bitsets.length;return this._bitsets.push(z.y.create(this._allocatedSize,x.KQ)),u+1}async createComputedField(u){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return d?a.create(u.expression,this.compilationOptions):await c.create(u.expression,this.compilationOptions)}catch(v){const d=new y.A("featurelayer","Failed to compile arcade expression",{error:v,expression:u.expression});return ComputedAttributeStorage_a().error(d),null}if(u.normalizationType||u.normalizationField)return new NormalizedField_r(u.field,u);if(u.field)return new r(u.field);const h=new y.A("featurelayer","Unable to create computed field. No expression or field found",{info:u});return ComputedAttributeStorage_a().error(h),null}async createWhereClause(u){return u?(0,F.$)(u,this.compilationOptions.fields):null}getBitset(u){return this._bitsets[u-1]}getComputedNumeric(u,d){return this.getComputedNumericAtIndex(u&x.KQ,0)}setComputedNumeric(u,d,h){return this.setComputedNumericAtIndex(u&x.KQ,h,0)}getComputedString(u,d){return this.getComputedStringAtIndex(u&x.KQ,0)}setComputedString(u,d,h){return this.setComputedStringAtIndex(u&x.KQ,0,h)}getComputedNumericAtIndex(u,d){const h=u&x.KQ;return this._ensureNumeric(d,h),this._numerics[d][h]}setComputedNumericAtIndex(u,d,h){const y=u&x.KQ;this._ensureNumeric(d,y),this._numerics[d][y]=h}getPackedChunkId(u){const d=u&x.KQ;return this._ensureInstanceId(d),this._instanceIds[d]}setPackedChunkId(u,d){const h=u&x.KQ;this._ensureInstanceId(h),this._instanceIds[h]=d}getComputedStringAtIndex(u,d){const h=u&x.KQ;return this._ensureString(d,h),this._strings[d][h]}setComputedStringAtIndex(u,d,h){const y=u&x.KQ;this._ensureString(d,y),this._strings[d][y]=h}getXMin(u){return this._bounds[4*(u&x.KQ)]}getYMin(u){return this._bounds[4*(u&x.KQ)+1]}getXMax(u){return this._bounds[4*(u&x.KQ)+2]}getYMax(u){return this._bounds[4*(u&x.KQ)+3]}setBounds(u,d){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const y=u&x.KQ;if(!h&&!this._dirtyBitset.has(u))return this._bounds[4*y]!==M;this._dirtyBitset.unset(u);const v=d.readGeometryWorldSpace();if(m(this._bounds,4*y+4,0),!v||!v.coords.length)return this._bounds[4*y]=M,this._bounds[4*y+1]=M,this._bounds[4*y+2]=M,this._bounds[4*y+3]=M,!1;let I=1/0,w=1/0,S=-1/0,A=-1/0;return v.forEachVertex(((u,d)=>{I=Math.min(I,u),w=Math.min(w,d),S=Math.max(S,u),A=Math.max(A,d)})),this._bounds[4*y]=I,this._bounds[4*y+1]=w,this._bounds[4*y+2]=S,this._bounds[4*y+3]=A,!0}getBounds(u,d){const h=this.getXMin(d),y=this.getYMin(d),v=this.getXMax(d),x=this.getYMax(d);return(0,I.BI)(u,h,y,v,x),h!==M}_ensureNumeric(u,d){this._numerics[u]||(this._numerics[u]=[]),m(this._numerics[u],d,0)}_ensureInstanceId(u){m(this._instanceIds,u,0)}_ensureString(u,d){this._strings[u]||(this._strings[u]=[]),m(this._strings[u],d,null)}}},14454:(u,d,h)=>{h.d(d,{G:()=>r});var y=h(56491);class r extends y.L{constructor(u){super(),this._value=u}resize(u){}read(u,d){return this._value}readWithDefault(u,d,h){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}},70535:(u,d,h)=>{h.d(d,{A:()=>p});var y=h(4180),v=h(89412),I=h(88965),x=h(12439),w=h(70857),S=h(70564),A=h(66174),T=h(49096),E=h(9099),z=h(87867);class p{constructor(u){this._geometryBounds=(0,I.vt)(),this._idToVisibility=new Map,this._serviceInfo=u}static async create(u){const d=new p(u);return await d.update(u.filterJSON,u.spatialReference),d}get hash(){return this._hash}check(u){return this._applyFilter(u)}clear(){const u=this._resetAllHiddenIds();return this.update(),{show:u,hide:[]}}invalidate(){this._idToVisibility.forEach(((u,d)=>{this._idToVisibility.set(d,0)}))}setKnownIds(u){for(const d of u)this._idToVisibility.set(d,1)}setTrue(u){const d=[],h=[],y=new Set(u);return this._idToVisibility.forEach(((u,v)=>{const I=!!(1&this._idToVisibility.get(v)),x=y.has(v);!I&&x?d.push(v):I&&!x&&h.push(v),this._idToVisibility.set(v,x?3:0)})),{show:d,hide:h}}createQuery(){const{geometry:u,spatialRel:d,where:h,timeExtent:y,objectIds:v}=this;return T.A.fromJSON({geometry:u,spatialRel:d,where:h,timeExtent:y,objectIds:v})}async update(u,d){this._hash=JSON.stringify(u);const h=await(0,w.T2)(u,null,d);await Promise.all([this._setGeometryFilter(h),this._setIdFilter(h),this._setAttributeFilter(h),this._setTimeFilter(h)])}async _setAttributeFilter(u){if(null===u||void 0===u||!u.where)return this._clause=null,void(this.where=null);this._clause=await(0,z.$)(u.where,this._serviceInfo.fieldsIndex),this.where=u.where}_setIdFilter(u){this._idsToShow=(null===u||void 0===u?void 0:u.objectIds)&&new Set(u.objectIds),this._idsToHide=(null===u||void 0===u?void 0:u.hiddenIds)&&new Set(u.hiddenIds),this.objectIds=null===u||void 0===u?void 0:u.objectIds}async _setGeometryFilter(u){if(null===u||void 0===u||!u.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const d=u.geometry,h=u.spatialRel||"esriSpatialRelIntersects",y=await(0,S.xt)(h,d,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,x.Rg)(this._geometryBounds,d),this._spatialQueryOperator=y,this.geometry=d,this.spatialRel=h}_setTimeFilter(u){if(this.timeExtent=this._timeOperator=null,null!==u&&void 0!==u&&u.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=u.timeExtent,this._timeOperator=(0,A.I)(this._serviceInfo.timeInfo,u.timeExtent,E.Z.Shared);else{const d=new y.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",u.timeExtent);v.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(d)}}_applyFilter(u){return this._filterByGeometry(u)&&this._filterById(u)&&this._filterByTime(u)&&this._filterByExpression(u)}_filterByExpression(u){return!this.where||this._clause(u)}_filterById(u){var d,h;return(!(null!==(d=this._idsToHide)&&void 0!==d&&d.size)||!this._idsToHide.has(u.getObjectId()))&&(!(null!==(h=this._idsToShow)&&void 0!==h&&h.size)||this._idsToShow.has(u.getObjectId()))}_filterByGeometry(u){if(!this.geometry)return!0;const d=u.readGeometryWorldSpace();return!!d&&this._spatialQueryOperator(d)}_filterByTime(u){return null==this._timeOperator||this._timeOperator(u)}_resetAllHiddenIds(){const u=[];return this._idToVisibility.forEach(((d,h)=>{1&d||(this._idToVisibility.set(h,1),u.push(h))})),u}}},91080:(u,d,h)=>{h.d(d,{h:()=>s,i:()=>i});var y=h(98664),v=h(8084);class i{constructor(u){var d,h,I;this._options=u,this._fieldsIndex="fieldsIndex"in u?v.A.fromJSON(u.fieldsIndex):new v.A(u.fields),u.spatialReference&&(this._spatialReference=y.A.fromJSON(u.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:null!==(d=this._options.typeIdField)&&void 0!==d?d:void 0,types:null!==(h=this._options.types)&&void 0!==h?h:void 0,subtypeField:this._options.subtypeField,subtypes:null!==(I=this._options.subtypes)&&void 0!==I?I:void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class s extends i{static create(u){return new s({fields:[],objectIdField:"uid",geometryType:null,spatialReference:u,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},95330:(u,d,h)=>{h.d(d,{Y:()=>B});h(30174);var y,v,I,x=h(46381),w=h(50886),S=h(35598),A=h(99343),T=h(23342),E=h(33303),z=h(21374),F=h(61693),M=h(32050),C=h(57224),R=h(41156),D=h(52994),O=h(92748),P=h(31670);const G=null!==(y=(0,w.A)("featurelayer-simplify-thresholds"))&&void 0!==y?y:[.5,.5,.5,.5],k=G[0],V=G[1],N=G[2],W=G[3],L=null!==(v=(0,w.A)("featurelayer-simplify-payload-size-factors"))&&void 0!==v?v:[1,2,4],Q=L[0],U=L[1],Y=L[2],K=null!==(I=(0,w.A)("featurelayer-simplify-mobile-factor"))&&void 0!==I?I:2,Z=(0,w.A)("esri-mobile"),H=4294967295;class B{constructor(u){this.metadata=u,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(u,d){let h=1;const y=Z?K:1;d>4e6?h=Y*y:d>1e6?h=U*y:d>5e5?h=Q*y:d>1e5&&(h=y);let v=0;return u>4e3?v=W*h:u>2e3?v=N*h:u>100?v=V:u>15&&(v=k),v}parseTimestampOffset(u){return u}getBounds(u){if(function j(u,d,h){if(!(u.length>d))for(;u.length<=d;)u.push(h)}(this._boundsBuffer,4*this.getIndex()+4,0),this.getBoundsXMin()===H)return!1;if(0===this.getBoundsXMin()){const d=this.readGeometryWorldSpace();if(!d)return this.setBoundsXMin(H),!1;let h=1/0,y=1/0,v=-1/0,I=-1/0;return d.forEachVertex(((u,d)=>{h=Math.min(h,u),y=Math.min(y,d),v=Math.max(v,u),I=Math.max(I,d)})),this.setBoundsXMin(h),this.setBoundsYMin(y),this.setBoundsXMax(v),this.setBoundsYMax(I),(0,z.BI)(u,h,y,v,I),!0}const d=this.getBoundsXMin(),h=this.getBoundsYMin(),y=this.getBoundsXMax(),v=this.getBoundsYMax();return(0,z.BI)(u,d,h,y,v),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(u){this._boundsBuffer[4*this.getIndex()]=u}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(u){this._boundsBuffer[4*this.getIndex()+1]=u}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(u){this._boundsBuffer[4*this.getIndex()+2]=u}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(u){this._boundsBuffer[4*this.getIndex()+3]=u}readAttributeAsTimestamp(u){const d=this.readAttribute(u);return"string"==typeof d?new Date(d).getTime():"number"==typeof d||null==d?d:null}readAttribute(u){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const h=this._readAttribute(u,d);if(void 0!==h)return h;for(const y of this._joined){y.setIndex(this.getIndex());const h=y._readAttribute(u,d);if(void 0!==h)return h}}readAttributes(){const u=this._readAttributes();for(const d of this._joined){d.setIndex(this.getIndex());const h=d._readAttributes();for(const d of Object.keys(h))u[d]=h[d]}return u}joinAttributes(u){this._joined.push(u)}removeIds(u){if(null==this._objectIdToIndex){const u=new Map,d=this.getCursor();for(;d.next();){const h=d.getObjectId();(0,S.Lw)(h),u.set(h,d.getIndex())}this._objectIdToIndex=u}const d=this._objectIdToIndex;for(const h of u.values())d.has(h)&&this._removeAtIndex(d.get(h))}readOptimizedFeatureWorldSpace(){const u=this.readGeometryWorldSpace(),d=this.readAttributes(),h=this.readCentroidWorldSpace(),y=new C.Om(u,d,h);return y.objectId=this.getObjectId(),y.displayId=this.getDisplayId(),y}readLegacyFeatureForDisplay(){var u;const d=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:null!==(u=d&&{x:d.coords[0],y:d.coords[1]})&&void 0!==u?u:null}}readLegacyFeatureWorldSpace(){var u;const d=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:null!==(u=d&&{x:d.coords[0],y:d.coords[1]})&&void 0!==u?u:null}}readLegacyGeometryForDisplay(){const u=this.readGeometryForDisplay();return(0,M.zv)(u,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const u=this._readX(),d=this.getInTransform();return null==d?u:u*d.scale[0]+d.translate[0]}readYWorldSpace(){const u=this._readY(),d=this.getInTransform();return null==d?u:d.translate[1]-u*d.scale[1]}readGeometryForDisplay(){const u=this._readGeometryDeltaDecoded(!0);if(!u){const u=this._createGeometryFromServerCentroid();return u?u.deltaDecode():null}return u}readGeometryWorldSpace(){let u=this._readGeometry();if(u||(u=this._createGeometryFromServerCentroid()),!u)return null;const d=u.clone(),h=this.getInTransform();return null!=h&&(0,M.Ch)(d,d,this.hasZ,this.hasM,h),d}readCentroidForDisplay(){const u=this.readGeometryForDisplay();return u?this._computeDisplayCentroid(u):this._readServerCentroid()}readCentroidWorldSpace(){const u=this.readGeometryForDisplay(),d=u?this._computeDisplayCentroid(u):this._readServerCentroid();if(!d)return null;const h=d.clone(),y=this.getInTransform();return null!=y&&(0,M.Ch)(h,h,this.hasZ,this.hasM,y),h}_readGeometryDeltaDecoded(u){const d=this._readGeometry(u);return"esriGeometryPoint"!==this.geometryType&&d&&this.getInTransform()?d.deltaDecode():d}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(u){this._contextTimeZone=u}readArcadeFeature(){return this}hasField(u){return this.fields.has(u)||this._joined.some((d=>d.hasField(u)))}geometry(){const u=this.readGeometryWorldSpace(),d=(0,M.zv)(u,this.geometryType,this.hasZ,this.hasM),h=(0,P.rS)(d);if(h){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");h.spatialReference=this.metadata.spatialReference}return h}autocastArcadeDate(u,d){var h;return d&&d instanceof Date?this.isUnknownDateTimeField(u)?x.lY.unknownDateJSToArcadeDate(d):x.lY.dateJSAndZoneToArcadeDate(d,null!==(h=this.contextTimeZone)&&void 0!==h?h:D.qU):d}isUnknownDateTimeField(u){return this.metadata.fieldsIndex.getTimeZone(u)===D.L5}field(u){let d=this.fields.get(u);if(d)switch(d.type){case"date-only":case"esriFieldTypeDateOnly":return A.n.fromReader(this.readAttribute(u,!1));case"time-only":case"esriFieldTypeTimeOnly":return T.k.fromReader(this.readAttribute(u,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return x.lY.fromReaderAsTimeStampOffset(this.readAttribute(u,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(u,this.readAttribute(u,!0));default:return this.readAttribute(u,!1)}for(const h of this._joined)if(h.setIndex(this.getIndex()),d=h.fields.get(u),d)switch(d.type){case"date-only":case"esriFieldTypeDateOnly":return A.n.fromReader(h._readAttribute(u,!1));case"time-only":case"esriFieldTypeTimeOnly":return T.k.fromReader(h._readAttribute(u,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return x.lY.fromReaderAsTimeStampOffset(h._readAttribute(u,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(u,h._readAttribute(u,!0));default:return this.readAttribute(u,!1)}throw new Error("Field ".concat(u," does not exist"))}setField(u,d){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map((u=>u.name))}castToText(){var u;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))return JSON.stringify(this.readLegacyFeatureForDisplay());const d=this.readLegacyFeatureForDisplay();if(!d)return JSON.stringify(null);const h={geometry:d.geometry,attributes:{...null!==(u=d.attributes)&&void 0!==u?u:{}}};for(const y in h.attributes){const u=h.attributes[y];u instanceof Date&&(h.attributes[y]=u.getTime())}return JSON.stringify(h)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(){var u,d;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{attributes:this._readAttributes(),geometry:!0===(null===h||void 0===h?void 0:h.keepGeometryType)?this.geometry():null!==(u=null===(d=this.geometry())||void 0===d?void 0:d.toJSON())&&void 0!==u?u:null}}castAsJsonAsync(){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Promise.resolve(this.castAsJson(u))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(u){const d=E.z.fromOptimized(u,this.geometryType);d.yFactor*=-1;const h=(0,F.d)(d);return h?(h[1]*=-1,new R.A([],h)):null}copyInto(u){u._joined=this._joined,u._deleted=this._deleted,u._objectIdToIndex=this._objectIdToIndex,u._boundsBuffer=this._boundsBuffer}_readLegacyGeometryWorldSpace(){const u=this.readGeometryWorldSpace();return(0,M.zv)(u,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const u=this._readServerCentroid();if(!u)return null;const[d,h]=u.coords;return this._createQuantizedExtrudedGeometry(d,h)}_createQuantizedExtrudedGeometry(u,d){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(u,d):this._createQuantizedExtrudedQuad(u,d)}_createQuantizedExtrudedQuad(u,d){return new R.A([5],[u-1,d,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(u,d){return new R.A([2],[u-1,d+1,1,-1])}_removeAtIndex(u){null==this._deleted&&(this._deleted=O.y.create(this.getSize())),this._deleted.set(u)}}},92748:(u,d,h)=>{h.d(d,{y:()=>t});class t{static fromBuffer(u,d){return new t(u,d)}static create(u){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4294967295;const h=new Uint32Array(Math.ceil(u/32));return new t(h,d)}constructor(u,d){this._mask=0,this._buf=u,this._mask=d}_getIndex(u){return Math.floor(u/32)}has(u){const d=this._mask&u;return!!(this._buf[this._getIndex(d)]&1<<d%32)}hasRange(u,d){let h=u,y=d;for(;h%32&&h!==y;){if(this.has(h))return!0;h++}for(;y%32&&h!==y;){if(this.has(h))return!0;y--}if(h===y)return!1;for(let v=h/32;v!==y/32;v++)if(this._buf[v])return!0;return!1}set(u){const d=this._mask&u,h=this._getIndex(d),y=1<<d%32;this._buf[h]|=y}setRange(u,d){let h=u,y=d;for(;h%32&&h!==y;)this.set(h++);for(;y%32&&h!==y;)this.set(y--);if(h!==y)for(let v=h/32;v!==y/32;v++)this._buf[v]=4294967295}unset(u){const d=this._mask&u,h=this._getIndex(d),y=1<<d%32;this._buf[h]&=4294967295^y}resize(u){const d=this._buf,h=new Uint32Array(Math.ceil(u/32));h.set(d),this._buf=h}or(u){for(let d=0;d<this._buf.length;d++)this._buf[d]|=u._buf[d];return this}and(u){for(let d=0;d<this._buf.length;d++)this._buf[d]&=u._buf[d];return this}xor(u){for(let d=0;d<this._buf.length;d++)this._buf[d]^=u._buf[d];return this}ior(u){for(let d=0;d<this._buf.length;d++)this._buf[d]|=~u._buf[d];return this}iand(u){for(let d=0;d<this._buf.length;d++)this._buf[d]&=~u._buf[d];return this}ixor(u){for(let d=0;d<this._buf.length;d++)this._buf[d]^=~u._buf[d];return this}any(){for(let u=0;u<this._buf.length;u++)if(this._buf[u])return!0;return!1}copy(u){for(let d=0;d<this._buf.length;d++)this._buf[d]=u._buf[d];return this}clone(){return new t(this._buf.slice(),this._mask)}clear(){for(let u=0;u<this._buf.length;u++)this._buf[u]=0;return this}forEachSet(u){for(let d=0;d<this._buf.length;d++){let h=this._buf[d],y=32*d;if(h)for(;h;)1&h&&u(y),h>>>=1,y++}}countSet(){let u=0;return this.forEachSet((d=>{u++})),u}}},87867:(u,d,h)=>{h.d(d,{$:()=>o});var y=h(4180),v=h(89412),I=h(25986);const a=()=>v.A.getLogger("esri.views.2d.layers.features.support.whereUtils"),x={getAttribute:(u,d)=>u.readAttribute(d)};async function o(u,d){try{const h=await(0,I.G)(u,d);if(!h.isStandardized){const u=new y.A("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",h);a().error(u)}return y=>{const v=y.readArcadeFeature();try{return h.testFeature(v,x)}catch(d){return a().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",u),!0}}}catch(h){return a().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",u),u=>!0}}}}]);
//# sourceMappingURL=664.4cc87cc3.chunk.js.map