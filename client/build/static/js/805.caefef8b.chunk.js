"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[805],{64957:(i,s,h)=>{h.d(s,{Y:()=>r});var a=h(80671),l=(h(89412),h(50886),h(76761),h(4180),h(68682)),p=h(88965),u=h(46427),c=h(82804),d=h(84624);class BitmapTile_r extends d.Y{constructor(i,s,h,a,l,p){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(i,s,h,a,l,p),this.bitmap=new c.mb(u),this.bitmap.coordScale=[l,p],this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(i){this.bitmap.beforeRender(i),super.beforeRender(i)}afterRender(i){this.bitmap.afterRender(i),super.afterRender(i)}set stencilRef(i){this.bitmap.stencilRef=i}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,u.vt)(),tileMat3:(0,u.vt)()}}setTransform(i){super.setTransform(i),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var g=h(82262),f=h(21847),m=h(49214);class n extends m.A{get requiresDedicatedFBO(){return this.children.some((i=>"additive"===i.bitmap.blendFunction))}createTile(i){const s=this._tileInfoView.getTileBounds((0,p.vt)(),i),h=this._tileInfoView.getTileResolution(i.level),[a,l]=this._tileInfoView.tileInfo.size;return new BitmapTile_r(i,h,s[0],s[3],a,l)}prepareRenderPasses(i){const s=i.registerRenderPass({name:"bitmap (tile)",brushes:[g.d.bitmap],target:()=>this.children.map((i=>i.bitmap)),drawPhase:f.S5.MAP});return[...super.prepareRenderPasses(i),s]}doRender(i){this.visible&&i.drawPhase===f.S5.MAP&&super.doRender(i)}}const r=i=>{let s=class extends i{attach(){this.view.timeline.record("".concat(this.layer.title," (BitmapTileLayer) Attach")),this._bitmapView=new n(this._tileInfoView),this.container.addChild(this._bitmapView)}detach(){var i;this.container.removeChild(this._bitmapView),null!==(i=this._bitmapView)&&void 0!==i&&i.removeAllChildren(),this._bitmapView=null}};return s=(0,a._)([(0,l.$)("esri.views.2d.layers.BitmapTileLayerView2D")],s),s}},70805:(i,s,h)=>{h.r(s),h.d(s,{default:()=>M});var a=h(80671),l=h(58285),p=h(89412),u=h(81618),c=h(57453),d=(h(50886),h(76761),h(68682)),g=h(78395),f=h(52015),m=(h(4180),h(59650),h(1698),h(50352),h(61272),h(48237),h(84661),h(40137),h(83157),h(66445),h(22156),h(57264),h(48343),h(60141),h(6744),h(5144),h(20665),h(77045),h(18356),h(5139),h(58860),h(870),h(9760),h(57516),h(70335),h(17985),h(76506),h(53185),h(99054),h(97887),h(54574),h(36654),h(85272),h(75184),h(11931),h(67382),h(11257),h(64032),h(80271),h(40102),h(73855),h(99442),h(85060),h(31714),h(21664),h(93170),h(23133),h(73067),h(21847),h(83817),h(9576),h(71014),h(60985),h(50707),h(55451),h(87107),h(83663),h(77415),h(40449),h(67685)),_=(h(7856),h(78844),h(46038),h(72339),h(4250),h(89766),h(22677),h(53705),h(4270),h(40954),h(71245),h(73025),h(80148),h(53944),h(43474),h(96767),h(55082),h(46081),h(4253),h(41096)),w=(h(87149),h(39652),h(22668),h(96415),h(42687),h(21374),h(53395),h(55476),h(98664),h(39572),h(30174),h(50075),h(37588),h(43401),h(64957)),y=h(86083),v=h(42238),b=h(68369),I=h(63801),V=h(54869),T=h(11808),H=h(27012),R=h(59995),A=h(60773),C=h(5058);const S=[0,0];let q=class extends((0,R.A)((0,w.Y)((0,y.e)(H.A)))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new f.Y,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(i){var s;this._fetchQueue.pause(),this._fetchQueue.state=i.state,this._tileStrategy.update(i),this._fetchQueue.resume(),null===(s=this._highlightView)||void 0===s||s.processUpdate(i)}attach(){const i="tileServers"in this.layer?this.layer.tileServers:null,s=this.tilemapCache;if(this._tileInfoView=new I.A(this.layer.tileInfo,this.layer.fullExtent,null===s||void 0===s?void 0:s.effectiveMinLOD,null===s||void 0===s?void 0:s.effectiveMaxLOD),this._fetchQueue=new V.A({tileInfoView:this._tileInfoView,concurrency:i&&10*i.length||10,process:(i,s)=>this.fetchTile(i,s)}),this._tileStrategy=new T.A({cachePolicy:"keep",resampling:this.resampling,acquireTile:i=>this.acquireTile(i),releaseTile:i=>this.releaseTile(i),tileInfoView:this._tileInfoView}),(0,A.ox)(this,this.layer)){const i=this._highlightView=new _.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new v.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new A.Uh({createFetchPopupFeaturesQueryGeometry:(i,s)=>(0,C.V)(i,s,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(s,h)=>{i.graphicUpdateHandler({graphic:s,property:h})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate(),this.addAttachHandles(this._updatingHandles.add((()=>this.resampling),(()=>{this.doRefresh()}))),super.attach()}detach(){var i,s;super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),null!==(i=this._popupHighlightHelper)&&void 0!==i&&i.destroy(),null!==(s=this._highlightView)&&void 0!==s&&s.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}async fetchPopupFeaturesAtLocation(i,s){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeaturesAtLocation(i,s):[]}highlight(i){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(i):(0,l.hA)()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(i){var s;return(0,g.aI)(null===(s=this.layer.tileInfo)||void 0===s?void 0:s.spatialReference,i)}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((i=>this._updatingHandles.addPromise(this._enqueueTileFetch(i))))}}acquireTile(i){const s=this._bitmapView.createTile(i),h=s.bitmap;return[h.x,h.y]=this._tileInfoView.getTileCoords(S,s.key),h.resolution=this._tileInfoView.getTileResolution(s.key),[h.width,h.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(s)),this._bitmapView.addChild(s),this.requestUpdate(),s}releaseTile(i){this._fetchQueue.abort(i.key.id),this._bitmapView.removeChild(i),i.once("detach",(()=>i.destroy())),this.requestUpdate()}async fetchTile(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=this.tilemapCache,{signal:a,resamplingLevel:l=0}=s;if(!h)try{return await this._fetchImage(i,a)}catch(d){if(!(0,u.zf)(d)&&!this.resampling)return(0,b.G)(this._tileInfoView.tileInfo.size);if(l<3){const h=this._tileInfoView.getTileParentId(i.id);if(h){const a=new m.A(h),p=await this.fetchTile(a,{...s,resamplingLevel:l+1});return(0,b.t)(this._tileInfoView,p,a,i)}}throw d}const p=new m.A(0,0,0,0);let c;try{if(await h.fetchAvailabilityUpsample(i.level,i.row,i.col,p,{signal:a}),p.level!==i.level&&!this.resampling)return(0,b.G)(this._tileInfoView.tileInfo.size);c=await this._fetchImage(p,a)}catch(d){if((0,u.zf)(d))throw d;c=await this._fetchImage(i,a)}return this.resampling?(0,b.t)(this._tileInfoView,c,p,i):c}async _enqueueTileFetch(i){if(!this._fetchQueue.has(i.key.id)){try{const s=await this._fetchQueue.push(i.key);i.bitmap.source=s,i.bitmap.width=this._tileInfoView.tileInfo.size[0],i.bitmap.height=this._tileInfoView.tileInfo.size[1],i.once("attach",(()=>this.requestUpdate()))}catch(s){(0,u.zf)(s)||p.A.getLogger(this).error(s)}this.requestUpdate()}}async _fetchImage(i,s){return this.layer.fetchImageBitmapTile(i.level,i.row,i.col,{signal:s})}};(0,a._)([(0,c.MZ)()],q.prototype,"resampling",null),(0,a._)([(0,c.MZ)()],q.prototype,"tilemapCache",null),q=(0,a._)([(0,d.$)("esri.views.2d.layers.TileLayerView2D")],q);const M=q},68369:(i,s,h)=>{function n(i,s,h,a){if(h.level===a.level)return s;const l=i.tileInfo.size,p=i.getTileResolution(h.level),u=i.getTileResolution(a.level);let c=i.getLODInfoAt(a.level);const d=c.getXForColumn(a.col),g=c.getYForRow(a.row);c=i.getLODInfoAt(h.level);const f=c.getXForColumn(h.col),m=c.getYForRow(h.row),_=function e(i){return i instanceof HTMLImageElement?i.naturalWidth:i.width}(s)/l[0],w=function t(i){return i instanceof HTMLImageElement?i.naturalHeight:i.height}(s)/l[1],y=Math.round(_*((d-f)/p)),v=Math.round(w*(-(g-m)/p)),b=Math.round(_*l[0]*(u/p)),I=Math.round(w*l[1]*(u/p)),V=o(l);return V.getContext("2d").drawImage(s,y,v,b,I,0,0,l[0],l[1]),V}function o(i){const s=document.createElement("canvas");return[s.width,s.height]=i,s}h.d(s,{G:()=>o,t:()=>n})}}]);
//# sourceMappingURL=805.caefef8b.chunk.js.map