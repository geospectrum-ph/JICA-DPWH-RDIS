"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[2416],{66912:(l,y,v)=>{function e(){return[1,0,0,0,1,0,0,0,1]}function t(l,y,v,_,w,M,R,S,b){return[l,y,v,_,w,M,R,S,b]}v.d(y,{fA:()=>t,vt:()=>e,zK:()=>_});const _=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:_,clone:function r(l){return[l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8]]},create:e,createView:function n(l,y){return new Float64Array(l,y,9)},fromValues:t},Symbol.toStringTag,{value:"Module"}))},74467:(l,y,v)=>{v.d(y,{O:()=>j,W:()=>p});var _=v(68052),w=v(66912),M=v(37131),R=v(54880);const S=(0,v(83800).vt)(),b=(0,w.vt)(),A=(0,w.vt)(),T=(0,w.vt)();function p(l,y,v){return(0,R.s)(S,y[0],y[1],1),(0,R.t)(S,S,(0,_.mg)(b,v)),0===S[2]?(0,M.hZ)(l,S[0],S[1]):(0,M.hZ)(l,S[0]/S[2],S[1]/S[2])}function j(l,y,v){return x(A,y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7]),x(T,v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7]),(0,_.lw)(l,(0,_.KC)(A,A),T),0!==l[8]&&(l[0]/=l[8],l[1]/=l[8],l[2]/=l[8],l[3]/=l[8],l[4]/=l[8],l[5]/=l[8],l[6]/=l[8],l[7]/=l[8],l[8]/=l[8]),l}function x(l,y,v,w,M,A,T,C,D){(0,_.hZ)(l,y,w,A,v,M,T,1,1,1),(0,R.s)(S,C,D,1),(0,_.KC)(b,l);const[Z,F,O]=(0,R.t)(S,S,(0,_.mg)(b,b));return(0,_.hZ)(b,Z,0,0,0,F,0,0,0,O),(0,_.lw)(l,b,l)}},637:(l,y,v)=>{v.d(y,{NH:()=>a,ip:()=>r,sU:()=>c,vG:()=>g});v(50886);var _=v(4180),w=v(4270);function a(l){const y=o(l);return null!=y?y.toDataURL():""}async function r(l){const y=o(l);if(null==y)throw new _.A("imageToArrayBuffer","Unsupported image type");const v=await async function i(l){if(!(l instanceof HTMLImageElement))return"image/png";const y=l.src;if((0,w.DB)(y)){const l=(0,w.r$)(y);return"image/jpeg"===(null===l||void 0===l?void 0:l.mediaType)?l.mediaType:"image/png"}return/\.png$/i.test(y)?"image/png":/\.(jpg|jpeg)$/i.test(y)?"image/jpeg":"image/png"}(l),M=await new Promise((l=>y.toBlob(l,v)));if(!M)throw new _.A("imageToArrayBuffer","Failed to encode image");return{data:await M.arrayBuffer(),type:v}}function o(l){if(l instanceof HTMLCanvasElement)return l;if(l instanceof HTMLVideoElement)return null;const y=document.createElement("canvas");y.width=l.width,y.height=l.height;const v=y.getContext("2d");return l instanceof HTMLImageElement?v.drawImage(l,0,0,l.width,l.height):l instanceof ImageData&&v.putImageData(l,0,0),y}function c(l){const y=[],v=new Uint8Array(l);for(let _=0;_<v.length;_++)y.push(String.fromCharCode(v[_]));return"data:application/octet-stream;base64,"+btoa(y.join(""))}function g(l){if(l.byteLength<8)return!1;const y=new Uint8Array(l);return 137===y[0]&&80===y[1]&&78===y[2]&&71===y[3]&&13===y[4]&&10===y[5]&&26===y[6]&&10===y[7]}},16906:(l,y,v)=>{v.d(y,{X_:()=>i,i1:()=>o,zx:()=>d});var _=v(48237),w=v(49049);const M=96;function i(l,y){const v=y||l.extent,_=l.width,R=(0,w.GA)(null===v||void 0===v?void 0:v.spatialReference);return v&&_?v.width/_*R*w.dy*M:0}function o(l,y){return l/((0,w.GA)(y)*w.dy*M)}function d(l,y,v){return function a(l,y){return 0===y||(0,_.Sp)(l,y)||l<y}(l,y)&&function p(l,y){return 0===y||(0,_.Sp)(l,y)||l>y}(l,v)}},82466:(l,y,v)=>{v.d(y,{_:()=>C});var _=v(80671),w=v(18763),M=v(57453),R=(v(50886),v(89412),v(76761),v(68682)),S=v(48343),b=v(54208),A=v(88965),T=v(12198);let C=class extends w.A{constructor(l){super(l)}get bounds(){const l=this.coords;return null==(null===l||void 0===l?void 0:l.extent)?null:(0,A.VY)(l.extent)}get coords(){var l;const y=null===(l=this.element.georeference)||void 0===l?void 0:l.coords;return(0,b.projectOrLoad)(y,this.spatialReference).geometry}get normalizedCoords(){return S.A.fromJSON((0,T.jZ)(this.coords))}get normalizedBounds(){const l=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=l?(0,A.VY)(l):null}};(0,_._)([(0,M.MZ)()],C.prototype,"spatialReference",void 0),(0,_._)([(0,M.MZ)()],C.prototype,"element",void 0),(0,_._)([(0,M.MZ)()],C.prototype,"bounds",null),(0,_._)([(0,M.MZ)()],C.prototype,"coords",null),(0,_._)([(0,M.MZ)()],C.prototype,"normalizedCoords",null),(0,_._)([(0,M.MZ)()],C.prototype,"normalizedBounds",null),C=(0,_._)([(0,R.$)("esri.layers.support.MediaElementView")],C)},73476:(l,y,v)=>{v.d(y,{ZH:()=>f});var _=v(58285),w=v(73905),M=(v(637),v(64032)),R=v(98824);function u(l,y){const{width:v,height:_,getFrame:M}=l,R=l.frameDurations.slice(),S=R.pop();return R.push((0,w.l5)(S+y)),{frameCount:l.frameCount,duration:l.duration+y,frameDurations:R,getFrame:M,width:v,height:_}}class h{constructor(l,y,v,_){this._animation=l,this._repeatType=v,this._onFrameData=_,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let w=0;for(;y>w;)w+=this.timeToFrame,this.nextFrame();const M=this._animation.getFrame(this._currentFrame);this._onFrameData(M)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case M.fu.None:this._currentFrame-=this._direction;break;case M.fu.Loop:this._currentFrame=0;break;case M.fu.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case M.fu.None:this._currentFrame-=this._direction;break;case M.fu.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case M.fu.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const l=this._animation.getFrame(this._currentFrame);this._onFrameData(l)}}function c(l,y,v,_){let S,{repeatType:b}=y;if(null==b&&(b=M.fu.Loop),!0===y.reverseAnimation&&(l=function o(l){const{width:y,height:v}=l,_=l.frameDurations.reverse();return{frameCount:l.frameCount,duration:l.duration,frameDurations:_,getFrame:y=>{const v=l.frameDurations.length-1-y;return l.getFrame(v)},width:y,height:v}}(l)),null!=y.duration&&(l=function s(l,y){const{width:v,height:_,getFrame:M}=l,R=y/l.duration,S=l.frameDurations.map((l=>(0,w.l5)(l*R)));return{frameCount:l.frameCount,duration:l.duration,frameDurations:S,getFrame:M,width:v,height:_}}(l,(0,w.l5)(1e3*y.duration))),null!=y.repeatDelay){const v=1e3*y.repeatDelay;b===M.fu.Loop?l=u(l,(0,w.l5)(v)):b===M.fu.Oscillate&&(l=function m(l,y){const{width:v,height:_,getFrame:M}=l,R=l.frameDurations.slice(),S=R.shift();return R.unshift((0,w.l5)(S+y)),{frameCount:l.frameCount,duration:l.duration+y,frameDurations:R,getFrame:M,width:v,height:_}}(u(l,(0,w.l5)(v/2)),(0,w.l5)(v/2)))}if(null!=y.startTimeOffset)S=(0,w.l5)(1e3*y.startTimeOffset);else if(null!=y.randomizeStartTime){const _=82749913,M=null!=y.randomizeStartSeed?y.randomizeStartSeed:_,b=(0,R.J)(v,M);S=(0,w.l5)(b*function n(l){return(0,w.l5)(l.frameDurations.reduce(((l,y)=>l+y),0))}(l))}else S=(0,w.l5)(0);return new h(l,S,b,_)}function f(l,y,v,w){const M=null==y.playAnimation||y.playAnimation,R=c(l,y,v,w);let S,b=R.timeToFrame;return function u(){S=M?setTimeout((()=>{R.nextFrame(),b=R.timeToFrame,u()}),b):void 0}(),(0,_.hA)((()=>M&&clearTimeout(S)))}},86083:(l,y,v)=>{v.d(y,{e:()=>m});var _,w=v(80671),M=v(39652),R=v(86479),S=v(4180),b=v(63390),A=v(57453),T=(v(50886),v(89412),v(76761),v(68682)),C=v(16906),D=v(5528),Z=v(45104),F=v(6673);let O=_=class extends F.A{constructor(l){super(l),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new _({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,w._)([(0,A.MZ)({type:[Number,String],json:{write:!0}})],O.prototype,"left",void 0),(0,w._)([(0,A.MZ)({type:[Number,String],json:{write:!0}})],O.prototype,"right",void 0),(0,w._)([(0,A.MZ)({type:[Number,String],json:{write:!0}})],O.prototype,"top",void 0),(0,w._)([(0,A.MZ)({type:[Number,String],json:{write:!0}})],O.prototype,"bottom",void 0),O=_=(0,w._)([(0,T.$)("esri.views.layers.support.ClipRect")],O);const q=O;var P=v(90874);let H=class extends F.A{constructor(l){super(l),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,w._)([(0,A.MZ)({type:[[[Number]]],json:{write:!0}})],H.prototype,"path",void 0),H=(0,w._)([(0,T.$)("esri.views.layers.support.Path")],H);const L=H,U=M.A.ofType({key:"type",base:null,typeMap:{rect:q,path:L,geometry:P.A}}),m=l=>{let y=class extends l{constructor(){super(...arguments),this.attached=!1,this.clips=new U,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1,this.highlightOptions=null}initialize(){var l,y,v,_;const w=null===(l=null===(y=this.view)||void 0===y?void 0:y.spatialReferenceLocked)||void 0===l||l;(null===(v=this.view)||void 0===v?void 0:v.spatialReference)&&w&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new S.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new D.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,b.wB)((()=>this.suspended),(l=>{this.container&&(this.container.visible=!l)}),b.pc),(0,b.wB)((()=>this.updateSuspended),(l=>{this.view&&!l&&this.updateRequested&&this.view.requestUpdate()}),b.pc),(0,b.wB)((()=>{var l,y;return null!==(l=null===(y=this.layer)||void 0===y?void 0:y.opacity)&&void 0!==l?l:1}),(l=>{this.container&&(this.container.opacity=l)}),b.pc),(0,b.wB)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(l=>{this.container&&(this.container.blendMode=l)}),b.pc),(0,b.wB)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(l=>{this.container&&(this.container.effect=l)}),b.pc),(0,b.wB)((()=>this.highlightOptions),(l=>this.container.highlightOptions=l),b.pc),(0,b.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),b.pc),(0,b.wB)((()=>{var l;return{scale:null===(l=this.view)||void 0===l?void 0:l.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}}),(l=>{let{scale:y}=l;const v=null!=y&&this.isVisibleAtScale(y);v!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",v)}),b.pc)],"constructor"),null!==(_=this.view)&&void 0!==_&&_.whenLayerView?this.view.whenLayerView(this.layer).then((l=>{l===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var l;const y=null===(l=this.view)||void 0===l?void 0:l.spatialReference;return null==y||this.supportsSpatialReference(y)}get updateSuspended(){return this.suspended}get updating(){var l;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(l=this._updatingHandles)||void 0===l||!l.updating))}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(l){const y=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!y)return!0;const{minScale:v,maxScale:_}=y;return(0,C.zx)(l,v,_)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(l){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",l),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(l))):this.updateRequested=!1}hitTest(l,y){return Promise.resolve(null)}supportsSpatialReference(l){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const l=super.getSuspendInfo(),y=!this.spatialReferenceSupported,v=this.visibleAtCurrentScale;return y&&(l.spatialReferenceNotSupported=y),v&&(l.outsideScaleRange=v),l}addAttachHandles(l){this.addHandles(l,"attach")}};return(0,w._)([(0,A.MZ)()],y.prototype,"attached",void 0),(0,w._)([(0,A.MZ)({type:U,set(l){const y=(0,R.V)(l,this._get("clips"),U);this._set("clips",y)}})],y.prototype,"clips",void 0),(0,w._)([(0,A.MZ)()],y.prototype,"container",void 0),(0,w._)([(0,A.MZ)()],y.prototype,"moving",void 0),(0,w._)([(0,A.MZ)({readOnly:!0})],y.prototype,"spatialReferenceSupported",null),(0,w._)([(0,A.MZ)({readOnly:!0})],y.prototype,"updateParameters",void 0),(0,w._)([(0,A.MZ)()],y.prototype,"updateRequested",void 0),(0,w._)([(0,A.MZ)()],y.prototype,"updateSuspended",null),(0,w._)([(0,A.MZ)()],y.prototype,"updating",null),(0,w._)([(0,A.MZ)()],y.prototype,"view",void 0),(0,w._)([(0,A.MZ)({readOnly:!0})],y.prototype,"visibleAtCurrentScale",void 0),(0,w._)([(0,A.MZ)({type:Z.A})],y.prototype,"highlightOptions",void 0),y=(0,w._)([(0,T.$)("esri.views.2d.layers.LayerView2D")],y),y}},32416:(l,y,v)=>{v.r(y),v.d(y,{default:()=>ve});var _=v(80671),w=(v(30174),v(13812),v(1804),v(26374),v(2725),v(66178),v(52902),v(55088),v(27150),v(16534),v(53440),v(89412)),M=(v(21343),v(39652)),R=(v(50886),v(69719)),S=v(81618),b=v(63390),A=v(57453),T=(v(76761),v(68682)),C=v(88965),D=v(94224),Z=v(5522),F=v(82466),O=v(4180),q=(v(59650),v(1698),v(50352),v(61272),v(40137),v(83157),v(84661)),P=(v(66445),v(22156),v(57264),v(48343),v(60141),v(6744),v(78395)),H=(v(5144),v(20665),v(77045),v(18356),v(5139),v(58860),v(870),v(9760),v(57516),v(70335),v(17985),v(76506),v(53185),v(99054),v(97887),v(54574),v(36654),v(85272),v(75184),v(11931),v(67382),v(11257),v(64032)),L=(v(48237),v(80271),v(40102)),U=(v(73855),v(99442),v(85060),v(31714),v(21664),v(93170)),I=(v(23133),v(73067),v(21847)),z=(v(83817),v(9576),v(71014),v(60985)),B=(v(50707),v(55451),v(87107),v(83663)),G=(v(77415),v(40449),v(67685),v(7856),v(78844),v(46038),v(72339),v(4250),v(89766),v(22677),v(53705),v(4270),v(40954),v(71245),v(73025),v(80148),v(53944),v(43474),v(96767),v(55082),v(46081),v(4253),v(41096),v(42687),v(21374),v(53395)),k=(v(55476),v(98664),v(39572),v(50075),v(37588),v(87149),v(43401),v(63801),v(54869)),N=v(11808),$=v(1045),W=v(35598),Q=v(74467),Y=v(66912),K=v(37131),J=v(52273),X=v(73476),ee=v(25078),te=v(83881),ie=v(77127);const re=(0,Y.vt)(),se={none:H.fu.None,loop:H.fu.Loop,oscillate:H.fu.Oscillate};class j extends U.q{constructor(l){super(),this.elementView=l,this.isWrapAround=!1,this.perspectiveTransform=(0,J.vt)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,b.wB)((()=>this.elementView.element.opacity),(l=>this.opacity=l),b.Vh),(0,b.wB)((()=>[this.elementView.coords]),(()=>{this.requestRender()}),b.Vh),(0,b.wB)((()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions]),(()=>{var l;null!==(l=this._playHandle)&&void 0!==l&&l.remove(),this.texture=(0,W.WD)(this.texture),this.requestRender()}),b.Vh),(0,b.z7)((()=>this.elementView.element.loaded),(()=>{const l=this.elementView.element;this.ready(),"video"===l.type&&null!=l.content&&this._handles.push((0,$.on)(l.content,"play",(()=>this.requestRender())))}),b.Vh)),l.element.load().catch((y=>{w.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new O.A("element-load-error","Element cannot be displayed",{element:l,error:y}))}))}getMesh(l){throw new Error("Method not implemented.")}destroy(){var l;null!==(l=this._playHandle)&&void 0!==l&&l.remove(),this._handles.forEach((l=>l.remove())),this.texture=(0,W.WD)(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(l){const{context:y}=l,v=this.elementView.element.content;if(null!=v){const l=v instanceof HTMLImageElement,_=v instanceof HTMLVideoElement,w=l?v.naturalWidth:_?v.videoWidth:v.width,M=l?v.naturalHeight:_?v.videoHeight:v.height;if(this._updatePerspectiveTransform(w,M),this.texture)_&&!v.paused&&(this.texture.setData(v),this.requestRender(),this.texture.generateMipmap());else{const l=new te.R;if(l.wrapMode=z.pF.CLAMP_TO_EDGE,l.preMultiplyAlpha=!0,l.width=w,l.height=M,"getFrame"in v){const s=v=>{this.texture?this.texture.setData(v):this.texture=new B.g(y,l,v),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,X.ZH)(v,function V(l){return l?{...l,playAnimation:l.playing,repeatType:l.repeatType?se[l.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,s))}else this.texture=new B.g(y,l,v);this.texture.generateMipmap(),_&&!v.paused&&this.requestRender()}}super.beforeRender(l)}_createTransforms(){return null}updateDrawCoords(l,y){const v=this.elementView.coords;if(null==v)return;const[_,w,M,R]=v.rings[0],S=this._vertices,{x:b,y:A}=l,T=0!==y;T?S.set([w[0]-b,w[1]-A,_[0]-b,_[1]-A,M[0]-b,M[1]-A,R[0]-b,R[1]-A,R[0]-b,R[1]-A,w[0]+y-b,w[1]-A,w[0]+y-b,w[1]-A,_[0]+y-b,_[1]-A,M[0]+y-b,M[1]-A,R[0]+y-b,R[1]-A]):S.set([w[0]-b,w[1]-A,_[0]-b,_[1]-A,M[0]-b,M[1]-A,R[0]-b,R[1]-A]),this.isWrapAround=T}getVAO(l,y,v){if(null==this.elementView.coords)return null;const _=this._vertices;if(this._vao)this._geometryVbo.setData(_);else{this._geometryVbo=ee.g.createVertex(l,z._U.DYNAMIC_DRAW,_);const w=ee.g.createVertex(l,z._U.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new ie.Z(l,v,y,{geometry:this._geometryVbo,tex:w})}return this._vao}_updatePerspectiveTransform(l,y){const v=this._vertices;(0,Q.O)(re,[0,0,l,0,0,y,l,y],[v[0],v[1],v[4],v[5],v[2],v[3],v[6],v[7]]),(0,K.hZ)(this.perspectiveTransform,re[6]/re[8]*l,re[7]/re[8]*y)}}var ne=v(62555),ae=v(68052),oe=v(46427),le=v(30172),he=v(33344),ue=v(82262),de=v(231);class u extends de.A{constructor(){super(...arguments),this._localOrigin=(0,ne.tc)(0,0),this._viewStateId=-1,this._dvsMat3=(0,oe.vt)()}get dvsMat3(){return this._dvsMat3}beforeRender(l){this._updateMatrices(l),this._updateOverlays(l,this.children);for(const y of this.children)y.beforeRender(l)}prepareRenderPasses(l){const y=l.registerRenderPass({name:"overlay",brushes:[ue.d.overlay],target:()=>this.children,drawPhase:I.S5.MAP});return[...super.prepareRenderPasses(l),y]}_updateMatrices(l){const{state:y}=l,{id:v,size:_,pixelRatio:w,resolution:M,rotation:R,viewpoint:S,displayMat3:b}=y;if(this._viewStateId===v)return;const A=Math.PI/180*R,T=w*_[0],C=w*_[1],{x:D,y:Z}=S.targetGeometry,F=(0,le.mT)(D,y.spatialReference);this._localOrigin.x=F,this._localOrigin.y=Z;const O=M*T,q=M*C,P=(0,ae.D_)(this._dvsMat3);(0,ae.lw)(P,P,b),(0,ae.Tl)(P,P,(0,L.fA)(T/2,C/2)),(0,ae.hs)(P,P,(0,G.fA)(T/O,-C/q,1)),(0,ae.e$)(P,P,-A),this._viewStateId=v}_updateOverlays(l,y){const{state:v}=l,{rotation:_,spatialReference:w,worldScreenWidth:M,size:R,viewpoint:S}=v,b=this._localOrigin;let A=0;const T=(0,P.Vp)(w);if(T&&w.isWrappable){const l=R[0],C=R[1],D=180/Math.PI*_,Z=Math.abs(Math.cos(D)),F=Math.abs(Math.sin(D)),O=Math.round(l*Z+C*F),[q,P]=T.valid,H=(0,he.FT)(w),{x:L,y:U}=S.targetGeometry,I=[L,U],z=[0,0];v.toScreen(z,I);const B=[0,0];let G;G=O>M?.5*M:.5*O;const k=Math.floor((L+.5*H)/H),N=q+k*H,$=P+k*H,W=[z[0]+G,0];v.toMap(B,W),B[0]>$&&(A=H),W[0]=z[0]-G,v.toMap(B,W),B[0]<N&&(A=-H);for(const v of y){const l=v.elementView.bounds;if(null==l)continue;const[y,,_]=l;y<q&&_>q?v.updateDrawCoords(b,H):_>P&&y<P?v.updateDrawCoords(b,-H):v.updateDrawCoords(b,A)}}else for(const C of y)C.updateDrawCoords(b,A)}}var ce=v(86083),pe=v(27012);let me=class extends((0,ce.e)(pe.A)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new M.A}attach(){this.addAttachHandles([(0,b.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((l=>this._updateTile(l))),this.requestUpdate()})),(0,b.on)((()=>this.layer.effectiveSource),"change",(l=>{let{element:y}=l;return this._elementUpdateHandler(y)}))]),this._overlayContainer=new u,this.container.addChild(this._overlayContainer),this._fetchQueue=new k.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(l,y)=>this._queryElements(l,y)}),this._tileStrategy=new N.A({cachePolicy:"purge",resampling:!0,acquireTile:l=>this._acquireTile(l),releaseTile:l=>this._releaseTile(l),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){var l;this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),null===(l=this._debugGraphicsView)||void 0===l||l.destroy()}supportsSpatialReference(l){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(l){var y;this._tileStrategy.update(l),null===(y=this._debugGraphicsView)||void 0===y||y.update(l)}async hitTest(l,y){const v=[],_=l.normalize(),w=[_.x,_.y];for(const{projectedElement:{normalizedCoords:M,element:R}}of this._elementReferences.values())null!=M&&(0,D.t1)(M.rings,w)&&v.push({type:"media",element:R,layer:this.layer,mapPoint:l,sourcePoint:R.toSource(l)});return v.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((l=>this._updateTile(l)))}_acquireTile(l){const y=new E(l.clone());return this._updateTile(y),y}_updateTile(l){this._updatingHandles.addPromise(this._fetchQueue.push(l.key).then((y=>{const[v,_]=l.setElements(y);this._referenceElements(l,v),this._dereferenceElements(l,_),this.requestUpdate()}),(l=>{(0,S.zf)(l)||w.A.getLogger(this).error(l)})))}_releaseTile(l){this._fetchQueue.abort(l.key.id),l.elements&&this._dereferenceElements(l,l.elements),this.requestUpdate()}async _queryElements(l,y){const v=this.layer.effectiveSource;if(null==v)return[];this.view.featuresTilingScheme.getTileBounds(ye,l,!0);const _=new q.A({xmin:ye[0],ymin:ye[1],xmax:ye[2],ymax:ye[3],spatialReference:this.view.spatialReference});return v.queryElements(_,y)}_referenceElements(l,y){if(null!=this.layer.source)for(const v of y)this._referenceElement(l,v)}_referenceElement(l,y){(0,R.tE)(this._elementReferences,y.uid,(()=>{const l=new F._({element:y,spatialReference:this.view.spatialReference}),v=new j(l);this._overlayContainer.addChild(v),this.elements.add(y);return{tiles:new Set,projectedElement:l,overlay:v,debugGraphic:null}})).tiles.add(l)}_dereferenceElements(l,y){for(const v of y)this._dereferenceElement(l,v)}_dereferenceElement(l,y){var v;const _=this._elementReferences.get(y.uid);_.tiles.delete(l),_.tiles.size||(this._overlayContainer.removeChild(_.overlay),_.overlay.destroy(),_.projectedElement.destroy(),this._elementReferences.delete(y.uid),this.elements.remove(y),null===(v=this._debugGraphicsView)||void 0===v||v.graphics.remove(_.debugGraphic))}_elementUpdateHandler(l){let y=this._elementReferences.get(l.uid);if(y){var v,_;const w=y.projectedElement.normalizedCoords;if(null==w)return this._overlayContainer.removeChild(y.overlay),y.overlay.destroy(),y.projectedElement.destroy(),this._elementReferences.delete(l.uid),this.elements.remove(l),void(null===(v=this._debugGraphicsView)||void 0===v||v.graphics.remove(y.debugGraphic));const M=[],R=[];for(const l of this._tileStrategy.tiles){const v=MediaLayerView2D_v(this.view.featuresTilingScheme,l,w);y.tiles.has(l)?v||R.push(l):v&&M.push(l)}for(const y of M)this._referenceElement(y,l);for(const y of R)this._dereferenceElement(y,l);return y=this._elementReferences.get(l.uid),void((null===(_=y)||void 0===_?void 0:_.debugGraphic)&&(y.debugGraphic.geometry=y.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:y.debugGraphic,property:"geometry"})))}const w=new F._({element:l,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=w)for(const M of this._tileStrategy.tiles)MediaLayerView2D_v(this.view.featuresTilingScheme,M,w)&&this._referenceElement(M,l)}};(0,_._)([(0,A.MZ)()],me.prototype,"layer",void 0),(0,_._)([(0,A.MZ)({readOnly:!0})],me.prototype,"elements",void 0),me=(0,_._)([(0,T.$)("esri.views.2d.layers.MediaLayerView2D")],me);const ye=(0,C.vt)(),fe={xmin:0,ymin:0,xmax:0,ymax:0};function MediaLayerView2D_v(l,y,v){return l.getTileBounds(ye,y.key,!0),fe.xmin=ye[0],fe.ymin=ye[1],fe.xmax=ye[2],fe.ymax=ye[3],(0,Z.fA)(fe,v)}class E{constructor(l){this.key=l,this.elements=null,this.isReady=!1,this.visible=!0}setElements(l){const y=[],v=new Set(this.elements);this.elements=l;for(const _ of l)v.has(_)?v.delete(_):y.push(_);return this.isReady=!0,[y,Array.from(v)]}destroy(){}}const ve=me},27012:(l,y,v)=>{v.d(y,{A:()=>F});var _=v(80671),w=v(18763),M=v(73067),R=v(16904),S=v(89412),b=v(35598),A=v(5203),T=v(57453),C=(v(50886),v(76761),v(68682)),D=v(31059);let Z=class extends((0,R.sA)((0,A.g)(M.A.EventedMixin(w.A)))){constructor(l){super(l),this._updatingHandles=new D.U,this.layer=null,this.parent=null}initialize(){this.when().catch((l=>{if("layerview:create-error"!==l.name){var y;const v=this.layer&&this.layer.id||"no id",_=(null===(y=this.layer)||void 0===y?void 0:y.title)||"no title";S.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(_,"', id: '").concat(v,"')"),l)}}))}destroy(){this._updatingHandles=(0,b.pR)(this._updatingHandles)}get fullOpacity(){var l,y,v,_;return(null!==(l=null===(y=this.layer)||void 0===y?void 0:y.opacity)&&void 0!==l?l:1)*(null!==(v=null===(_=this.parent)||void 0===_?void 0:_.fullOpacity)&&void 0!==v?v:1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var l;return!this.suspended&&!0===(null===(l=this.layer)||void 0===l?void 0:l.legendEnabled)}get updating(){var l;return!((null===(l=this._updatingHandles)||void 0===l||!l.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var l;return!0===(null===(l=this.layer)||void 0===l?void 0:l.visible)}set visible(l){this._overrideIfSome("visible",l)}canResume(){var l,y,v;return this.visible&&(null===(l=this.layer)||void 0===l?void 0:l.loaded)&&!(null!==(y=this.parent)&&void 0!==y&&y.suspended)&&(null===(v=this.view)||void 0===v?void 0:v.ready)||!1}getSuspendInfo(){var l,y;const v=null!==(l=this.parent)&&void 0!==l&&l.suspended?this.parent.suspendInfo:{};return null!==(y=this.view)&&void 0!==y&&y.ready||(v.viewNotReady=!0),this.layer&&this.layer.loaded||(v.layerNotLoaded=!0),this.visible||(v.layerInvisible=!0),v}isUpdating(){return!1}};(0,_._)([(0,T.MZ)()],Z.prototype,"fullOpacity",null),(0,_._)([(0,T.MZ)()],Z.prototype,"layer",void 0),(0,_._)([(0,T.MZ)()],Z.prototype,"parent",void 0),(0,_._)([(0,T.MZ)({readOnly:!0})],Z.prototype,"suspended",null),(0,_._)([(0,T.MZ)({readOnly:!0})],Z.prototype,"suspendInfo",null),(0,_._)([(0,T.MZ)({readOnly:!0})],Z.prototype,"legendEnabled",null),(0,_._)([(0,T.MZ)({type:Boolean,readOnly:!0})],Z.prototype,"updating",null),(0,_._)([(0,T.MZ)({readOnly:!0})],Z.prototype,"updatingProgress",null),(0,_._)([(0,T.MZ)()],Z.prototype,"visible",null),(0,_._)([(0,T.MZ)()],Z.prototype,"view",void 0),Z=(0,_._)([(0,C.$)("esri.views.layers.LayerView")],Z);const F=Z},6673:(l,y,v)=>{v.d(y,{A:()=>b});var _=v(80671),w=v(83375),M=v(57453),R=(v(50886),v(89412),v(76761),v(68682));let S=class extends w.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,_._)([(0,M.MZ)({readOnly:!0})],S.prototype,"version",null),S=(0,_._)([(0,R.$)("esri.views.layers.support.ClipArea")],S);const b=S},90874:(l,y,v)=>{v.d(y,{A:()=>F});var _,w=v(80671),M=(v(30174),v(57453)),R=(v(50886),v(89412),v(76761),v(68682)),S=v(66445),b=v(31670),A=v(6673),T=v(84661),C=v(48343);const D={base:S.A,key:"type",typeMap:{extent:T.A,polygon:C.A}};let Z=_=class extends A.A{constructor(l){super(l),this.type="geometry",this.geometry=null}clone(){var l,y;return new _({geometry:null!==(l=null===(y=this.geometry)||void 0===y?void 0:y.clone())&&void 0!==l?l:null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,w._)([(0,M.MZ)({types:D,json:{read:b.rS,write:!0}})],Z.prototype,"geometry",void 0),Z=_=(0,w._)([(0,R.$)("esri.views.layers.support.Geometry")],Z);const F=Z}}]);
//# sourceMappingURL=2416.ea4df149.chunk.js.map