"use strict";(self.webpackChunkSEEDs_v2_0_Client=self.webpackChunkSEEDs_v2_0_Client||[]).push([[9221],{48988:(o,h,m)=>{m.d(h,{A:()=>at});var y=m(80671),v=m(13812),w=m(18763),S=m(63390),A=m(57453),b=(m(50886),m(89412)),D=(m(76761),m(68682)),M=m(62555);function t(o){return"constant"===o.kind?o.value[0]:o.values[o.values.length-1]}function i(o){const h=o.toRgba();return[h[0]/255,h[1]/255,h[2]/255,h[3]]}function s(o){if(!o.hasVisualVariables("size"))return{kind:"constant",value:[(0,M.Lz)(o.trailWidth)]};const h=o.getVisualVariablesForType("size")[0],m=[],y=[];let v;if(h.stops){for(const o of h.stops)m.push(o.value),y.push((0,M.Lz)(o.size));v=h.stops.length}else m.push(h.minDataValue,h.maxDataValue),y.push((0,M.Lz)(h.minSize),(0,M.Lz)(h.maxSize)),v=2;return{kind:"ramp",stops:m,values:y,count:v}}function l(o){if(!o.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const h=o.getVisualVariablesForType("opacity")[0],m=[],y=[];for(const v of h.stops)m.push(v.value),y.push(v.opacity);return{kind:"ramp",stops:m,values:y,count:h.stops.length}}function r(o,h,m,y){switch(h){case"int":o.setUniform1iv(m,y);break;case"float":o.setUniform1fv(m,y);break;case"vec2":o.setUniform2fv(m,y);break;case"vec3":o.setUniform3fv(m,y);break;case"vec4":o.setUniform4fv(m,y)}}function u(o,h,m,y){"constant"===y.kind?r(o,m,"u_".concat(h),y.value):(r(o,"float","u_".concat(h,"_stops"),y.stops),r(o,m,"u_".concat(h,"_values"),y.values),o.setUniform1i("u_".concat(h,"_count"),y.count))}function p(o,h){return o===h||null!=o&&null!=h&&o.equals(h)}function f(o,h){if(!function c(o,h){let m=!0;return m=m&&o.collisions===h.collisions,m=m&&o.density===h.density,m=m&&o.interpolate===h.interpolate,m=m&&o.lineCollisionWidth===h.lineCollisionWidth,m=m&&o.lineSpacing===h.lineSpacing,m=m&&o.maxTurnAngle===h.maxTurnAngle,m=m&&o.minSpeedThreshold===h.minSpeedThreshold,m=m&&o.segmentLength===h.segmentLength,m=m&&o.smoothing===h.smoothing,m=m&&o.velocityScale===h.velocityScale,m=m&&o.verticesPerLine===h.verticesPerLine,m}(o.simulationSettings,h.simulationSettings))return!1;if(!p(o.timeExtent,h.timeExtent))return!1;let m=!0;return m=m&&o.loadImagery===h.loadImagery,m=m&&o.createFlowMesh===h.createFlowMesh,m=m&&o.color.kind===h.color.kind,m=m&&o.opacity.kind===h.opacity.kind,m=m&&o.size.kind===h.size.kind,m}var R=m(81618),T=m(25078),z=m(60985),U=m(83663),F=m(83881),E=m(77127),I=m(40332);class Imagery_f{constructor(o){this._params=o,this.animated=!1}isCompatible(o){if(!(o instanceof Imagery_f))return!1;if(!p(this._params.timeExtent,o._params.timeExtent))return!1;let h=!0;return h=h&&this._params.loadImagery===o._params.loadImagery,h=h&&this._params.color.kind===o._params.color.kind,h=h&&this._params.opacity.kind===o._params.opacity.kind,h}async load(o,h){const{extent:m,size:y}=o;(0,R.Te)(h);const v=await this._params.loadImagery(m,y[0],y[1],this._params.timeExtent,h);return new x(v,{color:this._params.color,opacity:this._params.opacity})}render(o,h,m){const{context:y}=o,{program:v}=m;y.setFaceCullingEnabled(!1),y.setBlendingEnabled(!0),y.setBlendFunction(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA),y.useProgram(v),v.setUniformMatrix3fv("u_dvsMat3",h.dvsMat3),y.bindTexture(m.texture,0),v.setUniform1i("u_texture",0),v.setUniform1f("u_Min",m.min),v.setUniform1f("u_Max",m.max),u(v,"color","vec4",this._params.color),u(v,"opacity","float",this._params.opacity),y.bindVAO(m.vertexArray),y.drawArrays(z.WR.TRIANGLE_STRIP,0,4)}}const P=new Map;P.set("a_position",0),P.set("a_texcoord",1);const V={geometry:[new I._("a_position",2,z.pe.UNSIGNED_SHORT,0,8),new I._("a_texcoord",2,z.pe.UNSIGNED_SHORT,4,8)]},k={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:P};class x{constructor(o,h){this._flowData=o,this._values=h}attach(o){const{context:h}=o,{width:m,height:y}=this._flowData,v=T.g.createVertex(h,z._U.STATIC_DRAW,new Uint16Array([0,0,0,1,m,0,1,1,0,y,0,0,m,y,1,0])),w=new E.Z(h,P,V,{geometry:v}),S=[];"ramp"===this._values.color.kind&&S.push("vvColor"),"ramp"===this._values.opacity.kind&&S.push("vvOpacity");const A=o.painter.materialManager.getProgram(k,S);let b=1e6,D=-1e6;for(let T=0;T<y;T++)for(let o=0;o<m;o++)if(0!==this._flowData.mask[T*m+o]){const h=this._flowData.data[2*(T*m+o)],y=this._flowData.data[2*(T*m+o)+1],v=Math.sqrt(h*h+y*y);b=Math.min(b,v),D=Math.max(D,v)}const M=new Uint8Array(4*m*y);for(let T=0;T<y;T++)for(let o=0;o<m;o++)if(0!==this._flowData.mask[T*m+o]){const h=this._flowData.data[2*(T*m+o)],y=this._flowData.data[2*(T*m+o)+1],v=(Math.sqrt(h*h+y*y)-b)/(D-b);M[4*(T*m+o)]=255*v,M[4*(T*m+o)+1]=0,M[4*(T*m+o)+2]=0,M[4*(T*m+o)+3]=255}else M[4*(T*m+o)]=0,M[4*(T*m+o)+1]=0,M[4*(T*m+o)+2]=0,M[4*(T*m+o)+3]=0;const R=new F.R;R.internalFormat=z.Ab.RGBA,R.wrapMode=z.pF.CLAMP_TO_EDGE,R.flipped=!0,R.width=m,R.height=y;const I=new U.g(h,R,M);this.vertexArray=w,this.program=A,this.texture=I,this.min=b,this.max=D,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}class _{constructor(o){this._params=o}get animated(){return this._params.flowSpeed>0}isCompatible(o){return o instanceof _&&f(this._params,o._params)}async load(o,h){const{extent:m,size:y}=o;(0,R.Te)(h);const v=await this._params.loadImagery(m,y[0],y[1],this._params.timeExtent,h),{vertexData:w,indexData:S}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,v,h);return new Particles_c(w,S,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(o,h,m){const{context:y}=o,{program:v}=m;y.setFaceCullingEnabled(!1),y.setBlendingEnabled(!0),y.setBlendFunction(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA),y.useProgram(v),v.setUniform1f("u_time",h.time),v.setUniform1f("u_trailLength",this._params.trailLength),v.setUniform1f("u_flowSpeed",this._params.flowSpeed),v.setUniform1f("u_featheringSize",this._params.featheringSize),v.setUniform1f("u_featheringOffset",this._params.featheringOffset),v.setUniform1f("u_introFade",this._params.introFade?1:0),v.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),v.setUniform1f("u_decayRate",this._params.decayRate),v.setUniformMatrix3fv("u_dvsMat3",h.dvsMat3),v.setUniformMatrix3fv("u_displayViewMat3",h.displayViewMat3),u(v,"color","vec4",this._params.color),u(v,"opacity","float",this._params.opacity),u(v,"size","float",this._params.size),y.bindVAO(m.vertexArray),y.drawElements(z.WR.TRIANGLES,m.indexCount,z.pe.UNSIGNED_INT,0)}}const O=new Map;O.set("a_xyts0",0),O.set("a_xyts1",1),O.set("a_typeIdDurationSeed",2),O.set("a_extrudeInfo",3);const C={geometry:[new I._("a_xyts0",4,z.pe.FLOAT,0,64),new I._("a_xyts1",4,z.pe.FLOAT,16,64),new I._("a_typeIdDurationSeed",4,z.pe.FLOAT,32,64),new I._("a_extrudeInfo",4,z.pe.FLOAT,48,64)]},L={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:O};class Particles_c{constructor(o,h,m){this._vertexData=o,this._indexData=h,this._values=m}attach(o){const{context:h}=o,m=T.g.createVertex(h,z._U.STATIC_DRAW,this._vertexData),y=T.g.createIndex(h,z._U.STATIC_DRAW,this._indexData),v=new E.Z(h,O,C,{geometry:m},y),w=[];"ramp"===this._values.color.kind&&w.push("vvColor"),"ramp"===this._values.opacity.kind&&w.push("vvOpacity"),"ramp"===this._values.size.kind&&w.push("vvSize");const S=o.painter.materialManager.getProgram(L,w);this.vertexArray=v,this.program=S,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}class Stack_t{constructor(o){this._styles=o}get animated(){return this._styles.reduce(((o,h)=>o||h.animated),!1)}isCompatible(o){if(!(o instanceof Stack_t))return!1;if(this._styles.length!==o._styles.length)return!1;const h=this._styles.length;for(let m=0;m<h;m++)if(!this._styles[m].isCompatible(o._styles[m]))return!1;return!0}async load(o,h){const m=await Promise.all(this._styles.map((m=>m.load(o,h))));return new Stack_s(m)}render(o,h,m){for(let y=0;y<this._styles.length;y++)this._styles[y].render(o,h,m.resources[y])}}class Stack_s{constructor(o){this.resources=o}attach(o){for(const h of this.resources)h.attach(o)}detach(){for(const o of this.resources)o.detach()}get ready(){return this.resources.reduce(((o,h)=>o&&h.ready),!0)}}class Streamlines_{constructor(o){this._params=o}get animated(){return this._params.flowSpeed>0}isCompatible(o){return o instanceof Streamlines_&&f(this._params,o._params)}async load(o,h){const{extent:m,size:y}=o;(0,R.Te)(h);const v=await this._params.loadImagery(m,y[0],y[1],this._params.timeExtent,h),{vertexData:w,indexData:S}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,v,h);return new Streamlines_d(w,S,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(o,h,m){const{context:y}=o,{program:v}=m;y.setFaceCullingEnabled(!1),y.setBlendingEnabled(!0),y.setBlendFunction(z.dn.ONE,z.dn.ONE_MINUS_SRC_ALPHA),y.useProgram(v),v.setUniform1f("u_time",h.time),v.setUniform1f("u_trailLength",this._params.trailLength),v.setUniform1f("u_flowSpeed",this._params.flowSpeed),v.setUniform1f("u_featheringSize",this._params.featheringSize),v.setUniform1f("u_featheringOffset",this._params.featheringOffset),v.setUniform1f("u_introFade",this._params.introFade?1:0),v.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),v.setUniform1f("u_decayRate",this._params.decayRate),v.setUniformMatrix3fv("u_dvsMat3",h.dvsMat3),v.setUniformMatrix3fv("u_displayViewMat3",h.displayViewMat3),u(v,"color","vec4",this._params.color),u(v,"opacity","float",this._params.opacity),u(v,"size","float",this._params.size),y.bindVAO(m.vertexArray),y.drawElements(z.WR.TRIANGLES,m.indexCount,z.pe.UNSIGNED_INT,0)}}const N=new Map;N.set("a_positionAndSide",0),N.set("a_timeInfo",1),N.set("a_extrude",2),N.set("a_speed",3);const Z={geometry:[new I._("a_positionAndSide",3,z.pe.FLOAT,0,36),new I._("a_timeInfo",3,z.pe.FLOAT,12,36),new I._("a_extrude",2,z.pe.FLOAT,24,36),new I._("a_speed",1,z.pe.FLOAT,32,36)]},W={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:N};class Streamlines_d{constructor(o,h,m){this._vertexData=o,this._indexData=h,this._values=m}attach(o){const{context:h}=o,m=T.g.createVertex(h,z._U.STATIC_DRAW,this._vertexData),y=T.g.createIndex(h,z._U.STATIC_DRAW,this._indexData),v=new E.Z(h,N,Z,{geometry:m},y),w=[];"ramp"===this._values.color.kind&&w.push("vvColor"),"ramp"===this._values.opacity.kind&&w.push("vvOpacity"),"ramp"===this._values.size.kind&&w.push("vvSize");const S=o.painter.materialManager.getProgram(W,w);this.vertexArray=v,this.program=S,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}function g(o,h){const{flowSpeed:m,trailLength:y}=o,v=function n(o){const h=t(s(o)),m=h,y=Math.max(h/2,5),v=Math.round((0,M.Lz)(o.maxPathLength)/y)+1,{density:w}=o;return{smoothing:(0,M.Lz)(o.smoothing),interpolate:!0,velocityScale:"flow-from"===o.flowRepresentation?1:-1,verticesPerLine:v,minSpeedThreshold:.001,segmentLength:y,maxTurnAngle:1,collisions:!0,lineCollisionWidth:m,lineSpacing:10,density:w}}(o);let w=null;const S={opacity:l(o),size:s(o)};let A=function a(o){if(!o.hasVisualVariables("color"))return{kind:"constant",value:i(o.color)};const h=o.getVisualVariablesForType("color")[0],m=[],y=[];for(const v of h.stops)m.push(v.value),Array.prototype.push.apply(y,i(v.color));return{kind:"ramp",stops:m,values:y,count:h.stops.length}}(o);if("none"===o.background)S.color=A;else{"constant"===A.kind&&(A={kind:"ramp",stops:[0,1],values:[0,0,0,1,A.value[0],A.value[1],A.value[2],A.value[3]],count:2});const o={loadImagery:h.loadImagery,timeExtent:h.timeExtent,color:A,opacity:{kind:"constant",value:[1]}};w=new Imagery_f(o),S.color={kind:"constant",value:[.1,.1,.1,1]}}const b={loadImagery:h.loadImagery,createFlowMesh:h.createFlowMesh,simulationSettings:v,timeExtent:h.timeExtent,trailLength:y,flowSpeed:m,featheringSize:1,featheringOffset:.5,introFade:true,fadeToZero:true,decayRate:2.3,color:S.color,opacity:S.opacity,size:S.size},D="butt"===o.trailCap||t(s(o))<=4?new Streamlines_(b):new _(b);return null!=w?new Stack_t([w,D]):D}var q=m(72013),B=m(46427),G=m(77322);class BrushFlow_s extends G.A{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,B.vt)(),displayViewMat3:(0,B.vt)()}}dispose(){}prepareState(o){const{context:h}=o;h.setColorMask(!0,!0,!0,!0),h.setStencilFunction(z.MT.EQUAL,0,255)}draw(o,h){const{requestRender:m,allowDelayedRender:y}=o,{displayData:v}=h;if(null==v)return;if("loaded"===v.state.name&&v.attach(o),"attached"!==v.state.name)return;const w=v.state.resources;!y||w.ready||null==m?(this._visualState.time=o.time/1e3,this._visualState.dvsMat3=h.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=o.state.displayViewMat3,v.flowStyle.render(o,this._visualState,w),v.flowStyle.animated&&null!=m&&m()):m()}}var H=m(21847),j=m(231);class FlowContainer_t extends j.A{constructor(){super(...arguments),this.flowStyle=null}doRender(o){super.doRender(o)}prepareRenderPasses(o){const h=o.registerRenderPass({name:"flow",brushes:[BrushFlow_s],target:()=>this.children,drawPhase:H.S5.MAP});return[...super.prepareRenderPasses(o),h]}}m(30174);var $=m(48237),J=m(57264);class FlowDisplayData_e{constructor(o,h,m,y){this.state={name:"created"},this.flowStyle=o,this.extent=h,this.size=m,this.pixelRatio=y}async load(){const o=new AbortController;this.state={name:"loading",abortController:o};const h={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},m=await this.flowStyle.load(h,o.signal);this.state={name:"loaded",resources:m}}attach(o){if("loaded"!==this.state.name)return void b.A.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const h=this.state.resources;h.attach(o),this.state={name:"attached",resources:h}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(o){return!!this.flowStyle.isCompatible(o.flowStyle)&&(!(!this.extent.equals(o.extent)||this.size[0]!==o.size[0]||this.size[1]!==o.size[1]||this.pixelRatio!==o.pixelRatio)&&(this.flowStyle=o.flowStyle,!0))}}var K=m(68052),Q=m(93170);class FlowDisplayObject_o extends Q.q{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(o){this._displayData=o,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(o){const{displayData:h}=this;if(null==h)return;const m=h.extent.xmin,y=h.extent.ymax,v=[0,0];o.toScreen(v,[m,y]);const w=(h.extent.xmax-h.extent.xmin)/h.size[0]/o.resolution,S=(0,$.kU)(o.rotation),{displayViewScreenMat3:A}=this.transforms;(0,K.kN)(A,[-1,1,0]),(0,K.hs)(A,A,[2/(o.size[0]*o.pixelRatio),-2/(o.size[1]*o.pixelRatio),1]),(0,K.Tl)(A,A,[v[0],v[1],0]),(0,K.e$)(A,A,S),(0,K.hs)(A,A,[w*o.pixelRatio,w*o.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:(0,B.vt)()}}}var X=m(84661);let Y=class extends w.A{constructor(o){super(o),this._flowDisplayObject=new FlowDisplayObject_o,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(o){const{flowStyle:h}=this.flowContainer;if(null==h)return void this._clear();const{extent:m,rotation:y,resolution:v,pixelRatio:w}=o.state,S=function FlowStrategy_f(o,h){const m=new J.A({x:(o.xmax+o.xmin)/2,y:(o.ymax+o.ymin)/2,spatialReference:o.spatialReference}),y=o.xmax-o.xmin,v=o.ymax-o.ymin,w=Math.abs(Math.cos((0,$.kU)(h))),S=Math.abs(Math.sin((0,$.kU)(h))),A=w*y+S*v,b=S*y+w*v,D=new X.A({xmin:m.x-A/2,ymin:m.y-b/2,xmax:m.x+A/2,ymax:m.y+b/2,spatialReference:o.spatialReference});return D.centerAt(m),D}(m,y);S.expand(1.15);const A=[Math.round((S.xmax-S.xmin)/v),Math.round((S.ymax-S.ymin)/v)],D=new FlowDisplayData_e(h,S,A,w);if(null!=this._loading){if(this._loading.update(D))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(D)||(D.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(o=>{(0,R.zf)(o)||(b.A.getLogger(this).error("A resource failed to load.",o),this._loading=null)})),this._loading=D)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};(0,y._)([(0,A.MZ)()],Y.prototype,"_loading",void 0),(0,y._)([(0,A.MZ)()],Y.prototype,"flowContainer",void 0),(0,y._)([(0,A.MZ)()],Y.prototype,"updating",null),Y=(0,y._)([(0,D.$)("esri.views.2d.engine.flow.FlowStrategy")],Y);const tt=Y;let et=class extends w.A{constructor(){super(...arguments),this._loadImagery=(o,h,m,y,v)=>(0,q.pH)(this.layer,o,h,m,y,v),this._createFlowMesh=(o,h,m,y)=>this.layer.createFlowMesh({meshType:o,flowData:m,simulationSettings:h},{signal:y}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:o}=this,e=()=>{this._loadImagery=(h,m,y,v,w)=>(0,q.pH)(o,h,m,y,v,w),this._updateVisualization()};"multidimensionalDefinition"in o?this.addHandles((0,S.wB)((()=>o.multidimensionalDefinition),e)):this.addHandles([(0,S.wB)((()=>o.mosaicRule),e),(0,S.wB)((()=>o.rasterFunction),e),(0,S.wB)((()=>o.definitionExpression),e)]),this.container=new FlowContainer_t,this._strategy=new tt({flowContainer:this.container}),this._updateVisualization()}detach(){var o;this._strategy.destroy(),null!==(o=this.container)&&void 0!==o&&o.removeAllChildren(),this.container=null,this.removeHandles()}update(o){o.stationary?this._strategy.update(o):this.layerView.requestUpdate()}hitTest(o){return new v.A({attributes:{},geometry:o.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const o=this.layer.renderer;if(null==o||"flow"!==o.type)return;const h=g(o,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=h,this.layerView.requestUpdate()}};(0,y._)([(0,A.MZ)()],et.prototype,"_strategy",void 0),(0,y._)([(0,A.MZ)()],et.prototype,"attached",void 0),(0,y._)([(0,A.MZ)()],et.prototype,"container",void 0),(0,y._)([(0,A.MZ)()],et.prototype,"layer",void 0),(0,y._)([(0,A.MZ)()],et.prototype,"layerView",void 0),(0,y._)([(0,A.MZ)()],et.prototype,"type",void 0),(0,y._)([(0,A.MZ)()],et.prototype,"updating",null),(0,y._)([(0,A.MZ)()],et.prototype,"timeExtent",void 0),et=(0,y._)([(0,D.$)("esri.views.2d.engine.flow.FlowView2D")],et);const at=et},12747:(o,h,m)=>{m.d(h,{A:()=>d});var y=m(77322),v=m(60985);const w=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),S=new Float32Array([0,92/255,230/255,1]),A={beaufort_ft:w,beaufort_m:w,beaufort_km:w,beaufort_mi:w,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:S,single_arrow:S,wind_speed:new Float32Array([0,0,0,1])},b=[0,20];class d extends y.A{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState(o){let{context:h}=o;h.setBlendingEnabled(!0),h.setBlendFunctionSeparate(v.dn.ONE,v.dn.ONE_MINUS_SRC_ALPHA,v.dn.ONE,v.dn.ONE_MINUS_SRC_ALPHA),h.setColorMask(!0,!0,!0,!0),h.setStencilWriteMask(0),h.setStencilTestEnabled(!0),h.setStencilOp(v.eA.KEEP,v.eA.KEEP,v.eA.REPLACE)}draw(o,h){if(null==h.source||0===h.source.validPixelCount)return;const{context:m,timeline:y}=o;if(y.begin(this.name),m.setStencilFunction(v.MT.EQUAL,h.stencilRef,255),h.updateVectorFieldVAO(o),"scalar"===o.renderPass){const m=h.vaoData.scalar;m&&this._drawScalars(o,h,m.vao,m.elementCount)}else{const m=h.vaoData.magdir;m&&this._drawTriangles(o,h,m.vao,m.elementCount)}y.end(this.name)}_drawTriangles(o,h,m,y){const{context:w,painter:S,requestRender:D,allowDelayedRender:M}=o,{symbolizerParameters:R}=h,T=R.dataRange?["dataRange"]:[];"geographic"===R.rotationType&&T.push("rotationGeographic");const z=S.materialManager.getProgram(this._desc.magdir,T);if(M&&null!=D&&!z.compiled)return void D();w.useProgram(z);const{coordScale:U,opacity:F,transforms:E}=h;z.setUniform2fv("u_coordScale",U),z.setUniform1f("u_opacity",F),z.setUniformMatrix3fv("u_dvsMat3",E.displayViewScreenMat3);const{style:I,dataRange:P,rotation:V,symbolPercentRange:k}=R;z.setUniform4fv("u_colors",A[I]),z.setUniform2fv("u_dataRange",P||b),z.setUniform1f("u_rotation",V),z.setUniform2fv("u_symbolPercentRange",k);const O=this._getSymbolSize(o,h);z.setUniform2fv("u_symbolSize",O),w.bindVAO(m),w.drawElements(v.WR.TRIANGLES,y,v.pe.UNSIGNED_INT,0)}_drawScalars(o,h,m,y){const{context:w,painter:S,requestRender:A,allowDelayedRender:D}=o,{symbolizerParameters:M}=h,R=[];"wind_speed"===M.style?R.push("innerCircle"):M.dataRange&&R.push("dataRange"),"geographic"===M.rotationType&&R.push("rotationGeographic");const T=S.materialManager.getProgram(this._desc.scalar,R);if(D&&null!=A&&!T.compiled)return void A();w.useProgram(T);const{coordScale:z,opacity:U,transforms:F}=h;T.setUniform2fv("u_coordScale",z),T.setUniform1f("u_opacity",U),T.setUniformMatrix3fv("u_dvsMat3",F.displayViewScreenMat3);const{dataRange:E,symbolPercentRange:I}=M;T.setUniform2fv("u_dataRange",E||b),T.setUniform2fv("u_symbolPercentRange",I);const P=this._getSymbolSize(o,h);T.setUniform2fv("u_symbolSize",P),w.bindVAO(m),w.drawElements(v.WR.TRIANGLES,y,v.pe.UNSIGNED_INT,0)}_getSymbolSize(o,h){const m=h.key?2**(o.displayLevel-h.key.level):h.resolution/o.state.resolution,{symbolTileSize:y}=h.symbolizerParameters;return[y/(Math.round((h.width-h.offset[0])/y)*y)/m,y/(Math.round((h.height-h.offset[1])/y)*y)/m]}}},78282:(o,h,m)=>{m.d(h,{X:()=>f});m(50886);var y=m(68052),v=m(46427),w=m(40102),S=m(60782),A=m(93170),b=m(82380),D=m(25078),M=m(60985),R=m(77127);class f extends A.q{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=o}destroy(){var o,h;null!=this.vaoData&&(null!==(o=this.vaoData.magdir)&&void 0!==o&&o.vao.dispose(),null!==(h=this.vaoData.scalar)&&void 0!==h&&h.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(o){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(o)&&(this._symbolizerParameters=o,this.invalidateVAO())}get source(){return this._source}set source(o){this._source=o,this.invalidateVAO()}invalidateVAO(){var o,h;this._vaoInvalidated||null==this.vaoData||(null!==(o=this.vaoData.magdir)&&void 0!==o&&o.vao.dispose(),null!==(h=this.vaoData.scalar)&&void 0!==h&&h.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(o){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:h}=this.symbolizerParameters;switch(h){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const h=(0,S.gf)(this.source,this.symbolizerParameters),m=this._createVectorFieldVAO(o.context,h);this.vaoData={magdir:m}}break;case"simple_scalar":{const h=(0,S.Ud)(this.source,this.symbolizerParameters),m=this._createVectorFieldVAO(o.context,h);this.vaoData={scalar:m}}break;case"wind_speed":{const h=(0,S.gf)(this.source,this.symbolizerParameters),m=this._createVectorFieldVAO(o.context,h),y=(0,S.Ud)(this.source,this.symbolizerParameters),v=this._createVectorFieldVAO(o.context,y);this.vaoData={magdir:m,scalar:v}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:(0,v.vt)()}}setTransform(o){const h=(0,y.D_)(this.transforms.displayViewScreenMat3),[m,v]=o.toScreenNoRotation([0,0],[this.x,this.y]),S=this.resolution/this.pixelRatio/o.resolution,A=S*this.width,b=S*this.height,D=Math.PI*this.rotation/180;(0,y.Tl)(h,h,(0,w.fA)(m,v)),(0,y.Tl)(h,h,(0,w.fA)(A/2,b/2)),(0,y.e$)(h,h,-D),(0,y.Tl)(h,h,(0,w.fA)(-A/2,-b/2)),(0,y.Oe)(h,h,(0,w.fA)(A,b)),(0,y.lw)(this.transforms.displayViewScreenMat3,o.displayViewMat3,h)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(o,h){const{vertexData:m,indexData:y}=h,v=D.g.createVertex(o,M._U.STATIC_DRAW,new Float32Array(m)),w=D.g.createIndex(o,M._U.STATIC_DRAW,new Uint32Array(y)),S=(0,b.ES)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:M.pe.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:M.pe.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:M.pe.FLOAT,normalized:!1}]});return{vao:new R.Z(o,S.attributes,S.bufferLayouts,{geometry:v},w),elementCount:y.length}}}},59995:(o,h,m)=>{m.d(h,{A:()=>i});var y=m(80671),v=m(89412),w=m(81618),S=m(63390),A=(m(50886),m(76761),m(4180),m(68682));const i=o=>{let h=class extends o{initialize(){this.addHandles((0,S.on)((()=>this.layer),"refresh",(o=>{this.doRefresh(o.dataChanged).catch((o=>{(0,w.zf)(o)||v.A.getLogger(this).error(o)}))})),"RefreshableLayerView")}};return h=(0,y._)([(0,A.$)("esri.layers.mixins.RefreshableLayerView")],h),h}},54217:(o,h,m)=>{m.d(h,{D8:()=>p,TO:()=>n,d0:()=>u});var y=m(57022);async function n(o){var h,m;let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.popupTemplate;if(null==v)return[];const w=await v.getRequiredFields(o.fieldsIndex),{lastEditInfoEnabled:S}=v,{objectIdField:A,typeIdField:b,globalIdField:D,relationships:M}=o;if(w.includes("*"))return["*"];const R=S?(0,y.eX)(o):[],T=(0,y.DB)(o.fieldsIndex,[...w,...R]);return b&&T.push(b),T&&A&&null!==(h=o.fieldsIndex)&&void 0!==h&&h.has(A)&&!T.includes(A)&&T.push(A),T&&D&&null!==(m=o.fieldsIndex)&&void 0!==m&&m.has(D)&&!T.includes(D)&&T.push(D),M&&M.forEach((h=>{var m;const{keyField:y}=h;T&&y&&(null===(m=o.fieldsIndex)||void 0===m?void 0:m.has(y))&&!T.includes(y)&&T.push(y)})),T}function p(o,h){return o.popupTemplate?o.popupTemplate:null!=h&&h.defaultPopupTemplateEnabled&&null!=o.defaultPopupTemplate?o.defaultPopupTemplate:null}function u(o,h){return null!=p(o,{defaultPopupTemplateEnabled:h})}}}]);
//# sourceMappingURL=9221.ea5864d3.chunk.js.map