{"version":3,"file":"static/js/1734.f6632f91.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/libs/i3s/enums.js","../node_modules/@arcgis/core/libs/i3s/I3SModule.js","../node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js","../node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nvar n,e;!function(n){n[n.None=0]=\"None\",n[n.Int16=1]=\"Int16\",n[n.Int32=2]=\"Int32\"}(n||(n={})),function(n){n[n.Replace=0]=\"Replace\",n[n.Outside=1]=\"Outside\",n[n.Inside=2]=\"Inside\",n[n.Finished=3]=\"Finished\"}(e||(e={}));export{n as IndexType,e as ModificationType};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function e(){return n||(n=new Promise((t=>import(\"../../chunks/i3s.js\").then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i,onRuntimeInitialized:()=>t(n)});delete n.then})))).catch((t=>{throw t}))),n}function i(e){return t(`esri/libs/i3s/${e}`)}let n;export{e as get};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{hasScaling as e}from\"../../../core/mathUtils.js\";import r from\"../../../geometry/SpatialReference.js\";import{toFloat64Array as t}from\"../../../geometry/support/DoubleArray.js\";import o from\"../../../geometry/support/MeshGeoreferencedVertexSpace.js\";import n from\"../../../geometry/support/MeshLocalVertexSpace.js\";import{t as s,n as i}from\"../../../chunks/vec3.js\";import{IndexType as a}from\"../../../libs/i3s/enums.js\";import{get as f}from\"../../../libs/i3s/I3SModule.js\";import{NodeIMModificationImpact as c}from\"./i3s/I3SNode.js\";async function l(e){w=await x();const r=[e.geometryBuffer];return{result:j(w,e,r),transferList:r}}async function u(e){w=await x();const r=[e.geometryBuffer],{geometryBuffer:t}=e,o=t.byteLength,n=w._malloc(o),s=new Uint8Array(w.HEAPU8.buffer,n,o);s.set(new Uint8Array(t));const i=w.dracoDecompressPointCloudData(n,s.byteLength);if(w._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&r.push(a.buffer),r.push(f.buffer),{result:{positions:f,featureIds:a},transferList:r}}async function m(e){await x(),L(e);const r={buffer:e.buffer};return{result:r,transferList:[r.buffer]}}async function y(e){await x(),E(e)}async function p(e){w=await x(),w.setLegacySchema(e.context,e.jsonSchema)}async function d(e){const{localMatrix:s,origin:i,positions:a,vertexSpace:f,localMode:c}=e,l=r.fromJSON(e.inSpatialReference),u=r.fromJSON(e.outSpatialReference);let m;const[{projectBuffer:y},{initializeProjection:p}]=await Promise.all([import(\"../../../geometry/projection/projectBuffer.js\"),import(\"../../../geometry/projection.js\")]);await p(l,u);const d=[0,0,0];if(!y(i,l,0,d,u,0,1))throw new Error(\"Failed to project\");if(\"georeferenced\"===f.type&&null==f.origin){if(m=new Float64Array(a.length),!y(a,l,0,m,u,0,m.length/3))throw new Error(\"Failed to project\")}else{const e=\"georeferenced\"===f.type?o.fromJSON(f):n.fromJSON(f),{project:r}=await import(\"../../../geometry/support/meshUtils/projection.js\"),i=r({positions:a,transform:s?{localMatrix:s}:void 0,vertexSpace:e,inSpatialReference:l,outSpatialReference:u,localMode:c});if(!i)throw new Error(\"Failed to project\");m=t(i)}const b=m.length,[h,g,w]=d;for(let r=0;r<b;r+=3)m[r]-=h,m[r+1]-=g,m[r+2]-=w;return{result:{projected:m,original:a,projectedOrigin:d},transferList:[m.buffer,a.buffer]}}async function b({normalMatrix:r,normals:t}){const o=new Float32Array(t.length);return s(o,t,r),e(r)&&i(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function h(e){I(e)}let g,w;function E(e){if(!w)return;const r=e.modifications,t=w._malloc(8*r.length),o=new Float64Array(w.HEAPU8.buffer,t,r.length);for(let n=0;n<r.length;++n)o[n]=r[n];w.setModifications(e.context,t,r.length,e.isGeodetic),w._free(t)}function j(e,r,t){const{context:o,globalTrafo:n,mbs:s,obbData:i,elevationOffset:f,geometryBuffer:c,geometryDescriptor:l,indexToVertexProjector:u,vertexToRenderProjector:m}=r,y=e._malloc(c.byteLength),p=33,d=e._malloc(p*Float64Array.BYTES_PER_ELEMENT),b=new Uint8Array(e.HEAPU8.buffer,y,c.byteLength);b.set(new Uint8Array(c));const h=new Float64Array(e.HEAPU8.buffer,d,p);S(h,[NaN,NaN,NaN]);let g=h.byteOffset+3*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g);S(w,n),g+=16*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g),S(w,s),g+=4*h.BYTES_PER_ELEMENT,i&&(w=new Float64Array(h.buffer,g),S(w,i));const E=l,j={isDraco:!1,isLegacy:!1,color:r.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:r.needNormals&&r.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:r.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:r.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:E.featureIndex},A=e.process(o,!!r.obbData,y,b.byteLength,E,j,d,f,u,m,r.normalReferenceFrame);if(e._free(d),e._free(y),A.error.length>0)throw new Error(`i3s.wasm: ${A.error}`);if(A.discarded)return null;const L=A.componentOffsets.length>0?A.componentOffsets.slice():null,I=A.featureIds.length>0?A.featureIds.slice():null,_=A.anchorIds.length>0?Array.from(A.anchorIds):null,x=A.anchors.length>0?Array.from(A.anchors):null,M=A.interleavedVertedData.slice().buffer,N=A.indicesType===a.Int16?new Uint16Array(A.indices.buffer,A.indices.byteOffset,A.indices.byteLength/2).slice():new Uint32Array(A.indices.buffer,A.indices.byteOffset,A.indices.byteLength/4).slice(),P=A.positions.slice(),U=A.positionIndicesType===a.Int16?new Uint16Array(A.positionIndices.buffer,A.positionIndices.byteOffset,A.positionIndices.byteLength/2).slice():new Uint32Array(A.positionIndices.buffer,A.positionIndices.byteOffset,A.positionIndices.byteLength/4).slice(),T={layout:r.layouts[0],interleavedVertexData:M,indices:N,hasColors:A.hasColors,hasModifications:A.hasModifications,positionData:{data:P,indices:U}};return I&&t.push(I.buffer),L&&t.push(L.buffer),t.push(M),t.push(N.buffer),t.push(P.buffer),t.push(U.buffer),{componentOffsets:L,featureIds:I,anchorIds:_,anchors:x,transformedGeometry:T,obb:A.obb,globalTrafo:n}}function A(e){return 0===e?c.Unmodified:1===e?c.PotentiallyModified:2===e?c.Culled:c.Unknown}function L(e){if(!w)return;const{context:r,buffer:t}=e,o=w._malloc(t.byteLength),n=t.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(w.HEAPU8.buffer,o,n),i=new Float64Array(t);s.set(i),w.filterOBBs(r,o,n),i.set(s),w._free(o)}function I(e){w&&0===w.destroy(e)&&(w=null)}function S(e,r){for(let t=0;t<r.length;++t)e[t]=r[t]}async function _(){w||await x()}function x(){return w?Promise.resolve(w):(g||(g=f().then((e=>(w=e,g=null,w)))),g)}const M={transform:(e,r)=>w&&j(w,e,r),destroy:I};export{h as destroyContext,u as dracoDecompressPointCloudData,m as filterObbsForModifications,L as filterObbsForModificationsSync,_ as initialize,A as interpretObbModificationResults,l as process,d as project,p as setLegacySchema,y as setModifications,E as setModificationsSync,M as test,b as transformNormals};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{fromValues as e}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{f as i}from\"../../../../chunks/sphere.js\";import{invalidateMbs as n}from\"./I3SUtil.js\";import{ElevationRange as t}from\"../../support/ElevationRange.js\";class s extends t{constructor(e,n){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=n,this.serviceMbsInRenderSR=i(0,0,0,-1)}invalidateServiceBVsInRenderSR(){n(this.serviceMbsInRenderSR),this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}var o,r,a,d,c;!function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.Culled=1]=\"Culled\",e[e.NotChecked=2]=\"NotChecked\"}(o||(o={})),function(e){e[e.Unmodified=0]=\"Unmodified\",e[e.PotentiallyModified=1]=\"PotentiallyModified\",e[e.Culled=2]=\"Culled\",e[e.Unknown=3]=\"Unknown\",e[e.NotChecked=4]=\"NotChecked\"}(r||(r={}));class h extends s{constructor(i,n,t,s,o,d,c,h,l,u){super(i,t),this.index=n,this.childCount=s,this.level=o,this.resources=d,this.version=c,this.lodMetric=h,this.maxError=l,this.numFeatures=u,this.failed=!1,this.cacheState=a.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=r.NotChecked,this.elevationAgnosticBoundingVolume=e(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}}!function(e){e[e.Unknown=0]=\"Unknown\",e[e.Uncached=1]=\"Uncached\",e[e.Cached=2]=\"Cached\"}(a||(a={})),function(e){e[e.None=0]=\"None\",e[e.MaxScreenThreshold=1]=\"MaxScreenThreshold\",e[e.ScreenSpaceRelative=2]=\"ScreenSpaceRelative\",e[e.RemovedFeatureDiameter=3]=\"RemovedFeatureDiameter\",e[e.DistanceRangeFromDefaultCamera=4]=\"DistanceRangeFromDefaultCamera\"}(d||(d={})),function(e){e[e.Hole=0]=\"Hole\",e[e.Leaf=1]=\"Leaf\"}(c||(c={}));class l{constructor(e,i,n,t){this.nodeHasLOD=e,this.isChosen=i,this.lodLevel=n,this.version=t}}export{a as CacheState,d as LodMetric,h as Node,s as NodeBase,o as NodeFilterImpact,r as NodeIMModificationImpact,c as NodeState,l as NodeTraversalState};\n"],"names":["n","e","None","Int16","Int32","Replace","Outside","Inside","Finished","i","t","concat","async","l","w","x","r","geometryBuffer","result","j","transferList","u","_i$featureIds","o","byteLength","_malloc","s","Uint8Array","HEAPU8","buffer","set","dracoDecompressPointCloudData","_free","error","length","Error","a","featureIds","slice","f","positions","push","m","L","y","E","p","setLegacySchema","context","jsonSchema","d","localMatrix","origin","vertexSpace","localMode","c","fromJSON","inSpatialReference","outSpatialReference","projectBuffer","initializeProjection","Promise","all","type","Float64Array","project","transform","b","h","g","projected","original","projectedOrigin","_ref","normalMatrix","normals","Float32Array","transformed","I","modifications","setModifications","isGeodetic","globalTrafo","mbs","obbData","elevationOffset","geometryDescriptor","indexToVertexProjector","vertexToRenderProjector","BYTES_PER_ELEMENT","S","NaN","byteOffset","isDraco","isLegacy","color","layouts","some","name","normal","needNormals","uv0","uvRegion","featureIndex","A","process","normalReferenceFrame","discarded","componentOffsets","_","anchorIds","Array","from","anchors","M","interleavedVertedData","N","indicesType","Uint16Array","indices","Uint32Array","P","U","positionIndicesType","positionIndices","T","layout","interleavedVertexData","hasColors","hasModifications","positionData","data","transformedGeometry","obb","Unmodified","PotentiallyModified","Culled","Unknown","filterOBBs","destroy","resolve","then","default","locateFile","onRuntimeInitialized","catch","constructor","super","this","id","serviceMbsInIndexSR","serviceMbsInRenderSR","invalidateServiceBVsInRenderSR","_this$serviceObbInRen","serviceObbInRenderSR","invalidate","shareServiceBVsInRenderSRWith","NotChecked","index","childCount","level","resources","version","lodMetric","maxError","numFeatures","failed","cacheState","vertexCount","memory","childrenLoaded","imModificationImpact","elevationAgnosticBoundingVolume","Uncached","Cached","MaxScreenThreshold","ScreenSpaceRelative","RemovedFeatureDiameter","DistanceRangeFromDefaultCamera","Hole","Leaf","nodeHasLOD","isChosen","lodLevel"],"sourceRoot":""}