"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[6840],{30050:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(85504),h=i(16770);class r{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let s=this._inFlightResourceMap.get(e);return s?s.then((e=>({width:e.width,height:e.height}))):(s=(0,h.M5)(e,t),this._inFlightResourceMap.set(e,s),s.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,s.Al)(e)}}},6840:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>c});var s=i(30050),h=i(83283),r=i(401),a=i(48988),n=i(97763);const l=96/72;class c{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new s.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,h,l,c,g,u){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:w}=d;l||(l=(0,n.n5)(w));const y=await a.$.resolveSymbolOverrides(d,t,this._spatialReference,h,l,c,g),m=this._cimResourceManager,p=[];r.wp.fetchResources(y,m,p),r.wp.fetchFonts(y,m,p),p.length>0&&await Promise.all(p);const{width:M,height:R}=i,_=o(l,M,R,s),b=r.wp.getEnvelope(y,_,m);if(!b)return null;let v=1,f=0,C=0;switch(w.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;b.width>M&&(e=M/b.width);let t=1;b.height>R&&(t=R/b.height),"preview"===s&&(b.width<M&&(e=M/b.width),b.height<R&&(t=R/b.height)),v=Math.min(e,t),f=b.x+b.width/2,C=b.y+b.height/2}break;case"CIMLineSymbol":{(u||b.height>R)&&(v=R/b.height),C=b.y+b.height/2;const e=b.x*v+M/2,t=(b.x+b.width)*v+M/2,{paths:i}=_;i[0][0][0]-=e/v,i[0][2][0]-=(t-M)/v}break;case"CIMPolygonSymbol":{f=b.x+b.width/2,C=b.y+b.height/2;const e=b.x*v+M/2,t=(b.x+b.width)*v+M/2,i=b.y*v+R/2,s=(b.y+b.height)*v+R/2,{rings:h}=_;e<0&&(h[0][0][0]-=e,h[0][3][0]-=e,h[0][4][0]-=e),i<0&&(h[0][0][1]+=i,h[0][1][1]+=i,h[0][4][1]+=i),t>M&&(h[0][1][0]-=t-M,h[0][2][0]-=t-M),s>R&&(h[0][2][1]+=s-R,h[0][3][1]+=s-R)}}const I={type:"cim",data:{type:"CIMSymbolReference",symbol:y}};return this.rasterize(I,M,R,f,C,v,l,1,_)}rasterize(e,t,i,s,r,a,c){let g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:w}=d,y=this._canvas,m=(window.devicePixelRatio||1)*l;y.width=t*m,y.height=i*m,c||(c=(0,n.n5)(w)),u||(u=o(c,t,i,"legend")),y.width+=2*g,y.height+=2*g;const p=y.getContext("2d",{willReadFrequently:!0}),M=h.IT.createIdentity();return M.translate(-s,-r),M.scale(a*m,-a*m),M.translate(t*m/2+g,i*m/2+g),p.clearRect(0,0,y.width,y.height),new h.Rj(p,this._cimResourceManager,M,!0).drawSymbol(w,u),p.getImageData(0,0,y.width,y.height)}}function o(e,t,i,s){const h=-t/2+1,r=t/2-1,a=i/2-1,n=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[h,0],[0,0],[r,0]]]};default:return"legend"===s?{rings:[[[h,a],[r,0],[r,n],[h,n],[h,a]]]}:{rings:[[[h,a],[r,a],[r,n],[h,n],[h,a]]]}}}}}]);
//# sourceMappingURL=6840.1b224226.chunk.js.map