"use strict";(self.webpackChunkRDIS_Web_Application=self.webpackChunkRDIS_Web_Application||[]).push([[6840,8675],{6840:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>o});var n=i(30050),a=i(83283),r=i(401),s=i(48988),l=i(97763);const h=96/72;class o{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new n.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,a,h,o,u,g){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;h||(h=(0,l.n5)(y));const w=await s.$.resolveSymbolOverrides(d,t,this._spatialReference,a,h,o,u),m=this._cimResourceManager,p=[];r.wp.fetchResources(w,m,p),r.wp.fetchFonts(w,m,p),p.length>0&&await Promise.all(p);const{width:f,height:M}=i,b=c(h,f,M,n),R=r.wp.getEnvelope(w,b,m);if(!R)return null;let v=1,_=0,C=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;R.width>f&&(e=f/R.width);let t=1;R.height>M&&(t=M/R.height),"preview"===n&&(R.width<f&&(e=f/R.width),R.height<M&&(t=M/R.height)),v=Math.min(e,t),_=R.x+R.width/2,C=R.y+R.height/2}break;case"CIMLineSymbol":{(g||R.height>M)&&(v=M/R.height),C=R.y+R.height/2;const e=R.x*v+f/2,t=(R.x+R.width)*v+f/2,{paths:i}=b;i[0][0][0]-=e/v,i[0][2][0]-=(t-f)/v}break;case"CIMPolygonSymbol":{_=R.x+R.width/2,C=R.y+R.height/2;const e=R.x*v+f/2,t=(R.x+R.width)*v+f/2,i=R.y*v+M/2,n=(R.y+R.height)*v+M/2,{rings:a}=b;e<0&&(a[0][0][0]-=e,a[0][3][0]-=e,a[0][4][0]-=e),i<0&&(a[0][0][1]+=i,a[0][1][1]+=i,a[0][4][1]+=i),t>f&&(a[0][1][0]-=t-f,a[0][2][0]-=t-f),n>M&&(a[0][2][1]+=n-M,a[0][3][1]+=n-M)}}const S={type:"cim",data:{type:"CIMSymbolReference",symbol:w}};return this.rasterize(S,f,M,_,C,v,h,1,b)}rasterize(e,t,i,n,r,s,o){let u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d,w=this._canvas,m=(window.devicePixelRatio||1)*h;w.width=t*m,w.height=i*m,o||(o=(0,l.n5)(y)),g||(g=c(o,t,i,"legend")),w.width+=2*u,w.height+=2*u;const p=w.getContext("2d",{willReadFrequently:!0}),f=a.IT.createIdentity();return f.translate(-n,-r),f.scale(s*m,-s*m),f.translate(t*m/2+u,i*m/2+u),p.clearRect(0,0,w.width,w.height),new a.Rj(p,this._cimResourceManager,f,!0).drawSymbol(y,g),p.getImageData(0,0,w.width,w.height)}}function c(e,t,i,n){const a=-t/2+1,r=t/2-1,s=i/2-1,l=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[a,0],[0,0],[r,0]]]};default:return"legend"===n?{rings:[[[a,s],[r,0],[r,l],[a,l],[a,s]]]}:{rings:[[[a,s],[r,s],[r,l],[a,l],[a,s]]]}}}},28675:(e,t,i)=>{i.d(t,{previewCIMSymbol:()=>m});var n=i(76931),a=i(401),r=i(6840),s=i(48988),l=i(97763),h=i(65709),o=i(26291);const c=new r.CIMSymbolRasterizer(null),u=(0,n.PN)(h.CB.size),g=(0,n.PN)(h.CB.maxSize),d=(0,n.PN)(h.CB.lineWidth),y=1;async function w(e,t,i){const n=t?.size;let r=null!=n&&"object"==typeof n&&"width"in n?n.width:n,l=null!=n&&"object"==typeof n&&"height"in n?n.height:n;if(null==r||null==l)if("esriGeometryPolygon"===i)r=u,l=u;else{const n=await async function(e,t,i){const{feature:n,fieldMap:r,viewParams:l}=t.cimOptions||t,h=await s.$.resolveSymbolOverrides(e.data,n,null,r,i,null,l);if(!h)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:h},e.data.primitiveOverrides=void 0;const o=[];return a.wp.fetchResources(h,c.resourceManager,o),a.wp.fetchFonts(h,c.resourceManager,o),o.length>0&&await Promise.all(o),a.wp.getEnvelope(h,null,c.resourceManager)}(e,t,i);n&&(r=n.width,l=n.height),"esriGeometryPolyline"===i&&(r=d),r=null!=r&&isFinite(r)?Math.min(r,g):u,l=null!=l&&isFinite(l)?Math.max(Math.min(l,g),y):u}return"legend"===t.style&&"esriGeometryPolyline"===i&&(r=d),{width:r,height:l}}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{node:i,opacity:a,symbolConfig:r}=t,s=null!=r&&"object"==typeof r&&"isSquareFill"in r&&r.isSquareFill,h=t.cimOptions||t,u=h.geometryType||(0,l.n5)(e?.data?.symbol),g=await w(e,t,u),{feature:d,fieldMap:y}=h,m=s||"esriGeometryPolygon"!==u?"preview":"legend",p=await c.rasterizeCIMSymbolAsync(e,d,g,m,y,u,null,h.viewParams,h.allowScalingUp);if(!p)return null;const{width:f,height:M}=p,b=document.createElement("canvas");b.width=f,b.height=M,b.getContext("2d").putImageData(p,0,0);const R=(0,n.Lz)(g.width),v=(0,n.Lz)(g.height),_=new Image(R,v);_.src=b.toDataURL(),_.ariaLabel=t.ariaLabel??null,_.alt=t.ariaLabel??"",null!=a&&(_.style.opacity=`${a}`);let C=_;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:R,height:v,src:_.src},fill:null,stroke:null,offset:[0,0]};C=(0,o.fz)([[e]],[R,v],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return i&&C&&i.appendChild(C),C}},30050:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(85504),a=i(16770);class r{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let n=this._inFlightResourceMap.get(e);return n?n.then((e=>({width:e.width,height:e.height}))):(n=(0,a.M5)(e,t),this._inFlightResourceMap.set(e,n),n.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,n.Al)(e)}}}}]);
//# sourceMappingURL=8675.7704e92b.chunk.js.map