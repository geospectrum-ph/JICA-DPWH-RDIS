{"version":3,"file":"static/js/7623.c1a76158.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","../node_modules/@arcgis/core/views/2d/layers/BaseDynamicLayerView2D.js","../node_modules/@arcgis/core/views/2d/viewStateUtils.js","../node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js","../node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class a extends s{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(s){const a=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),a]}_manageFade(){this.children.reduce(((e,r)=>e+(r.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction=\"additive\")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction=\"standard\")),this._hasCrossfade=!1)}}export{a as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Logger.js\";import{isAbortError as r}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapContainer as a}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import p from\"./support/ExportStrategy.js\";import n from\"../../layers/LayerView.js\";import h from\"../../layers/RefreshableLayerView.js\";let m=class extends(h(o(n))){update(t){this._strategy.update(t).catch((t=>{r(t)||e.getLogger(this).error(t)})),this.notifyChange(\"updating\")}attach(){this._bitmapContainer=new a,this.container.addChild(this._bitmapContainer),this._strategy=new p({container:this._bitmapContainer,fetchSource:this.fetchBitmapData.bind(this),requestUpdate:this.requestUpdate.bind(this)})}detach(){this._strategy.destroy(),this._strategy=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}viewChange(){}moveEnd(){this.requestUpdate()}fetchBitmapData(t,e,r){return this.layer.fetchImageBitmap(t,e,r)}async doRefresh(){this.requestUpdate()}isUpdating(){return this._strategy.updating||this.updateRequested}};t([s()],m.prototype,\"_strategy\",void 0),t([s()],m.prototype,\"updating\",void 0),m=t([i(\"esri.views.2d.layers.BaseDynamicLayerView2D\")],m);const d=m;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nconst t=Math.PI/180;function n(n){return n*t}function o(t,o){const a=n(o.rotation),r=Math.abs(Math.cos(a)),s=Math.abs(Math.sin(a)),[u,c]=o.size;return t[0]=Math.round(c*s+u*r),t[1]=Math.round(c*r+u*s),t}function a(t,n,o,a){const[r,s]=n,[u,c]=a,h=.5*o;return t[0]=r-h*u,t[1]=s-h*c,t[2]=r+h*u,t[3]=s+h*c,t}export{a as getBBox,o as getOuterSize};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import\"../../../../core/has.js\";import{debounce as i,throwIfAborted as o,throwIfAbortError as r,eachAlways as s}from\"../../../../core/promiseUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{create as p,toExtent as m}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import l from\"../../../../layers/support/TileInfo.js\";import{getOuterSize as d,getBBox as c}from\"../../viewStateUtils.js\";import{Bitmap as u}from\"../../engine/Bitmap.js\";import g from\"../../tiling/TileInfoView.js\";import f from\"../../tiling/TileKey.js\";const y=p(),x=[0,0],S=new f(0,0,0,0),w={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};let M=class extends e{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=w.hidpi,this.imageMaxWidth=w.imageMaxWidth,this.imageMaxHeight=w.imageMaxHeight,this.imageRotationSupported=w.imageRotationSupported,this.imageNormalizationSupported=w.imageNormalizationSupported,this.update=i((async(t,e)=>{if(o(e),!t.stationary||this.destroyed)return;const i=t.state,s=h(i.spatialReference),a=this.hidpi?t.pixelRatio:1,n=i.worldScreenWidth>0,p=n&&this.imageNormalizationSupported&&i.worldScreenWidth<i.size[0],m=Math.round((this.imageMaxWidth??0)/a),l=Math.round((this.imageMaxHeight??0)/a);p?(x[0]=i.worldScreenWidth,x[1]=i.size[1]):this.imageRotationSupported?(x[0]=i.size[0],x[1]=i.size[1]):d(x,i);const c=Math.floor(x[0])>m||Math.floor(x[1])>l,u=s&&(i.extent.xmin<s.valid[0]||i.extent.xmax>s.valid[1]),g=!this.imageNormalizationSupported&&u,f=!c&&!g,y=this.imageRotationSupported?i.rotation:0,S=this.container.children.slice();if(f){const t=p?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,x,t,i.resolution,y,a,e)}else{let t=Math.min(m,l);n&&(t=Math.min(i.worldScreenWidth,t),t=Math.round(i.worldScreenWidth/Math.ceil(i.worldScreenWidth/t))),this._imagePromise=this._tiledExport(i,t,a,e)}try{const t=await this._imagePromise??[];o(e);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=t;for(const e of S)t.includes(e)||i.push(e.fadeOut().then((()=>{e.remove(),e.destroy()})));for(const e of t)i.push(e.fadeIn());await Promise.all(i)}catch(w){this._imagePromise=null,r(w)}}),5e3),this.updateExports=i((async t=>{const e=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;e.push(t(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=s(e).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((t=>t.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(t,e,i,r,s,a){const n=await this.fetchSource(t,Math.floor(e*s),Math.floor(i*s),{rotation:r,pixelRatio:s,signal:a});o(a);const p=new u(null,!0);return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=r,p.pixelRatio=s,p.opacity=0,this.container.addChild(p),await p.setSourceAsync(n,a),o(a),p}async _singleExport(t,e,i,o,r,s,a){c(y,i,o,e);const n=m(y,t.spatialReference);return[await this._export(n,e[0],e[1],r,s,a)]}_tiledExport(t,e,i,o){const r=l.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),s=new g(r),a=s.getTileCoverage(t);if(!a)return null;const n=[];return a.forEach(((r,a,p,h)=>{S.set(r,a,p,0),s.getTileBounds(y,S);const l=m(y,t.spatialReference);n.push(this._export(l,e,e,0,i,o).then((t=>(0!==h&&(S.set(r,a,p,h),s.getTileBounds(y,S),t.x=y[0],t.y=y[3]),t))))})),Promise.all(n)}};t([a()],M.prototype,\"_imagePromise\",void 0),t([a()],M.prototype,\"bitmaps\",void 0),t([a()],M.prototype,\"container\",void 0),t([a()],M.prototype,\"fetchSource\",void 0),t([a()],M.prototype,\"hidpi\",void 0),t([a()],M.prototype,\"imageMaxWidth\",void 0),t([a()],M.prototype,\"imageMaxHeight\",void 0),t([a()],M.prototype,\"imageRotationSupported\",void 0),t([a()],M.prototype,\"imageNormalizationSupported\",void 0),t([a()],M.prototype,\"requestUpdate\",void 0),t([a()],M.prototype,\"updating\",null),M=t([n(\"esri.views.2d.layers.support.ExportStrategy\")],M);const _=M;export{_ as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/reactiveUtils.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import\"../../core/Error.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let a=class extends i{initialize(){this.addHandles(o((()=>this.layer),\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this).error(r)}))})),\"RefreshableLayerView\")}};return a=r([t(\"esri.views.layers.RefreshableLayerView\")],a),a};export{i as default};\n"],"names":["a","s","constructor","super","arguments","this","_hasCrossfade","requiresDedicatedFBO","beforeRender","e","_manageFade","prepareRenderPasses","registerRenderPass","name","brushes","bitmap","target","children","drawPhase","r","MAP","reduce","inFadeTransition","forEach","blendFunction","m","h","o","n","update","t","_strategy","catch","getLogger","error","notifyChange","attach","_bitmapContainer","container","addChild","p","fetchSource","fetchBitmapData","bind","requestUpdate","detach","destroy","removeChild","removeAllChildren","viewChange","moveEnd","layer","fetchImageBitmap","doRefresh","isUpdating","updating","updateRequested","prototype","i","d","Math","PI","rotation","abs","cos","sin","u","c","size","round","y","x","S","f","w","M","_imagePromise","bitmaps","hidpi","imageMaxWidth","imageMaxHeight","imageRotationSupported","imageNormalizationSupported","async","_this$imageMaxWidth","_this$imageMaxHeight","stationary","destroyed","state","spatialReference","pixelRatio","worldScreenWidth","l","floor","extent","xmin","valid","xmax","g","slice","paddedViewState","center","_singleExport","resolution","min","ceil","_tiledExport","_await$this$_imagePro","includes","push","fadeOut","then","remove","fadeIn","Promise","all","updateExports","visible","stage","invalidateTexture","requestRender","_export","signal","ymax","width","opacity","setSourceAsync","create","scales","scale","getTileCoverage","set","getTileBounds","_","initialize","addHandles","dataChanged"],"sourceRoot":""}