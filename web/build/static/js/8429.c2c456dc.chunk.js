"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[8429],{37923:(e,t,r)=>{r.d(t,{C:()=>R,b:()=>T});var n,i,o,s,a,l,c,d=r(57528),h=r(34981),u=r(26917),p=r(81776),f=r(90080),v=r(54478),g=r(48020),m=r(81993),_=r(66763),y=r(90235),w=r(80883),C=r(42451),A=r(58350),x=r(64839),O=r(32307),S=r(10773),b=r(66470);function T(e){const t=new O.N5,{vertex:r,fragment:T,attributes:R,varyings:E}=t;(0,C.NB)(r,e),t.include(p.d,e),t.include(v.c,e),t.include(_.A,e),t.include(f.g,e),R.add(b.r.POSITION,"vec3"),e.vvColor&&R.add(b.r.COLORFEATUREATTRIBUTE,"float"),E.add("vColor","vec4"),E.add("vpos","vec3");const D=e.multipassEnabled&&e.output===h.V.Color;D&&E.add("depth","float"),r.uniforms.add(new A.E("eColor",(e=>e.color))),r.code.add((0,x.H)(n||(n=(0,d.A)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n\n      ","\n      ","\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;",D?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(u.HQ,e),D&&t.include(m.Q,e),T.include(w.a);const P=e.output===h.V.Highlight;return P&&t.include(g.Qh,e),e.transparencyPassType===S.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),T.code.add((0,x.H)(i||(i=(0,d.A)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = vColor;\n\n    ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ",";\n    ","\n  }\n  "])),D?"terrainDepthTest(depth);":"",e.output===h.V.ObjectAndLayerIdColor?(0,x.H)(o||(o=(0,d.A)(["fColor.a = 1.0;"]))):"",x.H.float(y.y),e.output===h.V.Color?(0,x.H)(s||(s=(0,d.A)(["fragColor = highlightSlice(fColor, vpos); ",""])),e.transparencyPassType===S.y.ColorAlpha?(0,x.H)(a||(a=(0,d.A)(["\n                  fragColor = premultiplyAlpha(fragColor);\n                  fragAlpha = fragColor.a;"]))):""):"",P?(0,x.H)(l||(l=(0,d.A)(["outputHighlight();"]))):"",e.output===h.V.ObjectAndLayerIdColor?(0,x.H)(c||(c=(0,d.A)(["outputObjectAndLayerIdColor();"]))):"")),t}const R=Object.freeze(Object.defineProperty({__proto__:null,build:T},Symbol.toStringTag,{value:"Module"}))},19061:(e,t,r)=>{r.d(t,{H:()=>ee,b:()=>Q,c:()=>$});var n,i,o,s,a,l,c,d,h,u,p,f,v,g,m,_,y,w,C,A,x,O=r(57528),S=r(19555),b=r(72745),T=r(55855),R=r(34981),E=r(26917),D=r(90080),P=r(98720),M=r(40318),I=r(38280),N=r(62374),L=r(48020),F=r(66763),z=r(90235),V=r(80883),j=r(81449),H=r(69817),U=r(42451),W=r(95756),B=r(58350),G=r(21390),Z=r(64839),k=r(32307),q=r(70367),Y=r(10773),X=r(66470);function Q(e){const t=new k.N5,r=e.signedDistanceFieldEnabled;if(t.include(M.Q,e),t.include(E.HQ,e),e.occlusionPass)return t.include(I.I,e),t;const{vertex:b,fragment:Q}=t;t.include(H.Y6),Q.include(j.W),Q.include(V.a),t.include(F.A,e),t.include(D.g,e),t.include(N.y),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),b.uniforms.add(new B.E("viewport",((e,t)=>t.camera.fullViewport)),new W.G("screenOffset",((e,t)=>(0,S.hZ)(K,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new W.G("anchorPosition",(e=>$(e))),new B.E("materialColor",(e=>e.color))),(0,U.Nz)(b),r&&(b.uniforms.add(new B.E("outlineColor",(e=>e.outlineColor))),Q.uniforms.add(new B.E("outlineColor",(e=>J(e)?e.outlineColor:T.uY)),new G.m("outlineSize",(e=>J(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&b.include(P.K),e.hasScreenSizePerspective&&((0,H.pM)(b),(0,H.OH)(b)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(X.r.UV0,"vec2"),t.attributes.add(X.r.COLOR,"vec4"),t.attributes.add(X.r.SIZE,"vec2"),t.attributes.add(X.r.FEATUREATTRIBUTE,"vec4"),b.code.add((0,Z.H)(n||(n=(0,O.A)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      forwardObjectAndLayerIdColor();\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n      bool visible = testHUDVisibility(posProj);\n      voccluded = visible ? 0.0 : 1.0;\n    "])),e.hasScreenSizePerspective?(0,Z.H)(i||(i=(0,O.A)(["\n            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,Z.H)(o||(o=(0,O.A)(["\n            inputSize = size;\n            vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""));const ee=(0,Z.H)(s||(s=(0,O.A)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),te=e.pixelSnappingEnabled?r?(0,Z.H)(a||(a=(0,O.A)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,Z.H)(l||(l=(0,O.A)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,Z.H)(c||(c=(0,O.A)(["posProj += quadOffset;"])));b.code.add((0,Z.H)(d||(d=(0,O.A)(["\n    ","\n    ","\n    ","\n\n    ","\n\n    bool alphaDiscard = vcolor.a < ",";\n    ",'\n    if (alphaDiscard) {\n      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    } else {\n      ',"\n      gl_Position = posProj;\n    }\n\n    vtc = uv;\n\n    ","\n    vsize = inputSize;\n    ","\n  }\n  "])),e.occlusionTestEnabled?"if (visible) {":"",ee,e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;",e.output===R.V.ObjectAndLayerIdColor?(0,Z.H)(h||(h=(0,O.A)(["vcolor.a = 1.0;"]))):"",Z.H.float(z.y),r?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(Z.H.float(z.y),";"):"",te,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,Z.H)(u||(u=(0,O.A)(["} else { vtc = vec2(0.0);\n      ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),Q.uniforms.add(new q.N("tex",(e=>e.texture)));const re=e.debugDrawLabelBorder?(0,Z.H)(p||(p=(0,O.A)(["(isBorder > 0.0 ? 0.0 : ",")"])),Z.H.float(z.H)):Z.H.float(z.H),ne=(0,Z.H)(f||(f=(0,O.A)(["\n    ","\n\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,Z.H)(v||(v=(0,O.A)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",e.sampleSignedDistanceFieldTexelCenter?(0,Z.H)(g||(g=(0,O.A)(["\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      float txSize = float(textureSize(tex, 0).x);\n      float texelSize = 1.0 / txSize;\n\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n      "]))):(0,Z.H)(m||(m=(0,O.A)(["\n      vec2 samplePos = vtc;\n      "]))),r?(0,Z.H)(_||(_=(0,O.A)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        fragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        fragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),re,Z.H.float(z.y),re):(0,Z.H)(y||(y=(0,O.A)(["\n          vec4 texColor = texture(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          fragColor = texColor * premultiplyAlpha(vcolor);\n          "])),re),e.debugDrawLabelBorder?(0,Z.H)(w||(w=(0,O.A)(["fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");switch(e.output){case R.V.Color:e.transparencyPassType===Y.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),Q.code.add((0,Z.H)(C||(C=(0,O.A)(["\n        void main() {\n          ","\n          ","\n          ","\n        }"])),ne,e.transparencyPassType===Y.y.FrontFace?"fragColor.rgb /= fragColor.a;":"",e.transparencyPassType===Y.y.ColorAlpha?"fragAlpha = fragColor.a;":""));break;case R.V.ObjectAndLayerIdColor:Q.code.add((0,Z.H)(A||(A=(0,O.A)(["\n        void main() {\n          ","\n          outputObjectAndLayerIdColor();\n        }"])),ne));break;case R.V.Highlight:Q.constants.add("occludedHighlightFlag","vec4",L.U),Q.constants.add("unoccludedHighlightFlag","vec4",L.bO),Q.code.add((0,Z.H)(x||(x=(0,O.A)(["\n        void main() {\n          ","\n          if (voccluded == 1.0) {\n            fragColor = occludedHighlightFlag;\n          } else {\n            fragColor = unoccludedHighlightFlag;\n          }\n        }"])),ne))}return t}function J(e){return e.outlineColor[3]>0&&e.outlineSize>0}function $(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K;return e.textureIsSignedDistanceField?function(e,t,r){null!=t?(0,S.hZ)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,S.hZ)(r,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,S.C)(t,e.anchorPosition),t}const K=(0,b.vt)(),ee=Object.freeze(Object.defineProperty({__proto__:null,build:Q,calculateAnchorPosForRendering:$},Symbol.toStringTag,{value:"Module"}))},80381:(e,t,r)=>{r.d(t,{O:()=>u,a:()=>f,b:()=>p});var n,i=r(57528),o=r(19539),s=r(73398),a=r(21390),l=r(72790),c=r(64839),d=r(32307),h=r(70367);class u extends c.Y{constructor(){super(...arguments),this.overlayIndex=o.vr.INNER,this.opacity=1}}function p(){const e=new d.N5;return e.include(s.c),e.fragment.uniforms.add(new h.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new l.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity))),e.fragment.code.add((0,c.H)(n||(n=(0,i.A)(["void main() {\nvec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;\n}"])))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:p},Symbol.toStringTag,{value:"Module"}))},14623:(e,t,r)=>{r.d(t,{R:()=>ve,b:()=>fe,r:()=>pe});var n,i,o,s,a,l,c,d,h,u,p,f,v,g,m,_,y,w,C,A,x,O,S,b,T,R,E,D,P,M,I,N,L,F,z,V,j,H,U,W,B,G,Z=r(57528),k=r(34981),q=r(26917),Y=r(90080),X=r(3838),Q=r(56906),J=r(17698),$=r(81993),K=r(36324),ee=r(90235),te=r(80883),re=r(42451),ne=r(95756),ie=r(58350),oe=r(21390),se=r(64839),ae=r(43425),le=r(32307),ce=r(10773),de=r(66470),he=r(50125),ue=r(46259);const pe=1;function fe(e){const t=new le.N5,{attributes:r,varyings:fe,constants:ve,vertex:ge,fragment:me}=t;t.include(K.p),t.include(X.s,e),t.include(Q.q,e);const _e=e.applyMarkerOffset&&!e.draped;_e&&(ge.uniforms.add(new oe.m("markerScale",(e=>e.markerScale))),t.include(J.r,{space:he.lM.World,draped:!1})),t.include(Y.g,e),(0,re.NB)(ge,e),ge.uniforms.add(new ae.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new ne.G("nearFar",((e,t)=>t.camera.nearFar)),new oe.m("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new ie.E("viewport",((e,t)=>t.camera.fullViewport))),ge.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(de.r.POSITION,"vec3"),r.add(de.r.PREVPOSITION,"vec3"),r.add(de.r.NEXTPOSITION,"vec3"),r.add(de.r.SUBDIVISIONFACTOR,"float"),r.add(de.r.UV0,"vec2"),fe.add("vColor","vec4"),fe.add("vpos","vec3"),fe.add("vLineDistance","float"),fe.add("vLineWidth","float");const ye=e.multipassEnabled&&e.output===k.V.Color;ye&&fe.add("depth","float");const we=e.stippleEnabled;we&&fe.add("vLineSizeInv","float"),ve.add("aaWidth","float",e.stippleEnabled?0:1);const Ce=e.capType===ue.x.ROUND,Ae=e.stippleEnabled&&Ce,xe=e.falloffEnabled||Ae;xe&&fe.add("vLineDistanceNorm","float"),Ce&&(fe.add("vSegmentSDF","float"),fe.add("vReverseSegmentSDF","float")),ge.code.add((0,se.H)(n||(n=(0,Z.A)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),ge.code.add((0,se.H)(i||(i=(0,Z.A)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),ge.code.add((0,se.H)(o||(o=(0,Z.A)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),ye?"depth = pos.z;":"")),(0,re.Nz)(ge),ge.code.add((0,se.H)(s||(s=(0,Z.A)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n      float lineSize = getSize();\n\n      if (lineSize < 1.0) {\n        coverage = lineSize; // convert sub-pixel coverage to alpha\n        lineSize = 1.0;\n      }\n      lineSize += aaWidth;\n\n      float lineWidth = lineSize * pixelRatio;\n      vLineWidth = lineWidth;\n      ","\n\n      vec4 pos  = view * vec4(position, 1.0);\n      vec4 prev = view * vec4(prevPosition, 1.0);\n      vec4 next = view * vec4(nextPosition, 1.0);\n  "])),we?(0,se.H)(a||(a=(0,Z.A)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),_e&&ge.code.add((0,se.H)(l||(l=(0,Z.A)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),ge.code.add((0,se.H)(c||(c=(0,Z.A)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Ce)&&ge.code.add((0,se.H)(d||(d=(0,Z.A)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Ce?(0,se.H)(h||(h=(0,Z.A)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),ge.code.add((0,se.H)(u||(u=(0,Z.A)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?ge.code.add((0,se.H)(p||(p=(0,Z.A)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,se.H)(f||(f=(0,Z.A)(["min(1.0, subdivisionFactor * ",")"])),se.H.float((pe+2)/(pe+1))):(0,se.H)(v||(v=(0,Z.A)(["subdivisionFactor"]))))):ge.code.add((0,se.H)(g||(g=(0,Z.A)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));const Oe=e.capType!==ue.x.BUTT;return ge.code.add((0,se.H)(m||(m=(0,Z.A)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),Oe?(0,se.H)(_||(_=(0,Z.A)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),ge.code.add((0,se.H)(y||(y=(0,Z.A)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n    float lineDistNorm = sign(uv0.y) * pos.w;\n\n    vLineDistance =  lineWidth * lineDistNorm;\n    ","\n\n    pos.xy += dpos;\n  "])),xe?(0,se.H)(w||(w=(0,Z.A)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Ce&&ge.code.add((0,se.H)(C||(C=(0,Z.A)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?ge.uniforms.add(new oe.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):ge.code.add((0,se.H)(A||(A=(0,Z.A)(["vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),ge.code.add((0,se.H)(x||(x=(0,Z.A)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?ge.code.add((0,se.H)(O||(O=(0,Z.A)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):ge.code.add((0,se.H)(S||(S=(0,Z.A)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),ge.uniforms.add(new oe.m("stipplePatternPixelSize",(e=>(0,Q.h)(e)))),ge.code.add((0,se.H)(b||(b=(0,Z.A)(["float patternLength = lineSize * stipplePatternPixelSize;\nvStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\nvStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\nif (segmentLengthScreenDouble >= 0.001) {\nvec2 stippleDisplacement = pos.xy - segmentOrigin;\nfloat stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\nvStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n}\nvStippleDistanceLimits *= pos.w;\nvStippleDistance *= pos.w;\nvStippleDistanceLimits = isJoin ?\nvStippleDistanceLimits :\nisStartVertex ?\nvec2(-1e34, vStippleDistanceLimits.y) :\nvec2(vStippleDistanceLimits.x, 1e34);"]))))),ge.code.add((0,se.H)(T||(T=(0,Z.A)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),ye&&t.include($.Q,e),t.include(q.HQ,e),me.include(te.a),me.code.add((0,se.H)(R||(R=(0,Z.A)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),ye?"terrainDepthTest(depth);":"")),e.wireframe?me.code.add((0,se.H)(E||(E=(0,Z.A)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Ce&&me.code.add((0,se.H)(D||(D=(0,Z.A)(["\n        float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n        vec2 fragmentPosition = vec2(\n          min(sdf, 0.0),\n          vLineDistance\n        ) * gl_FragCoord.w;\n\n        float fragmentRadius = length(fragmentPosition);\n        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n        if (capCoverage < ",") {\n          discard;\n        }\n      "])),se.H.float(ee.y))),Ae?me.code.add((0,se.H)(P||(P=(0,Z.A)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),se.H.float(ee.y))):me.code.add((0,se.H)(M||(M=(0,Z.A)(["float stippleAlpha = getStippleAlpha();"])))),e.output!==k.V.ObjectAndLayerIdColor&&me.code.add((0,se.H)(I||(I=(0,Z.A)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),me.uniforms.add(new ie.E("intrinsicColor",(e=>e.color))),me.code.add((0,se.H)(N||(N=(0,Z.A)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(me.uniforms.add(new ie.E("innerColor",(e=>{var t;return null!==(t=e.innerColor)&&void 0!==t?t:e.color})),new oe.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),me.code.add((0,se.H)(L||(L=(0,Z.A)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),me.code.add((0,se.H)(F||(F=(0,Z.A)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(me.uniforms.add(new oe.m("falloff",(e=>e.falloff))),me.code.add((0,se.H)(z||(z=(0,Z.A)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"]))))),e.stippleEnabled||me.code.add((0,se.H)(V||(V=(0,Z.A)(["float featherStartDistance = max(vLineWidth - 2.0, 0.0);\nfloat value = abs(vLineDistance) * gl_FragCoord.w;\nfloat feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);\nfinalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);"]))))),e.transparencyPassType===ce.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),me.code.add((0,se.H)(j||(j=(0,Z.A)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===k.V.ObjectAndLayerIdColor?(0,se.H)(H||(H=(0,Z.A)(["finalColor.a = 1.0;"]))):"",se.H.float(ee.y),e.output===k.V.Color?(0,se.H)(U||(U=(0,Z.A)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===k.V.Color&&e.transparencyPassType===ce.y.ColorAlpha?(0,se.H)(W||(W=(0,Z.A)(["\n            fragColor = premultiplyAlpha(fragColor);\n            fragAlpha = fragColor.a;"]))):"",e.output===k.V.Highlight?(0,se.H)(B||(B=(0,Z.A)(["fragColor = vec4(1.0);"]))):"",e.output===k.V.ObjectAndLayerIdColor?(0,se.H)(G||(G=(0,Z.A)(["outputObjectAndLayerIdColor();"]))):"")),t}const ve=Object.freeze(Object.defineProperty({__proto__:null,build:fe,ribbonlineNumRoundJoinSubdivisions:pe},Symbol.toStringTag,{value:"Module"}))},53070:(e,t,r)=>{r.d(t,{T:()=>h,a:()=>p,b:()=>u});var n,i=r(57528),o=r(9392),s=r(73398),a=r(5517),l=r(64839),c=r(32307),d=r(70367);class h extends l.Y{constructor(){super(...arguments),this.color=(0,o.fA)(1,1,1)}}function u(){const e=new c.N5;return e.include(s.c),e.fragment.uniforms.add(new d.N("tex",(e=>e.texture)),new a.t("uColor",(e=>e.color))),e.fragment.code.add((0,l.H)(n||(n=(0,i.A)(["void main() {\nvec4 texColor = texture(tex, uv);\nfragColor = texColor * vec4(uColor, 1.0);\n}"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:h,build:u},Symbol.toStringTag,{value:"Module"}))},83755:(e,t,r)=>{function n(){return new Float32Array(3)}function i(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(e,t,r){const n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}function s(){return n()}function a(){return o(1,1,1)}function l(){return o(1,0,0)}function c(){return o(0,1,0)}function d(){return o(0,0,1)}r.d(t,{fA:()=>o,o8:()=>i,vt:()=>n});const h=s(),u=a(),p=l(),f=c(),v=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:p,UNIT_Y:f,UNIT_Z:v,ZEROS:h,clone:i,create:n,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:o,ones:a,unitX:l,unitY:c,unitZ:d,zeros:s},Symbol.toStringTag,{value:"Module"}))},60216:(e,t,r)=>{r.d(t,{E:()=>o});var n=r(9392),i=(r(9624),r(14487));function o(e,t,r){return!!(0,i.F)(e,t,s,r.spatialReference)&&(r.x=s[0],r.y=s[1],r.z=s[2],!0)}const s=(0,n.vt)()},81284:(e,t,r)=>{function n(e){return"point"===e.type}r.d(t,{v:()=>n})},82062:(e,t,r)=>{var n;r.d(t,{$:()=>n}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(n||(n={}))},49753:(e,t,r)=>{var n,i;function o(e){return null!=e&&!e.running}r.d(t,{c:()=>i,c2:()=>n,pi:()=>o}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(n||(n={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(i||(i={}))},63401:(e,t,r)=>{r.d(t,{OQ:()=>n,ny:()=>f});var n,i=r(15941),o=r(34761),s=r(13191),a=r(20664),l=r(9392),c=r(52896),d=r(14556),h=r(49753),u=r(317),p=r(98476);class f{constructor(){this.readChannels=h.c.RG,this.renderingStage=h.c2.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,l.vt)(),this.parallax=new v,this.parallaxNew=new v,this.pointOnGround=(0,l.vt)(),this.fadeMode=n.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,r=(0,a.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-d.$O.radius*d.$O.radius,0))/r,(0,c.Cr)(g,t.anchorPointClouds,m),(0,o.e$)(t.transform,s.zK,m[3],(0,c.yo)(m)),this.fadeMode===n.CROSS_FADE){const e=this.parallaxNew;(0,c.Cr)(g,e.anchorPointClouds,m),(0,o.e$)(e.transform,s.zK,m[3],(0,c.yo)(m))}}updateFading(e,t,r,n){this.isFading&&this._advanceFading(r,n),this._evaluateFading(e,t,r)}_evaluateFading(e,t,r){const i=e.relativeElevation,o=this._calculateDistanceToAnchorPoint(e);if((i>1.7*u.ni||i<-u.ni||o>A)&&this.opacity>0)this._setFade(n.HIDE,r);else if(!this.isFading)if((i>u.ni||i<-.35*u.ni||o>C)&&this.opacity>0)this._setFade(n.FADE_OUT,r);else if(i<=u.ni&&i>=-.35*u.ni&&t===p.M.IDLE&&(0,h.pi)(this.data)){if(0===this.opacity)return void this._setFade(n.FADE_IN,r);(o>w||this.renderingStage===h.c2.FADING)&&this._setFade(n.CROSS_FADE,r)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,i.qE)((e-this.startTime)/(y*t),0,1):1,this.fadeMode===n.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===n.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===n.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===n.FADE_OUT&&(this.opacity=0),this.fadeMode===n.FADE_IN&&(this.opacity=1),this.fadeMode===n.CROSS_FADE&&(this.opacity=1),this.fadeMode=n.NONE}_switchReadChannels(){const e=this.fadeMode===n.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===n.FADE_IN&&0===this.fadeFactor;this.renderingStage===h.c2.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=h.c2.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,a.n)(this.pointOnGround,e.eye),(0,a.j)(this.pointOnGround,this.pointOnGround,d.$O.radius),(0,a.l)((0,a.f)(_,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===n.CROSS_FADE&&(0===this.fadeFactor&&(0,a.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===n.FADE_IN&&0===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case n.HIDE:this.opacity=0;break;case n.FADE_OUT:this.opacity=1;break;case n.FADE_IN:this.opacity=0;break;case n.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===n.FADE_OUT||this.fadeMode===n.FADE_IN||this.fadeMode===n.CROSS_FADE}}!function(e){e[e.NONE=0]="NONE",e[e.HIDE=1]="HIDE",e[e.FADE_OUT=2]="FADE_OUT",e[e.FADE_IN=3]="FADE_IN",e[e.CROSS_FADE=4]="CROSS_FADE"}(n||(n={}));class v{constructor(){this.anchorPointClouds=(0,l.vt)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,s.vt)()}}const g=(0,l.fA)(0,0,1),m=(0,c.vt)(),_=(0,l.vt)(),y=1.25,w=34e3,C=64e3,A=2e5},317:(e,t,r)=>{r.d(t,{k9:()=>O,ni:()=>x});var n,i=r(35143),o=r(42553),s=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let c=n=class extends o.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new n({cloudCover:this.cloudCover})}};(0,i._)([(0,a.e)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=n=(0,i._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const d=c;var h;let u=h=class extends o.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,i._)([(0,a.e)({foggy:"foggy"})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],u.prototype,"fogStrength",void 0),u=h=(0,i._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],u);const p=u;var f;let v=f=class extends o.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,i._)([(0,a.e)({rainy:"rainy"})],v.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"cloudCover",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"precipitation",void 0),v=f=(0,i._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],v);const g=v;var m;let _=m=class extends o.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new m({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,i._)([(0,a.e)({snowy:"snowy"})],_.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"cloudCover",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"precipitation",void 0),(0,i._)([(0,s.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],_.prototype,"snowCover",void 0),_=m=(0,i._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],_);const y=_;var w;let C=w=class extends o.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new w({cloudCover:this.cloudCover})}};(0,i._)([(0,a.e)({sunny:"sunny"})],C.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],C.prototype,"cloudCover",void 0),C=w=(0,i._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],C);const A={key:"type",base:C,typeMap:{sunny:C,cloudy:d,rainy:g,snowy:y,foggy:p}};Object.keys(A.typeMap);const x=1e4,O=1e5},49296:(e,t,r)=>{r.d(t,{F:()=>o});var n=r(59097),i=r(41595);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,n.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,i.g7)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){var t;this.mode=e.mode,this.unit=(0,n.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=null!==(t=e.offset)&&void 0!==t?t:0}updateFeatureExpressionInfoContext(e,t,r){if(null==e)return void(this._featureExpressionInfoContext=null);const n=null===e||void 0===e?void 0:e.arcade;n&&null!=t&&null!=r?(this._featureExpressionInfoContext=(0,i.o8)(e),(0,i.gf)(this._featureExpressionInfoContext,(0,i.VG)(n.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},67425:(e,t,r)=>{r.d(t,{I2:()=>v,Kf:()=>m,Uk:()=>w,ai:()=>y,au:()=>u,fe:()=>_,nG:()=>f,nu:()=>g,sE:()=>p,uw:()=>n});var n,i=r(34761),o=r(13191),s=r(9392),a=r(5809),l=r(45308),c=r(81284),d=r(80935),h=r(66470);function u(e,t,r,n,i,o,s,a,c,d,h){const u=C[h.mode];let p,f,v=0;if((0,l.projectBuffer)(e,t,r,n,c.spatialReference,i,a))return u.requiresAlignment(h)?(v=u.applyElevationAlignmentBuffer(n,i,o,s,a,c,d,h),p=o,f=s):(p=n,f=i),(0,l.projectBuffer)(p,c.spatialReference,f,o,d.spatialReference,s,a)?v:void 0}function p(e,t,r,n,i){const o=((0,c.v)(e)?e.z:(0,d.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{var s;const r=null!==(s=(0,d.R1)(t,e,"ground"))&&void 0!==s?s:0;return i.verticalDistanceToGround=0,i.sampledElevation=r,void(i.z=r)}case"relative-to-ground":{var a;const s=null!==(a=(0,d.R1)(t,e,"ground"))&&void 0!==a?a:0,l=r.geometryZWithOffset(o,n);return i.verticalDistanceToGround=l,i.sampledElevation=s,void(i.z=l+s)}case"relative-to-scene":{var l;const s=null!==(l=(0,d.R1)(t,e,"scene"))&&void 0!==l?l:0,a=r.geometryZWithOffset(o,n);return i.verticalDistanceToGround=a,i.sampledElevation=s,void(i.z=a+s)}case"absolute-height":{var h;const s=r.geometryZWithOffset(o,n),a=null!==(h=(0,d.R1)(t,e,"ground"))&&void 0!==h?h:0;return i.verticalDistanceToGround=s-a,i.sampledElevation=a,void(i.z=s)}default:return void(i.z=0)}}function f(e,t,r,n){return p(e,t,r,n,x),x.z}function v(e,t,r){return"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?null==t||null==r?e.definedChanged:n.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function m(e){return"absolute-height"!==e}function _(e,t,r,n,o){p(t,r,o,n,x),y(e,x.verticalDistanceToGround);const s=x.sampledElevation,l=(0,i.C)(A,e.transformation);return O[0]=t.x,O[1]=t.y,O[2]=x.z,(0,a.l)(t.spatialReference,O,l,n.spatialReference)?e.transformation=l:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function y(e,t){for(let r=0;r<e.geometries.length;++r){const n=e.geometries[r].getMutableAttribute(h.r.CENTEROFFSETANDDISTANCE);n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[r],h.r.CENTEROFFSETANDDISTANCE))}}class w{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(n||(n={}));const C={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,n*=3;for(let d=0;d<i;++d){const i=e[t],o=e[t+1],s=e[t+2];r[n]=i,r[n+1]=o,r[n+2]=null==c?s+l:l,t+=3,n+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o){let s=0;const a=o.spatialReference;t*=3,n*=3;for(let c=0;c<i;++c){var l;const i=e[t],c=e[t+1],d=e[t+2],h=null!==(l=o.getElevation(i,c,d,a,"ground"))&&void 0!==l?l:0;s+=h,r[n]=i,r[n+1]=c,r[n+2]=h,t+=3,n+=3}return s/i},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),d=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,n*=3;for(let p=0;p<i;++p){var u;const i=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(i,s,a,h,"ground"))&&void 0!==u?u:0;l+=p,r[n]=i,r[n+1]=s,r[n+2]=null==d?a+p+c:p+c,t+=3,n+=3}return l/i},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,n,i,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),d=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,n*=3;for(let p=0;p<i;++p){var u;const i=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(i,s,a,h,"scene"))&&void 0!==u?u:0;l+=p,r[n]=i,r[n+1]=s,r[n+2]=null==d?a+p+c:p+c,t+=3,n+=3}return l/i},requiresAlignment:()=>!0}},A=(0,o.vt)(),x=new w,O=(0,s.vt)()},41595:(e,t,r)=>{r.d(t,{KF:()=>f,MF:()=>p,VG:()=>d,g7:()=>u,gf:()=>h,o8:()=>l,q6:()=>c});var n=r(76460),i=r(50346),o=r(32535),s=r(98976);const a=()=>n.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,r,n){const o=null===e||void 0===e?void 0:e.expression;if("string"!=typeof o)return null;const a=g(o);if(null!=a)return{cachedResult:a};const l=await(0,s.lw)();(0,i.Te)(r);const c=l.arcadeUtils,d=c.createSyntaxTree(o);return c.dependsOnView(d)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(d),context:c.createExecContext(null,{sr:t}),modules:l}}}function d(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function h(e,t){if(null!=e&&!v(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,o.wZ)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function u(e){if(null!=e){if(v(e))return e.cachedResult;const t=e.arcade;let r=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function p(e){var t,r;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null===e||void 0===e?void 0:e.featureExpressionInfo;const o=null===(t=i)||void 0===t?void 0:t.expression;return n||"0"===o||(i=null),null!==(r=i)&&void 0!==r?r:null}const f={cachedResult:0};function v(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}},36423:(e,t,r)=>{r.d(t,{$2:()=>O,$C:()=>w,Hj:()=>A,Mh:()=>x,W$:()=>g,pW:()=>C,t8:()=>y,vY:()=>S});var n=r(31633),i=r(34761),o=r(13191),s=r(9392),a=r(43047),l=r(55855),c=r(9624),d=r(42294),h=r(2413),u=r(205),p=r(5262),f=r(18117),v=r(32535);function g(e,t){if("point"===e.type)return _(e,t,!1);if((0,v.gr)(e))switch(e.type){case"extent":return _(e.center,t,!1);case"polygon":return _(e.centroid,t,!1);case"polyline":return _(m(e),t,!0);case"mesh":return _(e.origin,t,!1)}else switch(e.type){case"extent":return _(function(e){return(0,f.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return _(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=(0,u.S8)(e.rings,!!e.hasZ);return(0,f.T)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return _(m(e),t,!0)}}function m(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,p.$H)(t,(0,p.Yl)(t)/2);return(0,f.T)(r[0],r[1],r[2],e.spatialReference)}function _(e,t,r){const n=r?e:(0,v.EL)(e);return t&&e?(0,c.projectPoint)(e,n,t)?n:null:n}function y(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,h.vt)());const i=e;let o=.5*i.width*(r-1),s=.5*i.height*(r-1);return i.width<1e-7*i.height?o+=s/20:i.height<1e-7*i.width&&(s+=o/20),(0,a.s)(t,i.xmin-o-n,i.ymin-s-n,i.xmax+o+n,i.ymax+s+n),t}return null}function w(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=(0,l.o8)(l.Un);return null!=e&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),null!=t?n[3]=t:null!=e&&e.length>3&&(n[3]=e[3]),r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.Un,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const i=new Array(3);if(null==t||null==r)i[0]=1,i[1]=1,i[2]=1;else{let n,o=0;for(let s=2;s>=0;s--){const a=e[s];let l;const c=null!=a,d=0===s&&!n&&!c,h=r[s];"symbol-value"===a||d?l=0!==h?t[s]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(i[s]=l,n=l,o=Math.max(o,Math.abs(l)))}for(let e=2;e>=0;e--)null==i[e]?i[e]=n:0===i[e]&&(i[e]=.001*o)}for(let o=2;o>=0;o--)i[o]/=n;return(0,s.ci)(i)}function A(e){return x(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function x(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function O(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.vt)();return e&&(0,i.Qr)(n,n,-e/180*Math.PI),t&&(0,i.eL)(n,n,t/180*Math.PI),r&&(0,i.Z8)(n,n,r/180*Math.PI),n}function S(e,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const i=(0,n.GA)(t),o=(0,d.VL)(e)*i,s=(0,d.yr)(e)*i,a=(0,d.uJ)(e)*(t.isGeographic?1:i);return 0===o&&0===s&&0===a?r.minDemResolutionForPoints:.01*Math.max(o,s,a)}},57662:(e,t,r)=>{var n,i,o;r.d(t,{O7:()=>i,Om:()=>n,sv:()=>o}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(n||(n={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(i||(i={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},80935:(e,t,r)=>{r.d(t,{R1:()=>s,aY:()=>i,cN:()=>o});var n=r(81284);class i{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=r}}function o(e){return"array"in e}function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,n.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(o(t)){var i;let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,null!==(i=t.spatialReference)&&void 0!==i?i:e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},57481:(e,t,r)=>{r.d(t,{U:()=>o});var n=r(93345),i=r(21812);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.stride;return Array.from(e.fields.keys()).map((n=>{var o,a;const l=e.fields.get(n),c=l.constructor.ElementCount,d=s(l.constructor.ElementType),h=l.offset,u=null!==(o=null===(a=l.optional)||void 0===a?void 0:a.glNormalized)&&void 0!==o&&o;return new i._(n,c,d,h,r,u,t)}))}function s(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:n.pe.UNSIGNED_BYTE,u16:n.pe.UNSIGNED_SHORT,u32:n.pe.UNSIGNED_INT,i8:n.pe.BYTE,i16:n.pe.SHORT,i32:n.pe.INT,f32:n.pe.FLOAT}},70667:(e,t,r)=>{r.d(t,{t:()=>g,z:()=>y});var n=r(19555),i=r(72745),o=r(55855),s=r(34111),a=r(482),l=r(44815),c=r(75002),d=r(38496),h=r(64465),u=r(50468),p=r(87634),f=r(26300),v=r(66470);function g(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=[],g=t.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:n}=e,i=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&n,o=r.length/3-(i?1:0),s=new Array(2*(o-1)),a=i?r.slice(0,-3):r;let l=0;for(let c=0;c<o-1;c++)s[l++]=c,s[l++]=c+1;t.push([v.r.POSITION,new u.n(a,s,3,i)])}(t,i);const y=i[0][1].data,w=i[0][1].indices.length,C=(0,d.EH)(w);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const n=e.attributeData.color;t.push([v.r.COLOR,new u.n(null!==n&&void 0!==n?n:o.Un,r,4)])}(t,i,C),function(e,t,r){var n;null==e.attributeData.sizeFeature&&t.push([v.r.SIZE,new u.n([null!==(n=e.attributeData.size)&&void 0!==n?n:1],r,1,!0)])}(t,i,C),function(e,t,r){e.attributeData.normal&&t.push([v.r.NORMAL,new u.n(e.attributeData.normal,r,3)])}(t,i,C),function(e,t,r){null!=e.attributeData.colorFeature&&t.push([v.r.COLORFEATUREATTRIBUTE,new u.n([e.attributeData.colorFeature],r,1,!0)])}(t,i,C),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push([v.r.SIZEFEATUREATTRIBUTE,new u.n([e.attributeData.sizeFeature],r,1,!0)])}(t,i,C),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push([v.r.OPACITYFEATUREATTRIBUTE,new u.n([e.attributeData.opacityFeature],r,1,!0)])}(t,i,C),function(e,t,r){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const i=(0,l.jh)(r.length),o=(0,s.tO)(e.overlayInfo.spatialReference);for(let n=0;n<i.length;n+=3)(0,a.RC)(r,n,i,n,o);const d=r.length/3,p=(0,c.oe)(d+1);let f=m,g=_,y=0,w=0;(0,n.hZ)(f,i[w++],i[w++]),w++,p[0]=0;for(let s=1;s<d+1;++s)s===d&&(w=0),(0,n.hZ)(g,i[w++],i[w++]),w++,y+=(0,n.xg)(f,g),p[s]=y,[f,g]=[g,f];t.push([v.r.DISTANCETOSTART,new u.n(p,t[0][1].indices,1,!0)])}(t,i,y),new f.V(e,i,g,p.X.Line,r)}const m=(0,i.vt)(),_=(0,i.vt)();function y(e,t){if(null==e||0===e.length)return[];const r=[];return e.forEach((e=>{const n=e.length,i=(0,l.jh)(3*n);e.forEach(((e,t)=>{i[3*t]=e[0],i[3*t+1]=e[1],i[3*t+2]=e[2]}));const o={attributeData:{position:i,normal:t},removeDuplicateStartEnd:!1};r.push(o)})),r}},99443:(e,t,r)=>{r.d(t,{Cz:()=>i,DZ:()=>a,PV:()=>s,vO:()=>n});r(72900),r(93345),r(98433),r(96673);const n=64,i=n/2,o=i/5,s=n/o,a=.25},72900:(e,t,r)=>{r.d(t,{CN:()=>a,Q_:()=>s,ny:()=>l,sZ:()=>c});r(81806);var n=r(14522),i=r(37338),o=r(93345);const s=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;const r=d(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new i.g(r,{mipmap:!1,wrap:{s:o.pF.CLAMP_TO_EDGE,t:o.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return v(e,p(r,r,t/2))}(t,r);case"square":return function(e,t){return h(e,t,!1)}(t,r);case"cross":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!1,r)}(t,r,n);case"x":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!0,r)}(t,r,n);case"kite":return function(e,t){return h(e,t,!0)}(t,r);case"triangle":return function(e,t){return v(e,f(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,n=t/2,i=e/2,o=.8*r,s=p(i,(e-t)/2-o,Math.sqrt(o*o+n*n)),a=f(i,r,n);return v(e,((e,t)=>Math.max(a(e,t),-s(e,t))))}(t,r)}}function h(e,t,r){return r&&(t/=Math.SQRT2),v(e,((n,i)=>{let o=n-.5*e+.25,s=.5*e-i-.75;if(r){const e=(o+s)/Math.SQRT2;s=(s-o)/Math.SQRT2,o=e}return Math.max(Math.abs(o),Math.abs(s))-.5*t}))}function u(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=n,r&&(t*=Math.SQRT2);const i=.5*t;return v(e,((t,o)=>{let s,a=t-.5*e,l=.5*e-o-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),s=a>l?a>i?Math.sqrt((a-i)*(a-i)+l*l):l:l>i?Math.sqrt(a*a+(l-i)*(l-i)):a,s-=n/2,s}))}function p(e,t,r){return(n,i)=>{const o=n-e,s=i-t;return Math.sqrt(o*o+s*s)-r}}function f(e,t,r){const n=Math.sqrt(t*t+r*r);return(i,o)=>{const s=Math.abs(i-e)-r,a=o-e+t/2+.75,l=(t*s+r*a)/n,c=-a;return Math.max(l,c)}}function v(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let o=0;o<e;o++){const s=o+e*i;let a=t(o,i);a=a/e+.5,(0,n.U)(a,r,4*s)}return r}},29889:(e,t,r)=>{r.d(t,{A:()=>c,C:()=>l});var n=r(45308),i=r(44815),o=r(99785),s=r(67425),a=r(96046);function l(e,t,r,n){const a="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:h}=(0,o.oR)(l,!!e.hasZ,a,e.spatialReference),u=(0,i.jh)(c.length),p=(0,s.au)(c,e.spatialReference,0,u,0,c,0,c.length/3,t,r,n),f=null!=p;return{lines:f?d(h,c,u):[],projectionSuccess:f,sampledElevation:p}}function c(e,t){const r="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,i="polygon"===e.type?e.rings:e.paths,{position:s,outlines:l}=(0,o.oR)(i,!1,r),c=(0,n.projectBuffer)(s,e.spatialReference,0,s,t,0,s.length/3);for(let n=2;n<s.length;n+=3)s[n]=a.bi;return{lines:c?d(l,s):[],projectionSuccess:c}}function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Array;for(const{index:o,count:s}of e){if(s<=1)continue;const e=3*o,a=3*s;n.push({position:(0,i.l5)(t,3*o,3*s),mapPositions:null!=r?(0,i.l5)(r,e,a):void 0})}return n}},96046:(e,t,r)=>{r.d(t,{bi:()=>tr});var n,i=r(35143),o=r(54099),s=r(81806),a=r(87663),l=r(30726),c=r(30015),d=r(68134),h=r(41289),u=r(46053),p=r(76460),f=(r(47249),r(85842)),v=r(34761),g=r(20664),m=r(9392),_=r(64465),y=r(57662),w=r(22955),C=r(19539),A=r(2413),x=r(75507);class O{constructor(){this._extent=(0,A.vt)(),this.resolution=0,this.renderLocalOrigin=(0,x.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new S}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,A.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,A.cY)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,A.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class S{constructor(){this.extents=[(0,A.vt)(),(0,A.vt)(),(0,A.vt)()],this.numViews=0}}!function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(n||(n={}));class b{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){var e;return null!=(null===(e=this._handle)||void 0===e?void 0:e.getTexture())}dispose(){this._handle=(0,l.Gz)(this._handle)}get texture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}bind(e,t,r){var n,i,o,s,a;this._handle&&(null===(n=this._handle.fbo)||void 0===n?void 0:n.width)===t&&(null===(i=this._handle.fbo)||void 0===i?void 0:i.height)===r||(null!==(o=this._handle)&&void 0!==o&&o.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.unbindTexture(null===(s=this._handle)||void 0===s||null===(s=s.fbo)||void 0===s?void 0:s.colorTexture),e.bindFramebuffer(null===(a=this._handle)||void 0===a?void 0:a.fbo)}generateMipMap(){var e,t;(null===(e=this._handle)||void 0===e||null===(e=e.getTexture())||void 0===e||null===(e=e.descriptor)||void 0===e?void 0:e.hasMipmap)&&(null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t||t.generateMipmap())}}var T=r(16455),R=r(34981);class E{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:T.N.RGBA_MIPMAP;this.output=r,this.content=n,this.fbo=new b(e,i,t)}get valid(){return this.fbo.valid}}class D{constructor(e){this.targets=[new E(e,"overlay color",R.V.Color,n.Color),new E(e,"overlay IM color",R.V.Color,n.ColorNoRasterImage),new E(e,"overlay highlight",R.V.Highlight,n.Highlight,T.N.RGBA4),new E(e,"overlay water",R.V.Normal,n.WaterNormal),new E(e,"overlay occluded",R.V.Color,n.Occluded)],(0,s.A)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new E(e,"overlay oid",R.V.ObjectAndLayerIdColor,n.ObjectAndLayerIdColor))}getTexture(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var P,M=r(33062),I=r(55855),N=r(55386);N.Zo;!function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"}(P||(P={}));r(43557),r(26719),r(92176),r(20123),r(21390),r(64839),r(70367);var L,F=r(7223);!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(L||(L={}));F.n;(0,I.vt)();var z=r(53070),V=r(75941),j=r(99415);class H{constructor(e){this._context=e,this._perConstructorInstances=new V.O,this._frameCounter=0,this._keepAliveFrameCount=W}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;const r=t.key;let n=this._perConstructorInstances.get(e,r);if(null==n){const i=new e(this._context,t,(()=>this.release(i)));n=new U(i),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,t,r){if(null!=r){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==W&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,r))})),await Promise.all(e)}}class U{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const W=-1,B=new j.K;var G=r(60586),Z=r(86994);class k{constructor(e,t,r,n){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new V.O}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const n=e.produces.get(t);if(null===n||void 0===n||!n(r))return null;let i=this._id2glMaterialRef.get(r,e.id);if(null==i){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});i=new q(t),this._id2glMaterialRef.set(r,e.id,i)}return i.ref(),i.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,l.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&p.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class q{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,Z.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var Y=r(97583),X=r(45463),Q=(r(91417),r(13191)),J=r(72745),$=r(63401),K=r(98521),ee=r(10708),te=r(81993),re=r(83490),ne=r(77730),ie=r(10773),oe=r(4998);class se{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=ne.N.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ie.y.NONE,this.alignPixelEnabled=!1,this.decorations=re.ID.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new M.A,this._inverseViewport=(0,J.vt)(),this.oldLighting=new oe.TA,this.newLighting=new oe.TA,this._fadedLighting=new oe.TA,this._lighting=this.newLighting,this.ssr=new ae,this.multipassEnabled=!1,this.multipassTerrain=new te.h,this.multipassGeometry=new ee.U,this.hudRenderStyle=K.D.Occluded,this.cloudsFade=new $.ny,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}}class ae{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,Q.vt)()}}class le{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new M.A,this.output=R.V.Color,this.renderOccludedMask=ce,this.bindParameters=new se(t,null!=r?r.plane:null),this.bindParameters.alignPixelEnabled=!0}}const ce=X.m$.Occlude|X.m$.OccludeAndTransparent|X.m$.OccludeAndTransparentStencil;var de=r(15941),he=r(44680),ue=r(19555),pe=r(43047);let fe=class extends M.A{constructor(){super(...arguments),this._projectionMatrix=(0,Q.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,i._)([(0,u.MZ)()],fe.prototype,"_projectionMatrix",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],fe.prototype,"projectionMatrix",null),fe=(0,i._)([(0,f.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],fe);var ve,ge=r(81330),me=r(93345),_e=r(98433);!function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"}(ve||(ve={}));class ye{constructor(){this.camera=new fe,this.lightMat=(0,Q.vt)()}}class we{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Ce{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new we,this._projectionView=(0,Q.vt)(),this._projectionViewInverse=(0,Q.vt)(),this._modelViewLight=(0,Q.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,I.vt)(),this._cascades=[new ye,new ye,new ye,new ye],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,s.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,pe.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,l.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,de.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)Pe[e]=this._cascades[e];return Pe.length=this._numCascades,Pe}start(e,t,r,n,i){(0,Z.vA)(this.enabled);const{near:o,far:s}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(o,s,n),this._textureHeight=this._computeTextureHeight(e,i,n),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let c=0;c<this._numCascades;++c)this._constructCascade(c,l,a,t);this._lastOrigin=null,this.clear()}finish(){var e;(0,Z.vA)(this.enabled),null===(e=this._handle)||void 0===e||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,g.e)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,m.vt)(),(0,g.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,v.Tl)(Me,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)Ie[16*t+e]=Me[e]}}return Ie}moveSnapshot(e){var t,r;(0,Z.vA)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.detachDepth(),null!==(r=this._snapshots[e])&&void 0!==r&&r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var t,r,n;const i=null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t?void 0:t.descriptor;if(!this.enabled||!i)return;null===(r=this._snapshots[e])||void 0===r||r.release();const{width:o,height:s}=i,a=e===ve.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(o,s,a,T.N.RGBA4);const l=this._fbos.rctx;this._bindFbo();const c=l.bindTexture(null===(n=this._snapshots[e])||void 0===n?void 0:n.getTexture(),_e.g.TEXTURE_UNIT_FOR_UPDATES);l.gl.copyTexSubImage2D(me.Ap.TEXTURE_2D,0,0,0,0,0,o,s),l.bindTexture(c,_e.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(me.hn.COLOR_BUFFER_BIT|me.hn.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,r){const n=Math.min(window.devicePixelRatio,t)/e.pixelRatio,i=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,ge.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*i)),s=Math.min(this._maxTextureWidth,this._numCascades*o);return(0,ge.uT)(s/this._numCascades)}_ensureFbo(){var e,t,r,n;(null===(e=this._handle)||void 0===e||null===(e=e.fbo)||void 0===e?void 0:e.width)===this._textureWidth&&(null===(t=this._handle)||void 0===t?void 0:t.fbo.height)===this._textureHeight||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",T.N.RGBA4)),null===(n=this._handle)||void 0===n||n.acquireDepth(T.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,l.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;const t=this._fbos.rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}_constructCascade(e,t,r,n){const i=this._cascades[e],o=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],a=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),l=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);(0,Z.vA)(a<l);for(let u=0;u<8;++u){(0,pe.s)(xe,u%4==0||u%4==3?-1:1,u%4==0||u%4==1?-1:1,u<4?a:l,1);const e=Oe[u];(0,pe.t)(e,xe,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,g.k)(De,Oe[0]),i.camera.viewMatrix=(0,v.Tl)(Ae,this._modelViewLight,De);for(let u=0;u<8;++u)(0,g.h)(Oe[u],Oe[u],i.camera.viewMatrix);let c=Oe[0][2],d=Oe[0][2];for(let u=1;u<8;++u)c=Math.min(c,Oe[u][2]),d=Math.max(d,Oe[u][2]);c-=200,d+=200,i.camera.near=-d,i.camera.far=-c,function(e,t,r,n,i){const o=1/Oe[0][3],s=1/Oe[4][3];(0,Z.vA)(o<s);let a=o+Math.sqrt(o*s);const l=Math.sin((0,de.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,r,n,i,o,s,a){(0,ue.hZ)(Ne,0,0);for(let C=0;C<4;++C)(0,ue.WQ)(Ne,Ne,e[C]);(0,ue.hs)(Ne,Ne,.25),(0,ue.hZ)(Le,0,0);for(let C=4;C<8;++C)(0,ue.WQ)(Le,Le,e[C]);(0,ue.hs)(Le,Le,.25),(0,ue.Cc)(Fe[0],e[4],e[5],.5),(0,ue.Cc)(Fe[1],e[5],e[6],.5),(0,ue.Cc)(Fe[2],e[6],e[7],.5),(0,ue.Cc)(Fe[3],e[7],e[4],.5);let l=0,c=(0,ue.hG)(Fe[0],Ne);for(let C=1;C<4;++C){const e=(0,ue.hG)(Fe[C],Ne);e<c&&(c=e,l=C)}(0,ue.Re)(ze,Fe[l],e[l+4]);const d=ze[0];let h,u;ze[0]=-ze[1],ze[1]=d,(0,ue.Re)(Ve,Le,Ne),(0,ue.Om)(Ve,ze)<0&&(0,ue.ze)(ze,ze),(0,ue.Cc)(ze,ze,Ve,r),(0,ue.S8)(ze,ze),h=u=(0,ue.Om)((0,ue.Re)(je,e[0],Ne),ze);for(let C=1;C<8;++C){const t=(0,ue.Om)((0,ue.Re)(je,e[C],Ne),ze);t<h?h=t:t>u&&(u=t)}(0,ue.C)(n,Ne),(0,ue.hs)(je,ze,h-t),(0,ue.WQ)(n,n,je);let p=-1,f=1,v=0,g=0;for(let C=0;C<8;++C){(0,ue.Re)(He,e[C],n),(0,ue.S8)(He,He);const t=ze[0]*He[1]-ze[1]*He[0];t>0?t>p&&(p=t,v=C):t<f&&(f=t,g=C)}(0,Z.MX)(p>0,"leftArea"),(0,Z.MX)(f<0,"rightArea"),(0,ue.hs)(Ue,ze,h),(0,ue.WQ)(Ue,Ue,Ne),(0,ue.hs)(We,ze,u),(0,ue.WQ)(We,We,Ne),Be[0]=-ze[1],Be[1]=ze[0];const m=(0,Z.L)(n,e[g],We,(0,ue.WQ)(je,We,Be),1,i),_=(0,Z.L)(n,e[v],We,je,1,o),y=(0,Z.L)(n,e[v],Ue,(0,ue.WQ)(je,Ue,Be),1,s),w=(0,Z.L)(n,e[g],Ue,je,1,a);(0,Z.MX)(m,"rayRay"),(0,Z.MX)(_,"rayRay"),(0,Z.MX)(y,"rayRay"),(0,Z.MX)(w,"rayRay")}(Oe,a,l,Se,be,Te,Re,Ee),function(e,t,r,n,i){(0,ue.Re)(qe,r,n),(0,ue.hs)(qe,qe,.5),Ye[0]=qe[0],Ye[1]=qe[1],Ye[2]=0,Ye[3]=qe[1],Ye[4]=-qe[0],Ye[5]=0,Ye[6]=qe[0]*qe[0]+qe[1]*qe[1],Ye[7]=qe[0]*qe[1]-qe[1]*qe[0],Ye[8]=1,Ye[Ge(0,2)]=-(0,ue.Om)(ke(Ye,0),e),Ye[Ge(1,2)]=-(0,ue.Om)(ke(Ye,1),e);let o=(0,ue.Om)(ke(Ye,0),r)+Ye[Ge(0,2)],s=(0,ue.Om)(ke(Ye,1),r)+Ye[Ge(1,2)],a=(0,ue.Om)(ke(Ye,0),n)+Ye[Ge(0,2)],l=(0,ue.Om)(ke(Ye,1),n)+Ye[Ge(1,2)];o=-(o+a)/(s+l),Ye[Ge(0,0)]+=Ye[Ge(1,0)]*o,Ye[Ge(0,1)]+=Ye[Ge(1,1)]*o,Ye[Ge(0,2)]+=Ye[Ge(1,2)]*o,o=1/((0,ue.Om)(ke(Ye,0),r)+Ye[Ge(0,2)]),s=1/((0,ue.Om)(ke(Ye,1),r)+Ye[Ge(1,2)]),Ye[Ge(0,0)]*=o,Ye[Ge(0,1)]*=o,Ye[Ge(0,2)]*=o,Ye[Ge(1,0)]*=s,Ye[Ge(1,1)]*=s,Ye[Ge(1,2)]*=s,Ye[Ge(2,0)]=Ye[Ge(1,0)],Ye[Ge(2,1)]=Ye[Ge(1,1)],Ye[Ge(2,2)]=Ye[Ge(1,2)],Ye[Ge(1,2)]+=1,o=(0,ue.Om)(ke(Ye,1),t)+Ye[Ge(1,2)],s=(0,ue.Om)(ke(Ye,2),t)+Ye[Ge(2,2)],a=(0,ue.Om)(ke(Ye,1),r)+Ye[Ge(1,2)],l=(0,ue.Om)(ke(Ye,2),r)+Ye[Ge(2,2)],o=-.5*(o/s+a/l),Ye[Ge(1,0)]+=Ye[Ge(2,0)]*o,Ye[Ge(1,1)]+=Ye[Ge(2,1)]*o,Ye[Ge(1,2)]+=Ye[Ge(2,2)]*o,o=(0,ue.Om)(ke(Ye,1),t)+Ye[Ge(1,2)],s=(0,ue.Om)(ke(Ye,2),t)+Ye[Ge(2,2)],a=-s/o,Ye[Ge(1,0)]*=a,Ye[Ge(1,1)]*=a,Ye[Ge(1,2)]*=a,i[0]=Ye[0],i[1]=Ye[1],i[2]=0,i[3]=Ye[2],i[4]=Ye[3],i[5]=Ye[4],i[6]=0,i[7]=Ye[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=Ye[6],i[13]=Ye[7],i[14]=0,i[15]=Ye[8]}(Se,be,Re,Ee,i.projectionMatrix),i.projectionMatrix[10]=2/(r-n),i.projectionMatrix[14]=-(r+n)/(r-n)}(r,n,c,d,i.camera),(0,v.lw)(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);const h=this._textureHeight;i.camera.viewport=[e*h,0,h,h]}_setupMatrices(e,t){(0,v.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,v.B8)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===_.RT.Global?e.eye:(0,g.s)(De,0,0,1);(0,v.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const n=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,Z.kL)(t/e,4)),n);const i=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let s=e,a=e;for(let l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=(0,de.Cc)(s,a,this.settings.splitSchemeLambda),s*=o,a+=i}get test(){}}const Ae=(0,Q.vt)(),xe=(0,I.vt)(),Oe=[];for(let nr=0;nr<8;++nr)Oe.push((0,I.vt)());const Se=(0,J.vt)(),be=(0,J.vt)(),Te=(0,J.vt)(),Re=(0,J.vt)(),Ee=(0,J.vt)(),De=(0,m.vt)(),Pe=[],Me=(0,Q.vt)(),Ie=Q.zK.concat(Q.zK,Q.zK,Q.zK,Q.zK),Ne=(0,J.vt)(),Le=(0,J.vt)(),Fe=[(0,J.vt)(),(0,J.vt)(),(0,J.vt)(),(0,J.vt)()],ze=(0,J.vt)(),Ve=(0,J.vt)(),je=(0,J.vt)(),He=(0,J.vt)(),Ue=(0,J.vt)(),We=(0,J.vt)(),Be=(0,J.vt)();function Ge(e,t){return 3*t+e}const Ze=(0,J.vt)();function ke(e,t){return(0,ue.hZ)(Ze,e[t],e[t+3]),Ze}const qe=(0,J.vt)(),Ye=(0,he.vt)();var Xe=r(91967),Qe=r(93582),Je=r(3112),$e=r(35737);r(46571);class Ke extends $e.R6{constructor(e,t,r){super(e,t),this.triangleNr=r}}var et=r(63496),tt=r(29808),rt=r(57824),nt=r(13840),it=r(18690),ot=r(57481),st=r(50255);class at extends N.gy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.vt)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}class lt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function ct(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let n=0;n<e.length;++n){const i=e.data[n],o=t.get(i.to);if(!o)return;i.to=o.to,t.delete(o.from),e.removeUnordered(o),r=!0}}}class dt extends lt{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class ht{constructor(){this.first=0,this.count=0}}class ut{constructor(){this._numElements=0,this._instances=new Map,this.holes=new c.A({allocator:e=>e||new lt,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=pt(),this.drawCommandsHighlight=pt(),this.drawCommandsOccludees=pt(),this.drawCommandsShadowHighlightRest=pt()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=t,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const r of t)r.isVisible&&(ft(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),ft(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function pt(){return new c.A({allocator:e=>e||new ht,deallocator:e=>e})}function ft(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class vt{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var gt=r(79369);class mt{constructor(e,t){this._cache=e(t,((e,t,r)=>{switch(t){case gt.k2.ALL:return e.forEach((e=>e.dispose())),0;case gt.k2.SOME:{const t=e.shift();return t&&(r-=Math.round(t.usedMemory),t.dispose()),r}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const r=t.pop();if(t.length>0){if(r){const n=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,t,n)}}else this._cache.pop(e);return r}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:gt.Cn;const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[t],t.usedMemory,r);n.push(t);const i=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,n,i)}}var _t=r(69008),yt=r(76718);class wt{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=new mt(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let r=this._cache.pop(t);return r||(r=new _t.Z(this._rctx,this._locations,{geometry:this._layout},{geometry:yt.g.createVertex(this._rctx,me._U.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}let Ct=class extends G.Ot{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=(0,l.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,l.WD)(this._vaoCache)}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==R.V.Highlight&&t!==R.V.ShadowHighlight||this._hasHighlights))&&e(t)))}))}get produces(){return this._produces}initializeRenderContext(e,t){const{rctx:r}=e.renderContext;this._glMaterials=new st.c(this.material,null!==t&&void 0!==t?t:e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new wt(r,this.material.vertexAttributeLocations,(0,ot.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const r=t.vertexBufferLayout.stride/4;for(const n of e){const e=n.renderGeometry,i=this._dataByOrigin.get(e.localOrigin.id),o=null===i||void 0===i?void 0:i.findBuffer(e.id);if(null==o)return;const s=o.instances.get(e.id);if(n.updateType&(rt.k.GEOMETRY|rt.k.TRANSFORMATION)){const n=Nt(t.elementCount(s.geometry.geometry)*r),i=t.vertexBufferLayout.createView(n.buffer);this._writeGeometry(e,i,0),o.vao.vertexBuffers.geometry.setSubData(n,s.from*r,0,s.numElements*r)}n.updateType&(rt.k.HIGHLIGHT|rt.k.OCCLUDEE|rt.k.VISIBILITY)&&(o.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new V.O;for(const n of e){const e=n.localOrigin;if(null==e)continue;let t=r.get(e.id,null);null==t&&(t=new At(e.vec3),r.set(e.id,null,t)),t.changes.push(n)}for(const n of t){const e=n.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),i=null===t||void 0===t?void 0:t.findBuffer(n.id);if(null==i)continue;let o=r.get(e.id,i);null==o&&(o=new At(e.vec3),r.set(e.id,i,o)),o.changes.push(n)}return r}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:n}=this,i=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const s=e.get(null),a=null!=s?s.changes:[];o.delete(t,null);let l=n.get(t);if(e.forEach(((e,s)=>{if(o.delete(t,s),null==s)return void(0,Z.vA)(!1,"No VAO for removed geometries");if(s.instances.size===e.changes.length)return this._vaoCache.deleteVao(s.vao),(0,it.Xy)(l.buffers,s),void(0===l.buffers.length&&0===a.length&&n.delete(t));const c=s.numElements,d=s.vao.byteSize/4,h=a.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),u=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),p=Math.min((c+h-u)*i,Mt),f=p>d;p>Rt&&p<d/2?(e.changes.forEach((e=>{let{id:t}=e;return s.deleteInstance(t)})),s.instances.forEach((e=>{let{geometry:t}=e;return a.push(t)})),this._vaoCache.deleteVao(s.vao),(0,it.Xy)(l.buffers,s)):f?this._applyAndRebuild(s,a,e):this._applyRemoves(s,e)})),a.length>0)for(null==l&&(l=new vt(s.origin),n.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new ut,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,a.Bs)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(null!=r)for(const p of r.changes)e.deleteInstance(p.id);const n=this._bufferWriter,i=n.vertexBufferLayout.stride,o=i/4,s=Math.floor(Mt/o);let a=e.numElements;for(;t.length>0;){const r=t.pop(),i=n.elementCount(r.geometry);if(a+i>s&&a>0){t.push(r);break}a+=i;const o=new dt(r,0,0);(0,Z.vA)(null==e.instances.get(r.id)),e.addInstance(r.id,o)}const l=a*o,c=Nt(l),d=n.vertexBufferLayout.createView(c.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,d,h);const i=h;h+=n.elementCount(t.geometry.geometry),e.updateInstance(r,i,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Lt(l)),e.vao.vertexBuffers.geometry.setSubData(c,0,0,h*o),e.holes.clear();const u=e.holes.pushNew();return u.from=h,u.to=Math.floor(e.vao.byteSize/i),e.updateDrawCommands(i),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const s of t.changes){const t=s.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const n=Tt.back();if(n){if(n.to===r.from){n.to=r.to;continue}if(n.from===r.to){n.from=r.from;continue}}const i=Tt.pushNew();i.from=r.from,i.to=r.to}ct(Tt);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=Tt.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,i=Nt(n);i.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;Tt.forAll((e=>o.setSubData(i,e.from*r,0,e.numElements*r))),e.holes.pushArray(Tt.data,Tt.length),Tt.forAll(((e,t)=>Tt.data[t]=null)),Tt.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,i=e.numElements,o=t.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),s=Math.min((i+o)*n,Mt),a=4*s;if(e.vao.byteSize<Lt(Mt-Rt)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);ct(e.holes);const l=new Array;for(const g of t){const t=r.elementCount(g.geometry),n=xt(e.holes,t);l.push(n)}const c=e.vao.vertexBuffers.geometry;let d=0,h=0,u=0;const p=Nt(s),f=r.vertexBufferLayout.createView(p.buffer);t.forEach(((t,i)=>{const o=l[i];if(null==o)return;if(u!==o){const e=u-h;e>0&&c.setSubData(p,h*n,0,e*n),h=o,d=0}const s=r.elementCount(t.geometry);this._writeGeometry(t,f,d),d+=s,u=o+s;const a=new dt(t,o,o+s);(0,Z.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const v=u-h;v>0&&c.setSubData(p,h*n,0,v*n),(0,it.$i)(t,((e,t)=>null==l[t]))}_writeGeometry(e,t,r){if(null===this._bufferWriter)return;const n=e.localOrigin.vec3;(0,Z.M_)(Ot,-n[0],-n[1],-n[2]);const i=(0,v.lw)(St,Ot,e.transformation);(0,v.B8)(bt,i),(0,v.mg)(bt,bt),this._bufferWriter.write(i,bt,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:r}=e,n=this.material.produces.get(r.slot);if(null===n||void 0===n||!n(t))return null;const i=t===R.V.Highlight||t===R.V.ShadowHighlight;if(i&&!this._hasHighlights)return null;const o=t===R.V.ShadowExcludeHighlight,s=!(i||o);for(const a of this._dataByOrigin.values())for(const n of a.buffers){if(i&&!n.hasHighlights)continue;const a=(i?n.drawCommandsHighlight:o&&n.needsMultipleCommands()?n.drawCommandsShadowHighlightRest:n.drawCommandsDefault)||null,l=s&&n.drawCommandsOccludees||null;if(null!==a&&void 0!==a&&a.length||null!==l&&void 0!==l&&l.length){const n=this._glMaterials.load(e.rctx,r.slot,t),i=null!=n?n.beginSlot(r):null;if(null!=i)return i}}return null}renderNode(e,t){const{output:r,bindParameters:n}=e,i=r===R.V.Highlight||r===R.V.ShadowHighlight,o=r===R.V.ShadowExcludeHighlight,s=!(i||o),a=n.slot===ne.N.OCCLUDER_MATERIAL,l=n.slot===ne.N.TRANSPARENT_OCCLUDER_MATERIAL,c=e.rctx;c.runAppleAmdDriverHelper(),c.bindTechnique(t,n,this.material.parameters);for(const d of this._dataByOrigin.values())for(const e of d.buffers){if(i&&!e.hasHighlights)continue;const r=(i?e.drawCommandsHighlight:o&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,h=s&&e.drawCommandsOccludees||null;(null!==r&&void 0!==r&&r.length||null!==h&&void 0!==h&&h.length)&&(t.program.bindDraw(new at(d.origin),n,this.material.parameters),t.ensureAttributeLocations(e.vao),c.bindVAO(e.vao),null!==r&&void 0!==r&&r.length&&(c.setPipelineState(t.getPipeline(!1,a,l)),r.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))),(null===h||void 0===h?void 0:h.length)&&(c.setPipelineState(t.getPipeline(!0,a,l)),h.forAll((e=>c.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){}};(0,i._)([(0,u.MZ)({constructOnly:!0})],Ct.prototype,"material",void 0),Ct=(0,i._)([(0,f.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],Ct);class At{constructor(e){this.origin=e,this.changes=new Array}}function xt(e,t){let r;if(!e.some((e=>!(e.numElements<t)&&(r=e,!0))))return null;const n=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),n}const Ot=(0,Q.vt)(),St=(0,Q.vt)(),bt=(0,Q.vt)(),Tt=new c.A({allocator:e=>e||new lt,deallocator:null}),Rt=65536,Et=4*Rt,Dt=1024,Pt=16777216,Mt=Pt/4;let It=new Float32Array(Rt);function Nt(e){return It.length<e&&(It=new Float32Array(e)),It}function Lt(e){const t=4*e;return t<=Dt?Dt:t<Et?(0,de.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/Et)*Et,Pt),t)}let Ft=class extends Xe.A{constructor(e){super(e),this._pending=new zt,this._changes=new et.VR,this._materialRenderers=new Map,this._sortedMaterialRenderers=new c.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return(0,a.Bs)(this._materialRenderers,(e=>0!==e.numGeometries&&!e.queryRenderOccludedState(X.m$.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,nt.$T)(this._changes);let t=!1;return e.forEach(((e,r)=>{let n=this.getMaterialRenderer(r);if(!n&&e.adds.length>0){const e=new Ct({material:r});e.initializeRenderContext(this.rendererContext.pluginContext,this._materials),n=e,this._materialRenderers.set(r,n),t=!0}n&&(n.modify(e),0===n.numGeometries&&(this._materialRenderers.delete(r),n.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,a.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(ne.N.DRAPED_MATERIAL);return!!t&&t(R.V.Highlight)})),this._hasWater=(0,a.Bs)(this._materialRenderers,(e=>{const t=e.produces.get(ne.N.DRAPED_WATER);return!!t&&t(R.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const i of r)this._geometries.set(i.id,i);const n=this._pending.empty;for(const i of r)this._pending.adds.add(i);n&&this.notifyChange("updating"),t===rt.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,n=this._pending.adds;for(const i of e)n.has(i)?(this._pending.removed.add(i),n.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i),this._geometries.delete(i.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===rt.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const n of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(n),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case rt.k.TRANSFORMATION:case rt.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case rt.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const r=t.prepareTechnique(e);null!=r&&t.renderNode(e,r)}))}intersect(e,t,r,n,i){return this._geometries.forEach((o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,r,t,0,e,i);const s=this.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&this._intersectRenderGeometry(o,r,t,s.range,e,i),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&this._intersectRenderGeometry(o,r,t,-s.range,e,i)),i++})),i}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const t of this._materialRenderers.values())t.drapedPriority=e++,this._sortedMaterialRenderers.push(t);this._sortedMaterialRenderers.sort(((e,t)=>{var r,n,i,o;return(null===(r=t.materialReference)||void 0===r?void 0:r.renderPriority)===(null===(n=e.materialReference)||void 0===n?void 0:n.renderPriority)?e.drapedPriority-t.drapedPriority:((null===(i=t.materialReference)||void 0===i?void 0:i.renderPriority)||0)-((null===(o=e.materialReference)||void 0===o?void 0:o.renderPriority)||0)}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,n,i,o){if(!e.visible)return;let s=0;n+=e.transformation[12],s=e.transformation[13],Vt[0]=r[0]-n,Vt[1]=r[1]-s,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,i,Vt,((r,n,s)=>{!function(e,t,r,n,i,o,s){const a=new Ke(o,s,t),l=t=>{t.set(Je.dz.OVERLAY,a,e.dist,e.normal,e.transformation,r,n)};if((null==i.results.min.drapedLayerOrder||r>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&l(i.results.min),i.options.store!==Je.oH.MIN&&(null==i.results.max.drapedLayerOrder||r<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&l(i.results.max),i.options.store===Je.oH.ALL){const e=(0,tt.G7)(i.ray);l(e),i.results.all.push(e)}}(t,s,o,e.material.renderPriority,i,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,Qe.g)(e.boundingSphere))),e}get test(){}};(0,i._)([(0,u.MZ)()],Ft.prototype,"drapeSource",void 0),(0,i._)([(0,u.MZ)()],Ft.prototype,"updating",null),(0,i._)([(0,u.MZ)()],Ft.prototype,"rctx",null),(0,i._)([(0,u.MZ)({constructOnly:!0})],Ft.prototype,"rendererContext",void 0),(0,i._)([(0,u.MZ)()],Ft.prototype,"_materials",null),(0,i._)([(0,u.MZ)()],Ft.prototype,"_localOriginFactory",null),(0,i._)([(0,u.MZ)({readOnly:!0})],Ft.prototype,"isEmpty",null),(0,i._)([(0,u.MZ)()],Ft.prototype,"_materialRenderers",void 0),(0,i._)([(0,u.MZ)()],Ft.prototype,"_geometries",void 0),Ft=(0,i._)([(0,f.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ft);class zt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const Vt=(0,J.vt)();var jt=r(16506),Ht=r(42693),Ut=r(32119),Wt=r(28584),Bt=r(57162);class Gt extends Ht.w{initializeProgram(e){return new Wt.B(e.rctx,Gt.shader.get().build(),Ut.D)}initializePipeline(){return this.configuration.hasAlpha?(0,Bt.Ey)({blending:(0,Bt.p3)(me.dn.SRC_ALPHA,me.dn.ONE,me.dn.ONE_MINUS_SRC_ALPHA,me.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Bt.wE}):(0,Bt.Ey)({colorWrite:Bt.wE})}}Gt.shader=new jt.$(z.a,(()=>r.e(2553).then(r.bind(r,62553))));class Zt extends j.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,i._)([(0,j.W)()],Zt.prototype,"hasAlpha",void 0);var kt=r(44513),qt=r(71011),Yt=r(80381);class Xt extends Ht.w{initializeProgram(e){return new Wt.B(e.rctx,Xt.shader.get().build(),Ut.D)}initializePipeline(){return(0,Bt.Ey)({blending:(0,Bt.ox)(me.dn.ONE,me.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Bt.wE})}}Xt.shader=new jt.$(Yt.a,(()=>r.e(1747).then(r.bind(r,71747))));var Qt=r(59752),Jt=r(96673);let $t=class extends G.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Yt.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new c.A,this._passParameters=new z.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new M.A,this.worldToPCSRatio=1,this.events=new o.A,this.longitudeCyclical=null,this.produces=new Map([[ne.N.DRAPED_MATERIAL,e=>e!==R.V.Highlight||this.hasHighlights],[ne.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextures:r,stippleTextures:n,markerTextures:i}=t;this._techniques=new H({rctx:this._rctx,viewingMode:_.RT.Local,stippleTextures:n,markerTextures:i,waterTextures:r}),this._renderContext=new le(this._rctx,new Ce(e,this.view.state.viewingMode),null),this.addHandles([(0,d.wB)((()=>r.updating),(()=>this.events.emit("content-changed")),d.pc),(0,d.wB)((()=>this.spatialReference),(e=>this._localOriginFactory=new Y.g(e)),d.pc),(0,d.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materials=new k(t.textures,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=ne.N.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ie.y.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new qt.$p((0,m.fA)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(Qt.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,l.Gz)(this._debugTextureTechnique),this._passParameters.texture=(0,l.WD)(this._passParameters.texture),this._techniques=(0,l.pR)(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,a.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Ft)}createDrapeSourceRenderer(e,t,r){const n=this._renderers.get(e);null!=n&&n.destroy();const i=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,i),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,d.wB)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),i}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}releaseRenderTargets(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}get overlays(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,h.bw)(e,(e=>e.drapeTargetType===y.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,h.bw)(e,(e=>e.drapeSourceType===y.Om.Features)),this._hasDrapedRasterSource=(0,h.bw)(e,(e=>e.drapeSourceType===y.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new D(this.view._stage.renderer.fboCache),this._overlays=[new O,new O]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,l.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;if(null!=e)return e===n.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture(n.Color):null===(r=this._renderTargets)||void 0===r?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[n,i]of this._renderers){if(e.done)break;(n.destroyed||t(n))&&i.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,a.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Qt.Bb,(e=>e.updatePolicy===kt.q.SYNC))}get isEmpty(){return!w.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,a.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=rr;const t=this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}));return this._renderContext.renderOccludedMask=e,t}renders(e){return w.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==n.Occluded||this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}))}get mode(){var e,t;return this.isEmpty?L.Disabled:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture(n.WaterNormal)?L.EnabledWithWater:null!==(t=this._renderTargets)&&void 0!==t&&t.getTexture(n.Color)?L.Enabled:L.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets){if(t.content===n.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(C.vr.INNER,t,e),i=this._drawTarget(C.vr.OUTER,t,e);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const i=this._overlays[e],o=i.canvasGeometries;if(0===o.numViews)return!1;const{alignPixelEnabled:s,contentPixelRatio:a}=r;this._screenToWorldRatio=a*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=t.output;if(this.isEmpty||l===R.V.Highlight&&!this.hasHighlights||l===R.V.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=i.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===R.V.Normal?ne.N.DRAPED_WATER:ne.N.DRAPED_MATERIAL,t.content===n.Occluded&&(this._renderContext.renderOccludedMask=rr),!this.renders(t.content))return this._renderContext.renderOccludedMask=ce,!1;const d=i.resolution;this._rctx.setViewport(e===C.vr.INNER?0:d,0,d,d);const h=2*i.resolution,u=i.resolution,p=t.fbo;if(p.bind(c,h,u),e===C.vr.INNER&&(c.setClearColor(0,0,0,0),c.clear(me.hn.COLOR_BUFFER_BIT)),w.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==n.Occluded)for(let n=0;n<o.numViews;n++)this._setViewParameters(o.extents[n],i),this._ensureDebugPatternResources(i.resolution,er[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((r=>{let{drapeSource:s,renderer:a}=r;if(t.content===n.ColorNoRasterImage&&s.drapeSourceType===y.Om.RasterImage)return;const{fullOpacity:d}=s,f=null!=d&&d<1&&l===R.V.Color?this.bindTemporaryFramebuffer(h,u):null;for(let e=0;e<o.numViews;e++)this._setViewParameters(o.extents[e],i),a.render(this._renderContext);if(f){p.bind(c,h,u),this._overlayParameters.texture=f.getTexture(),this._overlayParameters.opacity=d,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniques.acquire(Xt);this._rctx.bindTechnique(t,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),t.release(),f.release()}})),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=ce,!0}bindTemporaryFramebuffer(e,t){var r;const n=this.view._stage.renderer.fboCache,i=n.acquire(e,t,"overlay tmp");return n.rctx.unbindTexture(null===(r=i.fbo)||void 0===r?void 0:r.colorTexture),n.rctx.bindFramebuffer(i.fbo),n.rctx.clear(me.hn.COLOR_BUFFER_BIT),i}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,n){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let i=0;for(const{renderer:a}of this._sortedRenderers){var o,s;i=null!==(o=null===(s=a.intersect)||void 0===s?void 0:s.call(a,e,t,r,n,i))&&void 0!==o?o:i}}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((r,n)=>{var i;const o=e.indexOf(n.layer),s=o>=0,a=null!==(i=n.renderGroup)&&void 0!==i?i:s?y.O7.MapLayer:y.O7.ViewLayer,l=t*a+(s?o:0);this._sortedRenderers.push(new Kt(n,r,l))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,v.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,v.kN)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,a.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,t){if((0,g.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let n=0;for(let s=0;s<e;s++)for(let t=0;t<e;t++){const i=Math.floor(t/10),o=Math.floor(s/10);i<2||o<2||10*i>e-20||10*o>e-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&i&&1&o?1&t^1&s?0:255:1&i^1&o?0:128)}const i=new Jt.R(e);i.samplingMode=me.Cj.NEAREST,this._passParameters.texture=new _e.g(this._rctx,i,r);const o=new Zt;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Gt,o)}get test(){}};(0,i._)([(0,u.MZ)()],$t.prototype,"hasHighlights",void 0),(0,i._)([(0,u.MZ)()],$t.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,i._)([(0,u.MZ)()],$t.prototype,"_techniques",void 0),(0,i._)([(0,u.MZ)({constructOnly:!0})],$t.prototype,"view",void 0),(0,i._)([(0,u.MZ)()],$t.prototype,"worldToPCSRatio",void 0),(0,i._)([(0,u.MZ)()],$t.prototype,"spatialReference",void 0),(0,i._)([(0,u.MZ)({type:Boolean,readOnly:!0})],$t.prototype,"updating",null),(0,i._)([(0,u.MZ)()],$t.prototype,"isEmpty",null),(0,i._)([(0,u.MZ)({readOnly:!0})],$t.prototype,"rendersOccludedDraped",null),$t=(0,i._)([(0,f.$)("esri.views.3d.terrain.OverlayRenderer")],$t);class Kt{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const er=[[1,.5,.5],[.5,.5,1]],tr=-2,rr=X.m$.OccludeAndTransparent},19539:(e,t,r)=>{var n,i,o,s;r.d(t,{vr:()=>n}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(n||(n={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(i||(i={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(s||(s={}))},3838:(e,t,r)=>{r.d(t,{s:()=>m});var n,i,o,s,a,l,c=r(57528),d=r(66763),h=r(5517),u=r(21390),p=r(60205),f=r(64839),v=r(66470);const g=8;function m(e,t){const r=e.vertex;r.uniforms.add(new u.m("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(v.r.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new h.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new h.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new h.t("vvSizeOffset",(e=>e.vvSize.offset)),new h.t("vvSizeFactor",(e=>e.vvSize.factor))),r.code.add((0,f.H)(n||(n=(0,c.A)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(v.r.SIZE,"float"),r.code.add((0,f.H)(i||(i=(0,c.A)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(v.r.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new p.x("vvOpacityValues",(e=>e.vvOpacity.values),g),new p.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),g)),r.code.add((0,f.H)(o||(o=(0,c.A)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):r.code.add((0,f.H)(s||(s=(0,c.A)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.include(d.A,t),e.attributes.add(v.r.COLORFEATUREATTRIBUTE,"float"),r.code.add((0,f.H)(a||(a=(0,c.A)(["vec4 getColor(){\nreturn applyOpacity(interpolateVVColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(v.r.COLOR,"vec4"),r.code.add((0,f.H)(l||(l=(0,c.A)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},98720:(e,t,r)=>{r.d(t,{K:()=>l});var n,i,o=r(57528),s=r(53736),a=r(64839);function l(e){e.uniforms.add(new s.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add((0,a.H)(n||(n=(0,o.A)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])))),e.code.add((0,a.H)(i||(i=(0,o.A)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))))}},40318:(e,t,r)=>{r.d(t,{Q:()=>y,R:()=>_});var n,i,o,s,a,l,c,d=r(57528),h=r(25530),u=r(69817),p=r(42451),f=r(58350),v=r(21390),g=r(64839),m=r(66470);const _=.5;function y(e,t){e.include(u.Y6),e.attributes.add(m.r.POSITION,"vec3"),e.attributes.add(m.r.NORMAL,"vec3"),e.attributes.add(m.r.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,p.NB)(r,t),(0,p.yu)(r,t),r.uniforms.add(new f.E("viewport",((e,t)=>t.camera.fullViewport)),new v.m("polygonOffset",(e=>e.shaderPolygonOffset)),new v.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,h.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add((0,g.H)(n||(n=(0,d.A)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),r.code.add((0,g.H)(i||(i=(0,d.A)(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = ",";\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is\n      // dropped is instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])),t.multipassEnabled?g.H.float(0):(0,g.H)(o||(o=(0,d.A)(["sign(pointGroundDistance)"]))))),t.draped&&!t.hasVerticalOffset||(0,p.S7)(r),t.draped||(r.uniforms.add(new v.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add((0,g.H)(s||(s=(0,d.A)(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * ",";\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])),g.H.float(_)))),t.screenCenterOffsetUnitsEnabled&&(0,p.Nz)(r),t.hasScreenSizePerspective&&(0,u.OH)(r),r.code.add((0,g.H)(a||(a=(0,d.A)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      vec3 centerOffset = centerOffsetAndDistance.xyz;\n      float pointGroundDistance = centerOffsetAndDistance.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.hasVerticalOffset?(0,g.H)(l||(l=(0,d.A)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled?"":(0,g.H)(c||(c=(0,d.A)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))),t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""))}},38280:(e,t,r)=>{r.d(t,{I:()=>d});var n,i,o,s=r(57528),a=r(98720),l=r(81993),c=r(64839);function d(e,t){const{vertex:r,fragment:d}=e;r.include(a.K),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add((0,c.H)(n||(n=(0,s.A)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassEnabled?"depth = projectAux.posView.z;":"")),e.include(l.Q,t),d.code.add((0,c.H)(i||(i=(0,s.A)(["\n  void main() {\n    fragColor = vec4(1);\n    ","\n  }\n  "])),t.multipassEnabled?(0,c.H)(o||(o=(0,s.A)(["\n        if(terrainDepthTest(depth)) {\n          fragColor.g = 0.5;\n        }"]))):""))}},98521:(e,t,r)=>{var n;r.d(t,{D:()=>n}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(n||(n={}))},62374:(e,t,r)=>{r.d(t,{y:()=>h});var n,i=r(57528),o=r(98720),s=r(98521),a=r(58350),l=r(21390),c=r(64839),d=r(70367);function h(e){e.vertex.uniforms.add(new l.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===s.D.Occluded?1:t.hudRenderStyle===s.D.NotOccluded?0:.75)),new a.E("viewport",((e,t)=>t.camera.fullViewport)),new d.N("hudVisibilityTexture",((e,t)=>{var r;return null===(r=t.hudVisibility)||void 0===r?void 0:r.getTexture()}))),e.vertex.include(o.K),e.vertex.code.add((0,c.H)(n||(n=(0,i.A)(["bool testHUDVisibility(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}},32925:(e,t,r)=>{r.d(t,{v:()=>l,z:()=>a});var n,i,o=r(57528),s=r(64839);function a(e){e.fragment.code.add((0,s.H)(n||(n=(0,o.A)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,s.H)(i||(i=(0,o.A)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},56906:(e,t,r)=>{r.d(t,{q:()=>S,h:()=>b});var n=r(57528),i=r(81449),o=r(42451),s=r(58350),a=r(21390),l=r(64839),c=r(70367);r(14522),r(93345),r(98433),r(96673);function d(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=d(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function u(e){return d(e).reduce(((e,t)=>Math.max(e,t)))}var p=r(43047),f=r(55855);const v=(0,f.vt)();var g,m,_,y,w,C,A,x,O;function S(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:d,fragment:h}=e;h.include(i.W),t.draped||((0,o.yu)(d,t),d.uniforms.add(new a.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),d.code.add((0,l.H)(g||(g=(0,n.A)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),d.code.add((0,l.H)(m||(m=(0,n.A)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),T)),d.code.add((0,l.H)(_||(_=(0,n.A)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),d.code.add((0,l.H)(y||(y=(0,n.A)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),r?"patternLength":"1e4")),(0,o.Nz)(d),d.code.add((0,l.H)(w||(w=(0,n.A)(["float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\nfloat flooredRepetitions = max(1.0, floor(repetitions + 0.5));\nfloat segmentLengthScreenRounded = flooredRepetitions * patternLength;\nfloat stretch = repetitions / flooredRepetitions;\nvStipplePatternStretch = max(0.75, stretch);\nreturn vec2(0.0, segmentLengthScreenRounded);\n}\nreturn vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n}"])))),h.uniforms.add(new c.N("stipplePatternTexture",(e=>e.stippleTexture)),new a.m("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*(u(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new a.m("stipplePatternPixelSizeInv",(e=>1/b(e)))),h.code.add((0,l.H)(C||(C=(0,n.A)(["float getStippleSDF(out bool isClamped) {\nfloat stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\nvec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\nisClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;\nfloat u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;\nu = fract(u);\nfloat encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));\nfloat sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\nreturn (sdf - 0.5) * vStipplePatternStretch + 0.5;\n}\nfloat getStippleSDF() {\nbool ignored;\nreturn getStippleSDF(ignored);\n}\nfloat getStippleAlpha() {\nbool isClamped;\nfloat stippleSDF = getStippleSDF(isClamped);\nfloat antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);\nreturn isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n}"])))),t.stippleOffColorEnabled?(h.uniforms.add(new s.E("stippleOffColor",(e=>function(e){return null==e?f.uY:4===e.length?e:(0,p.s)(v,e[0],e[1],e[2],1)}(e.stippleOffColor)))),h.code.add((0,l.H)(A||(A=(0,n.A)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):h.code.add((0,l.H)(x||(x=(0,n.A)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,l.H)(O||(O=(0,n.A)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function b(e){const t=e.stipplePattern;return t?h(e.stipplePattern)/t.pixelRatio:1}const T=l.H.float(.4)},17698:(e,t,r)=>{r.d(t,{r:()=>h});var n,i,o=r(57528),s=r(99443),a=r(42451),l=r(21390),c=r(64839),d=r(50125);function h(e,t){const{vertex:r,constants:h}=e;h.add("markerSizePerLineWidth","float",s.PV),(0,a.Nz)(r),null==r.uniforms.get("markerScale")&&r.constants.add("markerScale","float",1),r.code.add((0,c.H)(n||(n=(0,o.A)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===d.lM.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new l.m("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),r.code.add((0,c.H)(i||(i=(0,o.A)(["bool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}\nfloat getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}"])))))}},10708:(e,t,r)=>{r.d(t,{H:()=>l,U:()=>c});var n,i=r(57528),o=r(65058),s=r(64839),a=r(70367);function l(e){e.include(o.E),e.uniforms.add(new a.N("geometryDepthTexture",((e,t)=>{var r;return null===(r=t.multipassGeometry.depth)||void 0===r?void 0:r.attachment}))),e.code.add((0,s.H)(n||(n=(0,i.A)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}class c{}},92176:(e,t,r)=>{r.d(t,{E:()=>Z});var n,i=r(57528),o=r(32925),s=r(64839);function a(e){e.fragment.code.add((0,s.H)(n||(n=(0,i.A)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var l,c=r(42953),d=r(48353),h=r(65058),u=r(95756),p=r(21390),f=r(43425),v=r(70367);function g(e,t){const r=e.fragment;r.include(h.E),r.uniforms.add(new u.G("nearFar",((e,t)=>t.camera.nearFar))),r.uniforms.add(new v.N("depthMap",((e,t)=>{var r;return null===(r=t.depth)||void 0===r?void 0:r.attachment}))),r.uniforms.add(new f.X("proj",((e,t)=>t.camera.projectionMatrix))),r.uniforms.add(new p.m("invResolutionHeight",((e,t)=>1/t.camera.height))),r.uniforms.add(new f.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),r.code.add((0,s.H)(l||(l=(0,i.A)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var m,_,y,w,C,A,x,O,S,b,T,R,E,D,P,M,I=r(15941),N=r(14556),L=r(49753),F=r(63401),z=r(317),V=r(43557),j=r(53736),H=r(5517),U=r(7223),W=r(24245);class B extends U.n{constructor(e,t){super(e,"samplerCube",W.c.Pass,((r,n,i)=>r.bindTexture(e,t(n,i))))}}function G(e){const t=e.fragment;t.uniforms.add(new f.X("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new f.X("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new H.t("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new H.t("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new p.m("cloudsHeight",(()=>z.k9)),new p.m("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new p.m("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new p.m("crossFadeAnchorFactor",((e,t)=>(0,I.qE)(t.cloudsFade.fadeFactor,0,1))),new B("cubeMap",((e,t)=>{var r,n;return null!==(r=null===(n=t.cloudsFade.data)||void 0===n||null===(n=n.cubeMap)||void 0===n?void 0:n.colorTexture)&&void 0!==r?r:null})),new j.e("crossFade",((e,t)=>t.cloudsFade.fadeMode===F.OQ.CROSS_FADE)),new j.e("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===L.c.RG)),new j.e("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===L.c2.FADING))),t.constants.add("planetRadius","float",N.$O.radius),t.code.add((0,s.H)(m||(m=(0,i.A)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,s.H)(_||(_=(0,i.A)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,s.H)(y||(y=(0,i.A)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,V.Gc)(t),(0,V.O4)(t),t.code.add((0,s.H)(w||(w=(0,i.A)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,s.H)(C||(C=(0,i.A)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = texture(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,s.H)(A||(A=(0,i.A)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,s.H)(x||(x=(0,i.A)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,s.H)(O||(O=(0,i.A)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}function Z(e,t){e.include(c.f,t),e.include(a),e.include(o.v),t.hasCloudsReflections&&e.include(G,t),t.hasScreenSpaceReflections&&e.include(g,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",d.O).add("ssrHeightFadeEnd","float",d.b).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add((0,s.H)(S||(S=(0,i.A)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),r.uniforms.add(new p.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new p.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add((0,s.H)(b||(b=(0,i.A)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&r.code.add((0,s.H)(T||(T=(0,i.A)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(r.uniforms.add(new f.X("view",((e,t)=>t.camera.viewMatrix)),new v.N("lastFrameColorTexture",((e,t)=>{var r;return null===(r=t.ssr.lastFrameColor)||void 0===r?void 0:r.getTexture()})),new p.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),r.code.add((0,s.H)(R||(R=(0,i.A)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):r.code.add((0,s.H)(E||(E=(0,i.A)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add((0,s.H)(D||(D=(0,i.A)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):r.code.add((0,s.H)(P||(P=(0,i.A)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):r.code.add((0,s.H)(M||(M=(0,i.A)(["return waterRenderedColor;\n}"]))))}},60586:(e,t,r)=>{r.d(t,{B7:()=>s,Ot:()=>c,RW:()=>l,S:()=>d});var n=r(91967),i=r(34981);const o={required:[]},s={required:[i.V.Depth]};class a extends n.A{consumes(){return o}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}}class l extends a{}class c extends a{constructor(){super(...arguments),this.drapedPriority=0}}class d extends a{}},63496:(e,t,r)=>{r.d(t,{VR:()=>i,a0:()=>s});var n=r(30015);class i{constructor(){this.adds=new n.A,this.removes=new n.A,this.updates=new n.A({allocator:e=>e||new o,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class o{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},50255:(e,t,r)=>{r.d(t,{c:()=>i});var n=r(83490);class i{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const i=this._material.produces.get(t);if(null===i||void 0===i||!i(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const o=this._map.get(r);if(null!=o){if(o.ensureResources(e)===n.Am.LOADED)return o;this._repository.requestRender()}return null}}},62577:(e,t,r)=>{r.d(t,{zC:()=>ne,C1:()=>S,EE:()=>Q,nW:()=>J,td:()=>D,_B:()=>te,Nq:()=>K,DJ:()=>q,uX:()=>k,Z8:()=>ee,CM:()=>Z,Gj:()=>X,Ho:()=>G,Nb:()=>$,Xl:()=>oe,xh:()=>re});var n,i=r(72745),o=r(20664),s=r(83755),a=r(9392),l=r(44815),c=r(75002),d=r(38496),h=r(13927),u=r(95925),p=r(50468);!function(e){e.length=function(e,t){const r=e[t],n=e[t+1],i=e[t+2];return Math.sqrt(r*r+n*n+i*i)},e.normalize=function(e,t){const r=e[t],n=e[t+1],i=e[t+2],o=1/Math.sqrt(r*r+n*n+i*i);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[o]=e[t]+r[n],i[o+1]=e[t+1]+r[n+1],i[o+2]=e[t+2]+r[n+2]},e.subtract=function(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[o]=e[t]-r[n],i[o+1]=e[t+1]-r[n+1],i[o+2]=e[t+2]-r[n+2]}}(n||(n={}));var f=r(87634),v=r(26300),g=r(86994),m=r(66470);const _=n,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],w=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],C=[0,0,1,0,1,1,0,1],A=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],x=new Array(36);for(let le=0;le<6;le++)for(let e=0;e<6;e++)x[6*le+e]=le;const O=new Array(36);for(let le=0;le<6;le++)O[6*le]=0,O[6*le+1]=1,O[6*le+2]=2,O[6*le+3]=2,O[6*le+4]=3,O[6*le+5]=0;function S(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let n=0;n<8;n++)r[3*n]=y[n][0]*t[0],r[3*n+1]=y[n][1]*t[1],r[3*n+2]=y[n][2]*t[2];return new v.V(e,[[m.r.POSITION,new p.n(r,A,3,!0)],[m.r.NORMAL,new p.n(w,x,3)],[m.r.UV0,new p.n(C,O,2)]])}const b=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],T=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],R=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],E=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function D(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let n=0;n<6;n++)r[3*n]=b[n][0]*t[0],r[3*n+1]=b[n][1]*t[1],r[3*n+2]=b[n][2]*t[2];return new v.V(e,[[m.r.POSITION,new p.n(r,R,3,!0)],[m.r.NORMAL,new p.n(T,E,3)]])}const P=(0,s.fA)(-.5,0,-.5),M=(0,s.fA)(.5,0,-.5),I=(0,s.fA)(0,0,.5),N=(0,s.fA)(0,.5,0),L=(0,s.vt)(),F=(0,s.vt)(),z=(0,s.vt)(),V=(0,s.vt)(),j=(0,s.vt)();(0,o.f)(L,P,N),(0,o.f)(F,P,M),(0,o.b)(z,L,F),(0,o.n)(z,z),(0,o.f)(L,M,N),(0,o.f)(F,M,I),(0,o.b)(V,L,F),(0,o.n)(V,V),(0,o.f)(L,I,N),(0,o.f)(F,I,P),(0,o.b)(j,L,F),(0,o.n)(j,j);const H=[P,M,I,N],U=[0,-1,0,z[0],z[1],z[2],V[0],V[1],V[2],j[0],j[1],j[2]],W=[0,1,2,3,1,0,3,2,1,3,0,2],B=[0,0,0,1,1,1,2,2,2,3,3,3];function G(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let n=0;n<4;n++)r[3*n]=H[n][0]*t[0],r[3*n+1]=H[n][1]*t[1],r[3*n+2]=H[n][2]*t[2];return new v.V(e,[[m.r.POSITION,new p.n(r,W,3,!0)],[m.r.NORMAL,new p.n(U,B,3)]])}function Z(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const o=-Math.PI,s=2*Math.PI,a=-Math.PI/2,l=Math.PI,h=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(n)),f=(h+1)*(u+1),g=(0,c.oe)(3*f),_=(0,c.oe)(3*f),y=(0,c.oe)(2*f),w=[];let C=0;for(let c=0;c<=u;c++){const e=[],r=c/u,n=a+r*l,i=Math.cos(n);for(let a=0;a<=h;a++){const l=a/h,c=o+l*s,d=Math.cos(c)*i,u=Math.sin(n),p=-Math.sin(c)*i;g[3*C]=d*t,g[3*C+1]=u*t,g[3*C+2]=p*t,_[3*C]=d,_[3*C+1]=u,_[3*C+2]=p,y[2*C]=l,y[2*C+1]=r,e.push(C),++C}w.push(e)}const A=new Array;for(let c=0;c<u;c++)for(let e=0;e<h;e++){const t=w[c][e],r=w[c][e+1],n=w[c+1][e+1],i=w[c+1][e];0===c?(A.push(t),A.push(n),A.push(i)):c===u-1?(A.push(t),A.push(r),A.push(n)):(A.push(t),A.push(r),A.push(n),A.push(n),A.push(i),A.push(t))}const x=[[m.r.POSITION,new p.n(g,A,3,!0)],[m.r.NORMAL,new p.n(_,A,3,!0)]];return i.uv&&x.push([m.r.UV0,new p.n(y,A,2,!0)]),i.offset&&(x[0][0]=m.r.OFFSET,x.push([m.r.POSITION,new p.n(Float64Array.from(i.offset),(0,d.EH)(A.length),3,!0)])),new v.V(e,x)}function k(e,t,r,n){const i=function(e,t,r){const n=e;let i,o;if(r)i=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=n*(1+Math.sqrt(5))/2;i=[-n,e,0,n,e,0,-n,-e,0,n,-e,0,0,-n,e,0,n,e,0,-n,-e,0,n,-e,e,0,-n,e,0,n,-e,0,-n,-e,0,n],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<i.length;c+=3)_.scale(i,c,e/_.length(i,c));let s={};function a(t,r){t>r&&([t,r]=[r,t]);const n=t.toString()+"."+r.toString();if(s[n])return s[n];let o=i.length;return i.length+=3,_.add(i,3*t,i,3*r,i,o),_.scale(i,o,e/_.length(i,o)),o/=3,s[n]=o,o}for(let c=0;c<t;c++){const e=o.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=o[r],n=o[r+1],i=o[r+2],s=a(e,n),l=a(n,i),c=a(i,e),d=4*r;t[d]=e,t[d+1]=s,t[d+2]=c,t[d+3]=n,t[d+4]=l,t[d+5]=s,t[d+6]=i,t[d+7]=c,t[d+8]=l,t[d+9]=s,t[d+10]=l,t[d+11]=c}o=t,s={}}const l=(0,c.Wz)(i);for(let c=0;c<l.length;c+=3)_.normalize(l,c);return[[m.r.POSITION,new p.n((0,c.Wz)(i),o,3,!0)],[m.r.NORMAL,new p.n(l,o,3,!0)]]}(t,r,n);return new v.V(e,i)}function q(e,t,r,n,o,s,l,c){var h;let u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const g=r?(0,a.o8)(r):(0,a.vt)(),_=t?(0,a.o8)(t):(0,a.fA)(0,0,1);null!==(h=l)&&void 0!==h||(l=(0,i.vt)());const y=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],w=null!=o&&2===o.length?o:[1,1],C=(0,d.EH)(1),A=[[m.r.POSITION,new p.n(g,C,3,!0)],[m.r.NORMAL,new p.n(_,C,3,!0)],[m.r.UV0,new p.n(l,C,l.length)],[m.r.COLOR,new p.n(y,C,4,!0)],[m.r.SIZE,new p.n(w,C,2)]];if(null!=s&&(s=[s[0],s[1],s[2],s[3]],A.push([m.r.CENTEROFFSETANDDISTANCE,new p.n(s,C,4)])),c){const e=[c[0],c[1],c[2],c[3]];A.push([m.r.FEATUREATTRIBUTE,new p.n(e,C,4)])}return new v.V(e,A,null,f.X.Point,u)}const Y=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function X(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y;const r=new Array(12);for(let s=0;s<4;s++)for(let e=0;e<3;e++)r[3*s+e]=t[s][e];const n=[0,1,2,2,3,0],i=[0,0,0,0,0,0],o=[[m.r.POSITION,new p.n(r,n,3,!0)],[m.r.NORMAL,new p.n([0,0,1],i,3,!0)],[m.r.UV0,new p.n([0,0,1,0,1,1,0,1],n,2,!0)],[m.r.COLOR,new p.n([255,255,255,255],i,4,!0)]];return new v.V(e,o)}function Q(e,t,r,n,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=0;const d=r,h=t;let u=(0,s.fA)(0,l,0),f=(0,s.fA)(0,l+h,0),g=(0,s.fA)(0,-1,0),_=(0,s.fA)(0,1,0);i&&(l=h,f=(0,s.fA)(0,0,0),u=(0,s.fA)(0,l,0),g=(0,s.fA)(0,1,0),_=(0,s.fA)(0,-1,0));const y=[f,u],w=[g,_],C=n+2,A=Math.sqrt(h*h+d*d);if(i)for(let c=n-1;c>=0;c--){const e=c*(2*Math.PI/n),t=(0,s.fA)(Math.cos(e)*d,l,Math.sin(e)*d);y.push(t);const r=(0,s.fA)(h*Math.cos(e)/A,-d/A,h*Math.sin(e)/A);w.push(r)}else for(let c=0;c<n;c++){const e=c*(2*Math.PI/n),t=(0,s.fA)(Math.cos(e)*d,l,Math.sin(e)*d);y.push(t);const r=(0,s.fA)(h*Math.cos(e)/A,d/A,h*Math.sin(e)/A);w.push(r)}const x=new Array,O=new Array;if(o){for(let e=3;e<y.length;e++)x.push(1),x.push(e-1),x.push(e),O.push(0),O.push(0),O.push(0);x.push(y.length-1),x.push(2),x.push(1),O.push(0),O.push(0),O.push(0)}if(a){for(let e=3;e<y.length;e++)x.push(e),x.push(e-1),x.push(0),O.push(e),O.push(e-1),O.push(1);x.push(0),x.push(2),x.push(y.length-1),O.push(1),O.push(2),O.push(w.length-1)}const S=(0,c.oe)(3*C);for(let s=0;s<C;s++)S[3*s]=y[s][0],S[3*s+1]=y[s][1],S[3*s+2]=y[s][2];const b=(0,c.oe)(3*C);for(let s=0;s<C;s++)b[3*s]=w[s][0],b[3*s+1]=w[s][1],b[3*s+2]=w[s][2];const T=[[m.r.POSITION,new p.n(S,x,3,!0)],[m.r.NORMAL,new p.n(b,O,3,!0)]];return new v.V(e,T)}function J(e,t,r,n,i,a,l){var d;const h=i?(0,s.o8)(i):(0,s.fA)(1,0,0),u=a?(0,s.o8)(a):(0,s.fA)(0,0,0);null!==(d=l)&&void 0!==d||(l=!0);const f=(0,s.vt)();(0,o.n)(f,h);const g=(0,s.vt)();(0,o.j)(g,f,Math.abs(t));const _=(0,s.vt)();(0,o.j)(_,g,-.5),(0,o.g)(_,_,u);const y=(0,s.fA)(0,1,0);Math.abs(1-(0,o.m)(f,y))<.2&&(0,o.s)(y,0,0,1);const w=(0,s.vt)();(0,o.b)(w,f,y),(0,o.n)(w,w),(0,o.b)(y,w,f);const C=2*n+(l?2:0),A=n+(l?2:0),x=(0,c.oe)(3*C),O=(0,c.oe)(3*A),S=(0,c.oe)(2*C),b=new Array(3*n*(l?4:2)),T=new Array(3*n*(l?4:2));l&&(x[3*(C-2)]=_[0],x[3*(C-2)+1]=_[1],x[3*(C-2)+2]=_[2],S[2*(C-2)]=0,S[2*(C-2)+1]=0,x[3*(C-1)]=x[3*(C-2)]+g[0],x[3*(C-1)+1]=x[3*(C-2)+1]+g[1],x[3*(C-1)+2]=x[3*(C-2)+2]+g[2],S[2*(C-1)]=1,S[2*(C-1)+1]=1,O[3*(A-2)]=-f[0],O[3*(A-2)+1]=-f[1],O[3*(A-2)+2]=-f[2],O[3*(A-1)]=f[0],O[3*(A-1)+1]=f[1],O[3*(A-1)+2]=f[2]);const R=(e,t,r)=>{b[e]=t,T[e]=r};let E=0;const D=(0,s.vt)(),P=(0,s.vt)();for(let s=0;s<n;s++){const e=s*(2*Math.PI/n);(0,o.j)(D,y,Math.sin(e)),(0,o.j)(P,w,Math.cos(e)),(0,o.g)(D,D,P),O[3*s]=D[0],O[3*s+1]=D[1],O[3*s+2]=D[2],(0,o.j)(D,D,r),(0,o.g)(D,D,_),x[3*s]=D[0],x[3*s+1]=D[1],x[3*s+2]=D[2],S[2*s]=s/n,S[2*s+1]=0,x[3*(s+n)]=x[3*s]+g[0],x[3*(s+n)+1]=x[3*s+1]+g[1],x[3*(s+n)+2]=x[3*s+2]+g[2],S[2*(s+n)]=s/n,S[2*s+1]=1;const t=(s+1)%n;R(E++,s,s),R(E++,s+n,s),R(E++,t,t),R(E++,t,t),R(E++,s+n,s),R(E++,t+n,t)}if(l){for(let e=0;e<n;e++){const t=(e+1)%n;R(E++,C-2,A-2),R(E++,e,A-2),R(E++,t,A-2)}for(let e=0;e<n;e++){const t=(e+1)%n;R(E++,e+n,A-1),R(E++,C-1,A-1),R(E++,t+n,A-1)}}const M=[[m.r.POSITION,new p.n(x,b,3,!0)],[m.r.NORMAL,new p.n(O,T,3,!0)],[m.r.UV0,new p.n(S,b,2,!0)]];return new v.V(e,M)}function $(e,t,r,n,i,o){n=n||10,i=null==i||i,(0,g.vA)(t.length>1);const s=[],a=[];for(let l=0;l<n;l++){s.push([0,-l-1,-(l+1)%n-1]);const e=l/n*2*Math.PI;a.push([Math.cos(e)*r,Math.sin(e)*r])}return K(e,a,t,[[0,0,0]],s,i,o)}function K(e,t,r,n,i,l){let d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,s.fA)(0,0,0);const f=t.length,g=(0,c.oe)(r.length*f*3+(6*n.length||0)),_=(0,c.oe)(r.length*f*3+(n?6:0)),y=new Array,w=new Array;let C=0,A=0;const x=(0,a.vt)(),O=(0,a.vt)(),S=(0,a.vt)(),b=(0,a.vt)(),T=(0,a.vt)(),R=(0,a.vt)(),E=(0,a.vt)(),D=(0,a.vt)(),P=(0,a.vt)(),M=(0,a.vt)(),I=(0,a.vt)(),N=(0,a.vt)(),L=(0,a.vt)(),F=(0,h.vt)();(0,o.s)(P,0,1,0),(0,o.f)(O,r[1],r[0]),(0,o.n)(O,O),l?((0,o.g)(D,r[0],d),(0,o.n)(S,D)):(0,o.s)(S,0,0,1),oe(O,S,P,P,T,S,se),(0,o.c)(b,S),(0,o.c)(N,T);for(let s=0;s<n.length;s++)(0,o.j)(R,T,n[s][0]),(0,o.j)(D,S,n[s][2]),(0,o.g)(R,R,D),(0,o.g)(R,R,r[0]),g[C++]=R[0],g[C++]=R[1],g[C++]=R[2];_[A++]=-O[0],_[A++]=-O[1],_[A++]=-O[2];for(let o=0;o<i.length;o++)y.push(i[o][0]>0?i[o][0]:-i[o][0]-1+n.length),y.push(i[o][1]>0?i[o][1]:-i[o][1]-1+n.length),y.push(i[o][2]>0?i[o][2]:-i[o][2]-1+n.length),w.push(0),w.push(0),w.push(0);let z=n.length;const V=n.length-1;for(let s=0;s<r.length;s++){let e=!1;s>0&&((0,o.c)(x,O),s<r.length-1?((0,o.f)(O,r[s+1],r[s]),(0,o.n)(O,O)):e=!0,(0,o.g)(M,x,O),(0,o.n)(M,M),(0,o.g)(I,r[s-1],b),(0,h.O_)(r[s],M,F),(0,h.Ui)(F,(0,u.LV)(I,x),D)?((0,o.f)(D,D,r[s]),(0,o.n)(S,D),(0,o.b)(T,M,S),(0,o.n)(T,T)):oe(M,b,N,P,T,S,se),(0,o.c)(b,S),(0,o.c)(N,T)),l&&((0,o.g)(D,r[s],d),(0,o.n)(L,D));for(let n=0;n<f;n++)if((0,o.j)(R,T,t[n][0]),(0,o.j)(D,S,t[n][1]),(0,o.g)(R,R,D),(0,o.n)(E,R),_[A++]=E[0],_[A++]=E[1],_[A++]=E[2],(0,o.g)(R,R,r[s]),g[C++]=R[0],g[C++]=R[1],g[C++]=R[2],!e){const e=(n+1)%f;y.push(z+n),y.push(z+f+n),y.push(z+e),y.push(z+e),y.push(z+f+n),y.push(z+f+e);for(let t=0;t<6;t++){const e=y.length-6;w.push(y[e+t]-V)}}z+=f}const j=r[r.length-1];for(let s=0;s<n.length;s++)(0,o.j)(R,T,n[s][0]),(0,o.j)(D,S,n[s][1]),(0,o.g)(R,R,D),(0,o.g)(R,R,j),g[C++]=R[0],g[C++]=R[1],g[C++]=R[2];const H=A/3;_[A++]=O[0],_[A++]=O[1],_[A++]=O[2];const U=z-f;for(let o=0;o<i.length;o++)y.push(i[o][0]>=0?z+i[o][0]:-i[o][0]-1+U),y.push(i[o][2]>=0?z+i[o][2]:-i[o][2]-1+U),y.push(i[o][1]>=0?z+i[o][1]:-i[o][1]-1+U),w.push(H),w.push(H),w.push(H);const W=[[m.r.POSITION,new p.n(g,y,3,!0)],[m.r.NORMAL,new p.n(_,w,3,!0)]];return new v.V(e,W)}function ee(e,t,r,n){(0,g.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.vA)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.vA)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const i=(0,l.jh)(3*t.length),o=new Array(2*(t.length-1));let s=0,a=0;for(let l=0;l<t.length;l++){for(let e=0;e<3;e++)i[s++]=t[l][e];l>0&&(o[a++]=l-1,o[a++]=l)}const h=[[m.r.POSITION,new p.n(i,o,3,!0)]];if(r){const e=(0,c.oe)(3*r.length);let n=0;for(let i=0;i<t.length;i++)for(let t=0;t<3;t++)e[n++]=r[i][t];h.push([m.r.NORMAL,new p.n(e,o,3,!0)])}return n&&h.push([m.r.COLOR,new p.n(n,(0,d.tM)(n.length/4),4)]),new v.V(e,h,null,f.X.Line)}function te(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=new Array(18),a=[[-r,o,i/2],[n,o,i/2],[0,t+o,i/2],[-r,o,-i/2],[n,o,-i/2],[0,t+o,-i/2]];for(let l=0;l<6;l++)s[3*l]=a[l][0],s[3*l+1]=a[l][1],s[3*l+2]=a[l][2];return new v.V(e,[[m.r.POSITION,new p.n(s,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function re(e,t){const r=e.getMutableAttribute(m.r.POSITION).data;for(let n=0;n<r.length;n+=3){const e=r[n],i=r[n+1],s=r[n+2];(0,o.s)(ae,e,i,s),(0,o.h)(ae,ae,t),r[n]=ae[0],r[n+1]=ae[1],r[n+2]=ae[2]}}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const r=e.attributes,n=r.get(m.r.POSITION).data,i=r.get(m.r.NORMAL).data;if(i){const e=t.getMutableAttribute(m.r.NORMAL).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}if(n){const e=t.getMutableAttribute(m.r.POSITION).data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}}function ie(e,t,r,n,i){return!(Math.abs((0,o.m)(t,e))>i)&&((0,o.b)(r,e,t),(0,o.n)(r,r),(0,o.b)(n,r,e),(0,o.n)(n,n),!0)}function oe(e,t,r,n,i,o,s){return ie(e,t,i,o,s)||ie(e,r,i,o,s)||ie(e,n,i,o,s)}const se=.99619469809,ae=(0,a.vt)()},97583:(e,t,r)=>{r.d(t,{g:()=>m});r(81806);var n=r(90632),i=r(20664),o=r(9392),s=r(55855),a=r(45308),l=r(50468),c=r(87634),d=r(26300),h=r(75507),u=r(37046),p=r(67737),f=r(66470),v=r(8918),g=r(425);class m{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,n.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,h.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,n=Math.round(e[0]/r),o=Math.round(e[1]/r),s=Math.round(e[2]/r),a="".concat(n,"/").concat(o,"/").concat(s);let l=this._origins.get(a);const c=.5*r;if((0,i.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<c&&_[1]<c&&_[2]<c){if(l){const t=Math.max(..._);if((0,i.f)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.f)(n*r,o*r,s*r,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.fA)(1,1,0,1);const r=window.view,n=r._stage,i=t.toString();if(!this._objects.has(i)){this._material=new g.W({width:2,color:t}),n.add(this._material);const e=new v.x(n,{pickable:!1}),r=new u.B({castShadow:!1});n.add(r),e.add(r),this._objects.set(i,r)}const o=this._objects.get(i),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,m=new Array(3*p),_=new Array,y=.5*this._gridSize;for(let s=0;s<p;s++)m[3*s]=e[0]+(1&h[s]?y:-y),m[3*s+1]=e[1]+(2&h[s]?y:-y),m[3*s+2]=e[2]+(4&h[s]?y:-y),s>0&&_.push(s-1,s);(0,a.projectBuffer)(m,this._originSR,0,m,r.renderSpatialReference,0,p);const w=new d.V(this._material,[[f.r.POSITION,new l.n(m,_,3,!0)]],null,c.X.Line);n.add(w),o.addGeometry(w)}get test(){}}const _=(0,o.vt)()},29808:(e,t,r)=>{r.d(t,{G7:()=>A,hz:()=>_});var n=r(34761),i=r(13191),o=r(20664),s=r(9392),a=r(43047),l=r(55855),c=r(95925),d=r(64465),h=r(3112),u=r(35737),p=r(46571),f=r(97974);const v=1e-5;class g{constructor(e){this.options=new h.H6,this._results=new y,this.transform=new f.dg,this.tolerance=v,this.verticalOffset=null,this._ray=(0,c.vt)(),this._rayEnd=(0,s.vt)(),this._rayBeginTransformed=(0,s.vt)(),this._rayEndTransformed=(0,s.vt)(),this.viewingMode=null!==e&&void 0!==e?e:d.RT.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,c.Cr)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.C)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===d.RT.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,o.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;this.point=t,this.filterPredicate=n,this.tolerance=null!==r&&void 0!==r?r:v;const o=(0,f.ou)(this.verticalOffset);if(e&&e.length>0){const t=i?e=>{i(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){var s;const e=null===(s=r.getSpatialQueryAccelerator)||void 0===s?void 0:s.call(r);null!=e?(null!=o?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.effectiveTransformation,n=(0,f.ou)(this.verticalOffset);for(const s of t){if(!s.visible)continue;const{material:t,id:a}=s;this.transform.setAndInvalidateLazyTransforms(r,s.transformation),(0,o.h)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,o.h)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=n&&(n.objectTransform=this.transform),t.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,n,o,s,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const d=o?this._results.hud:this._results,p=o?o=>{const l=new u.B$(e,a,n,c);o.set(h.dz.HUD,l,t,r,i.zK,s)}:i=>i.set(h.dz.OBJECT,{object:e,geometryId:a,triangleNr:n},t,r,l,s);if((null==d.min.drapedLayerOrder||s>=d.min.drapedLayerOrder)&&(null==d.min.dist||t<d.min.dist)&&p(d.min),this.options.store!==h.oH.MIN&&(null==d.max.drapedLayerOrder||s<d.max.drapedLayerOrder)&&(null==d.max.dist||t>d.max.dist)&&p(d.max),this.options.store===h.oH.ALL)if(o){const e=new C(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new w(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort(((e,t)=>{var r,n;return e.dist!==t.dist?(null!==(r=e.dist)&&void 0!==r?r:0)-(null!==(n=t.dist)&&void 0!==n?n:0):e.drapedLayerOrder!==t.drapedLayerOrder?m(e.drapedLayerOrder,t.drapedLayerOrder):m(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)}))}}function m(e,t){return(null!==t&&void 0!==t?t:-Number.MAX_VALUE)-(null!==e&&void 0!==e?e:-Number.MAX_VALUE)}function _(e){return new g(e)}class y{constructor(){this.min=new w((0,c.vt)()),this.max=new w((0,c.vt)()),this.hud={min:new C((0,c.vt)()),max:new C((0,c.vt)()),all:new Array},this.ground=new w((0,c.vt)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class w{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,o.j)(x,this.ray.direction,this.dist),(0,o.l)(x)):null}getIntersectionPoint(e){return!!(0,p.i3)(this)&&((0,o.j)(x,this.ray.direction,this.dist),(0,o.g)(e,this.ray.origin,x),!0)}getTransformedNormal(e){return(0,o.c)(O,this.normal),O[3]=0,(0,a.t)(O,O,this.transformation),(0,o.c)(e,O),(0,o.n)(e,e)}constructor(e){this.intersector=h.dz.OBJECT,this.normal=(0,s.vt)(),this.transformation=(0,i.vt)(),this._ray=(0,c.vt)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.dz.OBJECT,(0,c.C)(e,this._ray)}set(e,t,r,a,l,c,d){this.intersector=e,this.dist=r,(0,o.c)(this.normal,null!==a&&void 0!==a?a:s.Cb),(0,n.C)(this.transformation,null!==l&&void 0!==l?l:i.zK),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=d}copy(e){(0,c.C)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,o.c)(this.normal,e.normal),(0,n.C)(this.transformation,e.transformation)}}class C extends w{constructor(){super(...arguments),this.intersector=h.dz.HUD}}function A(e){return new w(e)}const x=(0,s.vt)(),O=(0,l.vt)()},3112:(e,t,r)=>{var n,i;r.d(t,{H6:()=>o,dz:()=>n,oH:()=>i}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(n||(n={}));class o{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=i.ALL,this.normalRequired=!0}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(i||(i={}))},35737:(e,t,r)=>{r.d(t,{B$:()=>o,R6:()=>a});var n=r(9392);class i{constructor(e,t,r){this.object=e,this.geometryId=t,this.triangleNr=r}}class o extends i{constructor(e,t,r,i){super(e,t,r),this.center=null!=i?(0,n.o8)(i):null}}class s{constructor(e){this.layerUid=e}}class a extends s{constructor(e,t){super(e),this.graphicUid=t}}},75507:(e,t,r)=>{r.d(t,{f:()=>o});var n=r(9392);class i{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,r,o){return new i((0,n.fA)(e,t,r),o)}},57824:(e,t,r)=>{var n,i;r.d(t,{k:()=>i,q:()=>n}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(i||(i={}))},37046:(e,t,r)=>{r.d(t,{B:()=>g});r(81806);var n=r(34761),i=r(13191),o=r(20664),s=r(9392),a=r(93582),l=r(94966),c=r(83490),d=r(73146),h=r(87634),u=r(35416),p=r(86994),f=r(66470),v=r(68967);class g extends d.J{get geometries(){return this._geometries}get transformation(){var e;return null!==(e=this._transformation)&&void 0!==e?e:i.zK}set transformation(e){var t;this._transformation=(0,n.C)(null!==(t=this._transformation)&&void 0!==t?t:(0,i.vt)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){var t;this._shaderTransformation=e?(0,n.C)(null!==(t=this._shaderTransformation)&&void 0!==t?t:(0,i.vt)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){var e;return null!==(e=this.shaderTransformation)&&void 0!==e?e:this.transformation}constructor(){var e,t;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=h.X.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=null===(e=r.castShadow)||void 0===e||e,this.usesVerticalDistanceToGround=null!==(t=r.usesVerticalDistanceToGround)&&void 0!==t&&t,this.graphicUid=r.graphicUid,this.layerUid=r.layerUid,r.isElevationSource&&(this.lastValidElevationBB=new m),this._geometries=r.geometries?Array.from(r.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.vA)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:r}),(0,f.b)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new u.X(c.Mg.MaskOccludee);for(const t of this._geometries)t.occludees=(0,v.Ci)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,v.PC)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new u.X(c.Mg.Highlight);for(const t of this._geometries)t.highlights=(0,v.Ci)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,v.PC)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,n.lw)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.vt)();return(0,n.lw)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,O.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,O.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const r=t===O.ObjectSpace;for(const n of this._geometries){const t=n.boundingInfo;t&&y(t,e,r?n.transformation:this.getCombinedShaderTransformation(n))}(0,o.o)((0,a.g)(e.bounds),e.min,e.max,.5);for(const n of this._geometries){const t=n.boundingInfo;if(null==t)continue;const i=r?n.transformation:this.getCombinedShaderTransformation(n),s=(0,l.hG)(i);(0,o.h)(x,t.center,i);const c=(0,o.p)(x,(0,a.g)(e.bounds)),d=t.radius*s;e.bounds[3]=Math.max(e.bounds[3],c+d)}}_invalidateBoundingVolume(){var e;const t=null===(e=this._bvWorldSpace)||void 0===e?void 0:e.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class m{constructor(){this.min=(0,s.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,s.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends m{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,r){const i=e.bbMin,s=e.bbMax;if((0,n.tZ)(r)){const e=(0,o.s)(w,r[12],r[13],r[14]);(0,o.g)(C,i,e),(0,o.g)(A,s,e);for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],C[r]),t.max[r]=Math.max(t.max[r],A[r])}else if((0,o.h)(C,i,r),(0,o.e)(i,s))for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],C[n]),t.max[n]=Math.max(t.max[n],C[n]);else{(0,o.h)(A,s,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],C[e],A[e]),t.max[e]=Math.max(t.max[e],C[e],A[e]);for(let e=0;e<3;++e){(0,o.c)(C,i),(0,o.c)(A,s),C[e]=s[e],A[e]=i[e],(0,o.h)(C,C,r),(0,o.h)(A,A,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],C[e],A[e]),t.max[e]=Math.max(t.max[e],C[e],A[e])}}}const w=(0,s.vt)(),C=(0,s.vt)(),A=(0,s.vt)(),x=(0,s.vt)();var O;!function(e){e[e.WorldSpace=0]="WorldSpace",e[e.ObjectSpace=1]="ObjectSpace"}(O||(O={}))},442:(e,t,r)=>{r.d(t,{$:()=>c});var n=r(90632),i=r(34761),o=r(13191),s=r(20664),a=r(93582),l=r(94966);class c{constructor(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,n.c)(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=null!==(t=r.castShadow)&&void 0!==t&&t,null!=r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,i.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,o.vt)()),(0,i.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,a.c)()),(0,s.h)((0,a.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){var e;return null!==(e=this._shaderTransformation)&&void 0!==e?e:this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},44513:(e,t,r)=>{var n;r.d(t,{q:()=>n}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(n||(n={}))},69008:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(36911);class i extends n.Z{}},8918:(e,t,r)=>{r.d(t,{x:()=>u});var n=r(54099),i=r(88321),o=r(30726),s=r(30015),a=r(73146),l=r(87634);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var d=r(94536),h=r(44513);class u extends a.J{get objects(){return this._objects}constructor(e,t){var r,o,a,d;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.stage=e,this.apiLayerUid=u,this.type=l.X.Layer,this.events=new n.A,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new s.A,this._objectsAdded=new s.A,this._handles=new i.A,this.apiLayerUid=u,this.visible=null===(r=null===t||void 0===t?void 0:t.visible)||void 0===r||r,this.pickable=null===(o=null===t||void 0===t?void 0:t.pickable)||void 0===o||o,this.updatePolicy=null!==(a=null===t||void 0===t?void 0:t.updatePolicy)&&void 0!==a?a:h.q.ASYNC,this._disableOctree=null!==(d=null===t||void 0===t?void 0:t.disableOctree)&&void 0!==d&&d,e.add(this);for(const n of c)this._handles.add(this.events.on(n,(t=>e.handleEvent(n,t))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.q.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new d.A((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,o.pR)(this._octree),this._objectsAdded.clear()}}},46571:(e,t,r)=>{r.d(t,{i3:()=>i});r(20664);var n=r(9392);r(79650),r(3112);function i(e){return null!=(null===e||void 0===e?void 0:e.dist)}(0,n.vt)()},13840:(e,t,r)=>{r.d(t,{$T:()=>s,zj:()=>i});var n,i,o=r(63496);function s(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new o.a0,t.set(e,r)),r};return e.removes.forAll((e=>{a(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{a(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{a(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function a(e){return e.geometry.indexCount>=1}!function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(n||(n={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(i||(i={}))},67737:(e,t,r)=>{r.d(t,{G:()=>n,Q:()=>i});const n={stableRendering:!1},i={rootOrigin:null}},76956:(e,t,r)=>{r.d(t,{v:()=>D});var n=r(81806),i=r(55855),o=r(48549),s=r(34981),a=r(83490),l=r(59696),c=r(60322),d=r(77730),h=r(66470),u=r(82809),p=r(63928),f=r(93684),v=r(16506),g=r(42693),m=r(32119),_=r(28584),y=r(96643),w=r(10773),C=r(37923),A=r(93345),x=r(57162);f.S;class O extends g.w{initializeProgram(e){return new _.B(e.rctx,O.shader.get().build(this.configuration),m.D)}_createPipeline(e,t){const r=this.configuration,n=e===w.y.NONE,i=e===w.y.FrontFace;return(0,x.Ey)({blending:r.output===s.V.Color&&r.transparent?n?c.V0:(0,c.ez)(e):null,culling:(0,x.Xt)(r.cullFace),depthTest:r.draped?null:{func:(0,c.K_)(e)},depthWrite:r.draped?null:(n||i)&&r.writeDepth?x.kn:null,drawBuffers:r.output===s.V.Depth?{buffers:[A.Hr.NONE]}:(0,c.cl)(e),colorWrite:x.wE,stencilWrite:r.hasOccludees?y.v0:null,stencilTest:r.hasOccludees?t?y.a9:y.qh:null,polygonOffset:n||i?r.polygonOffset?S:null:(0,c.aB)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}O.shader=new v.$(C.C,(()=>r.e(5837).then(r.bind(r,35837))));const S={factor:1,units:1};var b=r(35143),T=r(99415),R=r(92656);class E extends R.E{constructor(){super(...arguments),this.output=s.V.Color,this.cullFace=a.s2.None,this.transparencyPassType=w.y.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}}(0,b._)([(0,T.W)({count:s.V.COUNT})],E.prototype,"output",void 0),(0,b._)([(0,T.W)({count:a.s2.COUNT})],E.prototype,"cullFace",void 0),(0,b._)([(0,T.W)({count:w.y.COUNT})],E.prototype,"transparencyPassType",void 0),(0,b._)([(0,T.W)()],E.prototype,"hasSlicePlane",void 0),(0,b._)([(0,T.W)()],E.prototype,"hasVertexColors",void 0),(0,b._)([(0,T.W)()],E.prototype,"transparent",void 0),(0,b._)([(0,T.W)()],E.prototype,"polygonOffset",void 0),(0,b._)([(0,T.W)()],E.prototype,"enableOffset",void 0),(0,b._)([(0,T.W)()],E.prototype,"writeDepth",void 0),(0,b._)([(0,T.W)()],E.prototype,"hasOccludees",void 0),(0,b._)([(0,T.W)()],E.prototype,"multipassEnabled",void 0),(0,b._)([(0,T.W)()],E.prototype,"cullAboveGround",void 0),(0,b._)([(0,T.W)()],E.prototype,"objectAndLayerIdColorInstanced",void 0),(0,b._)([(0,T.W)()],E.prototype,"vvColor",void 0),(0,b._)([(0,T.W)()],E.prototype,"draped",void 0),(0,b._)([(0,T.W)({constValue:!1})],E.prototype,"occlusionPass",void 0),(0,b._)([(0,T.W)({constValue:!0})],E.prototype,"hasVvInstancing",void 0),(0,b._)([(0,T.W)({constValue:!1})],E.prototype,"vvSize",void 0),(0,b._)([(0,T.W)({constValue:!1})],E.prototype,"vvOpacity",void 0);class D extends p.W{constructor(e){super(e,new M),this.supportsEdges=!0,this.produces=new Map([[d.N.OPAQUE_MATERIAL,e=>e===s.V.Highlight||(0,s.zW)(e)&&!this._isTransparent],[d.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,s.eh)(e)&&this.parameters.writeLinearDepth&&!this._isTransparent],[d.N.TRANSPARENT_MATERIAL,e=>(0,s.zW)(e)&&this._isTransparent&&this.parameters.writeDepth],[d.N.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,s.eh)(e)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[d.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,s.zW)(e)||(0,s.eh)(e)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[d.N.DRAPED_MATERIAL,e=>(0,s.i3)(e)]]),this._configuration=new E}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new P(e)}createBufferWriter(){const e=(0,o.BP)().vec3f(h.r.POSITION);return(0,n.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(h.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(h.r.COLORFEATUREATTRIBUTE):e.vec4u8(h.r.COLOR),new u.Z(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class P extends l.A{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===s.V.Color&&this._updateOccludeeState(e),this.ensureTechnique(O,e)}}class M extends f.S{constructor(){super(...arguments),this.color=i.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.s2.None,this.hasOccludees=!1,this.draped=!1}}},86401:(e,t,r)=>{r.d(t,{Ci:()=>o,Dq:()=>l,dB:()=>a,zK:()=>s});var n=r(48549),i=r(66470);const o=(0,n.BP)().vec3f(i.r.POSITION),s=(0,n.BP)().vec3f(i.r.POSITION).vec2f(i.r.UV0),a=(0,n.BP)().vec3f(i.r.POSITION).vec4u8(i.r.COLOR),l=(0,n.BP)().vec3f(i.r.POSITION).vec2f(i.r.UV0).vec4u8(i.r.OBJECTANDLAYERIDCOLOR)},90155:(e,t,r)=>{r.d(t,{R:()=>q});var n=r(81806),i=r(15941),o=r(63919),s=r(44680),a=r(34761),l=r(13191),c=r(72745),d=r(20664),h=r(9392),u=r(55855);function p(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var f=r(2413),v=r(88105),g=r(63048),m=r(22955),_=r(48549),y=r(34981),w=r(40318),C=r(75803),A=r(45463),x=r(77730),O=r(12028),S=r(86994),b=r(66470);class T{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var R=r(52757),E=r(99362),D=r(19061),P=r(64465),M=r(16506),I=r(42693),N=r(32119),L=r(60322),F=r(28584),z=r(10773),V=r(93345),j=r(57162);class H extends I.w{initializeConfiguration(e,t){t.spherical=e.viewingMode===P.RT.Global}initializeProgram(e){return new F.B(e.rctx,H.shader.get().build(this.configuration),N.D)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===z.y.NONE,n=e===z.y.FrontFace,i=this.configuration.hasPolygonOffset?U:null,o=t.draped?null:(r||n)&&t.output!==y.V.Highlight&&(t.depthEnabled||t.occlusionPass)?j.kn:null;return(0,j.Ey)({blending:t.output===y.V.Color||t.output===y.V.Highlight?r?W:(0,L.ez)(e):null,depthTest:t.draped?null:{func:V.MT.LEQUAL},depthWrite:o,drawBuffers:(0,L.cl)(e),colorWrite:j.wE,polygonOffset:i})}get primitiveType(){return this.configuration.occlusionPass?V.WR.POINTS:V.WR.TRIANGLES}}H.shader=new M.$(D.H,(()=>r.e(271).then(r.bind(r,60271))));const U={factor:0,units:-4},W=(0,j.ox)(V.dn.ONE,V.dn.ONE_MINUS_SRC_ALPHA);var B=r(35143),G=r(99415),Z=r(92656);class k extends Z.E{constructor(){super(...arguments),this.output=y.V.Color,this.transparencyPassType=z.y.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,B._)([(0,G.W)({count:y.V.COUNT})],k.prototype,"output",void 0),(0,B._)([(0,G.W)({count:z.y.COUNT})],k.prototype,"transparencyPassType",void 0),(0,B._)([(0,G.W)()],k.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,B._)([(0,G.W)()],k.prototype,"spherical",void 0),(0,B._)([(0,G.W)()],k.prototype,"occlusionTestEnabled",void 0),(0,B._)([(0,G.W)()],k.prototype,"signedDistanceFieldEnabled",void 0),(0,B._)([(0,G.W)()],k.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,B._)([(0,G.W)()],k.prototype,"vvSize",void 0),(0,B._)([(0,G.W)()],k.prototype,"vvColor",void 0),(0,B._)([(0,G.W)()],k.prototype,"hasVerticalOffset",void 0),(0,B._)([(0,G.W)()],k.prototype,"hasScreenSizePerspective",void 0),(0,B._)([(0,G.W)()],k.prototype,"debugDrawLabelBorder",void 0),(0,B._)([(0,G.W)()],k.prototype,"hasSlicePlane",void 0),(0,B._)([(0,G.W)()],k.prototype,"hasPolygonOffset",void 0),(0,B._)([(0,G.W)()],k.prototype,"depthEnabled",void 0),(0,B._)([(0,G.W)()],k.prototype,"pixelSnappingEnabled",void 0),(0,B._)([(0,G.W)()],k.prototype,"draped",void 0),(0,B._)([(0,G.W)()],k.prototype,"multipassEnabled",void 0),(0,B._)([(0,G.W)()],k.prototype,"cullAboveGround",void 0),(0,B._)([(0,G.W)()],k.prototype,"occlusionPass",void 0),(0,B._)([(0,G.W)()],k.prototype,"objectAndLayerIdColorInstanced",void 0),(0,B._)([(0,G.W)({constValue:!0})],k.prototype,"hasSliceInVertexProgram",void 0),(0,B._)([(0,G.W)({constValue:!1})],k.prototype,"hasVvInstancing",void 0);class q extends A.im{constructor(e){super(e,new fe),this._configuration=new k,this.produces=new Map([[x.N.HUD_MATERIAL,e=>(0,y.dX)(e)&&!this.parameters.drawInSecondSlot],[x.N.LABEL_MATERIAL,e=>(0,y.dX)(e)&&this.parameters.drawInSecondSlot],[x.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[x.N.DRAPED_MATERIAL,e=>(0,y.dX)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===x.N.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===y.V.Color&&(this._configuration.debugDrawLabelBorder=!!m.b.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,n,i,s){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const l=this.parameters,c=r.point,u=r.camera;let{scaleX:p,scaleY:f}=this._getScreenScale(e);p*=u.pixelRatio,f*=u.pixelRatio,(0,o.z0)(ne,t),e.attributes.has(b.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],d=1/Math.sqrt(t*t+r*r+n*n),h=1/Math.sqrt(i*i+o*o+s*s),u=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*d,e[1]=r*d,e[2]=n*d,e[3]=i*h,e[4]=o*h,e[5]=s*h,e[6]=a*u,e[7]=l*u,e[8]=c*u}(ne);const v=e.attributes.get(b.r.POSITION),g=e.attributes.get(b.r.SIZE),m=e.attributes.get(b.r.NORMAL),_=e.attributes.get(b.r.CENTEROFFSETANDDISTANCE);(0,S.vA)(v.size>=3);const y=(0,D.c)(l),w="screen"===this.parameters.centerOffsetUnits;for(let o=0;o<v.data.length/v.size;o++){const e=o*v.size;(0,d.s)($,v.data[e],v.data[e+1],v.data[e+2]),(0,d.h)($,$,t);const n=o*g.size;ue[0]=g.data[n]*p,ue[1]=g.data[n+1]*f,(0,d.h)($,$,u.viewMatrix);const i=o*_.size;if((0,d.s)(se,_.data[i],_.data[i+1],_.data[i+2]),!w&&($[0]+=se[0],$[1]+=se[1],0!==se[2])){const e=se[2];(0,d.n)(se,$),(0,d.f)($,$,(0,d.j)(se,se,e))}const C=o*m.size;if((0,d.s)(K,m.data[C],m.data[C+1],m.data[C+2]),X(K,ne,u,ce),this._applyVerticalOffsetTransformationView($,ce,u,J),u.applyProjection($,ee),ee[0]>-1){w&&(se[0]||se[1])&&(ee[0]+=se[0]*u.pixelRatio,0!==se[1]&&(ee[1]+=(0,O.m0)(se[1],J.factorAlignment)*u.pixelRatio),u.unapplyProjection(ee,$)),ee[0]+=this.parameters.screenOffset[0]*u.pixelRatio,ee[1]+=this.parameters.screenOffset[1]*u.pixelRatio,ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]),(0,O.MD)(ue,J.factor,ue);const e=de*u.pixelRatio;let t=0;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*u.pixelRatio/2),Q(c,ee[0],ee[1],ue,e,t,l,y)){const e=r.ray;if((0,d.h)(re,$,(0,a.B8)(oe,u.viewMatrix)),ee[0]=c[0],ee[1]=c[1],u.unprojectFromRenderScreen(ee,$)){const t=(0,h.vt)();(0,d.c)(t,e.direction);const r=1/(0,d.l)(t);(0,d.j)(t,t,r),s((0,d.p)(e.origin,$)*r,t,-1,!0,1,re)}}}}}intersectDraped(e,t,r,n,i,o){const s=e.attributes.get(b.r.POSITION),a=e.attributes.get(b.r.SIZE),l=this.parameters,c=(0,D.c)(l);let{scaleX:d,scaleY:h}=this._getScreenScale(e);d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=he*e.screenToWorldRatio;for(let p=0;p<s.data.length/s.size;p++){const t=p*s.size,r=s.data[t],f=s.data[t+1],v=p*a.size;ue[0]=a.data[v]*d,ue[1]=a.data[v+1]*h;let g=0;l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),Q(n,r,f,ue,u,g,l,c)&&i(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new me(this)}_updateScaleInfo(e,t,r){const n=this.parameters;null!=n.screenSizePerspective?(0,O.cJ)(r,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=n.screenSizePerspectiveAlignment?(0,O.cJ)(r,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,n,i,o,s){const a=X(t,r,i,ce);return this._applyVerticalGroundOffsetView(e,a,i,s),this._applyVerticalOffsetTransformationView(s,a,i,o),this._applyPolygonOffsetView(s,a,n[3],i,s),this._applyCenterOffsetView(s,n,s),s}applyShaderOffsetsNDC(e,t,r,n,i){return this._applyCenterOffsetNDC(e,t,r,n),null!=i&&(0,d.c)(i,n),this._applyPolygonOffsetNDC(n,t,r,n),n}_applyPolygonOffsetView(e,t,r,n,o){const s=n.aboveGround?1:-1;let a=Math.sign(r);0===a&&(a=s);const l=s*a;if(this.parameters.shaderPolygonOffset<=0)return(0,d.c)(o,e);const c=(0,i.qE)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/n.viewport[2];return(0,d.j)(o,e,l>0?h:1/h),o}_applyVerticalGroundOffsetView(e,t,r,n){const i=(0,d.l)(e),o=r.aboveGround?1:-1,s=r.computeRenderPixelSizeAtDist(i)*w.R,a=(0,d.j)($,t.normal,o*s);return(0,d.g)(n,e,a),n}_applyVerticalOffsetTransformationView(e,t,r,n){var i,o;const s=this.parameters;if(null===(i=s.verticalOffset)||void 0===i||!i.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const r=(0,d.l)(e);this._updateScaleInfo(n,r,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const a=(0,d.l)(e),l=null!==(o=s.screenSizePerspectiveAlignment)&&void 0!==o?o:s.screenSizePerspective,c=(0,E.kE)(r,a,s.verticalOffset,t.cosAngle,l);return this._updateScaleInfo(n,a,t.cosAngle),(0,d.j)(t.normal,t.normal,c),(0,d.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,d.c)(r,e),n&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,d.n)(K,r),(0,d.g)(r,r,(0,d.j)(K,K,t[2])))),r}_applyCenterOffsetNDC(e,t,r,n){const i="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,d.c)(n,e),i||(n[0]+=t[0]/r.fullWidth*2,n[1]+=t[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,t,r,n){const i=this.parameters.shaderPolygonOffset;if(e!==n&&(0,d.c)(n,e),i){const e=r.aboveGround?1:-1,o=e*Math.sign(t[3]);n[2]-=(o||e)*i}return n}createGLMaterial(e){return new Y(e)}calculateRelativeScreenBounds(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,f.vt)();return function(e,t,r,n){n[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,n[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const t=e.attributes.get(b.r.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const r=(0,u.ci)(t.data,le),[n,i]=(0,g.VC)(ae,this.parameters,r);return{scaleX:n,scaleY:i}}}class Y extends C.m{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(H,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function X(e,t,r,n){return p(t)&&(t=(0,o.z0)(ie,t)),(0,d.t)(n.normal,e,t),(0,d.h)(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=(0,d.m)(te,pe),n}function Q(e,t,r,n,i,o,s,a){let l=t-i-(a[0]>0?n[0]*a[0]:0),c=l+n[0]+2*i,d=r-i-(a[1]>0?n[1]*a[1]:0),h=d+n[1]+2*i;const u=s.distanceFieldBoundingBox;return s.textureIsSignedDistanceField&&null!=u&&(l+=n[0]*u[0],d+=n[1]*u[1],c-=n[0]*(1-u[2]),h-=n[1]*(1-u[3]),l-=o,c+=o,d-=o,h+=o),e[0]>l&&e[0]<c&&e[1]>d&&e[1]<h}const J=new class{constructor(){this.factor=new T,this.factorAlignment=new T}},$=(0,h.vt)(),K=(0,h.vt)(),ee=(0,u.vt)(),te=(0,h.vt)(),re=(0,h.vt)(),ne=(0,s.vt)(),ie=(0,s.vt)(),oe=(0,l.vt)(),se=(0,h.vt)(),ae=(0,h.vt)(),le=(0,u.vt)(),ce={normal:te,cosAngle:0},de=1,he=2,ue=[0,0],pe=(0,h.fA)(0,0,1);class fe extends C.N{constructor(){super(...arguments),this.renderOccluded=A.m$.Occlude,this.isDecoration=!1,this.color=(0,u.fA)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,u.fA)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const ve=(0,_.BP)().vec3f(b.r.POSITION).vec3f(b.r.NORMAL).vec2f(b.r.UV0).vec4u8(b.r.COLOR).vec2f(b.r.SIZE).vec4f(b.r.CENTEROFFSETANDDISTANCE).vec4f(b.r.FEATUREATTRIBUTE),ge=ve.clone().vec4u8(b.r.OBJECTANDLAYERIDCOLOR);class me{constructor(e){this._material=e,this.vertexBufferLayout=(0,n.A)("enable-feature:objectAndLayerId-rendering")?ge:ve}elementCount(e){return 6*e.attributes.get(b.r.POSITION).indices.length}write(e,t,r,n,i){(0,R.Hk)(r.attributes.get(b.r.POSITION),e,n.position,i,6),(0,R.p1)(r.attributes.get(b.r.NORMAL),t,n.normal,i,6);const o=r.attributes.get(b.r.UV0).data;let s,a,l,c;if(null==o||o.length<4){const e=this._material.parameters;s=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else s=o[0],a=o[1],l=o[2],c=o[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let d=r.attributes.get(b.r.POSITION).indices.length,h=i;const u=n.uv0;for(let v=0;v<d;++v)u.set(h,0,s),u.set(h,1,a),h++,u.set(h,0,l),u.set(h,1,a),h++,u.set(h,0,l),u.set(h,1,c),h++,u.set(h,0,l),u.set(h,1,c),h++,u.set(h,0,s),u.set(h,1,c),h++,u.set(h,0,s),u.set(h,1,a),h++;(0,R.tb)(r.attributes.get(b.r.COLOR),4,n.color,i,6);const{data:p,indices:f}=r.attributes.get(b.r.SIZE);d=f.length;const g=n.size;h=i;for(let v=0;v<d;++v){const e=p[2*f[v]],t=p[2*f[v]+1];for(let r=0;r<6;++r)g.set(h,0,e),g.set(h,1,t),h++}if(r.attributes.get(b.r.CENTEROFFSETANDDISTANCE)?(0,R.Ut)(r.attributes.get(b.r.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,i,6):(0,R.Pq)(n.centerOffsetAndDistance,i,6*d),r.attributes.get(b.r.FEATUREATTRIBUTE)?(0,R.Ut)(r.attributes.get(b.r.FEATUREATTRIBUTE),n.featureAttribute,i,6):(0,R.Pq)(n.featureAttribute,i,6*d),null!=r.objectAndLayerIdColor){var m;const e=null===(m=r.attributes.get(b.r.POSITION))||void 0===m?void 0:m.indices;if(e){const t=e.length,o=n.getField(b.r.OBJECTANDLAYERIDCOLOR,v.XP);(0,R.tH)(r.objectAndLayerIdColor,o,t,i,6)}}}}},425:(e,t,r)=>{r.d(t,{W:()=>z});var n=r(81806),i=r(76460),o=r(15941),s=r(76931),a=r(19555),l=r(20664),c=r(9392),d=r(55855),h=r(4763),u=r(44230),p=r(13927),f=r(48549),v=r(34981),g=r(59696),m=r(45463),_=r(77730),y=r(86994),w=r(66470),C=r(93684),A=r(50125),x=r(14623),O=r(16506),S=r(42693),b=r(60322),T=r(28584),R=r(96643),E=r(10773),D=r(93345),P=r(57162);const M=new Map([[w.r.POSITION,0],[w.r.PREVPOSITION,1],[w.r.NEXTPOSITION,2],[w.r.SUBDIVISIONFACTOR,3],[w.r.UV0,4],[w.r.COLOR,5],[w.r.COLORFEATUREATTRIBUTE,5],[w.r.SIZE,6],[w.r.SIZEFEATUREATTRIBUTE,6],[w.r.OPACITYFEATUREATTRIBUTE,7],[w.r.OBJECTANDLAYERIDCOLOR,8]]);class I extends S.w{initializeProgram(e){return new T.B(e.rctx,I.shader.get().build(this.configuration),M)}_makePipelineState(e,t){const r=this.configuration,n=e===E.y.NONE,i=e===E.y.FrontFace,o=(0,v.cb)(r.output);return(0,P.Ey)({blending:r.output===v.V.Color?n?b.V0:(0,b.ez)(e):null,depthTest:{func:(0,b.K_)(e)},depthWrite:n?r.writeDepth||o?P.kn:null:(0,b.XO)(e),drawBuffers:r.output===v.V.Depth?{buffers:[D.Hr.NONE]}:(0,b.cl)(e),colorWrite:P.wE,stencilWrite:r.hasOccludees?R.v0:null,stencilTest:r.hasOccludees?t?R.a9:R.qh:null,polygonOffset:n||i?r.hasPolygonOffset?N:null:b.SE})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?N:null;this._occluderPipelineTransparent=(0,P.Ey)({blending:b.V0,polygonOffset:t,depthTest:R.sf,depthWrite:null,colorWrite:P.wE,stencilWrite:null,stencilTest:R.mK,drawBuffers:e.output===v.V.Depth?{buffers:[D.Hr.NONE]}:null}),this._occluderPipelineOpaque=(0,P.Ey)({blending:b.V0,polygonOffset:t,depthTest:R.sf,depthWrite:null,colorWrite:P.wE,stencilWrite:R.r8,stencilTest:R.I$,drawBuffers:e.output===v.V.Depth?{buffers:[D.Hr.NONE]}:null}),this._occluderPipelineMaskWrite=(0,P.Ey)({blending:null,polygonOffset:t,depthTest:R.m,depthWrite:null,colorWrite:null,stencilWrite:R.v0,stencilTest:R.a9,drawBuffers:e.output===v.V.Depth?{buffers:[D.Hr.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?D.WR.LINES:D.WR.TRIANGLE_STRIP}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}I.shader=new O.$(x.R,(()=>r.e(1721).then(r.bind(r,61721))));const N={factor:0,units:-4};var L,F=r(46259);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(L||(L={}));class z extends m.im{constructor(e){super(e,new j),this._configuration=new F.Q,this.produces=new Map([[_.N.OPAQUE_MATERIAL,e=>e===v.V.Highlight||e===v.V.ObjectAndLayerIdColor||e===v.V.Color&&this.parameters.renderOccluded===m.m$.OccludeAndTransparentStencil],[_.N.OPAQUE_NO_SSAO_DEPTH,e=>(0,v.eh)(e)],[_.N.OCCLUDER_MATERIAL,e=>(0,v.MO)(e)&&this.parameters.renderOccluded===m.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,v.MO)(e)&&this.parameters.renderOccluded===m.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_MATERIAL,e=>e===v.V.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==m.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>e===v.V.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==m.m$.OccludeAndTransparentStencil],[_.N.DRAPED_MATERIAL,e=>(0,v.i3)(e)]]),this._vertexAttributeLocations=M}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===_.N.DRAPED_MATERIAL;const r=null!=this.parameters.stipplePattern&&e!==v.V.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===A.kJ.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===m.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,n,i,s){if(!r.options.selectionMode)return;const a=e.attributes.get(w.r.POSITION).data,l=e.attributes.get(w.r.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(w.r.SIZEFEATUREATTRIBUTE).data[0];c*=(0,o.qE)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const d=n[0],h=n[1],u=(c/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let v=0;v<a.length-5;v+=3){const e=a[v],t=a[v+1],r=d-e,n=h-t,i=a[v+3]-e,s=a[v+4]-t,l=(0,o.qE)((i*r+s*n)/(i*i+s*s),0,1),c=i*l-r,u=s*l-n,g=c*c+u*u;g<p&&(p=g,f=v/3)}p<u*u&&i(s.dist,s.normal,f,!1)}intersect(e,t,r,n,s,c){if(!r.options.selectionMode||!e.visible)return;if(!(0,y.zH)(t))return void i.A.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const d=e.attributes,f=d.get(w.r.POSITION).data;let v=this.parameters.width;if(this.parameters.vvSize){const e=d.get(w.r.SIZEFEATUREATTRIBUTE).data[0];v*=(0,o.qE)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else d.has(w.r.SIZE)&&(v*=d.get(w.r.SIZE).data[0]);const g=r.camera,m=q;(0,a.C)(m,r.point);const _=v*g.pixelRatio/2+4*g.pixelRatio;(0,l.s)(ne[0],m[0]-_,m[1]+_,0),(0,l.s)(ne[1],m[0]+_,m[1]+_,0),(0,l.s)(ne[2],m[0]+_,m[1]-_,0),(0,l.s)(ne[3],m[0]-_,m[1]-_,0);for(let i=0;i<4;i++)if(!g.unprojectFromRenderScreen(ne[i],ie[i]))return;(0,p.Cr)(g.eye,ie[0],ie[1],oe),(0,p.Cr)(g.eye,ie[1],ie[2],se),(0,p.Cr)(g.eye,ie[2],ie[3],ae),(0,p.Cr)(g.eye,ie[3],ie[0],le);let C=Number.MAX_VALUE,A=0;const x=W(this.parameters,d)?f.length-2:f.length-5;for(let i=0;i<x;i+=3){B[0]=f[i]+t[12],B[1]=f[i+1]+t[13],B[2]=f[i+2]+t[14];const e=(i+3)%f.length;if(G[0]=f[e]+t[12],G[1]=f[e+1]+t[13],G[2]=f[e+2]+t[14],(0,p.mN)(oe,B)<0&&(0,p.mN)(oe,G)<0||(0,p.mN)(se,B)<0&&(0,p.mN)(se,G)<0||(0,p.mN)(ae,B)<0&&(0,p.mN)(ae,G)<0||(0,p.mN)(le,B)<0&&(0,p.mN)(le,G)<0)continue;if(g.projectToRenderScreen(B,Y),g.projectToRenderScreen(G,X),Y[2]<0&&X[2]>0){(0,l.f)(Z,B,G);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],B)/(0,l.m)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(Z,Z,t),(0,l.g)(B,B,Z),g.projectToRenderScreen(B,Y)}else if(Y[2]>0&&X[2]<0){(0,l.f)(Z,G,B);const e=g.frustum,t=-(0,p.mN)(e[h.FB.NEAR],G)/(0,l.m)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.j)(Z,Z,t),(0,l.g)(G,G,Z),g.projectToRenderScreen(G,X)}else if(Y[2]<0&&X[2]<0)continue;Y[2]=0,X[2]=0;const r=(0,u.kb)((0,u.Cr)(Y,X,$),m);r<C&&(C=r,(0,l.c)(Q,B),(0,l.c)(J,G),A=i/3)}const O=r.rayBegin,S=r.rayEnd;if(C<_*_){let e=Number.MAX_VALUE;if((0,u.ld)((0,u.Cr)(Q,J,$),(0,u.Cr)(O,S,K),k)){(0,l.f)(k,k,O);const t=(0,l.l)(k);(0,l.j)(k,k,1/t),e=t/(0,l.p)(O,S)}c(e,k,A,!1)}}get _layout(){const e=(0,f.BP)().vec3f(w.r.POSITION).vec3f(w.r.PREVPOSITION).vec3f(w.r.NEXTPOSITION).f32(w.r.SUBDIVISIONFACTOR).vec2f(w.r.UV0);return this.parameters.vvSize?e.f32(w.r.SIZEFEATUREATTRIBUTE):e.f32(w.r.SIZE),this.parameters.vvColor?e.f32(w.r.COLORFEATUREATTRIBUTE):e.vec4f(w.r.COLOR),this.parameters.vvOpacity&&e.f32(w.r.OPACITYFEATUREATTRIBUTE),(0,n.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(w.r.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new H(this._layout,this.parameters)}createGLMaterial(e){return new V(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class V extends g.A{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===v.V.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(I,e)}}class j extends C.S{constructor(){super(...arguments),this.width=0,this.color=d.Un,this.join="miter",this.cap=F.x.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class H{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=x.r+r}}_isClosed(e){return W(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(w.r.POSITION).indices.length/2+1,r=this._isClosed(e);let n=r?2:4;return n+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,t,r,i,o){var s,a,c,d,h;const u=ee,p=te,f=re,v=r.attributes.get(w.r.POSITION),g=v.indices,m=v.data.length/3,_=null===(s=r.attributes.get(w.r.DISTANCETOSTART))||void 0===s?void 0:s.data;g&&g.length!==2*(m-1)&&console.warn("RibbonLineMaterial does not support indices");const y=null!==(a=null!==(c=null===(d=r.attributes.get(w.r.SIZEFEATUREATTRIBUTE))||void 0===d?void 0:d.data[0])&&void 0!==c?c:null===(h=r.attributes.get(w.r.SIZE))||void 0===h?void 0:h.data[0])&&void 0!==a?a:1;let C=[1,1,1,1],A=0;const x=this.vertexBufferLayout.fields.has(w.r.COLORFEATUREATTRIBUTE);x?A=r.attributes.get(w.r.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(w.r.COLOR)&&(C=r.attributes.get(w.r.COLOR).data);const O=(0,n.A)("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,S=this.vertexBufferLayout.fields.has(w.r.OPACITYFEATUREATTRIBUTE),b=S?r.attributes.get(w.r.OPACITYFEATUREATTRIBUTE).data[0]:0,T=new Float32Array(i.buffer),R=(0,n.A)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(i.buffer):null,E=this.vertexBufferLayout.stride/4;let D=o*E;const P=D;let M=0;const I=_?(e,t,r)=>M=_[r]:(e,t,r)=>M+=(0,l.p)(e,t),N=(0,n.A)("enable-feature:objectAndLayerId-rendering"),F=(e,t,r,n,i,o,s)=>{if(T[D++]=t[0],T[D++]=t[1],T[D++]=t[2],T[D++]=e[0],T[D++]=e[1],T[D++]=e[2],T[D++]=r[0],T[D++]=r[1],T[D++]=r[2],T[D++]=n,T[D++]=s,T[D++]=i,T[D++]=y,x)T[D++]=A;else{const e=Math.min(4*o,C.length-4);T[D++]=C[e],T[D++]=C[e+1],T[D++]=C[e+2],T[D++]=C[e+3]}S&&(T[D++]=b),N&&(null!=O&&(R[4*D]=O[0],R[4*D+1]=O[1],R[4*D+2]=O[2],R[4*D+3]=O[3]),D++)};D+=E,(0,l.s)(p,v.data[0],v.data[1],v.data[2]),e&&(0,l.h)(p,p,e);const z=this._isClosed(r);if(z){const t=v.data.length-3;(0,l.s)(u,v.data[t],v.data[t+1],v.data[t+2]),e&&(0,l.h)(u,u,e)}else(0,l.s)(f,v.data[3],v.data[4],v.data[5]),e&&(0,l.h)(f,f,e),F(p,p,f,1,L.LEFT_CAP_START,0,0),F(p,p,f,1,L.RIGHT_CAP_START,0,0),(0,l.c)(u,p),(0,l.c)(p,f);const V=z?0:1,j=z?m:m-1;for(let n=V;n<j;n++){const t=(n+1)%m*3;(0,l.s)(f,v.data[t],v.data[t+1],v.data[t+2]),e&&(0,l.h)(f,f,e),I(u,p,n),F(u,p,f,0,L.LEFT_JOIN_END,n,M),F(u,p,f,0,L.RIGHT_JOIN_END,n,M);const r=this.numJoinSubdivisions;for(let e=0;e<r;++e){const t=(e+1)/(r+1);F(u,p,f,t,L.LEFT_JOIN_END,n,M),F(u,p,f,t,L.RIGHT_JOIN_END,n,M)}F(u,p,f,1,L.LEFT_JOIN_START,n,M),F(u,p,f,1,L.RIGHT_JOIN_START,n,M),(0,l.c)(u,p),(0,l.c)(p,f)}z?((0,l.s)(f,v.data[3],v.data[4],v.data[5]),e&&(0,l.h)(f,f,e),M=I(u,p,j),F(u,p,f,0,L.LEFT_JOIN_END,V,M),F(u,p,f,0,L.RIGHT_JOIN_END,V,M)):(M=I(u,p,j),F(u,p,p,0,L.LEFT_CAP_END,j,M),F(u,p,p,0,L.RIGHT_CAP_END,j,M)),U(T,P+E,T,P,E),D=U(T,D-E,T,D,E),this._parameters.wireframe&&this._addWireframeVertices(i,P,D,E)}_addWireframeVertices(e,t,r,n){const i=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let s=0;const a=e=>s=U(o,e,i,s,n);for(let l=0;l<o.length-1;l+=2*n)a(l),a(l+2*n),a(l+1*n),a(l+2*n),a(l+1*n),a(l+3*n)}}function U(e,t,r,n,i){for(let o=0;o<i;o++)r[n++]=e[t++];return n}function W(e,t){return!!e.isClosed&&t.get(w.r.POSITION).indices.length>2}const B=(0,c.vt)(),G=(0,c.vt)(),Z=(0,c.vt)(),k=(0,c.vt)(),q=(0,c.vt)(),Y=(0,s.r_)(),X=(0,s.r_)(),Q=(0,c.vt)(),J=(0,c.vt)(),$=(0,u.vt)(),K=(0,u.vt)(),ee=(0,c.vt)(),te=(0,c.vt)(),re=(0,c.vt)(),ne=[(0,s.r_)(),(0,s.r_)(),(0,s.r_)(),(0,s.r_)()],ie=[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()],oe=(0,p.vt)(),se=(0,p.vt)(),ae=(0,p.vt)(),le=(0,p.vt)()},63928:(e,t,r)=>{r.d(t,{W:()=>o});var n=r(45463),i=r(48168);class o extends n.im{intersect(e,t,r,n,o,s){return(0,i.Uy)(e,r,n,o,void 0,s)}}},35925:(e,t,r)=>{r.d(t,{Xq:()=>a,wk:()=>s});const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},i={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null},o=8;function s(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return null!=e&&"style"===e.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(i[e],o):null}(e.style):null}},50125:(e,t,r)=>{r.d(t,{Dt:()=>d,kJ:()=>i,lM:()=>n});var n,i,o=r(35143),s=r(34981),a=r(99415),l=r(10773),c=r(92656);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(n||(n={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(i||(i={}));class d extends c.E{constructor(){super(...arguments),this.output=s.V.Color,this.transparencyPassType=l.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=n.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=i.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===n.Draped}}(0,o._)([(0,a.W)({count:s.V.COUNT})],d.prototype,"output",void 0),(0,o._)([(0,a.W)({count:l.y.COUNT})],d.prototype,"transparencyPassType",void 0),(0,o._)([(0,a.W)()],d.prototype,"occluder",void 0),(0,o._)([(0,a.W)()],d.prototype,"hasSlicePlane",void 0),(0,o._)([(0,a.W)()],d.prototype,"writeDepth",void 0),(0,o._)([(0,a.W)({count:n.COUNT})],d.prototype,"space",void 0),(0,o._)([(0,a.W)()],d.prototype,"hideOnShortSegments",void 0),(0,o._)([(0,a.W)()],d.prototype,"hasCap",void 0),(0,o._)([(0,a.W)({count:i.COUNT})],d.prototype,"anchor",void 0),(0,o._)([(0,a.W)()],d.prototype,"hasTip",void 0),(0,o._)([(0,a.W)()],d.prototype,"vvSize",void 0),(0,o._)([(0,a.W)()],d.prototype,"vvColor",void 0),(0,o._)([(0,a.W)()],d.prototype,"vvOpacity",void 0),(0,o._)([(0,a.W)()],d.prototype,"hasOccludees",void 0),(0,o._)([(0,a.W)()],d.prototype,"multipassEnabled",void 0),(0,o._)([(0,a.W)()],d.prototype,"cullAboveGround",void 0),(0,o._)([(0,a.W)({constValue:!1})],d.prototype,"occlusionPass",void 0),(0,o._)([(0,a.W)({constValue:!0})],d.prototype,"hasVvInstancing",void 0),(0,o._)([(0,a.W)({constValue:!0})],d.prototype,"hasSliceTranslatedView",void 0)},46259:(e,t,r)=>{r.d(t,{Q:()=>c,x:()=>n});var n,i=r(35143),o=r(34981),s=r(99415),a=r(10773),l=r(92656);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(n||(n={}));class c extends l.E{constructor(){super(...arguments),this.output=o.V.Color,this.capType=n.BUTT,this.transparencyPassType=a.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,i._)([(0,s.W)({count:o.V.COUNT})],c.prototype,"output",void 0),(0,i._)([(0,s.W)({count:n.COUNT})],c.prototype,"capType",void 0),(0,i._)([(0,s.W)({count:a.y.COUNT})],c.prototype,"transparencyPassType",void 0),(0,i._)([(0,s.W)()],c.prototype,"occluder",void 0),(0,i._)([(0,s.W)()],c.prototype,"hasSlicePlane",void 0),(0,i._)([(0,s.W)()],c.prototype,"hasPolygonOffset",void 0),(0,i._)([(0,s.W)()],c.prototype,"writeDepth",void 0),(0,i._)([(0,s.W)()],c.prototype,"draped",void 0),(0,i._)([(0,s.W)()],c.prototype,"stippleEnabled",void 0),(0,i._)([(0,s.W)()],c.prototype,"stippleOffColorEnabled",void 0),(0,i._)([(0,s.W)()],c.prototype,"stipplePreferContinuous",void 0),(0,i._)([(0,s.W)()],c.prototype,"roundJoins",void 0),(0,i._)([(0,s.W)()],c.prototype,"applyMarkerOffset",void 0),(0,i._)([(0,s.W)()],c.prototype,"vvSize",void 0),(0,i._)([(0,s.W)()],c.prototype,"vvColor",void 0),(0,i._)([(0,s.W)()],c.prototype,"vvOpacity",void 0),(0,i._)([(0,s.W)()],c.prototype,"falloffEnabled",void 0),(0,i._)([(0,s.W)()],c.prototype,"innerColorEnabled",void 0),(0,i._)([(0,s.W)()],c.prototype,"hasOccludees",void 0),(0,i._)([(0,s.W)()],c.prototype,"multipassEnabled",void 0),(0,i._)([(0,s.W)()],c.prototype,"cullAboveGround",void 0),(0,i._)([(0,s.W)()],c.prototype,"wireframe",void 0),(0,i._)([(0,s.W)()],c.prototype,"objectAndLayerIdColorInstanced",void 0),(0,i._)([(0,s.W)({constValue:!1})],c.prototype,"occlusionPass",void 0),(0,i._)([(0,s.W)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,i._)([(0,s.W)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0)},33062:(e,t,r)=>{r.d(t,{A:()=>S});var n=r(35143),i=r(91967),o=r(76460),s=r(15941),a=r(76931),l=r(46053),c=(r(81806),r(47249),r(85842)),d=r(34761),h=r(13191),u=r(19555),p=r(72745),f=r(20664),v=r(9392),g=r(43047),m=r(55855),_=r(4763),y=r(95925),w=r(96190),C=r(64465);var A,x=r(13840);let O=A=class extends i.A{constructor(e){super(e),this._ray=(0,y.vt)(),this._viewport=(0,m.fA)(0,0,1,1),this._padding=(0,m.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.vt)(),this._frustumDirty=!0,this._frustum=(0,_.vt)(),this._fullViewport=(0,m.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,v.vt)(),this._up=(0,v.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,f.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,d.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,f.s)((0,v.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,f.s)((0,v.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,f.s)((0,v.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,g.b)((0,m.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,g.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,g.b)((0,m.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,g.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[x.zj.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[x.zj.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[x.zj.RIGHT]+this._padding[x.zj.LEFT]}set fullWidth(e){this.width=e-(this._padding[x.zj.RIGHT]+this._padding[x.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[x.zj.TOP]+this._padding[x.zj.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[x.zj.TOP]+this._padding[x.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[x.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[x.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,g.a)(this._padding,e)||(this._viewport[0]+=e[x.zj.LEFT]-this._padding[x.zj.LEFT],this._viewport[1]+=e[x.zj.BOTTOM]-this._padding[x.zj.BOTTOM],this._viewport[2]-=e[x.zj.RIGHT]+e[x.zj.LEFT]-(this._padding[x.zj.RIGHT]+this._padding[x.zj.LEFT]),this._viewport[3]-=e[x.zj.TOP]+e[x.zj.BOTTOM]-(this._padding[x.zj.TOP]+this._padding[x.zj.BOTTOM]),(0,g.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,d.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,d.B8)((0,h.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,f.p)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,d.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,d.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,n=r*this._aspect,i=r/this.rows,o=n/this.columns,s=-n/2+this.column*o,a=s+o,l=-r/2+this.row*i,c=l+i,u=(0,d.$h)((0,h.vt)(),s*(1+2*this._padding[x.zj.LEFT]/e),a*(1+2*this._padding[x.zj.RIGHT]/e),l*(1+2*this._padding[x.zj.BOTTOM]/t),c*(1+2*this._padding[x.zj.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,d.aI)(p,u)?p:u}copyFrom(e){(0,f.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,g.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,g.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,u.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,d.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,_.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,d.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,g.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new A).copyFrom(this)}equals(e){return(0,f.e)(this.eye,e.eye)&&(0,f.e)(this.center,e.center)&&(0,f.e)(this.up,e.up)&&(0,g.a)(this._viewport,e.viewport)&&(0,g.a)(this._padding,e.padding)&&(0,u.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,g.d)(e.screenPadding,this.screenPadding)>=t||(0,g.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,f.z)(R,e.eye,e.center),(0,f.z)(E,this.eye,this.center);const r=(0,f.m)(R,E),n=(0,f.x)(R),i=(0,f.x)(E),o=5e-4;return r*r>=(1-1e-10)*n*i&&(0,f.w)(e.eye,this.eye)<Math.max(n,i)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,w.gr)(this.viewForward,(0,f.f)(R,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.gs)();return e[0]=(this.padding[x.zj.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[x.zj.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[x.zj.LEFT]+this.width*t,e[1]=this.padding[x.zj.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==b&&(0,f.c)(b,e),b[3]=1,(0,g.t)(b,b,this.projectionMatrix);const r=Math.abs(b[3]);(0,f.j)(b,b,1/r);const n=this.fullViewport;t[0]=(0,s.Cc)(0,n[0]+n[2],.5+.5*b[0]),t[1]=(0,s.Cc)(0,n[1]+n[3],.5+.5*b[1]),t[2]=.5*(b[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;b[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],b[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],b[2]=(2*e[2]-1)*e[3],b[3]=e[3],null!=this.inverseProjectionMatrix&&((0,g.t)(b,b,this.inverseProjectionMatrix),t[0]=b[0],t[1]=b[1],t[2]=b[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,D),this.renderToScreen(D,t),t}projectToRenderScreen(e,t){if(b[0]=e[0],b[1]=e[1],b[2]=e[2],b[3]=1,(0,g.t)(b,b,this.viewProjectionMatrix),0===b[3])return null;const r=b;(0,f.j)(r,r,1/Math.abs(b[3]));const n=this.fullViewport,i=(0,s.Cc)(0,n[0]+n[2],.5+.5*r[0]),o=(0,s.Cc)(0,n[1]+n[3],.5+.5*r[1]);return"x"in t?(t.x=i,t.y=o):(t[0]=i,t[1]=o,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,D),t)}unprojectFromRenderScreen(e,t){if((0,d.lw)(T,this.projectionMatrix,this.viewMatrix),!(0,d.B8)(T,T))return null;const r=this.fullViewport;return b[0]=2*(e[0]-r[0])/r[2]-1,b[1]=2*(e[1]-r[1])/r[3]-1,b[2]=2*e[2]-1,b[3]=1,(0,g.t)(b,b,T),0===b[3]?null:(t[0]=b[0]/b[3],t[1]=b[1]/b[3],t[2]=b[2]/b[3],t)}constrainWindowSize(e,t,r,n){const i=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(i-r/2,0),a=Math.max(this.fullHeight-o-n/2,0),l=-Math.min(i-r/2,0),c=-Math.min(this.fullHeight-o-n/2,0),d=r-l- -Math.min(this.fullWidth-i-r/2,0),h=n-c- -Math.min(o-n/2,0);return[Math.round(s),Math.round(a),Math.round(d),Math.round(h)]}computeUp(e){e===C.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=n,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=n}_computeUpGlobal(){(0,f.f)(R,this.center,this.eye);const e=(0,f.l)(this.center);e<1?((0,f.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,f.m)(R,this.center))>.9999*(0,f.l)(R)*e||((0,f.b)(this._up,R,this.center),(0,f.b)(this._up,this._up,R),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,f.E)(R,this.eye,this.center),Math.abs(R[2])<=.9999&&((0,f.j)(R,R,R[2]),(0,f.s)(this._up,-R[0],-R[1],1-R[2]),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,f.e)(e,t)||((0,f.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):o.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,_.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,d.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,n._)([(0,l.MZ)()],O.prototype,"_viewport",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_padding",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_fov",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_nearFar",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_viewDirty",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_viewMatrix",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_pixelRatio",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"pixelRatio",null),(0,n._)([(0,l.MZ)()],O.prototype,"row",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"column",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"_rows",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"rows",null),(0,n._)([(0,l.MZ)()],O.prototype,"_columns",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"columns",null),(0,n._)([(0,l.MZ)()],O.prototype,"eye",null),(0,n._)([(0,l.MZ)()],O.prototype,"center",null),(0,n._)([(0,l.MZ)()],O.prototype,"_center",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"up",null),(0,n._)([(0,l.MZ)()],O.prototype,"_up",void 0),(0,n._)([(0,l.MZ)()],O.prototype,"viewMatrix",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"viewForward",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"viewUp",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"viewRight",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"nearFar",null),(0,n._)([(0,l.MZ)()],O.prototype,"near",null),(0,n._)([(0,l.MZ)()],O.prototype,"far",null),(0,n._)([(0,l.MZ)()],O.prototype,"viewport",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"screenViewport",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"screenPadding",null),(0,n._)([(0,l.MZ)()],O.prototype,"x",null),(0,n._)([(0,l.MZ)()],O.prototype,"y",null),(0,n._)([(0,l.MZ)()],O.prototype,"width",null),(0,n._)([(0,l.MZ)()],O.prototype,"height",null),(0,n._)([(0,l.MZ)()],O.prototype,"fullWidth",null),(0,n._)([(0,l.MZ)()],O.prototype,"fullHeight",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"_aspect",null),(0,n._)([(0,l.MZ)()],O.prototype,"padding",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"projectionMatrix",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"inverseProjectionMatrix",null),(0,n._)([(0,l.MZ)()],O.prototype,"fov",null),(0,n._)([(0,l.MZ)()],O.prototype,"fovX",null),(0,n._)([(0,l.MZ)()],O.prototype,"fovY",null),(0,n._)([(0,l.MZ)()],O.prototype,"viewInverseTransposeMatrix",null),(0,n._)([(0,l.MZ)({readOnly:!0})],O.prototype,"_projectionMatrixInternal",null),(0,n._)([(0,l.MZ)()],O.prototype,"relativeElevation",void 0),O=A=(0,n._)([(0,c.$)("esri.views.3d.webgl.RenderCamera")],O);const S=O,b=(0,m.vt)(),T=(0,h.vt)(),R=(0,v.vt)(),E=(0,v.vt)(),D=(0,a.r_)()},76718:(e,t,r)=>{r.d(t,{g:()=>c});var n=r(18690),i=(r(81806),r(76460)),o=r(78393),s=r(61678),a=r(93345);const l=()=>i.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,r){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,a.NZ.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new c(e,a.NZ.UNIFORM_BUFFER,t,r)}static createPixelPack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_READ,r=arguments.length>2?arguments[2]:void 0;const n=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return r&&n.setSize(r),n}static createPixelUnpack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STREAM_DRAW,r=arguments.length>2?arguments[2]:void 0;return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a._U.STATIC_DRAW,r=arguments.length>2?arguments[2]:void 0;const n=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return n.setSize(r),n}constructor(e,t,r,n){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,s.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER?this._indexType===a.pe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){var e;null!==(e=this._context)&&void 0!==e&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,o.jq)(e)&&(t/=2,this._indexType=a.pe.UNSIGNED_SHORT),(0,o.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=t?n.bufferData(this.bufferType,t,this.usage):n.bufferData(this.bufferType,e,this.usage),(0,s.Y2)(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,n){if(!e)return;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,n-r),(0,s.Y2)(o),this._isVAOAware&&this._context.bindVAO(i)}getSubData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(r<0||i<0)return;const o=function(e){return(0,n.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(o*((null!==r&&void 0!==r?r:0)+(null!==i&&void 0!==i?i:0))>e.byteLength)return;t+o*(null!==i&&void 0!==i?i:0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const s=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),s.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,r,i),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),s.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,r,i),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;await this._context.clientWaitAsync(),this.getSubData(e,t,r,n)}}},36911:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(76460),i=r(30726),o=r(78393),s=r(93345),a=r(27207);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=r,this._buffers=n,this._indexBuffer=i,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*o.zQ}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers){var e;null!==(e=this._buffers[t])&&void 0!==e&&e.dispose(),delete this._buffers[t]}this._indexBuffer=(0,i.WD)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const i in e){const r=e[i];r||l().error("Vertex buffer is uninitialized!");const n=t[i];n||l().error("Vertex element descriptor is empty!"),(0,a.yu)(this._context,this._locations,r,n)}null!=r&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},21812:(e,t,r)=>{r.d(t,{_:()=>n});class n{constructor(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=e,this.count=t,this.type=r,this.offset=n,this.stride=i,this.normalized=o,this.divisor=s}}}}]);
//# sourceMappingURL=8429.c2c456dc.chunk.js.map