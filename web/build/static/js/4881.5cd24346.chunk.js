"use strict";(self.webpackChunkRDIS_Web_Application=self.webpackChunkRDIS_Web_Application||[]).push([[4881],{34881:(e,t,s)=>{s.d(t,{Upload:()=>f});var o=s(35143),r=s(91967),i=s(98773),l=s(50076),n=s(79053),a=s(50346),p=s(46053),h=(s(81806),s(76460),s(47249),s(85842)),u=s(19247),c=s(53195),d=s(19463),g=s(91364);let f=class extends r.A{constructor(){super({}),this.files=[],this.progress=0,this._uploadTask=null,this._layer=null}destroy(){this.cancel(),this.files=[],this._layer=null,this._uploadTask=null}get state(){const e=this._uploadTask;return e&&0!==this.files.length?e.finished?e.error?"error":"success":"pending":"default"}get result(){return this._uploadTask?.value??null}get error(){return this._uploadTask?.error??null}uploadTo(e){this.cancel(),this.files=[],this._layer=e,this._uploadTask=(0,i.UT)((async t=>{const s=await async function(e){const{resolve:t,promise:s}=(0,a.Tw)(),o=document.createElement("input");o.type="file",o.multiple=!1,o.accept=[...(0,d.hK)(e.infoFor3D),".zip"].join(","),o.style.display="none",document.body.appendChild(o);const r=(0,n.on)(o,"change",(()=>t(o.files?Array.from(o.files):[])));return m?m(o):o.click(),s.finally((()=>{r.remove(),o.remove()}))}(e);(0,a.Te)(t),this.progress=0,this.files=s;const o=(0,g.XA)(c.y.upload,(e=>{this.progress=e}),"Upload.uploadTo");if(0===s.length)return null;(0,a.Te)(t);const r=await e.extractAndFilterFiles(s);(0,a.Te)(t),r.length>0&&(this.files=r);const i=new u.A({x:0,y:0,z:0,spatialReference:e.spatialReference}),p=await e.convertMesh(r,{location:i,signal:t,onProgress:o.makeOnProgress("createFromFiles")});if((0,a.Te)(t),!p)throw new l.A("editor:upload","could not upload or convert model");const h=r.reduce(((e,t)=>e+t.size),0),f=o.simulate("loadMesh",(0,g.V7)(h));try{await p.load()}finally{f.remove()}return p}))}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){this._uploadTask?.abort()}};(0,o._)([(0,p.MZ)()],f.prototype,"files",void 0),(0,o._)([(0,p.MZ)()],f.prototype,"progress",void 0),(0,o._)([(0,p.MZ)()],f.prototype,"state",null),(0,o._)([(0,p.MZ)()],f.prototype,"result",null),(0,o._)([(0,p.MZ)()],f.prototype,"error",null),(0,o._)([(0,p.MZ)()],f.prototype,"_uploadTask",void 0),(0,o._)([(0,p.MZ)()],f.prototype,"_layer",void 0),f=(0,o._)([(0,h.$)("esri.widgets.Editor.Upload")],f);let m=null},53195:(e,t,s)=>{s.d(t,{y:()=>o});const o={upload:{createFromFiles:.8,loadMesh:.2},uploadAssetBlobs:{prepareAssetItems:.9,uploadAssetItems:.1},uploadConvertibleSource:{uploadEditSource:.5,serviceAssetsToGlb:.5},uploadLocalMesh:{meshToAssetBlob:.5,uploadAssetBlobs:.5}}},91364:(e,t,s)=>{s.d(t,{V7:()=>h,XA:()=>n,aG:()=>p,sL:()=>u});var o=s(54901),r=s(81806),i=s(87663),l=s(91417);function n(e){return new a(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{},arguments.length>2?arguments[2]:void 0)}class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{},s=arguments.length>2?arguments[2]:void 0;if(this.onProgress=t,this.taskName=s,this._progressMap=new Map,this._startTime=void 0,this._timingsMap=new Map,"number"==typeof e){this._weights={};for(let t=0;t<e;t++){const s=t,o=1/e;this._weights[s]=o,this._progressMap.set(s,0)}}else this._weights=e;this.emitProgress()}emitProgress(){let e=0;for(const[t,s]of this._progressMap.entries())e+=s*this._weights[t];if(1===e&&(0,r.A)("enable-feature:esri-3dofl-upload-timings")){const e=Math.round(performance.now()-(this._startTime??0))/1e3;console.log(`${this.taskName} done in ${e} sec`);for(const[t,s]of this._timingsMap){const o=Math.round(s.end-s.start)/1e3,r=Math.round(o/e*100);console.log(this.taskName??"Task",{stepKey:t,stepTime:o,relativeTime:r})}}this.onProgress(e)}setProgress(e,t){if(this._progressMap.set(e,t),(0,r.A)("enable-feature:esri-3dofl-upload-timings")){const s=performance.now();this._startTime??=s;const o=(0,i.tE)(this._timingsMap,e,(()=>({start:s,end:0})));1===t&&(o.end=s)}this.emitProgress()}simulate(e,t){return p((t=>this.setProgress(e,t)),t)}makeOnProgress(e){return t=>this.setProgress(e,t)}}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;const s=performance.now();e(0);const r=setInterval((()=>{const o=performance.now()-s,r=1-Math.exp(-o/t);e(r)}),f);return(0,o.hA)((()=>{clearInterval(r),e(1)}))}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;return(0,l.gr)((0,l.Kp)(e*g/t))}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return(0,l.gr)((0,l.Kp)(e*g/t))}const c=10,d=10,g=8e-6,f=(0,l.l5)(50),m=(0,l.l5)(1e3)}}]);
//# sourceMappingURL=4881.5cd24346.chunk.js.map