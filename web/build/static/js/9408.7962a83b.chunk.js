"use strict";(self.webpackChunkRDIS_Web_Application=self.webpackChunkRDIS_Web_Application||[]).push([[9408],{2522:(e,t,i)=>{i.d(t,{P:()=>l});var s=i(35143),a=i(54901),n=i(91291),r=i(46053),o=(i(81806),i(76460),i(47249),i(85842));const l=e=>{let t=class extends((0,n.g)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,a.hA)((()=>this._interactiveViewModelCount--))}};return(0,s._)([(0,r.MZ)({constructOnly:!0})],t.prototype,"parent",void 0),(0,s._)([(0,r.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,s._)([(0,r.MZ)({type:Boolean})],t.prototype,"interactive",null),(0,s._)([(0,r.MZ)()],t.prototype,"_userInteractive",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],t.prototype,"updating",null),(0,s._)([(0,r.MZ)()],t.prototype,"visible",null),(0,s._)([(0,r.MZ)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,s._)([(0,o.$)("esri.views.3d.analysis.AnalysisView3D")],t),t}},93131:(e,t,i)=>{i.d(t,{Bw:()=>w,D9:()=>y,DG:()=>c,E3:()=>T,FF:()=>l,Hb:()=>n,I4:()=>g,Jj:()=>C,Ll:()=>p,NT:()=>m,Sw:()=>S,UF:()=>o,YG:()=>O,ZR:()=>v,aE:()=>H,aj:()=>D,c1:()=>h,cE:()=>d,cO:()=>_,lS:()=>u,qD:()=>V,rb:()=>f,sd:()=>A,vA:()=>b,vo:()=>r,xj:()=>M});var s=i(81806),a=i(15941);const n=(0,s.A)("mac")?"Meta":"Control",r="Shift",o=2,l=1.15,d=1.15,h=2500,c=.02,u=Math.cos((0,a.kU)(45)),p=Math.cos((0,a.kU)(5)),v=.95,_=.3,w=2,m=1,V=3,f=11,M=22.5,g=40,b=48,y=2.25,D=4,O=1,C=.3,T=6,A=4,S=1600,H=.4},87027:(e,t,i)=>{i.r(t),i.d(t,{default:()=>gt});var s=i(35143),a=i(91967),n=i(30726),r=i(68134),o=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),d=i(2522),h=i(54901),c=i(69539),u=i(53084),p=i(15941),v=i(34761),_=i(13191),w=i(20664),m=i(9392),V=(i(19555),i(72745)),f=i(63391),M=(i(75762),i(38317)),g=i(7947);function b(e,t){let{tiltedUpVector:i,rightVector:s,observerRenderSpace:a}=e;const n=(0,M.wQ)(i,s,a,t);return n[12]=0,n[13]=0,n[14]=0,n}function y(e,t,i){const s=(0,m.vt)(),a=(0,w.b)((0,m.vt)(),i.basis1,i.basis2);return e.next((0,g.AA)(t,i.plane)).next((e=>{"start"===e.action&&(0,w.c)(s,e.renderStart);const t=(0,p.KJ)((0,M.FY)(s,e.renderEnd,i.origin,a));return{...e,deltaAngle:t}}))}function D(e,t){if(null==e)return 0;const{observer:i,target:s}=e,a=t.camera.position,n=(0,f.distance)(a,i)>(0,f.distance)(a,s)?i:s;return t.pixelSizeAt(n)}(0,V.vt)();var O=i(7256),C=i(45463),T=i(35925);const A=new c.A([85,85,85,.5]);let S=class extends a.A{constructor(e){super(e),this.visible=!0,this._viewshedCorners={topLeft:(0,m.vt)(),topRight:(0,m.vt)(),bottomLeft:(0,m.vt)(),bottomRight:(0,m.vt)(),center:(0,m.vt)()},this._arcCenterPoints={top:(0,m.vt)(),bottom:(0,m.vt)(),left:(0,m.vt)(),right:(0,m.vt)()},this._parallelCenters={top:(0,m.vt)(),bottom:(0,m.vt)()}}initialize(){const e={view:this.view,isDecoration:!0,color:this._color,renderOccluded:C.m$.OccludeAndTransparent},t={...e,width:2,stipplePattern:(0,T.wk)(2)};this._boundaryLinesVisualElement=new O.t(e),this._leftArcVisualElement=new O.t(e),this._rightArcVisualElement=new O.t(e),this._topArcVisualElement=new O.t(e),this._bottomArcVisualElement=new O.t(e),this._centralLongitude=new O.t(t),this._centralLatitude=new O.t(t),this.addHandles([(0,r.wB)((()=>{const e=this.viewshedComputedData;if(null===e||void 0===e||!e.isValid())return null;const t=this._offsetScale,i=this._viewshedCorners,s=this._arcCenterPoints,a=this._parallelCenters;return e.cornerPoints(t,i),e.arcCentersPoints(t,s),e.parallelCenterPoints(a),{viewshedComputedData:e,corners:i,arcCenters:s,parallelCenters:a}}),(e=>{null!=e?(this._forEachVisualElement((e=>e.attached=!0)),this._updateVisualElements(e)):this._forEachVisualElement((e=>e.attached=!1))}),{initial:!0,equals:u.aI}),(0,r.wB)((()=>{var e;return{visible:this.visible,horFOV:null===(e=this.viewshedComputedData)||void 0===e?void 0:e.horizontalFieldOfView}}),((e,t)=>{let{visible:i,horFOV:s}=e;i!==(null===t||void 0===t?void 0:t.visible)&&this._forEachVisualElement((e=>e.visible=i)),i&&s!==(null===t||void 0===t?void 0:t.horFOV)&&(this._boundaryLinesVisualElement.visible=360!==s)}),r.Vh),(0,r.wB)((()=>this._color),(e=>this._forEachVisualElement((t=>t.color=e))),r.Vh)])}get _color(){var e,t;const i=this.viewshedComputedData;if(null==i)return c.A.toUnitRGBA(A);const s=this.analysisViewData,a=(null===(e=s.tool)||void 0===e?void 0:e.active)||s.interactive,n=i===s.selectedViewshedComputedData,r=i.viewshed===(null===(t=s.tool)||void 0===t?void 0:t.stagedViewshed),o=a&&(n||r)?this.view.effectiveTheme.accentColor:A;return c.A.toUnitRGBA(o)}get _offsetScale(){return D(this.viewshedComputedData,this.view)}destroy(){this._boundaryLinesVisualElement=(0,n.pR)(this._boundaryLinesVisualElement),this._leftArcVisualElement=(0,n.pR)(this._leftArcVisualElement),this._rightArcVisualElement=(0,n.pR)(this._rightArcVisualElement),this._topArcVisualElement=(0,n.pR)(this._topArcVisualElement),this._bottomArcVisualElement=(0,n.pR)(this._bottomArcVisualElement),this._centralLongitude=(0,n.pR)(this._centralLongitude),this._centralLatitude=(0,n.pR)(this._centralLatitude)}_forEachVisualElement(e){[this._boundaryLinesVisualElement,this._leftArcVisualElement,this._rightArcVisualElement,this._topArcVisualElement,this._bottomArcVisualElement,this._centralLatitude,this._centralLongitude].forEach(e)}_updateVisualElements(e){const{viewshedComputedData:t,corners:i,arcCenters:s,parallelCenters:a}=e;this._updateBoundaryLines(i),this._updateBoundaryArcs(t,i,a),this._updateCentralHelperArcs(t,s)}_updateBoundaryLines(e){this._boundaryLinesVisualElement.geometry=[[e.center,e.topLeft],[e.center,e.topRight],[e.center,e.bottomLeft],[e.center,e.bottomRight]]}_updateBoundaryArcs(e,t,i){const{observerRenderSpace:s,rightVector:a,horizontalFieldOfView:n,tiltedUpVector:r}=e,o=(0,p.kU)(n),l=(0,m.vt)(),d=(0,_.vt)();(0,v.$0)(d,o/2,r),(0,w.h)(l,a,d),H(this._leftArcVisualElement,s,t.bottomLeft,t.topLeft,"forward",l),(0,v.$0)(d,-o/2,r),(0,w.s)(l,0,0,0),(0,w.h)(l,a,d),H(this._rightArcVisualElement,s,t.bottomRight,t.topRight,"forward",l);const h=n>180?"backward":"forward";H(this._topArcVisualElement,i.top,t.topRight,t.topLeft,h,r),H(this._bottomArcVisualElement,i.bottom,t.bottomRight,t.bottomLeft,h,r)}_updateCentralHelperArcs(e,t){const i=e.observerRenderSpace,s=e.horizontalFieldOfView>=180?"backward":"forward";H(this._centralLatitude,i,t.right,t.left,s,e.tiltedUpVector),H(this._centralLongitude,i,t.top,t.bottom,"forward",e.leftVector)}};function H(e,t,i,s,a,n){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5;const o=(0,m.vt)();(0,w.z)(o,i,t);const l=(0,w.H)(o),d=(0,m.vt)();(0,w.z)(d,s,t),(0,w.n)(d,d),(0,w.j)(d,d,l);let h=(0,w.d)(o,d);const c=(0,m.o8)(n);"backward"===a&&((0,w.k)(c,c),h=-(2*Math.PI-h));const u=[],V=Math.ceil(Math.abs(h)/(0,p.kU)(r)),f=(0,_.vt)();(0,v.$0)(f,h/V,c);const M=(0,m.vt)();(0,w.c)(M,o);const g=(0,m.vt)();(0,w.c)(g,i);for(let p=0;p<V;p++){const e=(0,m.vt)();(0,w.c)(e,g),(0,w.h)(M,M,f),(0,w.g)(g,t,M);const i=(0,m.vt)();(0,w.c)(i,g),u.push([e,i])}e.geometry=u}(0,s._)([(0,o.MZ)()],S.prototype,"view",void 0),(0,s._)([(0,o.MZ)()],S.prototype,"analysisViewData",void 0),(0,s._)([(0,o.MZ)()],S.prototype,"viewshedComputedData",void 0),(0,s._)([(0,o.MZ)()],S.prototype,"visible",void 0),(0,s._)([(0,o.MZ)()],S.prototype,"_color",null),(0,s._)([(0,o.MZ)()],S.prototype,"_offsetScale",null),S=(0,s._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedVisualization")],S);const E=S;let R=class extends a.A{get visible(){return this.analysisViewData.visible}constructor(e){super(e)}initialize(){const e=this.analysisViewData,t=(0,r.LF)((()=>this.analysisViewData.viewshedComputedDataHandles),(t=>{let{viewshedComputedData:i}=t;const s=new E({view:this.view,viewshedComputedData:i,analysisViewData:e});return{visualization:s,remove:()=>s.destroy()}}));this._viewshedVisualizations=t,this.addHandles([(0,h.DQ)(t),(0,r.wB)((()=>this.visible),(e=>this._viewshedVisualizations.forEach((t=>{let{visualization:i}=t;return i.visible=e}))))])}};(0,s._)([(0,o.MZ)({constructOnly:!0})],R.prototype,"analysisViewData",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],R.prototype,"view",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0})],R.prototype,"isDecoration",void 0),(0,s._)([(0,o.MZ)()],R.prototype,"visible",null),R=(0,s._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedAnalysisVisualization")],R);i(35238);var Z,F=i(19247);let P=Z=class extends a.A{constructor(e){super(e)}get observer(){var e;return null!==(e=this.viewshed.observer)&&void 0!==e?e:new F.A}get farDistance(){return this.viewshed.farDistance}get farDistanceRenderSpace(){return this.farDistance/this.metersPerUnit}get heading(){return this.viewshed.heading}get tilt(){return this.viewshed.tilt}get tiltParallelToSurface(){return this.tilt-90}get horizontalFieldOfView(){return this.viewshed.horizontalFieldOfView}get verticalFieldOfView(){return this.viewshed.verticalFieldOfView}get observerRenderSpace(){return this._pointToRenderSpace(this.observer,(0,m.vt)())}get target(){const e=this.targetRenderSpace;return this.renderSpaceToPoint(e,this.observer.spatialReference)}get targetRenderSpace(){const{leftVector:e,northVector:t,upVector:i}=this,s=this.observerRenderSpace,a=this.farDistanceRenderSpace,n=(0,m.vt)();return(0,w.j)(n,t,a),k(n,-(0,p.kU)(this.heading),i,n),k(n,-(0,p.kU)(this.tiltParallelToSurface),e,n),(0,w.g)(n,s,n),n}get targetDirection(){const e=(0,w.z)((0,m.vt)(),this.targetRenderSpace,this.observerRenderSpace);return(0,w.n)(e,e)}get tiltedUpVector(){const e=k(this.upVector,-(0,p.kU)(this.tiltParallelToSurface),this.leftVector,(0,m.vt)());return(0,w.n)(e,e)}get _basis(){return this.renderCoordsHelper.basisMatrixAtPosition(this.observerRenderSpace,(0,_.vt)())}get upVector(){const e=this._basis;return(0,m.fA)(e[8],e[9],e[10])}get northVector(){const e=this._basis;return(0,m.fA)(e[4],e[5],e[6])}get leftVector(){const e=this.upVector,t=k(this.northVector,-(0,p.kU)(this.heading),e,(0,m.vt)());return(0,w.b)(t,e,t)}get rightVector(){return(0,w.k)((0,m.vt)(),this.leftVector)}clone(){return new Z({renderCoordsHelper:this.renderCoordsHelper,viewshed:this.viewshed.clone()})}isValid(){return this.viewshed.isValid()}get metersPerUnit(){return this.renderCoordsHelper.spatialReference.metersPerUnit}pointOnSphere(e,t,i){const{observerRenderSpace:s,targetRenderSpace:a}=this,n=(0,w.z)(x,a,s);return k(n,-(0,p.kU)(t),this.leftVector,n),k(n,-(0,p.kU)(e),this.tiltedUpVector,n),(0,w.g)(i,n,s)}cornerPoints(e,t){const i=this.observerRenderSpace,s=this.horizontalFieldOfView/2,a=this.verticalFieldOfView/2,n=this.pointOnSphere(-s,a,W),r=this.pointOnSphere(s,a,q),o=this.pointOnSphere(-s,-a,J),l=this.pointOnSphere(s,-a,X),d=(0,w.z)(j,n,i),h=(0,w.z)($,r,i),c=(0,w.z)(G,o,i),u=(0,w.z)(K,l,i),{horizontalFieldOfView:p}=this,v=I;z(d,h,n,o,i,e,p,t.topLeft,t.bottomLeft,v);const _=N;z(u,c,r,l,i,e,p,t.topRight,t.bottomRight,_),(0,w.j)(t.center,(0,w.g)(t.center,_,v),.5)}arcCentersPoints(e,t){const i=this.horizontalFieldOfView/2,s=this.verticalFieldOfView/2,a=this.pointOnSphere(0,s,t.top),n=this.pointOnSphere(0,-s,t.bottom),r=this.pointOnSphere(-i,0,t.left),o=this.pointOnSphere(i,0,t.right),{observerRenderSpace:l}=this;L(a,l,e),L(n,l,e),L(r,l,e),L(o,l,e)}parallelCenterPoints(e){const t=this.observerRenderSpace,i=this.farDistanceRenderSpace*Math.sin((0,p.kU)(this.verticalFieldOfView/2)),s=(0,w.j)(x,this.tiltedUpVector,i);(0,w.g)(e.top,t,s),(0,w.z)(e.bottom,t,s)}renderSpaceToPoint(e,t){const i=x;return this.renderCoordsHelper.fromRenderCoords(e,i,t),new F.A(i[0],i[1],i[2],t)}_pointToRenderSpace(e,t){const i=(0,m.ci)(e.toArray());return this.renderCoordsHelper.toRenderCoords(i,e.spatialReference,t),t}};function z(e,t,i,s,a,n,r,o,l,d){const h=function(e,t,i,s){const a=(0,w.b)(s,e,t);return(0,w.n)(a,a),(0,w.j)(a,a,i),a}(e,t,n,B);(0,w.g)(d,a,h),U(i,e,h,n,r,o),U(s,e,h,n,r,l)}function k(e,t,i,s){return(0,v.$0)(Y,t,i),(0,w.h)(s,e,Y)}function U(e,t,i,s,a,n){const r=(0,w.n)(x,t);return(0,w.j)(r,r,s),(0,w.g)(n,e,r),0!==a&&360!==a&&(0,w.g)(n,n,i),n}function L(e,t,i){const s=(0,w.z)(x,e,t);(0,w.n)(s,s),(0,w.j)(s,s,i),(0,w.g)(e,e,s)}(0,s._)([(0,o.MZ)()],P.prototype,"renderCoordsHelper",void 0),(0,s._)([(0,o.MZ)()],P.prototype,"viewshed",void 0),(0,s._)([(0,o.MZ)()],P.prototype,"observer",null),(0,s._)([(0,o.MZ)()],P.prototype,"farDistance",null),(0,s._)([(0,o.MZ)()],P.prototype,"farDistanceRenderSpace",null),(0,s._)([(0,o.MZ)()],P.prototype,"heading",null),(0,s._)([(0,o.MZ)()],P.prototype,"tilt",null),(0,s._)([(0,o.MZ)()],P.prototype,"tiltParallelToSurface",null),(0,s._)([(0,o.MZ)()],P.prototype,"horizontalFieldOfView",null),(0,s._)([(0,o.MZ)()],P.prototype,"verticalFieldOfView",null),(0,s._)([(0,o.MZ)()],P.prototype,"observerRenderSpace",null),(0,s._)([(0,o.MZ)()],P.prototype,"target",null),(0,s._)([(0,o.MZ)()],P.prototype,"targetRenderSpace",null),(0,s._)([(0,o.MZ)()],P.prototype,"targetDirection",null),(0,s._)([(0,o.MZ)()],P.prototype,"tiltedUpVector",null),(0,s._)([(0,o.MZ)()],P.prototype,"_basis",null),(0,s._)([(0,o.MZ)()],P.prototype,"upVector",null),(0,s._)([(0,o.MZ)()],P.prototype,"northVector",null),(0,s._)([(0,o.MZ)()],P.prototype,"leftVector",null),(0,s._)([(0,o.MZ)()],P.prototype,"rightVector",null),(0,s._)([(0,o.MZ)()],P.prototype,"isValid",null),(0,s._)([(0,o.MZ)()],P.prototype,"metersPerUnit",null),P=Z=(0,s._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedComputedData")],P);const x=(0,m.vt)(),B=(0,m.vt)(),I=(0,m.vt)(),N=(0,m.vt)(),j=(0,m.vt)(),$=(0,m.vt)(),G=(0,m.vt)(),K=(0,m.vt)(),W=(0,m.vt)(),q=(0,m.vt)(),J=(0,m.vt)(),X=(0,m.vt)(),Y=(0,_.vt)();var Q=i(69098),ee=i(73582),te=i(21403),ie=i(40565);let se=class extends((0,Q.O)(a.A)){constructor(e){super(e),this.observer=null,this.farDistance=1e3,this.heading=0,this.tilt=90,this.horizontalFieldOfView=45,this.verticalFieldOfView=45}isValid(){return null!=this.observer&&this.farDistance>0}equals(e){return(0,n.CM)(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView}};(0,s._)([(0,o.MZ)({type:F.A})],se.prototype,"observer",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0}})],se.prototype,"farDistance",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0}),(0,te.w)((e=>ee.ie.normalize((0,ie.GB)(e))))],se.prototype,"heading",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180}})],se.prototype,"tilt",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}})],se.prototype,"horizontalFieldOfView",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180}})],se.prototype,"verticalFieldOfView",void 0),(0,s._)([(0,o.MZ)()],se.prototype,"isValid",null),se=(0,s._)([(0,l.$)("esri.analysis.Viewshed")],se);const ae=se;var ne=i(13927),re=i(18690),oe=i(9624),le=i(64465),de=i(88321),he=i(79650),ce=i(93131);const ue=ce.aj,pe=ce.UF*ue,ve=.0025,_e=Math.sin((0,p.kU)(2)),we=ce.UF/1.5;var me=i(56121),Ve=i(91175),fe=i(19112),Me=i(60428),ge=i(62577),be=i(86994),ye=i(425),De=i(17046),Oe=i(76336);class Ce extends Me.c{constructor(e){super(),this._handles=new de.A,this._interactive=!0,this._tool=e.tool,this._view=e.view,this._focusedArcMaterial=this._createArcMaterial(!0),this._unfocusedArcMaterial=this._createArcMaterial(!1),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,n.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulators=null}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}createDragPipeline(e,t){const i=Object.values(this._manipulators);return(0,h.vE)(i.map((i=>{let{manipulator:s,side:a}=i;return(0,De.Xt)(s,((i,s,n,r,o)=>{const l=function(e,t){let{observerRenderSpace:i,targetDirection:s,tiltedUpVector:a,rightVector:n}=t;const r=Ae(e)?n:a;return(0,he.f)(i,s,r)}(a,t);Ae(a)?t.horizontalFieldOfView:t.verticalFieldOfView;const d=s.next((e=>({...e,manipulatorType:fe.r.SCALE,side:a}))),h=y(d,this._view,l);e(i,h,n)}))})))}updateManipulatorsTransform(e){this._forEachManipulatorInfo((t=>this._updateArcManipulatorTransform(t,e)))}updateManipulatorVisuals(e){this._forEachManipulatorInfo((t=>this._updateArcManipulatorVisuals(t,e)))}_updateArcManipulatorVisuals(e,t){let{manipulator:i,side:s}=e;const a=[];if(null!=t){if("left"===s&&(t.horizontalFieldOfView<1||t.horizontalFieldOfView>359)||"bottom"===s&&t.verticalFieldOfView<1)return i.renderObjects=[],void(i.collisionType={type:"line",paths:[]});const[e,n]=function(e,t,i){const{horizontalFieldOfView:s,verticalFieldOfView:a}=t,n=Ae(e),r=(0,p.kU)((0,p.qE)((n?a:s)/2,0,15)),o=n?1:Math.max(Math.sin((0,p.kU)(90-a/2)),.1),l=Te(-r/2,r/2,o,[-o,0,0]);return[(0,ge.Z8)(i,l),l]}(s,t,this._unfocusedArcMaterial);a.push(new Ve.M(e,Oe.p7.Unfocused),new Ve.M(e.instantiate({material:this._focusedArcMaterial}),Oe.p7.Focused)),i.collisionType={type:"line",paths:[n]}}i.renderObjects=a,i.radius=10}_updateArcManipulatorTransform(e,t){let{manipulator:i,side:s}=e;const a=t.horizontalFieldOfView,n=(0,p.kU)(t.verticalFieldOfView/2),r=(0,p.kU)(a/2),o=Ae(s);i.location=t.observer;const l=(0,_.vt)(),d=e=>{(0,v.lw)(l,e,l)};d((0,v.i1)(He,(0,p.kU)(-90))),o||d((0,v.hM)(He,n));const h=t.farDistanceRenderSpace;d((0,v.CV)(He,(0,w.s)(Ee,h,h,h))),d((0,v.N9)(He,function(e){return function(e){switch(e){case"left":return 0;case"bottom":return 1;case"right":return 2;case"top":return 3}}(e)*Se}(s))),d(b(t,He));const c=(0,w.z)(Ee,t.targetRenderSpace,t.observerRenderSpace);let u,m;if(d((0,v.kN)(He,c)),o){if(u=r,m=t.tiltedUpVector,0!==a&&360!==a){const e=D(t,this._view);u+=2*Math.tan(e/(2*t.farDistance))}}else m=t.rightVector,u=n;u*="right"===s||"bottom"===s?-1:1;const V=(0,v.$0)(He,u,m);null!=V&&d(V),i.modelTransform=l}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this.interactive||t.grabbing}))}_createManipulators(){const e=this._createArcManipulator("left"),t=this._createArcManipulator("right"),i=this._createArcManipulator("top"),s=this._createArcManipulator("bottom");this._manipulators={left:e,right:t,top:i,bottom:s};const a=[[s.manipulator,i.manipulator],[e.manipulator,t.manipulator]];a.push(...a.map((e=>{let[t,i]=e;return[i,t]}))),this._handles.add(a.map((e=>{let[t,i]=e;return t.events.on("focus-changed",(e=>{const t="focus"===e.action;i.hovering=t}))})))}_createArcManipulator(e){const t={manipulator:new me.q({view:this._view,autoScaleRenderObjects:!1,worldSized:!0}),side:e};return this._updateArcManipulatorVisuals(t),t}_createArcMaterial(e){const t=e?pe:ue,i=new ye.W({renderOccluded:C.m$.OccludeAndTransparent,isDecoration:!0,width:t});return this._handles.add((0,r.wB)((()=>c.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(e=>i.setParameters({color:e})),r.Vh)),i}forEachManipulator(e){Object.values(this._manipulators).forEach((t=>{let{manipulator:i}=t;return e(i,fe.r.SCALE)}))}_forEachManipulatorInfo(e){Object.values(this._manipulators).forEach((t=>e(t)))}}function Te(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;(0,be.vA)(a>1,"createArcPolylineGeometry() needs at least 2 for numVertices");const n=t-e,[r,o,l]=s;if(n<=0||i<=0){const e=.001;return[(0,m.fA)(r,o,l+e),(0,m.fA)(r,o,o+-e)]}const d=[],h=n/a;for(let c=0;c<a;c++){let s=e+c*h;c===a-1&&(s=t);const n=Math.cos(s)*i,u=Math.sin(s)*i,p=(0,m.fA)(n+r,o,u+l);d.push(p)}return d}function Ae(e){return"left"===e||"right"===e}const Se=Math.PI/2,He=(0,_.vt)(),Ee=(0,m.vt)();var Re=i(95925),Ze=i(83490),Fe=i(76956);class Pe extends me.q{constructor(e,t,i,s){super({view:e,autoScaleRenderObjects:!1,worldSized:!0,radius:5}),this._handles=new de.A,this._setupManipulatorVisual(t,i,s)}destroy(){this._handles.remove(),super.destroy()}_setupManipulatorVisual(e,t,i){const s=this._createMaterial(),a=(0,p.kU)(t),n=e?1:Math.sin(a),r=e?Te(0,a,n,[-n,0,0]):[(0,m.fA)(0,0,0),(0,m.fA)(0,0,n)],o=(0,ge.Nb)(s,r,i,16,!1),l=(0,ge.Nb)(s,r,i*ce.UF,16,!1),d=ze(!1,s,i),h=ze(!0,s,i),c=(0,_.vt)();(0,v.kN)(c,r[r.length-1]),(0,v.lK)(c,c,(0,v.hM)(Ue,Math.PI/2)),(0,v.lK)(c,c,(0,v.i1)(Ue,Math.PI/2)),e&&(0,v.lK)(c,c,(0,v.hM)(Ue,-a)),d.transformation=c,h.transformation=c,this.renderObjects=[new Ve.M(o,Oe.p7.Unfocused),new Ve.M(l,Oe.p7.Focused),new Ve.M(d,Oe.p7.Unfocused),new Ve.M(h,Oe.p7.Focused)];const u=(0,m.fA)(0,ke(!0),0),V=(0,w.h)(u,u,c),f=[...r,V];this.collisionType={type:"line",paths:[f]}}_createMaterial(){const e=new Fe.v({cullFace:Ze.s2.Back,renderOccluded:C.m$.OccludeAndTransparent,isDecoration:!0,writeLinearDepth:!0});return this._handles.add((0,r.wB)((()=>c.A.toUnitRGBA(this.view.effectiveTheme.accentColor)),(t=>e.setParameters({color:t})),r.Vh)),e}}function ze(e,t,i){const s=ke(e);let a=2*i;e&&(a*=ce.UF);const n=s/2;return(0,ge._B)(t,s,n,n,a,0)}function ke(e){let t=_e;return e&&(t*=we),t}const Ue=(0,_.vt)();class Le extends Me.c{constructor(e){super(),this._handles=new de.A,this._interactive=!0,this._tool=e.tool,this._view=e.view,this._manipulatorHeading=new Pe(this._view,!0,5,ve),this._manipulatorTilt=new Pe(this._view,!0,5,ve),this._manipulatorDistance=new Pe(this._view,!1,5,ve),this.forEachManipulator((e=>{this._tool.manipulators.add(e),this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._manipulatorHeading=null,this._manipulatorTilt=null,this._manipulatorDistance=null,this._tool=null,this._view=null}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}createHeadingDragPipeline(e,t){return(0,De.Xt)(this._manipulatorHeading,((i,s,a,n,r)=>{const{_view:o}=this,l=Math.sin((0,p.kU)(t.tiltParallelToSurface))*t.farDistanceRenderSpace,d=(0,w.g)(Ne,t.observerRenderSpace,(0,w.j)(je,t.upVector,l)),h=(0,w.b)(je,t.northVector,t.upVector),c=y(s,o,(0,he.f)(d,t.northVector,h)).next((e=>({...e,manipulatorType:fe.r.ROTATE})));e(i,c,a)}))}createTiltDragPipeline(e,t){return(0,De.Xt)(this._manipulatorTilt,((i,s,a,n,r)=>{const o=(0,he.f)(t.observerRenderSpace,t.targetDirection,t.tiltedUpVector),l=y(s,this._view,o).next((e=>({...e,manipulatorType:fe.r.ROTATE})));e(i,l,a)}))}createDistanceDragPipeline(e,t){return(0,De.Xt)(this._manipulatorDistance,((i,s,a,n,r)=>{const o=(0,Re.fA)(t.observerRenderSpace,t.targetDirection),l=s.next((0,De.Tp)(this._view,i.location)).next((0,g.ov)(this._view,o)).next((e=>({...e,manipulatorType:fe.r.SCALE})));e(i,l,a)}))}updateManipulators(e){const{target:t}=e;this._manipulatorHeading.location=t,this._manipulatorTilt.location=t,this._manipulatorDistance.location=t;const i=(0,_.vt)(),s=e=>{(0,v.lw)(i,e,i)},a=function(e){const t=1,{verticalFieldOfView:i,horizontalFieldOfView:s}=e,a=i>180,n=s>180,r=e.farDistanceRenderSpace;if(a&&n)return Math.max(t,r);e.arcCentersPoints(r,xe);const{left:o,right:l,top:d,bottom:h}=xe,c=1.9*(a?(0,w.p)(o,l):n?(0,w.p)(h,o):Math.sqrt(Math.min((0,w.a)(h,d),(0,w.a)(o,l))));return Math.max(t,Math.min(r,c))}(e);s((0,v.CV)(Be,(0,w.s)(Ne,a,a,a))),s(b(e,Be));const n=ve*ce.UF*a,r=(0,w.j)(Ne,e.targetDirection,n);s((0,v.kN)(Be,r));const o=(0,v.N9)(Be,-$e);(0,v.lK)(o,o,(0,v.i1)(Ie,-$e)),this._manipulatorHeading.modelTransform=(0,v.lK)((0,_.vt)(),i,o);const l=(0,v.i1)(Be,$e);(0,v.lK)(l,l,(0,v.N9)(Ie,Math.PI)),this._manipulatorTilt.modelTransform=(0,v.lw)((0,_.vt)(),i,l),this._manipulatorDistance.modelTransform=i}_updateManipulatorInteractivity(){const e=!this.grabbing;this.forEachManipulator((t=>{t.interactive=e&&this._interactive||t.grabbing}))}forEachManipulator(e){e(this._manipulatorHeading,fe.r.ROTATE),e(this._manipulatorTilt,fe.r.ROTATE),e(this._manipulatorDistance,fe.r.SCALE)}}const xe={top:(0,m.vt)(),bottom:(0,m.vt)(),left:(0,m.vt)(),right:(0,m.vt)()},Be=(0,_.vt)(),Ie=(0,_.vt)(),Ne=(0,m.vt)(),je=(0,m.vt)(),$e=Math.PI/2;i(39299),i(15434),i(62754),i(50076);class Ge extends me.q{constructor(e,t){super({view:e,autoScaleRenderObjects:!1,worldSized:!1,radius:5,interactive:!1}),this._handles=new de.A;const i=(0,M.UM)(this._color);this.renderObjects=[new Ve.M((0,ge.CM)(i,5,32,32))],t.manipulators.add(this),this._handles.add([(0,r.wB)((()=>this._color),(e=>{i.setParameters({color:e})}),r.Vh)])}destroy(){this._handles.remove(),super.destroy()}get _color(){return c.A.toUnitRGBA(this.view.effectiveTheme.accentColor)}}(0,s._)([(0,o.MZ)()],Ge.prototype,"_color",null);var Ke=i(14835),We=i(46947),qe=i(96999),Je=i(75655),Xe=i(1307),Ye=i(59833);const Qe=Symbol("dragHandles"),et=Symbol("hideManipulators");let tt=class extends a.A{constructor(e){super(e),this._moveManipulation=null,this._observerManipulator=null,this._fieldOfViewManipulation=null,this._scaleOrientManipulation=null,this._moveHelperVisualElement=null,this._settings=new Ke.w({getTheme:()=>this.view.effectiveTheme}),this._grabbing=!1,this.viewshedComputedData=null}initialize(){this._moveManipulation=this._createMoveManipulation(),this._fieldOfViewManipulation=new Ce({view:this.view,tool:this.parentTool}),this._scaleOrientManipulation=new Le({view:this.view,tool:this.parentTool}),this._observerManipulator=new Ge(this.view,this.parentTool),this._createMoveHelperVisuals(),this.addHandles([(0,r.wB)((()=>{const{observer:e}=this;return{observer:e,array:null===e||void 0===e?void 0:e.toArray()}}),(e=>{let{observer:t}=e;null!=t&&(this._moveManipulation.location=t,this._observerManipulator.location=t)}),r.pc),(0,r.wB)((()=>{const{viewshedComputedData:e}=this;return{viewshedComputedData:e,observer:null===e||void 0===e?void 0:e.observer}}),((e,t)=>{let{viewshedComputedData:i,observer:s}=e;this._grabbing&&s!==(null===t||void 0===t?void 0:t.observer)||(this.removeHandles(Qe),(null===i||void 0===i?void 0:i.isValid())&&this.addHandles([this._buildObserverDragPipeline(i),this._buildFOVDragPipeline(i),this._buildScaleOrientDragPipeline(i)].filter(re.Ru),Qe))}),r.Vh),(0,r.wB)((()=>{const e=this.viewshedComputedData;return null!==e&&void 0!==e&&e.isValid()?{viewshedCompData:e,target:e.targetRenderSpace,hFOV:e.horizontalFieldOfView,vFOV:e.verticalFieldOfView}:null}),(e=>{null!=e&&this._fieldOfViewManipulation.updateManipulatorsTransform(e.viewshedCompData)}),r.Vh),(0,r.wB)((()=>{const e=this.viewshedComputedData;return null!==e&&void 0!==e&&e.isValid()?{viewshedCompData:e,hFOV:e.horizontalFieldOfView,vFOV:e.verticalFieldOfView,tilt:e.tilt}:null}),(e=>{null!=e&&this._fieldOfViewManipulation.updateManipulatorVisuals(e.viewshedCompData)}),r.Vh),(0,r.wB)((()=>{var e,t;return this.analysisViewData.visible&&null!==(e=null===(t=this.viewshedComputedData)||void 0===t?void 0:t.isValid())&&void 0!==e&&e&&!this.parentTool.placingTarget}),(e=>this._updateManipulationAvailability(e)),r.Vh),(0,r.wB)((()=>{const e=this.viewshedComputedData;if(null===e||void 0===e||!e.isValid())return null;const{observer:t,target:i,verticalFieldOfView:s,horizontalFieldOfView:a}=e;return{viewshedCompData:e,observer:t,target:i,verticalFieldOfView:s,horizontalFieldOfView:a}}),(e=>{null!=e&&this._scaleOrientManipulation.updateManipulators(e.viewshedCompData)}),r.Vh),(0,r.wB)((()=>{var e;return null===(e=this.viewshedComputedData)||void 0===e?void 0:e.observerRenderSpace}),(e=>{null!=e&&this._updateMoveHelperVisualsLocation(e)}),r.Vh)]);this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",(()=>this._updateManipulatorVisibility())),e.events.on("grab-changed",(e=>{this._grabbing="start"===e.action}))])}))}destroy(){this._moveManipulation=(0,n.pR)(this._moveManipulation),this._fieldOfViewManipulation=(0,n.pR)(this._fieldOfViewManipulation),this._scaleOrientManipulation=(0,n.pR)(this._scaleOrientManipulation),this.parentTool.manipulators.remove(this._observerManipulator),this._observerManipulator=(0,n.pR)(this._observerManipulator),this._destroyMoveHelperVisuals()}get viewshed(){var e;return null===(e=this.viewshedComputedData)||void 0===e?void 0:e.viewshed}get grabbing(){return this._grabbing}get observer(){var e;return null===(e=this.viewshed)||void 0===e?void 0:e.observer}set observer(e){const t=this.viewshed;null!=t&&(t.observer=e)}get discManipulator(){return this._moveManipulation.xyManipulation.discManipulator}onManipulatorSelectionChanged(){this._updateManipulatorVisibility()}hasManipulator(e){let t=!1;return this._forEachManipulator((i=>{t=t||i===e})),t}_someManipulatorSelected(){return this._moveManipulation.selected||this._fieldOfViewManipulation.selected||this._scaleOrientManipulation.selected}_someManipulatorHovering(){return this._moveManipulation.hovering||this._fieldOfViewManipulation.hovering||this._scaleOrientManipulation.hovering}_createMoveManipulation(){return new qe.v({view:this.view,tool:this.parentTool,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:We.HJ})}_buildObserverDragPipeline(e){const t=e.observer;return null==t?null:this._moveManipulation.createDragPipeline(((t,i,s,a,n)=>{a=a.next((0,De.VG)(this,["observer"]));const r=e.observer.clone();if(null==r)return{steps:s,cancel:a};const o=Ye.p.fromGeometry(r,(0,le.yX)(this.view.viewingMode));return{steps:s.next((0,De.Wp)({operations:o})).next((e=>(this.observer=(0,oe.project)(o.data.geometry,r.spatialReference),e))),cancel:a}}),{mode:"absolute-height",offset:0},t.spatialReference,void 0)}_buildFOVDragPipeline(e){let t=0,i=0;return this._fieldOfViewManipulation.createDragPipeline(((s,a,n)=>{if(null==e)return{steps:a,cancel:n};const r=e.viewshed;return n=n.next((0,De.VG)(e,["horizontalFieldOfView","verticalFieldOfView"])),{steps:a.next((s=>{"start"===s.action&&(t=e.horizontalFieldOfView,i=e.verticalFieldOfView);const a=s.deltaAngle;let n=0;switch(s.side){case"left":n=t/2-a;break;case"right":n=t/2+a;break;case"top":n=i+2*a;break;case"bottom":n=i-2*a}return Ae(s.side)?(n=ee.ie.normalize(n),n=n>270?0:n>180?180:n,r.horizontalFieldOfView=2*n):r.verticalFieldOfView=n,s})),cancel:n}}),e)}_buildScaleOrientDragPipeline(e){let t=0,i=0;const s=(t,i)=>(s,a,n)=>{if(null==e)return{steps:a,cancel:n};const r=e.viewshed;return n=n.next((0,De.VG)(r,[t])),{steps:a=a.next(i(r,e)),cancel:n}};return(0,h.vE)([this._scaleOrientManipulation.createHeadingDragPipeline(s("heading",((t,s)=>s=>("start"===s.action&&(i=e.heading),t.heading=ee.ie.normalize(i+s.deltaAngle),s))),e),this._scaleOrientManipulation.createTiltDragPipeline(s("tilt",((i,s)=>s=>{"start"===s.action&&(t=e.tilt);let a=t+s.deltaAngle;return a<-90?a=180:a>270&&(a=0),i.tilt=st.clamp(a),s})),e),this._scaleOrientManipulation.createDistanceDragPipeline(s("farDistance",((e,t)=>i=>{const s=(0,w.z)(it,i.renderEnd,t.observerRenderSpace),a=(0,w.H)(s)*t.metersPerUnit,n=(0,w.m)(s,t.targetDirection)<0?1:a;return e.farDistance=n,i})),e)])}_updateManipulationAvailability(e){this._moveManipulation.available=e,this._fieldOfViewManipulation.available=e,this._scaleOrientManipulation.available=e,this._observerManipulator.available=e}_updateManipulatorVisibility(){const e=this._someManipulatorSelected()||this._someManipulatorHovering()&&null==this.view.activeTool;if(e)this.removeHandles(et);else{const e=[],t=t=>{e.push(t.disableDisplay())};this._forEachManipulator(t),this.addHandles(e,et)}this._updateMoveHelperVisualsVisibility(e)}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),this._fieldOfViewManipulation.forEachManipulator(e),this._scaleOrientManipulation.forEachManipulator(e),e(this._observerManipulator)}_createMoveHelperVisuals(){this._destroyMoveHelperVisuals();const e=new Xe.o({view:this.view,attached:!0,style:{glowWidth:this._settings.visualElements.heightPlane.glowWidth,innerWidth:this._settings.visualElements.heightPlane.innerWidth},isDecoration:!0}),t=new Je.U({view:this.view,extensionType:this._settings.visualElements.zVerticalLine.extensionType,attached:!0,innerWidth:1,writeDepthEnabled:!1,renderOccluded:C.m$.OccludeAndTransparent,isDecoration:!0});this._moveHelperVisualElement={laserline:e,verticalLine:t},this.addHandles([(0,r.wB)((()=>this._settings.visualElements.zVerticalLine),(e=>e.apply(t)),r.pc),(0,r.wB)((()=>this._settings.visualElements.heightPlane),(t=>t.apply(e)),r.pc)])}_updateMoveHelperVisualsVisibility(e){e=this.analysisViewData.visible&&e;const t=this._moveHelperVisualElement;null!=t&&(t.verticalLine.visible=e,t.laserline.visible=e)}_updateMoveHelperVisualsLocation(e){const t=this._moveHelperVisualElement;if(null==t)return;const{laserline:i,verticalLine:s}=t;i.heightManifoldTarget=e,i.intersectsWorldUpAtLocation=e,null!=e&&s.setStartEndFromWorldDownAtLocation(e)}_destroyMoveHelperVisuals(){const e=this._moveHelperVisualElement;null!=e&&(e.laserline.destroy(),e.verticalLine.destroy(),this._moveHelperVisualElement=null)}get test(){return{moveManipulation:this._moveManipulation,fieldOfViewManipulation:this._fieldOfViewManipulation,scaleOrientManipulation:this._scaleOrientManipulation,moveHelperVisualElements:this._moveHelperVisualElement,viewshedComputedData:this.viewshedComputedData}}};(0,s._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"analysis",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"analysisViewData",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"parentTool",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],tt.prototype,"view",void 0),(0,s._)([(0,o.MZ)()],tt.prototype,"viewshed",null),(0,s._)([(0,o.MZ)()],tt.prototype,"_grabbing",void 0),(0,s._)([(0,o.MZ)()],tt.prototype,"grabbing",null),(0,s._)([(0,o.MZ)()],tt.prototype,"viewshedComputedData",void 0),(0,s._)([(0,o.MZ)()],tt.prototype,"observer",null),tt=(0,s._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedSubTool")],tt);const it=(0,m.vt)(),st=new ee.hr(0,180);var at,nt=i(5109),rt=i(82307),ot=i(46576),lt=i(11500);let dt=at=class extends nt.k{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.automaticManipulatorSelection=!1,this._stagedViewshed=null,this._stagedViewshedComputedData=null,this._creating=!1,this._selectedManipulator=null,this._selectedManipulatorSubTool=null}initialize(){this._intersector=(0,ot.T)(this.view.state.viewingMode);const e=this.analysisViewData.viewshedComputedDataHandles;this.addHandles([(0,r.wB)((()=>e.some((e=>e.viewshedComputedData.isValid()))),(e=>{e&&this.finishToolCreation()}),r.pc),(0,r.wB)((()=>this._stagedViewshed),(e=>{var t;this._stagedViewshedComputedData=null!=e?null===(t=this.analysisViewData.viewshedComputedDataHandles.find((t=>t.viewshedComputedData.viewshed===e)))||void 0===t?void 0:t.viewshedComputedData:null}),r.pc),(0,r.wB)((()=>this.firstGrabbedManipulator),(e=>{null!=e&&this._selectManipulator(e)}),r.OH),(0,r.wB)((()=>this.analysisViewData.visible),(e=>{e||this._selectManipulator(null)})),(0,r.wB)((()=>this.view.activeTool),(e=>{e!==this&&null!=e&&this._selectManipulator(null)}))]),this.subToolHandles=(0,r.LF)((()=>e),(e=>{let{viewshedComputedData:t}=e;const i=new tt({analysis:this.analysis,analysisViewData:this.analysisViewData,parentTool:this,view:this.view,viewshedComputedData:t});return{subTool:i,remove:()=>{this._selectedManipulatorSubTool===i&&this._selectManipulator(null),i.destroy()}}}))}destroy(){this.subToolHandles=(0,n.pR)(this.subToolHandles)}onDeactivate(){this.removeStaged()}get cursor(){return this.creating?"crosshair":null}_selectManipulator(e){var t,i,s;const a=this._selectedManipulator;null!=a&&(a.selected=!1,this._selectedManipulator=null,null!==(t=this._selectedManipulatorSubTool)&&void 0!==t&&t.onManipulatorSelectionChanged(),this._selectedManipulatorSubTool=null),null!=e&&(e.selected=!0,this._selectedManipulator=e,this._selectedManipulatorSubTool=null===(i=this.subToolHandles.find((t=>t.subTool.hasManipulator(e))))||void 0===i?void 0:i.subTool,null===(s=this._selectedManipulatorSubTool)||void 0===s||s.onManipulatorSelectionChanged())}get selectedViewshed(){var e;return null===(e=this._selectedManipulatorSubTool)||void 0===e?void 0:e.viewshed}set selectedViewshed(e){this.selectViewshed(e)}get selectedViewshedComputedData(){var e;return null===(e=this._selectedManipulatorSubTool)||void 0===e?void 0:e.viewshedComputedData}get stagedViewshed(){return this._stagedViewshed}get grabbing(){return this.subToolHandles.some((e=>{let{subTool:t}=e;return t.grabbing}))}get creating(){return this._creating&&this.active}get placingTarget(){return null!=this._stagedViewshed}createViewsheds(){this._creating=!0}onManipulatorSelectionChanged(){this.subToolHandles.forEach((e=>e.subTool.onManipulatorSelectionChanged()))}onInputEvent(e){switch(e.type){case"immediate-click":this._clickDeselectHandler();break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":rt.NE.cancel===e.key?this._cancelKeyHandler(e):rt.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onInputEventAfter(e){"immediate-click"===e.type&&this._clickPlacementHandler(e)}_clickDeselectHandler(){this.hasFocusedManipulators||this._selectManipulator(null)}_clickPlacementHandler(e){if(!this.creating||this.hasFocusedManipulators)return;const t=this._stagedViewshed,i=this._intersectScreen(e,wt);if(null!=i){if(null==t){var s;i.mapPoint.z=(null!==(s=i.mapPoint.z)&&void 0!==s?s:0)+2;const e=new ae({observer:i.mapPoint.clone()});this.analysis.viewsheds.add(e),this._stagedViewshed=e,this._updateStagedViewshed(i.scenePoint)}else{this._updateStagedViewshed(i.scenePoint);const e=this._stagedViewshed;this._stagedViewshed=null,this.selectViewshed(e)}e.stopPropagation()}}_doubleClickHandler(e){this.creating&&(this.removeStaged(),this._selectManipulator(null),this._creating=!1,this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(!this.creating||null==this._stagedViewshed)return;const t=this._intersectScreen(e,wt);null!=t&&this._updateStagedViewshed(t.scenePoint)}_cancelKeyHandler(e){if(this.creating){if(this.removeStaged())return this._selectManipulator(null),void e.stopPropagation();this._creating=!1}else if(!this.grabbing)return this.selectViewshed(null),void e.stopPropagation()}_deleteKeyHandler(){this.creating&&this.removeStaged(),null!=this.selectedViewshed&&this.analysis.viewsheds.remove(this.selectedViewshed)}_updateStagedViewshed(e){const t=this._stagedViewshed,i=this._stagedViewshedComputedData;if(null==t||null==i)return;const{heading:s,tilt:a,farDistance:n}=function(e,t,i){const s=t.observerRenderSpace,a=(0,w.z)(ht,i,s),n=(0,w.H)(a)*t.metersPerUnit,r=e.renderCoordsHelper.basisMatrixAtPosition(s,vt),o=(0,w.s)(ct,r[8],r[9],r[10]),l=(0,ne.O_)(s,o,_t),d=(0,ne._I)(l,i,ut),h=(0,w.z)(d,d,s),c=(0,p.KJ)((0,w.d)(a,h))*((0,w.m)(o,a)<0?-1:1)+90,u=(0,w.s)(pt,r[4],r[5],r[6]),v=(0,p.KJ)((0,w.d)(u,h)),_=(0,w.s)(pt,r[0],r[1],r[2]);return{heading:(0,w.m)(h,_)<0?360-v:v,tilt:c,farDistance:n}}(this.view,i,e);t.farDistance=n,t.tilt=a,t.heading=s}removeStaged(){return null!=this._stagedViewshed&&(this.analysis.viewsheds.remove(this._stagedViewshed),this._stagedViewshed=null,!0)}selectViewshed(e){var t;if(null!=e)for(const s of this.view.tools.items)s!==this&&s instanceof at&&s.selectViewshed(null);const i=null===(t=this.subToolHandles.find((t=>t.subTool.viewshed===e)))||void 0===t?void 0:t.subTool;this._selectManipulator(null===i||void 0===i?void 0:i.discManipulator)}_intersectScreen(e,t){const i=(0,lt.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,a=t.scenePoint;if(!s.getIntersectionPoint(a))return null;const n=t.mapPoint;return n.spatialReference=this.view.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(a,n),null==n?null:t}get test(){var e;return{subTools:this.subToolHandles.map((e=>e.subTool.test)),selectedSubTool:null===(e=this._selectedManipulatorSubTool)||void 0===e?void 0:e.test,stagedViewshed:this._stagedViewshed}}};(0,s._)([(0,o.MZ)({constructOnly:!0})],dt.prototype,"view",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"analysisViewData",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"removeIncompleteOnCancel",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0})],dt.prototype,"analysis",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"subToolHandles",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"_stagedViewshed",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"_stagedViewshedComputedData",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"_creating",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],dt.prototype,"cursor",null),(0,s._)([(0,o.MZ)()],dt.prototype,"_selectedManipulator",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"_selectedManipulatorSubTool",void 0),(0,s._)([(0,o.MZ)()],dt.prototype,"selectedViewshed",null),(0,s._)([(0,o.MZ)()],dt.prototype,"selectedViewshedComputedData",null),(0,s._)([(0,o.MZ)()],dt.prototype,"grabbing",null),(0,s._)([(0,o.MZ)()],dt.prototype,"creating",null),(0,s._)([(0,o.MZ)()],dt.prototype,"placingTarget",null),dt=at=(0,s._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedTool")],dt);const ht=(0,m.vt)(),ct=(0,m.vt)(),ut=(0,m.vt)(),pt=(0,m.vt)(),vt=(0,_.vt)(),_t=(0,ne.vt)(),wt={mapPoint:new F.A,scenePoint:(0,m.vt)()},mt=dt;var Vt=i(92290),ft=i(10260);let Mt=class extends((0,d.P)(a.A)){constructor(e){super(e),this.type="viewshed-view-3d",this.analysis=null,this.tool=null,this.viewshedComputedDataHandles=null,this._placementTask=null}get selectedViewshed(){var e;return null===(e=this.tool)||void 0===e?void 0:e.selectedViewshed}set selectedViewshed(e){const{tool:t}=this;null!=t&&(t.selectedViewshed=e)}get selectedViewshedComputedData(){var e;return null===(e=this.tool)||void 0===e?void 0:e.selectedViewshedComputedData}initialize(){this._initializeUpdateHandle(),this.viewshedComputedDataHandles=(0,r.LF)((()=>this.analysis.viewsheds),(e=>{const t=new P({renderCoordsHelper:this.view.renderCoordsHelper,viewshed:e}),i=Symbol();return this.addHandles((0,r.wB)((()=>t.isValid()),((e,i)=>{this.visible&&(e?this._addViewshedsToRenderer(t):i&&this._removeViewshedsFromRenderer(t))}),r.Vh)),{viewshedComputedData:t,remove:()=>{this.removeHandles(i),this._removeViewshedsFromRenderer(t),t.destroy()}}})),this._analysisVisualization=new R({view:this.view,analysisViewData:this,isDecoration:!this.parent}),this.addHandles([(0,r.wB)((()=>this.visible),(e=>{const t=this.viewshedComputedDataHandles.map((e=>e.viewshedComputedData)).filter((e=>e.isValid()));e?this._addViewshedsToRenderer(t):this._removeViewshedsFromRenderer(t)})),(0,r.wB)((()=>this.view.renderCoordsHelper),(e=>{this.viewshedComputedDataHandles.forEach((t=>{let{viewshedComputedData:i}=t;return i.renderCoordsHelper=e}))})),(0,ft.Hd)(this,mt)])}destroy(){this._placementTask=(0,n.DC)(this._placementTask),(0,ft.aS)(this),this._analysisVisualization=(0,n.pR)(this._analysisVisualization),this._removeViewshedsFromRenderer(this.viewshedComputedDataHandles.map((e=>e.viewshedComputedData)))}async createViewsheds(e){return this._placementTask=(0,n.DC)(this._placementTask),this._placementTask=(0,ft.JY)(this,e),null!=this.tool&&this.tool.createViewsheds(),await this._placementTask.promise}_initializeUpdateHandle(){const e=this.view._stage.renderer.plugins.plugins.find((e=>e instanceof Vt.S));e&&(this._updateHandleInRenderer=e.updateViewsheds.bind(e))}_addViewshedsToRenderer(e){this._updateHandleInRenderer({adds:e})}_removeViewshedsFromRenderer(e){this._updateHandleInRenderer({removes:e})}};(0,s._)([(0,o.MZ)({readOnly:!0})],Mt.prototype,"type",void 0),(0,s._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],Mt.prototype,"analysis",void 0),(0,s._)([(0,o.MZ)()],Mt.prototype,"tool",void 0),(0,s._)([(0,o.MZ)()],Mt.prototype,"selectedViewshed",null),(0,s._)([(0,o.MZ)()],Mt.prototype,"selectedViewshedComputedData",null),(0,s._)([(0,o.MZ)()],Mt.prototype,"viewshedComputedDataHandles",void 0),(0,s._)([(0,o.MZ)()],Mt.prototype,"_analysisVisualization",void 0),(0,s._)([(0,o.MZ)()],Mt.prototype,"_placementTask",void 0),Mt=(0,s._)([(0,l.$)("esri.views.3d.analysis.ViewshedAnalysisView3D")],Mt);const gt=Mt},10260:(e,t,i)=>{i.d(t,{Hd:()=>l,JY:()=>o,aS:()=>d});var s=i(98773),a=i(30726),n=i(50346),r=i(68134);function o(e,t){e.interactive=!0;const{tool:i,view:o}=e;o.activeTool=i;let l=(0,n.u7)(t,(()=>{o.activeTool===i&&(o.activeTool=null)}));return(0,s.UT)((async e=>{await(0,r.C_)((()=>null==i||!i.active),e),l=(0,a.xt)(l)}),t)}function l(e,t){return(0,r.wB)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){d(e);const{view:i,analysis:s}=e,a=new t({view:i,analysis:s,analysisViewData:e});e.tool=a,i.tools.add(a)}(e,t):d(e)}(e,t)),r.pc)}function d(e){const{view:t,tool:i}=e;null!=i&&(t.tools.remove(i),e.tool=null)}},5109:(e,t,i)=>{i.d(t,{k:()=>o});var s=i(35143),a=i(68134),n=(i(76460),i(81806),i(47249),i(50076),i(85842)),r=i(46975);let o=class extends r.g{constructor(e){super(e)}initialize(){this.addHandles((0,a.wB)((()=>this.analysisViewData.visible),(e=>this.visible=e),a.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};o=(0,s._)([(0,n.$)("esri.views.interactive.AnalysisToolBase")],o)},46576:(e,t,i)=>{i.d(t,{T:()=>n});var s=i(29808),a=i(3112);function n(e){const t=(0,s.hz)(e);return t.options.store=a.oH.MIN,t.options.hud=!1,t}}}]);
//# sourceMappingURL=9408.7962a83b.chunk.js.map