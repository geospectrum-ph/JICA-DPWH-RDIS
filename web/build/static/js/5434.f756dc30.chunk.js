"use strict";(self.webpackChunkRDIS_Web_Application=self.webpackChunkRDIS_Web_Application||[]).push([[5434],{95434:(e,t,i)=>{i.r(t),i.d(t,{default:()=>hi});var o=i(35143),n=i(63241),s=i(76460),r=i(68134),l=i(46053),a=(i(81806),i(47249),i(85842)),d=i(16700),c=(i(11265),i(19276));function u(e,t,i,o){let n=null,s=1e3;"number"==typeof t?(s=t,o=i):(n=null!==t&&void 0!==t?t:null,s=i);let r,l=0;const a=()=>{l=0,e.apply(o,r)},d=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n&&n.apply(o,t),r=t,s?l||(l=setTimeout(a,s)):a()};return d.remove=()=>{l&&(clearTimeout(l),l=0)},d.forceUpdate=()=>{l&&(clearTimeout(l),a())},d.hasPendingUpdates=()=>!!l,d}var h=i(86100),p=i(38623),v=i(21403),g=i(25329),_=i(81594),f=i(78583);let m=class extends f.A{constructor(e){super(e),this.description=null,this.title=null}};(0,o._)([(0,l.MZ)()],m.prototype,"description",void 0),(0,o._)([(0,l.MZ)()],m.prototype,"title",void 0),m=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],m);const w=m;var y=i(87540),M=i(76099),b=i(54761);const F="esri-feature-element-info",I={base:F,title:"".concat(F,"__title"),description:"".concat(F,"__description")};let A=class extends g.A{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,b.K)("div",{class:I.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?(0,b.K)(y.D,{class:I.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?(0,b.K)("div",{class:I.description,innerHTML:e,key:"description"}):null}};(0,o._)([(0,l.MZ)()],A.prototype,"description",void 0),(0,o._)([(0,l.MZ)()],A.prototype,"headingLevel",void 0),(0,o._)([(0,l.MZ)()],A.prototype,"title",void 0),A=(0,o._)([(0,a.$)("esri.widgets.Feature.support.FeatureElementInfo")],A);const C=A,x="esri-feature-attachments";let E=class extends g.A{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new _.A,this.headingLevel=2,this.viewModel=new w}initialize(){this._featureElementInfo=new C,this.addHandles([(0,r.wB)((()=>{var e,t;return[null===(e=this.viewModel)||void 0===e?void 0:e.description,null===(t=this.viewModel)||void 0===t?void 0:t.title,this.headingLevel]}),(()=>this._setupFeatureElementInfo()),r.Vh),(0,r.wB)((()=>this.viewModel),(e=>this.attachmentsWidget.viewModel=e),r.Vh)])}destroy(){var e;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),null===(e=this._featureElementInfo)||void 0===e||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;const{attachmentsWidget:t}=this;return(0,b.K)("div",{class:x},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),null===t||void 0===t?void 0:t.render())}_setupFeatureElementInfo(){var e;const{description:t,title:i,headingLevel:o}=this;null===(e=this._featureElementInfo)||void 0===e||e.set({description:t,title:i,headingLevel:o})}};(0,o._)([(0,l.MZ)({readOnly:!0})],E.prototype,"attachmentsWidget",void 0),(0,o._)([(0,l.MZ)()],E.prototype,"description",null),(0,o._)([(0,l.MZ)()],E.prototype,"displayType",null),(0,o._)([(0,l.MZ)()],E.prototype,"graphic",null),(0,o._)([(0,l.MZ)()],E.prototype,"headingLevel",void 0),(0,o._)([(0,l.MZ)()],E.prototype,"title",null),(0,o._)([(0,l.MZ)({type:w})],E.prototype,"viewModel",void 0),E=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureAttachments")],E);const T=E;var Z=i(39356),k=i(91967),L=i(9912);let R=class extends k.A{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,r.wB)((()=>this.creator),(e=>{this._destroyContent(),this._createContent(e)}),r.Vh))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&t&&((0,L.AB)({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const i=(0,L.AB)({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");const o=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",o))}};(0,o._)([(0,l.MZ)({readOnly:!0})],R.prototype,"created",void 0),(0,o._)([(0,l.MZ)()],R.prototype,"creator",void 0),(0,o._)([(0,l.MZ)()],R.prototype,"destroyer",void 0),(0,o._)([(0,l.MZ)({type:Z.A})],R.prototype,"graphic",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],R.prototype,"state",null),R=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],R);const P=R;var V=i(95752);const N="esri-feature-content",O={base:N,loaderContainer:"".concat(N,"__loader-container"),loader:"".concat(N,"__loader")};let B=class extends g.A{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{(0,L.kX)(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}get creator(){var e;return null===(e=this.viewModel)||void 0===e?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return null===(e=this.viewModel)||void 0===e?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){var e;const t=null===(e=this.viewModel)||void 0===e?void 0:e.state;return(0,b.K)("div",{class:O.base},"loading"===t?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,b.K)("div",{class:O.loaderContainer,key:"loader"},(0,b.K)("div",{class:O.loader}))}_renderCreated(){var e;const t=null===(e=this.viewModel)||void 0===e?void 0:e.created;return t?t instanceof HTMLElement?(0,b.K)("div",{afterCreate:this._attachToNode,bind:t,key:t}):(0,V.p4)(t)?(0,b.K)("div",{key:t},!t.destroyed&&t.render()):(0,b.K)("div",{afterCreate:this._addTargetToAnchors,innerHTML:t,key:t}):null}_attachToNode(e){e.appendChild(this)}};(0,o._)([(0,l.MZ)()],B.prototype,"creator",null),(0,o._)([(0,l.MZ)()],B.prototype,"graphic",null),(0,o._)([(0,l.MZ)({type:P})],B.prototype,"viewModel",void 0),B=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureContent")],B);const S=B;var K=i(81779),W=i(40585);let D=class extends k.A{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null!==t&&void 0!==t&&t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const o=t.clone();o.label=(0,L.bV)(o,e),i.push(o)})),i}};(0,o._)([(0,l.MZ)()],D.prototype,"attributes",void 0),(0,o._)([(0,l.MZ)({type:[K.A]})],D.prototype,"expressionInfos",void 0),(0,o._)([(0,l.MZ)()],D.prototype,"description",void 0),(0,o._)([(0,l.MZ)({type:[W.A]})],D.prototype,"fieldInfos",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],D.prototype,"formattedFieldInfos",null),(0,o._)([(0,l.MZ)()],D.prototype,"title",void 0),D=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],D);const H=D;var z=i(98108),$=i(88685);const U=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];var j=i(63582);const G="esri-feature-fields",q={base:G,fieldHeader:"".concat(G,"__field-header"),fieldData:"".concat(G,"__field-data"),fieldDataDate:"".concat(G,"__field-data--date")};let X=class extends g.A{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new H,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new C,this.addHandles((0,r.wB)((()=>{var e,t;return[null===(e=this.viewModel)||void 0===e?void 0:e.description,null===(t=this.viewModel)||void 0===t?void 0:t.title]}),(()=>this._setupFeatureElementInfo()),r.Vh))}destroy(){var e;null===(e=this._featureElementInfo)||void 0===e||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return(0,b.K)("div",{class:q.base},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),this._renderFields())}_renderFieldInfo(e,t){var i;const{attributes:o}=this.viewModel,n=e.fieldName||"",s=e.label||n,r=o?null==o[n]?"":o[n]:"",l=!(null===(i=e.format)||void 0===i||!i.dateFormat),a="number"!=typeof r||l?function(e,t){if("string"!=typeof t||!t)return t;const i=U.find((e=>e.pattern.test(t)));if(!i)return t;const o=t.match(i.pattern),n=null===o||void 0===o?void 0:o[2],s=(0,$.HC)((0,$.HC)(i.label,{messages:e,hierPart:n}),{appName:i.appName}),r=i.target?' target="'.concat(i.target,'"'):"",l="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,"<a".concat(r,' href="$1"').concat(l,">").concat(s,"</a>"))}(this.messagesURIUtils,r):this._forceLTR(r),d={[q.fieldDataDate]:l};return(0,b.K)("tr",{key:"fields-element-info-row-".concat(n,"-").concat(t)},(0,b.K)("th",{class:q.fieldHeader,innerHTML:s,key:"fields-element-info-row-header-".concat(n,"-").concat(t)}),(0,b.K)("td",{class:this.classes(q.fieldData,d),innerHTML:a,key:"fields-element-info-row-data-".concat(n,"-").concat(t)}))}_renderFields(){const{formattedFieldInfos:e}=this.viewModel;return null!==e&&void 0!==e&&e.length?(0,b.K)("table",{class:z.D.table,summary:this.messages.fieldsSummary},(0,b.K)("tbody",null,e.map(((e,t)=>this._renderFieldInfo(e,t))))):null}_setupFeatureElementInfo(){var e;const{description:t,title:i}=this;null===(e=this._featureElementInfo)||void 0===e||e.set({description:t,title:i})}_forceLTR(e){return"&lrm;".concat(e)}};(0,o._)([(0,l.MZ)()],X.prototype,"attributes",null),(0,o._)([(0,l.MZ)()],X.prototype,"description",null),(0,o._)([(0,l.MZ)()],X.prototype,"expressionInfos",null),(0,o._)([(0,l.MZ)()],X.prototype,"fieldInfos",null),(0,o._)([(0,l.MZ)()],X.prototype,"title",null),(0,o._)([(0,l.MZ)({type:H,nonNullable:!0})],X.prototype,"viewModel",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Feature/t9n/Feature")],X.prototype,"messages",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/support/t9n/uriUtils")],X.prototype,"messagesURIUtils",void 0),X=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureFields")],X);const Y=X;var Q=i(17555),J=i(23994),ee=i(18690),te=i(22431),ie=i(3825),oe=i(50076),ne=i(50346),se=i(53430),re=(i(89551),i(14009)),le=(i(86560),i(55171),i(90534),i(31633),i(34111),i(80963),i(42294),i(15941),i(76797),i(89189),i(66388),i(19247)),ae=(i(65215),i(23701),i(73548),i(13312),i(14556),i(35238),i(29234),i(77725),i(68295)),de=(i(88084),i(9708),i(58289)),ce=(i(58672),i(21820));const ue=()=>s.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),he=new Map;function pe(e){if(!(0,L.s$)(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function ve(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:o}=t;return o.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(i)return{url:"".concat(t.url,"/").concat(i.relatedTableId),sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}async function ge(e,t,i,o){const n=i.layerId.toString(),{layerInfo:s,relation:r,relatedFields:l,outStatistics:a,url:d,sourceSpatialReference:c}=t,u=function(e){return e?(0,ee.Am)(e):void 0}(l),h=function(e){return e?(0,ee.Am)(e,((e,t)=>JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON()))):void 0}(a);if(!s||!r)return null;const p=function(e){var t;let{originRelationship:i,relationships:o,layerId:n}=e;return null!==(t=o.find((e=>{let{relatedTableId:t,id:o}=e;return"".concat(t)===n&&o===(null===i||void 0===i?void 0:i.id)})))&&void 0!==t?t:null}({originRelationship:r,relationships:s.relationships,layerId:n});if(null!==p&&void 0!==p&&p.relationshipTableId&&p.keyFieldInRelationshipTable){const t=(await function(e,t,i,o){var n,s,r,l;const a=new de.default;return a.outFields=["*"],a.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),a.objectIds=[e.attributes[i.objectIdField]],a.gdbVersion=null!==(n=i.gdbVersion)&&void 0!==n?n:null,a.historicMoment=null!==(s=i.historicMoment)&&void 0!==s?s:null,null!==(r=null===(l=i.queryRelatedFeatures)||void 0===l?void 0:l.call(i,a,o))&&void 0!==r?r:Promise.resolve({})}(e,p,i,o))[e.attributes[i.objectIdField]];if(!t)return null;const n=t.features.map((e=>e.attributes[s.objectIdField]));if(null!==h&&void 0!==h&&h.length&&s.supportsStatistics){const e=new ae.A;e.where=function(e,t,i){let o=0;const n=[];for(;o<t.length;)n.push("".concat(e," IN (").concat(t.slice(o,i+o),")")),o+=i;return n.join(" OR ")}(s.objectIdField,n,1e3),e.outFields=u,e.outStatistics=h,e.sourceSpatialReference=c;const i={features:Promise.resolve(t),statsFeatures:(0,re.s)(d,e)};return(0,ne.Lx)(i)}}const v=null===p||void 0===p?void 0:p.keyField;if(v){const t=(0,se.WA)(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(s.fields,v)),n=function(e,t){const i=t.toLowerCase();for(const o in e)if(o.toLowerCase()===i)return e[o];return null}(e.attributes,r.keyField),l=t?"".concat(v,"=").concat(n):"".concat(v,"='").concat(n,"'"),a=i.historicMoment,p=i.gdbVersion,g=(0,re.s)(d,new ae.A({where:l,outFields:u,sourceSpatialReference:c,historicMoment:a,gdbVersion:p}),o),_=null!==h&&void 0!==h&&h.length&&s.supportsStatistics?(0,re.s)(d,new ae.A({where:l,outFields:u,outStatistics:h,sourceSpatialReference:c}),o):null,f={features:g};return _&&(f.statsFeatures=_),(0,ne.Lx)(f)}return null}function _e(e,t){let{relatedInfos:i,layer:o}=e;const n={};return i.forEach(((e,t)=>{const{relation:i}=e;if(!i){const e=new oe.A("relation-required","A relation is required on a layer to retrieve related records.");throw ue().error(e),e}const{relatedTableId:s}=i;if("number"!=typeof s){const e=new oe.A("A related table ID is required on a layer to retrieve related records.");throw ue().error(e),e}const r="".concat(o.url,"/").concat(s),l=he.get(r),a=null!==l&&void 0!==l?l:function(e,t){return(0,ie.A)(e,{query:{f:"json"},signal:null===t||void 0===t?void 0:t.signal})}(r);l||he.set(r,a),n[t]=a})),(0,ne.qr)((0,ne.Lx)(n),t)}const fe={chartAnimation:!0};let me=class extends k.A{constructor(e){super(e),this.abilities={...fe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...fe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){var e,t,i,o,n;const{mediaInfos:s,layer:r}=this,l=null!==(e=this.attributes)&&void 0!==e?e:{},a=null!==(t=this.formattedAttributes)&&void 0!==t?t:{},d=null!==(i=this.expressionAttributes)&&void 0!==i?i:{},c=null!==(o=this.fieldInfoMap)&&void 0!==o?o:new Map;return null!==(n=null===s||void 0===s?void 0:s.map((e=>{const t=null===e||void 0===e?void 0:e.clone();if(!t)return null;if(t.title=(0,L.u2)({attributes:l,fieldInfoMap:c,globalAttributes:a,expressionAttributes:d,layer:r,text:t.title}),t.caption=(0,L.u2)({attributes:l,fieldInfoMap:c,globalAttributes:a,expressionAttributes:d,layer:r,text:t.caption}),t.altText=(0,L.u2)({attributes:l,fieldInfoMap:c,globalAttributes:a,expressionAttributes:d,layer:r,text:t.altText}),"image"===t.type){if(!t.value)return;return this._setImageValue({value:t.value,formattedAttributes:a,layer:r}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){if(!t.value)return;return this._setChartValue({value:t.value,chartType:t.type,attributes:l,formattedAttributes:a,layer:r,expressionAttributes:d}),t}return null})).filter(ee.Ru))&&void 0!==n?n:[]}_setImageValue(e){var t;const i=null!==(t=this.fieldInfoMap)&&void 0!==t?t:new Map,{value:o,formattedAttributes:n,layer:s}=e,{linkURL:r,sourceURL:l}=o;if(l){const e=(0,L.MK)(l,s);o.sourceURL=(0,L.gd)({formattedAttributes:n,template:e,fieldInfoMap:i})}if(r){const e=(0,L.MK)(r,s);o.linkURL=(0,L.gd)({formattedAttributes:n,template:e,fieldInfoMap:i})}}_setChartValue(e){var t;const{value:i,attributes:o,formattedAttributes:n,chartType:s,layer:r,expressionAttributes:l}=e,{popupTemplate:a,relatedInfos:d}=this,{fields:c,normalizeField:u}=i,h=r;if(i.fields=(0,L.xL)(c,h),u&&(i.normalizeField=(0,L.A4)(u,h)),!c.some((e=>!!(null!=n[e]||(0,L.s$)(e)&&null!==d&&void 0!==d&&d.size))))return;const p=null!==(t=null===a||void 0===a?void 0:a.fieldInfos)&&void 0!==t?t:[];c.forEach(((e,t)=>{var r;const a=null===(r=i.colors)||void 0===r?void 0:r[t];if((0,L.s$)(e))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:p,fieldName:e,formattedAttributes:n,chartType:s,value:i,color:a})]);const d=this._getChartOption({value:i,attributes:o,chartType:s,formattedAttributes:n,expressionAttributes:l,fieldName:e,fieldInfos:p,color:a});i.series.push(d)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:o,formattedAttributes:n,chartType:s,value:r,color:l}=e,a=[],d=pe(o),c=d&&(null===(t=this.relatedInfos)||void 0===t?void 0:t.get(d.layerId.toString()));if(!c)return a;const{relatedFeatures:u,relation:h}=c;if(!h||!u)return a;const{cardinality:p}=h;return u.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===d.fieldName&&a.push(this._getChartOption({value:r,attributes:t,formattedAttributes:n,fieldName:o,chartType:s,relatedFieldName:e,hasMultipleRelatedFeatures:(null===u||void 0===u?void 0:u.length)>1,fieldInfos:i,color:l}))}))})),"one-to-many"===p||"many-to-many"===p?a:[a[0]]}_getTooltip(e){let{label:t,value:i,chartType:o}=e;return"pie-chart"===o?"".concat(t):"".concat(t,": ").concat(i)}_getChartOption(e){var t,i;const{value:o,attributes:n,formattedAttributes:s,expressionAttributes:r,fieldName:l,relatedFieldName:a,fieldInfos:d,chartType:c,hasMultipleRelatedFeatures:u,color:h}=e,p=this.layer,v=null!==(t=this.fieldInfoMap)&&void 0!==t?t:new Map,{normalizeField:g,tooltipField:_}=o,f=g?(0,L.s$)(g)?n[pe(g).fieldName]:n[g]:null,m=(0,L.Tt)(l)&&r&&void 0!==r[l]?r[l]:a&&void 0!==n[a]?n[a]:void 0!==n[l]?n[l]:s[l],w=new te.A({fieldName:l,color:h,value:void 0===m?null:m&&f?m/f:m});if((0,L.s$)(l)){var y,M,b,F,I;const e=v.get(l.toLowerCase()),t=_&&v.get(_.toLowerCase()),i=null!==(y=null===e||void 0===e?void 0:e.fieldName)&&void 0!==y?y:l,o=u&&_?pe(_).fieldName:null!==(M=null===t||void 0===t?void 0:t.fieldName)&&void 0!==M?M:_,r=u&&o?n[o]:null!==(b=null!==(F=null!==(I=s[o])&&void 0!==I?I:null===e||void 0===e?void 0:e.label)&&void 0!==F?F:null===e||void 0===e?void 0:e.fieldName)&&void 0!==b?b:a,d=u&&a?n[a]:s[i];return w.tooltip=this._getTooltip({label:r,value:d,chartType:c}),w}const A=(0,L.lm)(d,l),C=(0,L.A4)(l,p),x=_&&void 0!==s[_]?s[_]:(0,L.bV)(A||new W.A({fieldName:C}),null===(i=this.popupTemplate)||void 0===i?void 0:i.expressionInfos),E=s[C];return w.tooltip=this._getTooltip({label:x,value:E,chartType:c}),w}};(0,o._)([(0,l.MZ)()],me.prototype,"abilities",void 0),(0,o._)([(0,v.w)("abilities")],me.prototype,"castAbilities",null),(0,o._)([(0,l.MZ)()],me.prototype,"activeMediaInfoIndex",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],me.prototype,"activeMediaInfo",null),(0,o._)([(0,l.MZ)()],me.prototype,"attributes",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"description",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"fieldInfoMap",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"formattedAttributes",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"expressionAttributes",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],me.prototype,"formattedMediaInfos",null),(0,o._)([(0,l.MZ)()],me.prototype,"isAggregate",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],me.prototype,"formattedMediaInfoCount",null),(0,o._)([(0,l.MZ)()],me.prototype,"mediaInfos",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"popupTemplate",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"relatedInfos",void 0),(0,o._)([(0,l.MZ)()],me.prototype,"title",void 0),me=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],me);const we=me;var ye=i(77666),Me=i(91896),be=i(39348);const Fe="esri-feature-media",Ie={base:Fe,mediaContainer:"".concat(Fe,"__container"),mediaItemContainer:"".concat(Fe,"__item-container"),mediaItem:"".concat(Fe,"__item"),mediaItemText:"".concat(Fe,"__item-text"),mediaItemTitle:"".concat(Fe,"__item-title"),mediaItemCaption:"".concat(Fe,"__item-caption"),mediaNavigation:"".concat(Fe,"__item-navigation"),mediaPagination:"".concat(Fe,"__pagination"),mediaPaginationText:"".concat(Fe,"__pagination-text"),mediaPrevious:"".concat(Fe,"__previous"),mediaPreviousIconLTR:"".concat(Fe,"__previous-icon"),mediaPreviousIconRTL:"".concat(Fe,"__previous-icon--rtl"),mediaNext:"".concat(Fe,"__next"),mediaNextIconLTR:"".concat(Fe,"__next-icon"),mediaNextIconRTL:"".concat(Fe,"__next-icon--rtl"),mediaChart:"".concat(Fe,"__chart"),mediaPaginationButton:"".concat(Fe,"__pagination-button"),mediaPaginationIcon:"".concat(Fe,"__pagination-icon"),mediaChartRendered:"".concat(Fe,"__chart--rendered")},Ae="category",Ce="value";let xe=class extends g.A{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new we,this.messages=null,this._disposeChart=e=>{var t;null!==(t=this._chartRootMap.get(e))&&void 0!==t&&t.dispose(),this._chartRootMap.delete(e)},this._createChart=async e=>{const{destroyed:t,viewModel:o}=this;if(t||!o||!e)return;const{createRoot:n}=await Promise.all([i.e(3318),i.e(6083)]).then(i.bind(i,56083)),s=await n(e);this._chartRootMap.set(e,s),this._renderChart({mediaInfo:o.activeMediaInfo,root:s})}}initialize(){this._featureElementInfo=new C,this.addHandles([(0,r.wB)((()=>{var e,t;return[null===(e=this.viewModel)||void 0===e?void 0:e.activeMediaInfo,null===(t=this.viewModel)||void 0===t?void 0:t.activeMediaInfoIndex]}),(()=>this._setupMediaRefreshTimer()),r.Vh),(0,r.wB)((()=>{var e,t;return[null===(e=this.viewModel)||void 0===e?void 0:e.description,null===(t=this.viewModel)||void 0===t?void 0:t.title]}),(()=>this._setupFeatureElementInfo()),r.Vh)])}loadDependencies(){return(0,ye.W)({icon:()=>Promise.all([i.e(9879),i.e(5012)]).then(i.bind(i,95012))})}destroy(){var e;this._clearMediaRefreshTimer(),null===(e=this._featureElementInfo)||void 0===e||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return(0,b.K)("div",{bind:this,class:Ie.base,onkeyup:this._handleMediaKeyup},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?(0,b.K)("div",{class:Ie.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,b.K)("div",{class:Ie.mediaNavigation},i,e>1?(0,b.K)("div",{class:Ie.mediaPagination},this._renderMediaPageButton("previous"),(0,b.K)("span",{class:Ie.mediaPaginationText},(0,be.V)(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e&&e.title?(0,b.K)("div",{class:Ie.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?(0,b.K)("div",{class:Ie.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?(0,b.K)("div",{class:Ie.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){var t;if(!e.value)return null;const{_refreshIntervalInfo:i}=this,{activeMediaInfoIndex:o,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:r,altText:l,title:a,type:d}=e,{sourceURL:c,linkURL:u}=s,h=(0,L.kX)(null!==u&&void 0!==u?u:void 0)?"_blank":"_self",p="_blank"===h?"noreferrer":"",v=r?i:null,g=v?v.timestamp:0,_=v?v.sourceURL:c,f=(0,b.K)("img",{alt:l||a,key:"media-".concat(d,"-").concat(o,"-").concat(n,"-").concat(g),src:null!==_&&void 0!==_?_:void 0});return null!==(t=u?(0,b.K)("a",{href:u,rel:p,target:h,title:a},f):null)&&void 0!==t?t:f}_renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return(0,b.K)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Ie.mediaChart,key:"media-".concat(e.type,"-").concat(t,"-").concat(i)})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?(0,b.K)("div",{class:Ie.mediaItemContainer,key:"media-container"},(0,b.K)("div",{class:Ie.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,o=t?"chevron-left":"chevron-right",n=t?"media-previous":"media-next",s=t?this._previous:this._next;return(0,b.K)("button",{"aria-label":i,bind:this,class:Ie.mediaPaginationButton,key:n,onclick:s,tabIndex:0,title:i,type:"button"},(0,b.K)("calcite-icon",{class:Ie.mediaPaginationIcon,icon:o,scale:"s"}))}_setupFeatureElementInfo(){var e;const{description:t,title:i}=this;null===(e=this._featureElementInfo)||void 0===e||e.set({description:t,title:i})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:e,layer:t}=this.viewModel;return e&&null!==t&&void 0!==t&&t.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:null===t||void 0===t?void 0:t.renderer}async _getSeriesColors(e){const{colorAm5:t}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),o=new Map;return e.forEach((e=>{e.color&&o.set(e,t(e.color.toCss(!0)))})),o}async _getRendererColors(){const{colorAm5:e}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),t=new Map,o=this._getRenderer();if(!o)return t;const n=await(0,J.iA)(o);return n.delete("default"),Array.from(n.values()).every((e=>1===(null===e||void 0===e?void 0:e.length)))?(Array.from(n.keys()).forEach((i=>{var o;const s=null===(o=n.get(i))||void 0===o||null===(o=o[0])||void 0===o?void 0:o.toCss(!0);s&&t.set(i,e(s))})),t):t}_handleMediaKeyup(e){const{key:t}=e;"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!(0,Q.O)()}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}async _renderChart(e){const{root:t,mediaInfo:o}=e,{value:n,type:s}=o,{ResponsiveThemeAm5:r,DarkThemeAm5:l,AnimatedThemeAm5:a,ColorSetAm5:d,ThemeAm5:c,esriChartColorSet:u}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),h=c.new(t);h.rule("ColorSet").set("colors",u),h.rule("ColorSet").set("reuse",!0);const p=[r.new(t),h];(0,Me.g4)()&&p.push(l.new(t)),this._canAnimateChart()&&p.push(a.new(t)),t.setThemes(p);const v=await this._getRendererColors(),g=await this._getSeriesColors(n.series),_=d.new(t,{}),f=g.get(n.series[0]),m=f?{lineSettings:{stroke:f}}:void 0,w=n.series.map(((e,t)=>{const i=g.get(e)||v.get(e.fieldName)||_.getIndex(t);return{[Ae]:e.tooltip,[Ce]:e.value,columnSettings:{fill:i,stroke:i},...m}})).filter((e=>"pie-chart"!==s||null!=e.value&&e.value>0));"pie-chart"===s?this._createPieChart(e,w):this._createXYChart(e,w)}_getDirection(){return(0,M.V8)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,M.V8)(this.container)}async _customizeChartTooltip(e){var t;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal";const{colorAm5:n}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855));e.setAll({pointerOrientation:o}),null!==(t=e.get("background"))&&void 0!==t&&t.setAll({stroke:n("rgba(50, 50, 50, 1)")}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200})}async _createPieChart(e,t){const{TooltipAm5:o}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{PieChartAm5:n,PieSeriesAm5:s}=await Promise.all([i.e(3318),i.e(2225),i.e(2818)]).then(i.bind(i,82818)),{mediaInfo:r,root:l}=e,{title:a}=r,d=(null===r||void 0===r?void 0:r.altText)||(null===r||void 0===r?void 0:r.title)||"",c=l.container.children.push(n.new(l,{ariaLabel:d,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),u="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",h=o.new(l,{labelText:u}),p=c.series.push(s.new(l,{name:a,valueField:Ce,categoryField:Ae,tooltip:h}));p.ticks.template.set("forceHidden",!0),p.labels.template.set("forceHidden",!0),p.slices.template.states.create("active",{shiftRadius:5}),this._customizeChartTooltip(h),p.slices.template.setAll({ariaLabel:u,focusable:!0,templateField:"columnSettings"}),p.data.setAll(t),p.appear(this._getChartSeriesAnimationMS()),c.appear(this._getChartAnimationMS()),c.root.dom.classList.toggle(Ie.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}async _createColumnChart(e,t,o){const{TooltipAm5:n,ScrollbarAm5:s}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{CategoryAxisAm5:r,AxisRendererXAm5:l,ValueAxisAm5:a,AxisRendererYAm5:d,ColumnSeriesAm5:c}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{mediaInfo:u,root:h}=t,{value:p,title:v}=u;e.setAll({wheelX:"panX",wheelY:"zoomX"});const g=e.xAxes.push(r.new(h,{renderer:l.new(h,{inversed:this._isInversed()}),categoryField:Ae}));g.get("renderer").labels.template.setAll({forceHidden:!0});const _=e.yAxes.push(a.new(h,{renderer:d.new(h,{inside:!1}),min:this._getMinSeriesValue(p.series)}));_.get("renderer").labels.template.setAll({direction:this._getDirection()});const f="{categoryX}",m=n.new(h,{labelText:f}),w=e.series.push(c.new(h,{name:v,xAxis:g,yAxis:_,valueYField:Ce,categoryXField:Ae,tooltip:m}));this._customizeChartTooltip(m),w.columns.template.setAll({ariaLabel:f,focusable:!0,templateField:"columnSettings"}),p.series.length>15&&e.set("scrollbarX",s.new(h,{orientation:"horizontal"})),g.data.setAll(o),w.data.setAll(o),w.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,o){const{TooltipAm5:n,ScrollbarAm5:s}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{CategoryAxisAm5:r,AxisRendererXAm5:l,ValueAxisAm5:a,AxisRendererYAm5:d,ColumnSeriesAm5:c}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{mediaInfo:u,root:h}=t,{value:p,title:v}=u;e.setAll({wheelX:"panY",wheelY:"zoomY"});const g=e.yAxes.push(r.new(h,{renderer:d.new(h,{inversed:!0}),categoryField:Ae}));g.get("renderer").labels.template.setAll({forceHidden:!0});const _=e.xAxes.push(a.new(h,{renderer:l.new(h,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(p.series)}));_.get("renderer").labels.template.setAll({direction:this._getDirection()});const f="{categoryY}",m=n.new(h,{labelText:f}),w=e.series.push(c.new(h,{name:v,xAxis:_,yAxis:g,valueXField:Ce,categoryYField:Ae,tooltip:m}));this._customizeChartTooltip(m,"vertical"),w.columns.template.setAll({ariaLabel:f,focusable:!0,templateField:"columnSettings"}),p.series.length>15&&e.set("scrollbarY",s.new(h,{orientation:"vertical"})),g.data.setAll(o),w.data.setAll(o),w.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,o){var n,s;const{TooltipAm5:r,ScrollbarAm5:l}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{CategoryAxisAm5:a,AxisRendererXAm5:d,ValueAxisAm5:c,AxisRendererYAm5:u,LineSeriesAm5:h}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{root:p,mediaInfo:v}=t,{value:g,title:_}=v;e.setAll({wheelX:"panX",wheelY:"zoomX"});const f=e.xAxes.push(a.new(p,{renderer:d.new(p,{inversed:this._isInversed()}),categoryField:Ae}));f.get("renderer").labels.template.setAll({forceHidden:!0});const m=e.yAxes.push(c.new(p,{renderer:u.new(p,{inside:!1}),min:this._getMinSeriesValue(g.series)}));m.get("renderer").labels.template.setAll({direction:this._getDirection()});const w=null===(n=o[0])||void 0===n||null===(n=n.lineSettings)||void 0===n?void 0:n.stroke,y=r.new(p,{getFillFromSprite:!w,labelText:"{categoryX}"});w&&(null===(s=y.get("background"))||void 0===s||s.setAll({fill:w}));const M=e.series.push(h.new(p,{name:_,xAxis:f,yAxis:m,valueYField:Ce,categoryXField:Ae,tooltip:y}));M.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(y,"vertical"),g.series.length>15&&e.set("scrollbarX",l.new(p,{orientation:"horizontal"})),f.data.setAll(o),M.data.setAll(o),M.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){const{XYChartAm5:o,XYCursorAm5:n}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{root:s,mediaInfo:r}=e,{type:l}=r,a=(null===r||void 0===r?void 0:r.altText)||(null===r||void 0===r?void 0:r.title)||"",d=s.container.children.push(o.new(s,{ariaLabel:a,focusable:!0,panX:!0,panY:!0}));d.set("cursor",n.new(s,{})),"column-chart"===l&&await this._createColumnChart(d,e,t),"bar-chart"===l&&await this._createBarChart(d,e,t),"line-chart"===l&&await this._createLineChart(d,e,t),d.root.dom.classList.toggle(Ie.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;"image"===(null===e||void 0===e?void 0:e.type)&&(null===e||void 0===e?void 0:e.refreshInterval)>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e,o=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const n=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),o);this._refreshTimer=n}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[o,n=""]=e.split("#");return"".concat(o).concat(i,"timestamp=").concat(t).concat(n?"#":"").concat(n)}};(0,o._)([(0,l.MZ)()],xe.prototype,"_refreshIntervalInfo",void 0),(0,o._)([(0,l.MZ)()],xe.prototype,"attributes",null),(0,o._)([(0,l.MZ)()],xe.prototype,"activeMediaInfoIndex",null),(0,o._)([(0,l.MZ)()],xe.prototype,"description",null),(0,o._)([(0,l.MZ)()],xe.prototype,"fieldInfoMap",null),(0,o._)([(0,l.MZ)()],xe.prototype,"layer",null),(0,o._)([(0,l.MZ)()],xe.prototype,"mediaInfos",null),(0,o._)([(0,l.MZ)()],xe.prototype,"popupTemplate",null),(0,o._)([(0,l.MZ)()],xe.prototype,"relatedInfos",null),(0,o._)([(0,l.MZ)()],xe.prototype,"title",null),(0,o._)([(0,l.MZ)({type:we})],xe.prototype,"viewModel",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Feature/t9n/Feature")],xe.prototype,"messages",void 0),xe=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureMedia")],xe);const Ee=xe;i(75900),i(56362),i(87015),i(81940);var Te=i(6929),Ze=i(7198),ke=(i(93616),i(53539)),Le=i(66267),Re=i(38451);const Pe=()=>s.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Ve(e){return"string"==typeof e?(0,L.Uu)((0,L.bG)(e)):Array.isArray(e)?function(e){return'<ul class="esri-widget__list">'.concat(e.map((e=>"<li>".concat("string"==typeof e?(0,L.Uu)((0,L.bG)(e)):e,"</li>"))).join(""),"</ul>")}(e):"esri.arcade.Dictionary"===(null===e||void 0===e?void 0:e.declaredClass)?function(e){const t=e.keys().map((t=>{const i=e.field(t);return"<tr><th>".concat(t,"</th><td>").concat("string"==typeof i?(0,L.Uu)((0,L.bG)(i)):i,"</td></tr>")})).join("");return'<table class="'.concat(z.D.table,'">').concat(t,"</table>")}(e):e}function Ne(){return Promise.resolve().then(i.bind(i,30550))}async function Oe(e){let{graphic:t,view:i,options:o}=e;const{isAggregate:n,layer:s}=t;if(!n||!s||"2d"!==(null===i||void 0===i?void 0:i.type))return[];const r=await i.whenLayerView(s);if(!function(e){return"createQuery"in e&&"queryFeatures"in e}(r))return[];const l=r.createQuery(),a=t.getObjectId();l.aggregateIds=null!=a?[a]:[];const{features:d}=await r.queryFeatures(l,o);return d}async function Be(e){var t,i,o;let{expressionInfo:n,arcade:s,interceptor:r,spatialReference:l,map:a,graphic:d,location:c,view:u,options:h}=e;if(null===n||void 0===n||!n.expression)return null;const{isAggregate:p}=d,v=null!==(t=d.sourceLayer||d.layer)&&void 0!==t?t:void 0,g=p?"feature-reduction-popup":"popup",_=s.createArcadeProfile(g),f=s.createArcadeExecutor(n.expression,_).catch((e=>Pe().error("arcade-executor-error",{error:e,expressionInfo:n}))),[m,w]=await Promise.all([Oe({graphic:d,view:u,options:h}),f]);if(!w)return null;const y="feature-reduction-popup"===g?function(e){let{layer:t,aggregatedFeatures:i,interceptor:o}=e;const{fields:n,objectIdField:s,geometryType:r,spatialReference:l,displayField:a}=t;return new Re.default({fields:n,objectIdField:s,geometryType:r,spatialReference:l,displayField:a,interceptor:o,..."feature"===t.type?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:i})}({layer:v,aggregatedFeatures:m,interceptor:r}):void 0,M={..."feature-reduction-popup"===g?{$aggregatedFeatures:y}:{$datastore:null===v||void 0===v?void 0:v.url,$layer:"feature"===(null===v||void 0===v?void 0:v.type)||"subtype-sublayer"===(null===v||void 0===v?void 0:v.type)||"catalog-footprint"===(null===v||void 0===v?void 0:v.type)||"oriented-imagery"===(null===v||void 0===v?void 0:v.type)?v:"scene"===(null===v||void 0===v?void 0:v.type)&&null!=v.associatedLayer?v.associatedLayer:void 0,$map:a,$userInput:c,$graph:"knowledge-graph-sublayer"===(null===v||void 0===v?void 0:v.type)?null===v||void 0===v||null===(i=v.parentCompositeLayer)||void 0===i?void 0:i.knowledgeGraph:void 0},$feature:d},b={abortSignal:null!==(o=null===h||void 0===h?void 0:h.signal)&&void 0!==o?o:void 0,interceptor:null!==r&&void 0!==r?r:void 0,rawOutput:!0,spatialReference:null!==l&&void 0!==l?l:void 0,timeZone:null===u||void 0===u?void 0:u.timeZone};return await w.executeAsync(M,b).catch((e=>Pe().error("arcade-execution-error",{error:e,graphic:d,expressionInfo:n}))).finally((()=>null===y||void 0===y?void 0:y.destroy()))}async function Se(e){let{expressionInfos:t,spatialReference:i,graphic:o,interceptor:n,map:s,view:r,location:l,options:a}=e;if(null===t||void 0===t||!t.length)return{};const d=await Ne(),c={};for(const p of t)c["expression/".concat(p.name)]=Be({expressionInfo:p,arcade:d,interceptor:n,spatialReference:i,map:s,graphic:o,location:l,view:r,options:a});const u=await(0,ne.Lx)(c),h={};for(const p in u)h[p]=Ve(u[p].value);return h}let Ke=class extends k.A{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:e}=this;e&&e.abort(),this._abortController=null},this._createVM=()=>{var e,t;const i=null===(e=this.contentElement)||void 0===e?void 0:e.type;null===(t=this.contentElementViewModel)||void 0===t||t.destroy();const o="fields"===i?new H:"media"===i?new we:"text"===i?new P:null;this._set("contentElementViewModel",o)},this._compile=async()=>{this._cancelQuery();const e=new AbortController;this._abortController=e,await this._compileExpression(),this._abortController===e&&(this._abortController=null)},this._compileThrottled=u(this._compile,1,this),this._compileExpression=async()=>{const{expressionInfo:e,graphic:t,interceptor:i,spatialReference:o,map:n,location:s,view:r,_abortController:l}=this;if(!e||!t)return void this._set("contentElement",null);const a=await Ne();if(l!==this._abortController)return;const d=await Be({arcade:a,expressionInfo:e,graphic:t,location:s,interceptor:i,map:n,spatialReference:o,view:r});if(!d||"esri.arcade.Dictionary"!==d.declaredClass)return void this._set("contentElement",null);const c=await d.castAsJsonAsync(null===l||void 0===l?void 0:l.signal),u=null===c||void 0===c?void 0:c.type,h="media"===u?Ze.A.fromJSON(c):"text"===u?ke.A.fromJSON(c):"fields"===u?Te.A.fromJSON(c):null;this._set("contentElement",h)},this.addHandles([(0,r.wB)((()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view]),(()=>this._compileThrottled()),r.Vh),(0,r.wB)((()=>[this.contentElement]),(()=>this._createVM()),r.Vh)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var e;this._cancelQuery(),null!==(e=this.contentElementViewModel)&&void 0!==e&&e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.map)&&void 0!==e?e:null}set map(e){this._override("map",e)}};(0,o._)([(0,l.MZ)()],Ke.prototype,"_abortController",void 0),(0,o._)([(0,l.MZ)({type:Le.A})],Ke.prototype,"expressionInfo",void 0),(0,o._)([(0,l.MZ)({type:Z.A})],Ke.prototype,"graphic",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ke.prototype,"contentElement",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ke.prototype,"contentElementViewModel",void 0),(0,o._)([(0,l.MZ)()],Ke.prototype,"interceptor",void 0),(0,o._)([(0,l.MZ)({type:le.A})],Ke.prototype,"location",void 0),(0,o._)([(0,l.MZ)()],Ke.prototype,"spatialReference",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ke.prototype,"state",null),(0,o._)([(0,l.MZ)()],Ke.prototype,"map",null),(0,o._)([(0,l.MZ)()],Ke.prototype,"view",void 0),Ke=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Ke);const We=Ke,De="esri-feature",He={base:"".concat(De,"-expression"),loadingSpinnerContainer:"".concat(De,"__loading-container")};let ze=class extends g.A{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new We}initialize(){this.addHandles((0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.contentElementViewModel}),(()=>this._setupExpressionWidget()),r.Vh))}loadDependencies(){return(0,ye.W)({loader:()=>i.e(6454).then(i.bind(i,76454))})}destroy(){this._destroyContentWidget()}render(){var e;const{state:t}=this.viewModel;return(0,b.K)("div",{class:He.base},"loading"===t?this._renderLoading():"disabled"===t?null:null===(e=this._contentWidget)||void 0===e?void 0:e.render())}_renderLoading(){return(0,b.K)("div",{class:He.loadingSpinnerContainer,key:"loading-container"},(0,b.K)("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=null===t||void 0===t?void 0:t.type;this._destroyContentWidget();const o=e?"fields"===i?new Y({viewModel:e}):"media"===i?new Ee({viewModel:e}):"text"===i?new S({viewModel:e}):null:null;this._contentWidget=o,this.scheduleRender()}};(0,o._)([(0,l.MZ)({type:We})],ze.prototype,"viewModel",void 0),ze=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureExpression")],ze);const $e=ze;var Ue=i(30726),je=i(87404);const Ge="esri-feature",qe="".concat(Ge,"-relationship"),Xe={base:qe,listContainer:"".concat(qe,"__list"),listItem:"".concat(qe,"__list-item"),listItemHidden:"".concat(qe,"__list-item--hidden"),listContainerQuerying:"".concat(qe,"__list--querying"),featureObserver:"".concat(Ge,"__feature-observer"),stickySpinnerContainer:"".concat(Ge,"__sticky-loading-container"),loadingSpinnerContainer:"".concat(Ge,"__loading-container")},Ye={title:!0,description:!0};let Qe=class extends g.A{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver((e=>{let[t]=e;(null===t||void 0===t?void 0:t.isIntersecting)&&this._increaseFeaturePage()}),{root:window.document}),this.headingLevel=2,this.viewModel=new je.A,this.messages=null,this.messagesCommon=null,this.visibleElements={...Ye},this._increaseFeaturePage=()=>{const{state:e,showAllEnabled:t,relatedFeatures:i,featuresPerPage:o,featurePage:n}=this.viewModel;"ready"===e&&t&&i.length>=o*n&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new C,this.addHandles([(0,r.wB)((()=>[this.viewModel.description,this.viewModel.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),r.Vh),(0,r.wB)((()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode]),(()=>this._handleRelatedFeatureObserverChange())),(0,r.on)((()=>this.viewModel.relatedFeatureViewModels),"change",(()=>this._setupRelatedFeatureViewModels()))])}loadDependencies(){return(0,ye.W)({icon:()=>Promise.all([i.e(9879),i.e(5012)]).then(i.bind(i,95012)),list:()=>Promise.all([i.e(9879),i.e(6988),i.e(2085),i.e(8010),i.e(9545),i.e(8838)]).then(i.bind(i,58838)),"list-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(3732)]).then(i.bind(i,84661)),loader:()=>i.e(6454).then(i.bind(i,76454)),notice:()=>Promise.all([i.e(9879),i.e(6988),i.e(1985)]).then(i.bind(i,81985))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,Ue.pR)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:i,state:o}=this.viewModel;return!e&&!!t&&"ready"===o&&(t>i||0===i)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return(0,be.V)(null===e||void 0===e?void 0:e.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...Ye,...e}}render(){var e;const{state:t}=this.viewModel;return(0,b.K)("div",{class:this.classes(Xe.base,z.D.widget)},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),"loading"===t?this._renderLoading():"disabled"===t?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,b.K)("div",{class:Xe.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,b.K)("calcite-loader",{inline:!0,label:""})}_renderLoading(){return(0,b.K)("div",{class:Xe.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,b.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=(0,M.V8)(this.container)?"chevron-left":"chevron-right";return(0,b.K)("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){var t,i;const{itemDescriptionFieldName:o}=this.viewModel,n=e.title;e.description=o&&(null===(t=e.formattedAttributes)||void 0===t?void 0:t.global[o]);const s="loading"===e.state;return(0,b.K)("calcite-list-item",{class:this.classes(Xe.listItem,{[Xe.listItemHidden]:s}),description:null!==(i=e.description)&&void 0!==i?i:"",key:e.uid,label:n,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){var e;return this.displayShowAllButton?(0,b.K)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:null===(e=this.messages)||void 0===e?void 0:e.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var e;return(0,b.K)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,b.K)("div",{slot:"message"},null===(e=this.messages)||void 0===e?void 0:e.noRelatedFeatures))}_renderFeatureObserver(){return(0,b.K)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Xe.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return(0,b.K)("calcite-list",null,e.toArray().map((e=>this._renderRelatedFeature(e))),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return(0,b.K)("div",{class:this.classes(Xe.listContainer,{[Xe.listContainerQuerying]:"querying"===t}),key:"list-container"},e?this._renderList():"ready"===t?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var e;return(0,b.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,b.K)("div",{slot:"message"},null===(e=this.messages)||void 0===e?void 0:e.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),null!==e&&void 0!==e&&e.forEach((e=>{this.addHandles((0,r.wB)((()=>[e.title,e.state]),(()=>this.scheduleRender()),r.Vh),t)})),this.scheduleRender()}_setupFeatureElementInfo(){var e;const{headingLevel:t,visibleElements:i}=this,o=i.description&&this.description,n=i.title&&this.title;null===(e=this._featureElementInfo)||void 0===e||e.set({description:o,title:n,headingLevel:t})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await(0,ne.Pl)(0),this._relatedFeatureIntersectionObserverNode&&"ready"===e&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,o._)([(0,l.MZ)()],Qe.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Qe.prototype,"displayShowAllButton",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Qe.prototype,"displayListItems",null),(0,o._)([(0,l.MZ)()],Qe.prototype,"description",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Qe.prototype,"featureCountDescription",null),(0,o._)([(0,l.MZ)()],Qe.prototype,"headingLevel",void 0),(0,o._)([(0,l.MZ)()],Qe.prototype,"title",null),(0,o._)([(0,l.MZ)({type:je.A})],Qe.prototype,"viewModel",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Feature/t9n/Feature")],Qe.prototype,"messages",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/t9n/common")],Qe.prototype,"messagesCommon",void 0),(0,o._)([(0,l.MZ)()],Qe.prototype,"visibleElements",void 0),(0,o._)([(0,v.w)("visibleElements")],Qe.prototype,"castVisibleElements",null),Qe=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureRelationship")],Qe);const Je=Qe;var et,tt=i(5632),it=i(67478);const ot="content-view-models",nt="relationship-view-models",st={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let rt=et=class extends((0,tt.sA)(k.A)){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=u(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...st},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:t}=this;return"attachments"===e.type&&!!t.attachmentsContent||"custom"===e.type&&!!t.customContent||"fields"===e.type&&!!t.fieldsContent||"media"===e.type&&!!t.mediaContent||"text"===e.type&&!!t.textContent||"expression"===e.type&&!!t.expressionContent||"relationship"===e.type&&!!t.relationshipContent},this.addHandles((0,r.wB)((()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone]),(()=>this._graphicChangedThrottled()),r.Vh))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return(0,L.n_)((0,L.ld)(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return(0,L.JF)(this.graphic)}castAbilities(e){return{...st,...e}}get isTable(){var e;return(null===(e=this._sourceLayer)||void 0===e?void 0:e.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){var t;this._set("graphic",null!==(t=null===e||void 0===e?void 0:e.clone())&&void 0!==t?t:null)}get spatialReference(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.timeZone)&&void 0!==e?e:it.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){var e;return(null===(e=this.view)||void 0===e?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof we&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof we&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof we&&t.previous()}async updateGeometry(){var e;const{graphic:t,spatialReference:i,_sourceLayer:o}=this;await(null===o||void 0===o?void 0:o.load());const n=null===o||void 0===o?void 0:o.objectIdField;if(!n||!t||!o)return;const s=null===t||void 0===t||null===(e=t.attributes)||void 0===e?void 0:e[n];if(null==s)return;const r=[s];if(!t.geometry){const e=await(0,L.DU)({layer:o,graphic:t,outFields:[],objectIds:r,returnGeometry:!0,spatialReference:i}),n=null===e||void 0===e?void 0:e.geometry;n&&(t.geometry=n)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){(0,ne.zf)(i)||(this._error=i,s.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):"relationship"===e.type?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map(((e,t)=>this._compileContentElement(e,t))).filter(ee.Ru):"string"==typeof e?this._compileText(new ke.A({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(nt),this.removeHandles(ot),this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_matchesFeature(e,t){var i;const o=null===e||void 0===e||null===(i=e.graphic)||void 0===i?void 0:i.getObjectId(),n=null===t||void 0===t?void 0:t.getObjectId();return null!=o&&null!=n&&o===n}_setRelatedFeaturesViewModels(e){let{relatedFeatureViewModels:t,relatedFeatures:i,map:o}=e;const{view:n,spatialReference:s,timeZone:r}=this;null!==i&&void 0!==i&&i.filter(Boolean).forEach((e=>{t.some((t=>this._matchesFeature(t,e)))||t.add(new et({abilities:{relationshipContent:!1},map:o,view:n,spatialReference:s,timeZone:r,graphic:e}))})),t.forEach((e=>{const o=null===i||void 0===i?void 0:i.find((t=>this._matchesFeature(e,t)));o||t.remove(e)}))}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:o,contentElementViewModel:n}=e,s=null===o||void 0===o?void 0:o.type;n&&s&&("fields"===s&&(this._createFieldsFormattedAttributes({contentElement:o,contentElementIndex:t,formattedAttributes:i}),n.set(this._createFieldsVMParams(o,t))),"media"===s&&(this._createMediaFormattedAttributes({contentElement:o,contentElementIndex:t,formattedAttributes:i}),n.set(this._createMediaVMParams(o,t))),"text"===s&&n.set(this._createTextVMParams(o)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:o,relationshipId:n,title:s,description:l}=e,{_sourceLayer:a,graphic:d,map:c}=this;if(!(0,L.sS)(a))return;const u=new je.A({displayCount:i,graphic:d,orderByFields:o,relationshipId:n,layer:a,map:c,...this._compileTitleAndDesc({title:s,description:l})});return this.contentViewModels[t]=u,this.addHandles((0,r.on)((()=>u.relatedFeatures),"change",(()=>this._setRelatedFeaturesViewModels(u))),nt),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:o,map:n,spatialReference:s,view:l,location:a}=this,d=new We({expressionInfo:i,graphic:o,interceptor:et.interceptor,map:n,spatialReference:s,view:l,location:a});return this.contentViewModels[t]=d,this.addHandles((0,r.wB)((()=>d.contentElementViewModel),(()=>this._setExpressionContentVM(d,t)),r.Vh),ot),e}_compileAttachments(e,t){const{graphic:i}=this,{description:o,title:n}=e;return this.contentViewModels[t]=new w({graphic:i,...this._compileTitleAndDesc({title:n,description:o})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:o,destroyer:n}=e;return this.contentViewModels[t]=new P({graphic:i,creator:o,destroyer:n}),e}_compileTitleAndDesc(e){let{title:t,description:i}=e;const{_fieldInfoMap:o,_sourceLayer:n,graphic:s,formattedAttributes:r}=this,l=null===s||void 0===s?void 0:s.attributes,a=this._expressionAttributes,d=r.global;return{title:(0,L.u2)({attributes:l,fieldInfoMap:o,globalAttributes:d,expressionAttributes:a,layer:n,text:t}),description:(0,L.u2)({attributes:l,fieldInfoMap:o,globalAttributes:d,expressionAttributes:a,layer:n,text:i})}}_createFieldsVMParams(e,t){const i=this._effectivePopupTemplate,o=this.formattedAttributes,n={...null===o||void 0===o?void 0:o.global,...null===o||void 0===o?void 0:o.content[t]},s=(null===e||void 0===e?void 0:e.fieldInfos)||(null===i||void 0===i?void 0:i.fieldInfos),r=null===s||void 0===s?void 0:s.filter((e=>{let{fieldName:t}=e;return!!t&&((0,L.Tt)(t)||(0,L.s$)(t)||n.hasOwnProperty(t))})),l=null===i||void 0===i?void 0:i.expressionInfos,{description:a,title:d}=e;return{attributes:n,expressionInfos:l,fieldInfos:r,...this._compileTitleAndDesc({title:d,description:a})}}_compileFields(e,t){const i=e.clone(),o=new H(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=o,i.fieldInfos=o.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){var i;const{abilities:o,graphic:n,_fieldInfoMap:s,_effectivePopupTemplate:r,relatedInfos:l,_sourceLayer:a,_expressionAttributes:d}=this,c=this.formattedAttributes,u=null!==(i=null===n||void 0===n?void 0:n.attributes)&&void 0!==i?i:{},{description:h,mediaInfos:p,title:v}=e;return{abilities:{chartAnimation:o.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,isAggregate:null===n||void 0===n?void 0:n.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...null===c||void 0===c?void 0:c.global,...null===c||void 0===c?void 0:c.content[t]},expressionAttributes:d,mediaInfos:p,popupTemplate:r,relatedInfos:l,...this._compileTitleAndDesc({title:v,description:h})}}_compileMedia(e,t){const i=e.clone(),o=new we(this._createMediaVMParams(e,t));return i.mediaInfos=o.formattedMediaInfos.slice(0),this.contentViewModels[t]=o,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:o,_expressionAttributes:n}=this;if(e&&e.text){var s,r,l;const a=null!==(s=null===t||void 0===t?void 0:t.attributes)&&void 0!==s?s:{},d=null!==(r=null===(l=this.formattedAttributes)||void 0===l?void 0:l.global)&&void 0!==r?r:{};e.text=(0,L.u2)({attributes:a,fieldInfoMap:i,globalAttributes:d,expressionAttributes:n,layer:o,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new P(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:o}=this;if(!e)return;const{lastEditInfoEnabled:n}=e,s=null===t||void 0===t?void 0:t.editFieldsInfo;return n&&s?(0,L.a$)(s,null===i||void 0===i?void 0:i.attributes,o,t):void 0}_compileTitle(e){var t,i,o;const{_fieldInfoMap:n,_sourceLayer:s,graphic:r,_expressionAttributes:l}=this,a=null!==(t=null===r||void 0===r?void 0:r.attributes)&&void 0!==t?t:{},d=null!==(i=null===(o=this.formattedAttributes)||void 0===o?void 0:o.global)&&void 0!==i?i:{};return(0,L.u2)({attributes:a,fieldInfoMap:n,globalAttributes:d,expressionAttributes:l,layer:s,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,L.AB)({type:"title",value:null===e||void 0===e?void 0:e.title,event:{graphic:t}}):null}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,L.AB)({type:"content",value:null===e||void 0===e?void 0:e.content,event:{graphic:t}}):null}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:o,_effectivePopupTemplate:n}=this,s=this.map,r=this.view,l=this.spatialReference,a=this.location;if(t!==this._featureAbortController||!o)return;await(0,L.c3)({graphic:o,popupTemplate:n,layer:i,spatialReference:l},e);const{content:{value:d},title:{value:c}}=await(0,ne.Lx)({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:u}}=await(0,ne.Lx)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Se({expressionInfos:null===n||void 0===n?void 0:n.expressionInfos,spatialReference:l,graphic:o,map:s,interceptor:et.interceptor,view:r,options:e,location:a})});t===this._featureAbortController&&o&&(this._expressionAttributes=u,this._graphicExpressionAttributes={...o.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(d)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(d)||null))}_createMediaFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:o}=e;const{_effectivePopupTemplate:n,graphic:s,relatedInfos:r,_sourceLayer:l,_fieldInfoMap:a,_graphicExpressionAttributes:d,timeZone:c}=this;o.content[i]=(0,L.x1)({fieldInfos:null===n||void 0===n?void 0:n.fieldInfos,graphic:s,attributes:{...d,...t.attributes},layer:l,fieldInfoMap:a,relatedInfos:r,timeZone:c})}_createFieldsFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:o}=e;if(t.fieldInfos){const{graphic:e,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:r,_graphicExpressionAttributes:l,timeZone:a}=this;o.content[i]=(0,L.x1)({fieldInfos:t.fieldInfos,graphic:e,attributes:{...l,...t.attributes},layer:s,fieldInfoMap:r,relatedInfos:n,timeZone:a})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:o,_sourceLayer:n,_fieldInfoMap:s,_graphicExpressionAttributes:r,timeZone:l}=this,a=null===t||void 0===t?void 0:t.fieldInfos,d={global:(0,L.x1)({fieldInfos:a,graphic:i,attributes:r,layer:n,fieldInfoMap:s,relatedInfos:o,timeZone:l}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:d}),"media"===e.type&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:d})})),d}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,(0,L.ld)(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:o,_sourceLayer:n}=this;o.clear();const s=null!=(null===n||void 0===n?void 0:n.associatedLayer)?await(null===n||void 0===n?void 0:n.associatedLayer.load(i)):n;if(!s||!e)return;const r=t.filter((e=>!!e.fieldName&&(0,L.s$)(e.fieldName)));if(null===r||void 0===r||!r.length)return;t.forEach((e=>this._configureRelatedInfo(e,s)));const l=await _e({relatedInfos:o,layer:s},i);Object.keys(l).forEach((e=>{var t;const i=o.get(e.toString()),n=null===(t=l[e])||void 0===t?void 0:t.value;i&&n&&(i.layerInfo=n.data)}));const a=await function(e,t){let{graphic:i,relatedInfos:o,layer:n}=e;const s={};return o.forEach(((e,o)=>{e.layerInfo&&(s[o]=ge(i,e,n,t))})),(0,ne.Lx)(s)}({graphic:e,relatedInfos:o,layer:s},i);Object.keys(a).forEach((e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:o}=e,n=null===i||void 0===i?void 0:i.value;t.relatedFeatures=n?n.features:[];const s=null===o||void 0===o?void 0:o.value;t.relatedStatsFeatures=s?s.features:[]}(null===(t=a[e])||void 0===t?void 0:t.value,o.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,o=pe(e.fieldName||"");if(!o)return;const{layerId:n,fieldName:s}=o;if(!n)return;const r=i.get(n.toString())||ve(n,t);r&&(function(e){var t;let{relatedInfo:i,fieldName:o,fieldInfo:n}=e;if(null!==(t=i.relatedFields)&&void 0!==t&&t.push(o),n.statisticType){var s;const e=new ce.A({statisticType:n.statisticType,onStatisticField:o,outStatisticFieldName:o});null===(s=i.outStatistics)||void 0===s||s.push(e)}}({relatedInfo:r,fieldName:s,fieldInfo:e}),this.relatedInfos.set(n,r))}};rt.interceptor=new class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||(this.preLayerQueryCallback=e=>{}),this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}}(L.Ao,L.q6),(0,o._)([(0,l.MZ)()],rt.prototype,"_error",void 0),(0,o._)([(0,l.MZ)()],rt.prototype,"_featureAbortController",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"_effectivePopupTemplate",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"_fieldInfoMap",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"_sourceLayer",null),(0,o._)([(0,l.MZ)()],rt.prototype,"abilities",void 0),(0,o._)([(0,v.w)("abilities")],rt.prototype,"castAbilities",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"content",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"contentViewModels",void 0),(0,o._)([(0,l.MZ)()],rt.prototype,"description",void 0),(0,o._)([(0,l.MZ)({type:Boolean})],rt.prototype,"defaultPopupTemplateEnabled",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"isTable",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"state",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"formattedAttributes",void 0),(0,o._)([(0,l.MZ)({type:Z.A,value:null})],rt.prototype,"graphic",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"lastEditInfo",void 0),(0,o._)([(0,l.MZ)({type:le.A})],rt.prototype,"location",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"relatedInfos",void 0),(0,o._)([(0,l.MZ)()],rt.prototype,"spatialReference",null),(0,o._)([(0,l.MZ)()],rt.prototype,"timeZone",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"title",void 0),(0,o._)([(0,l.MZ)()],rt.prototype,"map",null),(0,o._)([(0,l.MZ)({readOnly:!0})],rt.prototype,"waitingForContent",null),(0,o._)([(0,l.MZ)()],rt.prototype,"view",void 0),rt=et=(0,o._)([(0,a.$)("esri.widgets.Feature.FeatureViewModel")],rt);const lt=rt,at="esri-feature",dt={base:at,container:"".concat(at,"__size-container"),title:"".concat(at,"__title"),main:"".concat(at,"__main-container"),btn:"".concat(at,"__button"),icon:"".concat(at,"__icon"),content:"".concat(at,"__content"),contentNode:"".concat(at,"__content-node"),contentNodeText:"".concat(at,"__content-node--text"),contentElement:"".concat(at,"__content-element"),text:"".concat(at,"__text"),lastEditedInfo:"".concat(at,"__last-edited-info"),fields:"".concat(at,"__fields"),fieldHeader:"".concat(at,"__field-header"),fieldData:"".concat(at,"__field-data"),fieldDataDate:"".concat(at,"__field-data--date"),loadingSpinnerContainer:"".concat(at,"__loading-container")},ct=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>(0,V.p4)(e)&&!e.destroyed?(0,b.K)("div",{class:dt.contentNode,key:e},e.render()):e instanceof HTMLElement?(0,b.K)("div",{afterCreate:this._attachToNode,bind:e,class:dt.contentNode,key:e}):(0,V.xk)(e)?(0,b.K)("div",{afterCreate:this._attachToNode,bind:e.domNode,class:dt.contentNode,key:e}):null}_attachToNode(e){e.appendChild(this)}};return t=(0,o._)([(0,a.$)("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var ut;const ht={title:!0,content:!0,lastEditedInfo:!0},pt="relationship-handles";let vt=ut=class extends(ct(g.A)){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...ht},this.viewModel=new lt}initialize(){this.addHandles((0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.contentViewModels}),(()=>this._setupContentWidgets()),r.Vh))}loadDependencies(){return(0,ye.W)({notice:()=>Promise.all([i.e(9879),i.e(6988),i.e(1985)]).then(i.bind(i,81985)),loader:()=>i.e(6454).then(i.bind(i,76454))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...ht,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){const{state:e}=this.viewModel,t=(0,b.K)("div",{class:dt.container,key:"container"},this._renderTitle(),"error"===e?this._renderError():"loading"===e?this._renderLoading():this._renderContentContainer());return(0,b.K)("div",{class:this.classes(dt.base,z.D.widget)},t)}_renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return(0,b.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?(0,b.K)("div",{key:"error-title",slot:"title"},e.errorMessage):null,(0,b.K)("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return(0,b.K)("div",{class:dt.loadingSpinnerContainer,key:"loading-container"},(0,b.K)("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:e}=this;return e.content?(0,b.K)("div",{class:dt.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:e,title:t}=this;return e.title?(0,b.K)(y.D,{class:dt.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,b.K)("div",{class:dt.contentNode,key:"".concat(t,"-content-elements")},e.map(this._renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:(0,b.K)("div",{class:this.classes(dt.contentNode,dt.contentNodeText),key:"".concat(t,"-content")},e.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){var i;const{visibleElements:o}=this;if("boolean"!=typeof o.content&&(null===(i=o.content)||void 0===i||!i[e.type]))return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:o}=t.viewModel;return"loading"===i||o.length>0?(0,b.K)("div",{class:this.classes(dt.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){const{creator:i}=e,o=this._contentWidgets[t];return!o||o.destroyed?null:i?(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("custom-element",t)},o.render()):null}_renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:o,user:n}=i,s="edit"===i.type?n?t.lastEditedByUser:t.lastEdited:n?t.lastCreatedByUser:t.lastCreated,r=(0,be.V)(s,{date:o,user:n});return(0,b.K)("div",{class:this.classes(dt.lastEditedInfo,dt.contentElement),key:"edit-info-element"},r)}_renderText(e,t){const i=e.text,o=this._contentWidgets[t];return!o||o.destroyed?null:i?(0,b.K)("div",{class:this.classes(dt.contentElement,dt.text),key:this._buildKey("text-element",t)},o.render()):null}_buildKey(e){for(var t,i=arguments.length,o=new Array(i>1?i-1:0),n=1;n<i;n++)o[n-1]=arguments[n];return"".concat(e,"__").concat((null===(t=this.viewModel)||void 0===t||null===(t=t.graphic)||void 0===t?void 0:t.uid)||"0","-").concat(o.join("-"))}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(pt),this._contentWidgets.forEach((e=>this._destroyContentWidget(e))),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){const{flowItems:t,visibleElements:i}=this;this.addHandles([(0,r.on)((()=>e),"select-record",(e=>{let{featureViewModel:o}=e;t&&(o.abilities={relationshipContent:!0},t.push(new ut({flowItems:t,viewModel:o,visibleElements:i})))})),(0,r.on)((()=>e),"show-all-records",(()=>{if(!t)return;const{viewModel:i}=e;i.showAllEnabled=!0;const o=new Je({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(o),t.push(o)}))],pt)}_setupContentWidgets(){var e;this._destroyContentWidgets();const{headingLevel:t,visibleElements:i}=this,o=null===(e=this.viewModel)||void 0===e?void 0:e.content,{contentViewModels:n}=this.viewModel;if(Array.isArray(o))o.forEach(((e,o)=>{if("attachments"===e.type&&(this._contentWidgets[o]=new T({displayType:e.displayType,headingLevel:i.title&&t<6?t+1:t,viewModel:n[o]})),"fields"===e.type&&(this._contentWidgets[o]=new Y({viewModel:n[o]})),"media"===e.type&&(this._contentWidgets[o]=new Ee({viewModel:n[o]})),"text"===e.type&&(this._contentWidgets[o]=new S({viewModel:n[o]})),"custom"===e.type&&(this._contentWidgets[o]=new S({viewModel:n[o]})),"expression"===e.type&&(this._contentWidgets[o]=new $e({viewModel:n[o]})),"relationship"===e.type){const e=new Je({viewModel:n[o]});this._addFeatureRelationshipHandles(e),this._contentWidgets[o]=e}}),this);else{const e=n[0];e&&!e.destroyed&&(this._contentWidgets[0]=new S({viewModel:e}))}this.scheduleRender()}};(0,o._)([(0,l.MZ)()],vt.prototype,"graphic",null),(0,o._)([(0,l.MZ)()],vt.prototype,"defaultPopupTemplateEnabled",null),(0,o._)([(0,l.MZ)()],vt.prototype,"flowItems",void 0),(0,o._)([(0,l.MZ)()],vt.prototype,"headingLevel",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],vt.prototype,"isTable",null),(0,o._)([(0,l.MZ)()],vt.prototype,"icon",null),(0,o._)([(0,l.MZ)()],vt.prototype,"label",null),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Feature/t9n/Feature")],vt.prototype,"messages",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/t9n/common")],vt.prototype,"messagesCommon",void 0),(0,o._)([(0,l.MZ)()],vt.prototype,"spatialReference",null),(0,o._)([(0,l.MZ)()],vt.prototype,"timeZone",null),(0,o._)([(0,l.MZ)({readOnly:!0})],vt.prototype,"title",null),(0,o._)([(0,l.MZ)()],vt.prototype,"visibleElements",void 0),(0,o._)([(0,v.w)("visibleElements")],vt.prototype,"castVisibleElements",null),(0,o._)([(0,l.MZ)()],vt.prototype,"map",null),(0,o._)([(0,l.MZ)()],vt.prototype,"view",null),(0,o._)([(0,l.MZ)({type:lt})],vt.prototype,"viewModel",void 0),vt=ut=(0,o._)([(0,a.$)("esri.widgets.Feature")],vt);const gt=vt;var _t=i(55191);const ft="esri-features",mt={icon:"".concat(ft,"__icon"),actionImage:"".concat(ft,"__action-image"),base:ft,container:"".concat(ft,"__container"),contentContainer:"".concat(ft,"__content-container"),contentFeature:"".concat(ft,"__content-feature"),flowItemCollapsed:"".concat(ft,"__flow-item--collapsed"),header:"".concat(ft,"__header"),footer:"".concat(ft,"__footer"),featureMenuObserver:"".concat(ft,"__feature-menu-observer"),actionExit:"".concat(ft,"__action--exit"),loader:"".concat(ft,"__loader"),featuresHeading:"".concat(ft,"__heading"),paginationActionBar:"".concat(ft,"__pagination-action-bar"),paginationPrevious:"".concat(ft,"__pagination-previous"),paginationNext:"".concat(ft,"__pagination-next")};let wt=class extends g.A{constructor(e,t){super(e,t),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=e=>{this.emit("open-related-feature",{feature:e})}}loadDependencies(){return(0,ye.W)({action:()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(4068)]).then(i.bind(i,92111)),"flow-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(6269),i.e(661)]).then(i.bind(i,40661))})}render(){const{flowItems:e}=this,t=null===e||void 0===e?void 0:e.toArray();return(0,b.K)(b.w,null,null===t||void 0===t?void 0:t.map((e=>this._renderRelatedRecordsFlowItem(e))))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){var e;const t=null===(e=this.flowItems)||void 0===e?void 0:e.pop();t&&("showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t&&(t.viewModel=null,t.destroy()))}_renderRelatedRecordsFlowItem(e){var t,i;const{messages:o,closable:n,closed:s}=this,r="graphic"in e&&!e.isTable&&(null===(t=e.graphic)||void 0===t?void 0:t.geometry),l=o.exitRelatedRecords,a=o.selectFeature;return(0,b.K)("calcite-flow-item",{bind:this,closable:n,closed:s,description:this._getRelatedRecordsFlowItemDescription(e),heading:null!==(i=e.title)&&void 0!==i?i:"",key:"flow-item-".concat(e.viewModel.uid),onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,b.K)("calcite-action",{appearance:"transparent",bind:this,class:mt.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:l,title:l}),r?(0,b.K)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:a,title:a}):null,(0,b.K)("div",{class:mt.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){var t;return"featureCountDescription"in e?e.featureCountDescription:null!==(t=e.viewModel.description)&&void 0!==t?t:""}};(0,o._)([(0,l.MZ)()],wt.prototype,"flowItems",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Features/t9n/Features")],wt.prototype,"messages",void 0),(0,o._)([(0,l.MZ)()],wt.prototype,"closed",void 0),(0,o._)([(0,l.MZ)()],wt.prototype,"closable",void 0),wt=(0,o._)([(0,a.$)("esri.widgets.Features.FeaturesRelatedRecords")],wt);const yt=wt;i(95444);var Mt=i(60767),bt=i(9624),Ft=i(45417),It=i(25515),At=i(3569),Ct=i(8503),xt=i(90992),Et=i(50037),Tt=i(76192),Zt=i(15062);const kt=c.A.ofType({key:"type",defaultKeyValue:"button",base:Et.A,typeMap:{button:d.A,toggle:Tt.A}}),Lt=new d.A({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Zt.T.zoomInMagnifyingGlass}),Rt=new d.A({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Zt.T.trash}),Pt=new d.A({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Zt.T.zoomInMagnifyingGlass}),Vt=new Tt.A({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Zt.T.table,value:!1}),Nt=()=>s.A.getLogger("esri.widgets.Popup.PopupViewModel"),Ot=e=>{const{event:t,view:i,viewModel:o}=e,{action:n}=t;if(!n)return Promise.reject(new oe.A("trigger-action:missing-arguments","Event has no action"));const{disabled:s,id:r}=n;if(!r)return Promise.reject(new oe.A("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new oe.A("trigger-action:invalid-action","Action is disabled"));if(r===Lt.id)return async function(e){var t;const{location:i,selectedFeature:o,view:n,zoomFactor:s}=e,r=Bt(e);if(!n||!r){const e=new oe.A("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:r,view:n});throw Nt().error(e),e}const l=n.scale/s,a=null===(t=e.selectedFeature)||void 0===t?void 0:t.geometry,d=null!==a&&void 0!==a?a:i,c=null!=d&&"point"===d.type&&await async function(e,t){if("3d"!==(null===t||void 0===t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=null;try{t=await i.whenGraphicBounds(e,{useViewElevation:!0})}catch(ni){}return!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]}return!0}(o,n);Lt.active=!0,Lt.disabled=!0;try{await e.zoomTo({target:{target:r,scale:c?l:void 0}})}catch(u){const e=new oe.A("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:o});Nt().error(e)}finally{Lt.active=!1,Lt.disabled=!1,e.zoomToLocation=null,c&&(e.location=d)}}(o).catch(ne.jH);if(r===Pt.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null===i||void 0===i?void 0:i.type)){const e=new oe.A("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Nt().error(e),e}if(!t||!St(t)){const e=new oe.A("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Nt().error(e),e}const[o,n]=await Kt(i,t);Pt.active=!0,Pt.disabled=!0;const{extent:s}=await o.queryExtent(n);s&&await e.zoomTo({target:s}),Pt.active=!1,Pt.disabled=!1}(o);if(r===Vt.id)return o.browseClusterEnabled=!o.browseClusterEnabled,o.featureMenuOpen=o.browseClusterEnabled,Promise.resolve();if(r===Rt.id){o.visible=!1;const{selectedFeature:e}=o;if(!e)return Promise.reject(new oe.A("trigger-action:".concat(Rt.id),"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):null===i||void 0===i||i.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function Bt(e){var t;const{selectedFeature:i,location:o,view:n}=e;return n&&null!==(t=null!==i&&void 0!==i?i:o)&&void 0!==t?t:null}function St(e){var t;return!!e&&e.isAggregate&&"cluster"===(null===(t=e.sourceLayer)||void 0===t||null===(t=t.featureReduction)||void 0===t?void 0:t.type)}async function Kt(e,t){const i=await e.whenLayerView(t.sourceLayer),o=i.createQuery(),n=t.getObjectId();return o.aggregateIds=null!=n?[n]:[],[i,o]}var Wt=i(68999),Dt=i(79535),Ht=i(86875);const zt="location-scale-handle";let $t=null;let Ut=class extends((0,Dt.R)(Wt.A)){constructor(e){super(e),this._pendingPromises=new Mt.A,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new kt,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Z.A({symbol:new Ht.default({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,ne.sg)((async e=>{var t,o,n;const{spatialReference:r}=this,l=null===(t=this.selectedFeature)||void 0===t||null===(t=t.geometry)||void 0===t?void 0:t.type,a=null!==(o=this.location)&&void 0!==o?o:e;if(l&&"mesh"!==l&&r&&a&&this.selectedFeature)if("point"!==l)try{const e=this.selectedFeature;let t=e.geometry;const o=this._getHighlightLayer(e),n=e.getObjectId();if(!o||!this.view)return;if(n){var d,c;const e=null===(d=this.view)||void 0===d?void 0:d.allLayerViews.find((e=>e.layer.uid===o.uid));if(!e||!("queryFeatures"in e))return;const i=e.createQuery();i.outSpatialReference=r,i.objectIds=[n],i.returnGeometry=!0;const{features:s}=await e.queryFeatures(i);t=null===(c=s[0])||void 0===c?void 0:c.geometry}if(!t||"mesh"===t.type)return;if(t=(0,bt.project)(t,r),$t||($t=await i.e(6203).then(i.bind(i,56203))),!await $t.intersects(t,a)){var u;const i=null!==(u=(await $t.nearestCoordinate(t,a)).coordinate)&&void 0!==u?u:a;this.selectedFeature===e&&(this.location=i)}}catch(ni){(0,ne.zf)(ni)||s.A.getLogger(this).error(ni)}else this.location=null!==(n=(0,h.z8)(this.selectedFeature.geometry))&&void 0!==n?n:a}))}initialize(){this.addHandles([this.on("view-change",(()=>this._autoClose())),(0,r.wB)((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),(0,r.wB)((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),(0,r.wB)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.animation)||void 0===e?void 0:e.state}),(e=>this._animationStateChange(e))),(0,r.wB)((()=>this.location),(e=>this._locationChange(e))),(0,r.wB)((()=>this.selectedFeature),(e=>this._selectedFeatureChange(e))),(0,r.wB)((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),(0,r.wB)((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),(0,r.wB)((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>Ot({event:e,viewModel:this,view:this.view}))),(0,r.z7)((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),r.OH),(0,r.wB)((()=>[this.features,this.map,this.spatialReference,this.timeZone]),(()=>this._updateFeatureVMs())),(0,r.wB)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.scale}),(()=>this._viewScaleChange())),(0,r.z7)((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),(0,r.wB)((()=>this.browseClusterEnabled),(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){var e;const t=this._get("allActions")||new kt;t.removeAll();const{actions:i,defaultActions:o,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:r}=this,l=s?o.concat(i):i,a=r&&("function"==typeof r.getEffectivePopupTemplate&&r.getEffectivePopupTemplate(n)||r.popupTemplate),d=null===a||void 0===a?void 0:a.actions,c=null!==a&&void 0!==a&&a.overwriteActions?d:null!==(e=null===d||void 0===d?void 0:d.concat(l))&&void 0!==e?e:l;return null!==c&&void 0!==c&&c.filter(Boolean).forEach((e=>t.add(e))),t}get defaultActions(){const e=this._get("defaultActions")||new kt;return e.removeAll(),e.addMany(St(this.selectedFeature)?[Pt.clone(),Vt.clone()]:[Lt.clone()]),e}get featureCount(){return this.features.length}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:o,selectedFeatureIndex:n}=this,s=o&&t.length;s&&i&&-1===n?this.selectedFeatureIndex=0:s&&-1!==n||(this.selectedFeatureIndex=t.length?0:-1)}set location(e){var t,i;let o=e;const n=null===(t=this.spatialReference)||void 0===t?void 0:t.isWebMercator;(null===e||void 0===e||null===(i=e.spatialReference)||void 0===i?void 0:i.isWGS84)&&n&&(o=(0,Ft.Gh)(e)),this._set("location",o)}get map(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.map)&&void 0!==e?e:null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach((e=>this._pendingPromises.add(e))),e.reduce(((e,t)=>e.finally((()=>t.then((e=>{this._pendingPromises.has(t)&&this._updateFeatures(e)})).finally((()=>this._pendingPromises.delete(t))).catch((()=>{}))))),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.timeZone)&&void 0!==e?e:it.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some((e=>e.waitingForContent))}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:e}=this,t=Bt(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new oe.A("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){var i;const{view:o}=this;if(!o||!e)throw new oe.A("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:o});return o.fetchPopupFeatures(e,{pointerType:null===t||void 0===t||null===(i=t.event)||void 0===i?void 0:i.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:null===t||void 0===t?void 0:t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const o=["actionsMenuOpen","collapsed"];for(const n of o)delete t[n];this.set(t)}triggerAction(e){const t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function(e){Vt.value=!1;const t=e.features.filter((e=>St(e)));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;"2d"===(null===e||void 0===e?void 0:e.type)?St(t)?(await async function(e){const{view:t,selectedFeature:i}=e;if(!t||!i)return;const[o,n]=await Kt(t,i),{extent:s}=await o.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=s,t.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e;if(!i||!t)return;const[o,n]=await Kt(i,t);Vt.active=!0,Vt.disabled=!0;const{features:s}=await o.queryFeatures(n);Vt.active=!1,Vt.disabled=!1,Vt.value=!0,null===e||void 0===e||e.open({features:[t].concat(s),featureMenuOpen:!0})}(this)):s.A.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):s.A.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(Lt.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){var e;const t=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(ee.Ru);null!==(e=this.view)&&void 0!==e&&null!==(e=e.graphics)&&void 0!==e&&e.removeMany(t),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(St(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i,view:o}=this;o&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:o,featureViewModels:n}=this;if(null===i)return;const s=((i-1)*o+t)%t,r=s+o;n.slice(s,r).forEach(((t,i)=>{var o;t&&(null!==(o=t.graphic)&&void 0!==o||(t.graphic=e[s+i]))}))}async _selectedFeatureChange(e){var t;const{location:i,updateLocationEnabled:o,view:n}=this;if(!e||!n)return;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),St(e))return;return e.symbol=await(0,Ct.Kf)(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}const s=null===(t=e.sourceLayer)||void 0===t?void 0:t.type;if("map-image"!==s&&"imagery"!==s&&"imagery-tile"!==s||(e.symbol=await(0,Ct.Kf)(e)),!o&&i||!e.geometry){if(o&&!e.geometry){var r;await this.centerAtLocation();const e=null===(r=n.center)||void 0===r?void 0:r.clone();e&&(this.location=e)}}else this.location=(0,h.z8)(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(e){const{pendingFeatures:t}=await this._fetchFeaturesWithController({mapPoint:e});this.promises=t}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i,view:o,spatialReference:n,map:s,timeZone:r,location:l}=this;if(St(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),null===t||void 0===t||!t.length)return;const a=i.slice(0),d=[];t.forEach(((t,i)=>{if(!t)return;let c=null;if(a.some(((e,i)=>(e&&e.graphic===t&&(c=e,a.splice(i,1)),!!c))),c)d[i]=c;else{const a=new lt({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:n,graphic:t===e?t:null,location:l,map:s,view:o,timeZone:r});d[i]=a}})),a.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",d)}async _getScreenPoint(e,t){const{spatialReference:i,view:o}=this;if(!o)return null;await(null===o||void 0===o?void 0:o.when());const n=null===e||void 0===e?void 0:e.spatialReference;return n&&i?(await(0,bt.initializeProjection)(n,i,null,t),o.toScreen(e)):null}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures(e){let{mapPoint:t,screenPoint:i,event:o,signal:n}=e;return this.fetchFeatures(null!==i&&void 0!==i?i:await this._getScreenPoint(null!==t&&void 0!==t?t:this.location,{signal:n}),{signal:n,event:o})}_fetchFeaturesWithController(e){let{mapPoint:t,screenPoint:i,event:o}=e;this._cancelFetchingFeatures();const n=new AbortController,{signal:s}=n;this._fetchFeaturesController=n;const r=this._projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:i,signal:s,event:o});return r.catch((()=>{})).then((()=>{this._fetchFeaturesController=null})),r}async _fetchFeaturesAndOpen(e){const{mapPoint:t,screenPoint:i}=e,{view:o}=this;this.removeHandles(zt),this.addHandles([(0,r.wB)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.scale}),(()=>this._debouncedLocationUpdate(t).catch((e=>{(0,ne.zf)(e)||s.A.getLogger(this).error(e)})))),(0,r.z7)((()=>!this.visible),(()=>{this.removeHandles(zt)}),{once:!0})],zt);const{pendingFeatures:n}=await this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});(null===o||void 0===o?void 0:o.popup)&&"open"in o.popup&&o.popup.open({location:null!==t&&void 0!==t?t:void 0,promises:n})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:"map-notes"===(null===i||void 0===i?void 0:i.type)||"subtype-group"===(null===i||void 0===i?void 0:i.type)?i:t}_getHighlightTarget(e,t,i){if(function(e,t){return"building-scene"===e||"2d"===t&&("map-image"===e||"tile"===e||"imagery"===e||"imagery-tile"===e)}(t.type,i))return e;const o=e.getObjectId();if(null!=o)return o;const n="imagery"===t.type?void 0:"objectIdField"in t?t.objectIdField||At.r:null,s=e.attributes;return s&&n&&s[n]||e}_mapIncludesLayer(e){var t;return!(null===(t=this.map)||void 0===t||null===(t=t.allLayers)||void 0===t||!t.includes(e))}async _highlightActiveFeature(){const e="highlight-active-feature";this.removeHandles(e);const{highlightEnabled:t,view:i,activeFeature:o,visible:n}=this;if(!(o&&i&&t&&n))return;const s=this._getHighlightLayer(o);if(!(s&&s instanceof It.A&&this._mapIncludesLayer(s)))return;const r=this._getLayerView(i,s);this._highlightActiveFeaturePromise=r;const l=await r;if(!(l&&(0,xt.Of)(l)&&this._highlightActiveFeaturePromise===r&&this.activeFeature&&this.highlightEnabled))return;const a=l.highlight(this._getHighlightTarget(o,s,i.type));this.addHandles(a,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this.removeHandles(e);const{selectedFeature:t,highlightEnabled:i,view:o,visible:n}=this;if(!(t&&o&&i&&n))return;const s=this._getHighlightLayer(t);if(!(s&&s instanceof It.A&&this._mapIncludesLayer(s)))return;const r=this._getLayerView(o,s);this._highlightSelectedFeaturePromise=r;const l=await r;if(!(l&&(0,xt.Of)(l)&&this._highlightSelectedFeaturePromise===r&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const a=l.highlight(this._getHighlightTarget(t,s,o.type));this.addHandles(a,e)}_updateFeatures(e){const{features:t}=this,i=e.filter((e=>!t.includes(e)));(null===i||void 0===i?void 0:i.length)&&(this.features=t.concat(i))}};(0,o._)([(0,l.MZ)()],Ut.prototype,"_fetchFeaturesController",void 0),(0,o._)([(0,l.MZ)({type:kt})],Ut.prototype,"actions",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"active",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"activeFeature",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"allActions",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"autoCloseEnabled",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"browseClusterEnabled",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"content",void 0),(0,o._)([(0,l.MZ)({type:kt,readOnly:!0})],Ut.prototype,"defaultActions",null),(0,o._)([(0,l.MZ)({type:Boolean})],Ut.prototype,"defaultPopupTemplateEnabled",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"featureCount",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"featurePage",void 0),(0,o._)([(0,l.MZ)({value:[]})],Ut.prototype,"features",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"featuresPerPage",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"featureMenuOpen",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"featureViewModelAbilities",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"featureViewModels",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"highlightEnabled",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"includeDefaultActions",void 0),(0,o._)([(0,l.MZ)({type:le.A})],Ut.prototype,"location",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"map",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"pendingPromisesCount",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"promiseCount",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"promises",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"selectedClusterBoundaryFeature",void 0),(0,o._)([(0,l.MZ)({value:null,readOnly:!0})],Ut.prototype,"selectedFeature",null),(0,o._)([(0,l.MZ)({value:-1})],Ut.prototype,"selectedFeatureIndex",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"selectedFeatureViewModel",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"state",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"timeZone",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"title",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"updateLocationEnabled",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"view",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"visible",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"waitingForContents",null),(0,o._)([(0,l.MZ)({readOnly:!0})],Ut.prototype,"waitingForResult",null),(0,o._)([(0,l.MZ)()],Ut.prototype,"zoomFactor",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"zoomToLocation",void 0),(0,o._)([(0,l.MZ)()],Ut.prototype,"centerAtLocation",null),Ut=(0,o._)([(0,a.$)("esri.widgets.Features.FeaturesViewModel")],Ut);const jt=Ut;let Gt=class extends k.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"actionBar",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"closeButton",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"collapseButton",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"featureNavigation",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"featureListLayerTitle",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"flow",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"heading",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],Gt.prototype,"spinner",void 0),Gt=(0,o._)([(0,a.$)("esri.widgets.Features.FeaturesVisibleElements")],Gt);const qt=Gt;var Xt=i(12254),Yt=i(50265);const Qt="selected-index",Jt="features-spinner";function ei(e){var t;return null!==(t=null===e||void 0===e?void 0:e.declaredClass.startsWith("esri.layers."))&&void 0!==t&&t}let ti=class extends(ct(g.A)){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=e=>{let[t]=e;(null===t||void 0===t?void 0:t.isIntersecting)&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new c.A,this._relatedRecordsWidget=new yt({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new kt,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new jt,this.visibleElements=new qt,this._renderAction=(e,t)=>{const i=this._getActionTitle(e),{type:o,active:n,uid:s,disabled:r,indicator:l}=e;return e.visible?(0,b.K)("calcite-action",{active:"toggle"===o&&e.value,appearance:"solid",bind:this,"data-action-uid":s,disabled:r,icon:this._getActionIcon(e),indicator:l,key:"action-".concat(t),loading:n,onclick:this._triggerAction,scale:"s",text:i,title:this._hideActionText?i:void 0},this._getFallbackIcon(e)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=e=>{this._focusOn===e&&requestAnimationFrame((async()=>{var t,i;switch(e){case"menu-flow-item":await(null===(t=this._featureMenuViewportNode)||void 0===t?void 0:t.setFocus());break;case"root-flow-item":await(null===(i=this._rootFlowItemNode)||void 0===i?void 0:i.setFocus())}this._focusOn=null}))},this._focusFlowItemNodeThrottled=u(this._focusFlowItemNode,50),this._displaySpinnerThrottled=u((()=>this._displaySpinner()),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.active}),(()=>this._toggleScreenLocationEnabled())),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.active}),(e=>this._relatedRecordsWidget.closed=!e)),(0,r.wB)((()=>{var e;return null===(e=this.visibleElements)||void 0===e?void 0:e.closeButton}),(e=>this._relatedRecordsWidget.closable=e)),(0,r.wB)((()=>{var e;return null===(e=this.visibleElements)||void 0===e?void 0:e.spinner}),(e=>this._spinnerEnabledChange(e))),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.view}),((e,t)=>this._viewChange(e,t))),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.ready}),((e,t)=>this._viewReadyChange(null!==e&&void 0!==e&&e,null!==t&&void 0!==t&&t))),(0,r.wB)((()=>{var e,t;return[null===(e=this.viewModel)||void 0===e?void 0:e.waitingForResult,null===(t=this.viewModel)||void 0===t?void 0:t.location]}),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.screenLocation}),(()=>this._closeOpenActionMenu())),(0,r.wB)((()=>this.selectedFeatureWidget),(()=>this._destroyRelatedRecordsFlowItemWidgets())),(0,r.wB)((()=>{var e;const t=null===(e=this.selectedFeatureWidget)||void 0===e?void 0:e.viewModel;return[null===t||void 0===t?void 0:t.title,null===t||void 0===t?void 0:t.state]}),(()=>this._setTitleFromFeatureWidget())),(0,r.wB)((()=>{var e;const t=null===(e=this.selectedFeatureWidget)||void 0===e?void 0:e.viewModel;return[null===t||void 0===t?void 0:t.content,null===t||void 0===t?void 0:t.state]}),(()=>this._setContentFromFeatureWidget())),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.featureViewModels}),(()=>this._featureMenuViewportScrollTop())),this._relatedRecordsWidget.on("close",(()=>this.close())),this._relatedRecordsWidget.on("exit",(()=>this._destroyRelatedRecordsFlowItemWidgets())),this._relatedRecordsWidget.on("open-related-feature",(e=>{let{feature:t}=e;return this._openRelatedFeature(t)}))])}loadDependencies(){return(0,ye.W)({action:()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(4068)]).then(i.bind(i,92111)),"action-bar":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(8723)]).then(i.bind(i,48723)),"action-group":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(7689)]).then(i.bind(i,67689)),button:()=>Promise.all([i.e(9879),i.e(6988),i.e(2085),i.e(2602)]).then(i.bind(i,52602)),flow:()=>i.e(4961).then(i.bind(i,14961)),"flow-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(6269),i.e(661)]).then(i.bind(i,40661)),list:()=>Promise.all([i.e(9879),i.e(6988),i.e(2085),i.e(8010),i.e(9545),i.e(8838)]).then(i.bind(i,58838)),"list-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(3732)]).then(i.bind(i,84661)),"list-item-group":()=>i.e(4795).then(i.bind(i,24795)),loader:()=>i.e(6454).then(i.bind(i,76454))})}destroy(){var e,t;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),null!==(e=this._featureMenuIntersectionObserver)&&void 0!==e&&e.disconnect(),null===(t=this._relatedRecordsWidget)||void 0===t||t.destroy()}get _hideActionText(){var e;if(!this.responsiveActionsEnabled)return!1;const t=null===(e=this.view)||void 0===e?void 0:e.widthBreakpoint;return"xsmall"===t||"small"===t||"medium"===t}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:t,_relatedRecordsFlowItems:i,timeZone:o,spatialReference:n,map:s}=this,{selectedFeatureViewModel:r}=this.viewModel,l={title:!1};return r?(e?(e.viewModel=r,e.visibleElements=l):this._feature=new gt({flowItems:i,headingLevel:t+1,timeZone:o,spatialReference:n,map:s,viewModel:r,visibleElements:l}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){var e;const{active:t}=this.viewModel;t?null===(e=this._rootFlowItemNode)||void 0===e||e.blur():s.A.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e?this._setFocusOn():s.A.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){var t;this.removeHandles(Qt);const i={collapsed:null!==(t=null===e||void 0===e?void 0:e.collapsed)&&void 0!==t&&t};this.set(i),this.viewModel.open(e),this.addHandles((0,r.z7)((()=>!this.viewModel.waitingForResult),(()=>this._addSelectedFeatureIndexHandle()),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return(0,b.K)("div",{bind:this,class:this.classes(mt.base,z.D.widget,z.D.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,b.K)("div",{class:mt.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,b.K)("div",{class:mt.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:o,pendingPromisesCount:n}=t;return(0,b.K)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:n>0,onclick:this._openFeatureMenu,scale:"s",text:(0,be.V)(e.pageText,{index:(0,Yt.ZV)(o+1),total:(0,Yt.ZV)(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:t}=this.messagesCommon.pagination;return(0,b.K)("calcite-action-bar",{class:mt.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,b.K)("calcite-action-group",{scale:"s"},(0,b.K)("calcite-action",{appearance:"solid",class:mt.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),(0,b.K)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){const{selectedFeatureViewModel:t,featureViewModels:i}=this.viewModel,o=e===t,n=i.indexOf(e);return(0,b.K)("calcite-list-item",{bind:this,"data-feature-index":n,key:"feature-menu-item-".concat(e.uid),onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:o,onCalciteListItemSelect:this._selectFeature},(0,b.K)("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach((e=>{var i;const o=null===e||void 0===e?void 0:e.graphic;if(!o)return;const{layer:n,sourceLayer:s}=o,r=(ei(n)?n:null)||(ei(s)?s:null),l=null!==(i=t.get(r))&&void 0!==i?i:[];t.set(r,[...l,e])})),t}_renderFeatureMenu(){const{featureViewModels:e}=this.viewModel,t=this._groupResultsByLayer();return e.length?(0,b.K)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(t.keys(),(e=>{var i,o;const n=null===(i=t.get(e))||void 0===i?void 0:i.map((e=>this._renderFeatureMenuItem(e))),s=e?null!==(o=e.title)&&void 0!==o?o:this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&null!==s?(0,b.K)("calcite-list-item-group",{heading:s,key:(null===e||void 0===e?void 0:e.uid)||"map-graphics"},n):n}))):null}_renderHeaderAction(e,t){var i;const o=e.title||"";return e.visible?(0,b.K)("calcite-action",{active:"toggle"===e.type&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:null!==(i=e.icon)&&void 0!==i?i:void 0,indicator:e.indicator,key:"header-action-".concat(t),loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:o,title:o}):null}_renderHeaderActions(){return this.headerActions.map(((e,t)=>this._renderHeaderAction(e,t))).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:o,featureNavigationTop:n}=this,{title:s,active:r}=this.viewModel,l=t.heading&&s?s:"";return(0,b.K)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[mt.contentFeature]:!0,[mt.flowItemCollapsed]:i}),closable:t.closeButton,closed:!r,collapsed:i,collapseDirection:n?"down":"up",collapsible:o,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},l?(0,b.K)(y.D,{class:this.classes(mt.featuresHeading,z.D.heading),innerHTML:l,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:(0,b.K)("div",{class:this.classes(mt.container,mt.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,featureMenuOpen:t,messages:i,messagesCommon:o}=this,{active:n,featureViewModels:s,pendingPromisesCount:r}=e;return t?(0,b.K)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!n,description:(0,be.V)(i.total,{total:s.length}),heading:i.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleFeatureMenuBack()}},r>0?(0,b.K)("calcite-loader",{class:mt.loader,inline:!0,key:"feature-menu-loader",label:o.loading,slot:"header-actions-end"}):null,(0,b.K)("div",{class:mt.container},this._renderFeatureMenu()),(0,b.K)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:mt.featureMenuObserver}),(0,b.K)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},o.back)):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,b.K)("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:t,icon:i}=e;if(i)return null;const o=(0,p.CA)({action:e,feature:this.selectedFeature}),n={[mt.icon]:!!t,[mt.actionImage]:!!o};return t&&(n[t]=!0),o||t?(0,b.K)("span",{"aria-hidden":"true",class:this.classes(mt.icon,n),key:"icon",styles:(0,p.p5)(o)}):null}_renderActionBar(){var e;return!this._isCollapsed&&this.visibleElements.actionBar&&null!==(e=this.viewModel.allActions)&&void 0!==e&&e.length?(0,b.K)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,b.K)("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var e;const t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?(0,b.K)("div",{class:dt.contentNode,innerHTML:t,key:t}):this.renderNodeContent(t):null}_setFocusOn(){this.renderNow(),requestAnimationFrame((()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"}))}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=null===t||void 0===t?void 0:t.geometry;if(null==i||null==t)return;this._destroyRelatedRecordsFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const o=(0,h.z8)(i);this.open({features:[t],location:null!=o?o:void 0})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){var t;const{viewModel:i}=this,o=e.currentTarget["data-feature-index"];i.activeFeature=(null===(t=i.features)||void 0===t?void 0:t[o])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){var t;const{messages:i,selectedFeature:o,messagesCommon:n}=this,{id:s}=e,r=null===o||void 0===o?void 0:o.attributes,l=null!==(t=e.title)&&void 0!==t?t:"",a="zoom-to-feature"===s?(0,be.V)(l,{messages:i}):"remove-selected-feature"===s?(0,be.V)(l,{messages:n}):"zoom-to-clustered-features"===s||"browse-clustered-features"===s?(0,be.V)(l,{messages:i}):e.title;return a&&r?(0,be.V)(a,r):null!==a&&void 0!==a?a:""}_onMainKeydown(e){const{key:t}=e;"ArrowLeft"===t&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this,i=null===e||void 0===e?void 0:e.viewModel;e&&(this.viewModel.title="error"===(null===i||void 0===i?void 0:i.state)?null===t||void 0===t?void 0:t.errorMessage:(null===i||void 0===i?void 0:i.title)||"")}_addSelectedFeatureIndexHandle(){const e=(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.selectedFeatureIndex}),((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this.addHandles(e,Qt)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this.viewModel;i&&e!==t&&-1!==e&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,o=this.headerActions.find((e=>{let{uid:t}=e;return t===i}));o&&!o.disabled&&("toggle"===(null===o||void 0===o?void 0:o.type)&&(o.value=!o.value),this.emit("trigger-header-action",{action:o}))}_triggerAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,{allActions:o}=this.viewModel,n=o.findIndex((e=>e.uid===i)),s=o.at(n);s&&"toggle"===s.type&&(s.value=!s.value),this.viewModel.triggerAction(n)}_createSpinner(e){e&&(this._spinner=new _t.A({view:e}),e.ui.add(this._spinner,{key:Jt,position:"manual",internal:!0}))}_wireUpView(e){var t;this._destroySpinner(),e&&(null===(t=this.visibleElements)||void 0===t?void 0:t.spinner)&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){var i;e?this._wireUpView(null===(i=this.viewModel)||void 0===i?void 0:i.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain((e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()}))}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){var e;const{_spinner:t,view:i}=this;t&&(null!==i&&void 0!==i&&null!==(e=i.ui)&&void 0!==e&&e.remove(t,Jt),t.destroy(),this._spinner=null)}_spinnerEnabledChange(e){var t;this._destroySpinner(),e&&this._createSpinner(null===(t=this.viewModel)||void 0===t?void 0:t.view)}};(0,o._)([(0,l.MZ)()],ti.prototype,"_focusOn",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"_relatedRecordsFlowItems",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"_hideActionText",null),(0,o._)([(0,l.MZ)()],ti.prototype,"_featureNavigationVisible",null),(0,o._)([(0,l.MZ)()],ti.prototype,"_isCollapsed",null),(0,o._)([(0,l.MZ)()],ti.prototype,"_collapseEnabled",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ti.prototype,"active",null),(0,o._)([(0,l.MZ)()],ti.prototype,"collapsed",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"content",null),(0,o._)([(0,l.MZ)()],ti.prototype,"icon",null),(0,o._)([(0,l.MZ)()],ti.prototype,"featureMenuOpen",null),(0,o._)([(0,l.MZ)()],ti.prototype,"featureNavigationTop",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"features",null),(0,o._)([(0,l.MZ)()],ti.prototype,"goToOverride",null),(0,o._)([(0,l.MZ)({type:kt})],ti.prototype,"headerActions",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"headingLevel",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"location",null),(0,o._)([(0,l.MZ)()],ti.prototype,"label",null),(0,o._)([(0,l.MZ)()],ti.prototype,"map",null),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Features/t9n/Features")],ti.prototype,"messages",void 0),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/t9n/common")],ti.prototype,"messagesCommon",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"promises",null),(0,o._)([(0,l.MZ)()],ti.prototype,"responsiveActionsEnabled",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],ti.prototype,"selectedFeature",null),(0,o._)([(0,l.MZ)()],ti.prototype,"selectedFeatureIndex",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ti.prototype,"selectedFeatureWidget",null),(0,o._)([(0,l.MZ)()],ti.prototype,"spatialReference",null),(0,o._)([(0,l.MZ)()],ti.prototype,"title",null),(0,o._)([(0,l.MZ)()],ti.prototype,"timeZone",null),(0,o._)([(0,l.MZ)()],ti.prototype,"updateLocationEnabled",null),(0,o._)([(0,l.MZ)()],ti.prototype,"view",null),(0,o._)([(0,l.MZ)({type:jt}),(0,Xt.U)(["triggerAction","trigger-action"])],ti.prototype,"viewModel",void 0),(0,o._)([(0,l.MZ)({type:qt,nonNullable:!0})],ti.prototype,"visibleElements",void 0),(0,o._)([(0,l.MZ)()],ti.prototype,"visible",null),ti=(0,o._)([(0,a.$)("esri.widgets.Features")],ti);const ii=ti,oi="esri-popup",ni="".concat(oi,"--is-docked"),si={base:oi,baseHidden:"".concat(oi,"--hidden"),main:"".concat(oi,"__main-container"),shadow:"".concat(oi,"--shadow"),isDocked:ni,isDockedTopLeft:"".concat(ni,"-top-left"),isDockedTopCenter:"".concat(ni,"-top-center"),isDockedTopRight:"".concat(ni,"-top-right"),isDockedBottomLeft:"".concat(ni,"-bottom-left"),isDockedBottomCenter:"".concat(ni,"-bottom-center"),isDockedBottomRight:"".concat(ni,"-bottom-right"),alignTopCenter:"".concat(oi,"--aligned-top-center"),alignBottomCenter:"".concat(oi,"--aligned-bottom-center"),alignTopLeft:"".concat(oi,"--aligned-top-left"),alignBottomLeft:"".concat(oi,"--aligned-bottom-left"),alignTopRight:"".concat(oi,"--aligned-top-right"),alignBottomRight:"".concat(oi,"--aligned-bottom-right"),pointer:"".concat(oi,"__pointer"),pointerDirection:"".concat(oi,"__pointer-direction")};let ri=class extends jt{constructor(e){super(e)}};ri=(0,o._)([(0,a.$)("esri.widgets.Popup.PopupViewModel")],ri);const li=ri;let ai=class extends k.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"actionBar",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"closeButton",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"collapseButton",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"featureNavigation",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"featureListLayerTitle",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"heading",void 0),(0,o._)([(0,l.MZ)({type:Boolean,nonNullable:!0})],ai.prototype,"spinner",void 0),ai=(0,o._)([(0,a.$)("esri.widgets.Popup.PopupVisibleElements")],ai);const di=ai,ci={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let ui=class extends g.A{constructor(e,t){super(e,t),this._dockAction=new d.A({id:"popup-dock-action"}),this._featuresWidget=new ii({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new li,this.visibleElements=new di}initialize(){this.addHandles([(0,r.wB)((()=>{var e;return[null===(e=this.viewModel)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.widthBreakpoint,this.dockEnabled]}),(()=>this._handleDockIcon()),r.Vh),(0,r.wB)((()=>{var e,t;return[this.dockEnabled,null===(e=this.messages)||void 0===e?void 0:e.undock,null===(t=this.messages)||void 0===t?void 0:t.dock]}),(()=>this._handleDockEnabled()),r.Vh),(0,r.wB)((()=>this.dockOptions),(e=>{const{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)}),r.Vh),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.screenLocation}),(()=>this._positionContainer())),(0,r.wB)((()=>{var e;return[null===(e=this.viewModel)||void 0===e?void 0:e.active,this.dockEnabled]}),(()=>this._toggleScreenLocationEnabled())),(0,r.wB)((()=>{var e,t,i,o,n;return[null===(e=this.viewModel)||void 0===e?void 0:e.screenLocation,null===(t=this.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.padding,null===(i=this.viewModel)||void 0===i||null===(i=i.view)||void 0===i?void 0:i.size,null===(o=this.viewModel)||void 0===o?void 0:o.active,null===(n=this.viewModel)||void 0===n?void 0:n.location,this.alignment]}),(()=>this.reposition())),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.size}),((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.view}),((e,t)=>this._viewChange(e,t))),(0,r.wB)((()=>{var e;return null===(e=this.viewModel)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.ready}),((e,t)=>this._viewReadyChange(null!==e&&void 0!==e&&e,null!==t&&void 0!==t&&t))),(0,r.wB)((()=>this.viewModel),(()=>this._featuresWidget.viewModel=this.viewModel),r.Vh),(0,r.wB)((()=>this._featureNavigationTop),(e=>this._featuresWidget.featureNavigationTop=e),r.Vh),(0,r.wB)((()=>this.headingLevel),(e=>this._featuresWidget.headingLevel=e),r.Vh),(0,r.wB)((()=>this.visibleElements.actionBar),(e=>this._featuresWidget.visibleElements.actionBar=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.closeButton),(e=>this._featuresWidget.visibleElements.closeButton=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.collapseButton),(e=>this._featuresWidget.visibleElements.collapseButton=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.heading),(e=>this._featuresWidget.visibleElements.heading=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.spinner),(e=>this._featuresWidget.visibleElements.spinner=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.featureNavigation),(e=>this._featuresWidget.visibleElements.featureNavigation=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.featureListLayerTitle),(e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e),r.Vh),(0,r.on)((()=>this._featuresWidget),"trigger-header-action",(e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)}))])}normalizeCtorArgs(e){const t={...e};return null!=(null===e||void 0===e?void 0:e.visibleElements)&&(t.visibleElements=new di(e.visibleElements),null!=e.collapseEnabled&&(t.visibleElements.collapseButton=e.collapseEnabled),null!=e.spinnerEnabled&&(t.visibleElements.spinner=e.spinnerEnabled)),t}destroy(){var e;this._dockAction.destroy(),null===(e=this._featuresWidget)||void 0===e||e.destroy()}get _featureNavigationTop(){const{currentAlignment:e,currentDockPosition:t}=this;return"bottom-left"===e||"bottom-center"===e||"bottom-right"===e||"top-left"===t||"top-center"===t||"top-right"===t}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get collapseEnabled(){return(0,n.Lx)(s.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(e){(0,n.Lx)(s.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ci}set dockOptions(e){var t;const i={...ci},o=null===(t=this.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.breakpoints,n={};o&&(n.width=o.xsmall,n.height=o.xsmall);const s={...i,...e},r={...i.breakpoint,...n},{breakpoint:l}=s;"object"==typeof l?s.breakpoint={...r,...l}:l&&(s.breakpoint=r),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,n.Lx)(s.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(e){(0,n.Lx)(s.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e||s.A.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||s.A.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame((()=>{this._featuresWidget.focus()}))}next(){return this.viewModel.next()}open(e){const t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),this._shouldFocus(e)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var e,t;const{dockEnabled:i,currentAlignment:o,currentDockPosition:n}=this,{active:s,screenLocation:r}=this.viewModel,l=s&&i,a=s&&!i,d=null===(e=this.selectedFeature)||void 0===e||null===(e=e.layer)||void 0===e?void 0:e.title,c=null===(t=this.selectedFeature)||void 0===t||null===(t=t.layer)||void 0===t?void 0:t.id,u={[si.alignTopCenter]:"top-center"===o,[si.alignBottomCenter]:"bottom-center"===o,[si.alignTopLeft]:"top-left"===o,[si.alignBottomLeft]:"bottom-left"===o,[si.alignTopRight]:"top-right"===o,[si.alignBottomRight]:"bottom-right"===o,[si.isDocked]:l,[si.shadow]:a,[si.isDockedTopLeft]:"top-left"===n,[si.isDockedTopCenter]:"top-center"===n,[si.isDockedTopRight]:"top-right"===n,[si.isDockedBottomLeft]:"bottom-left"===n,[si.isDockedBottomCenter]:"bottom-center"===n,[si.isDockedBottomRight]:"bottom-right"===n};return(0,b.K)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(si.base,u,{[si.baseHidden]:!r&&!i}),"data-layer-id":c,"data-layer-title":d,role:"presentation"},s?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,b.K)("div",{class:si.pointer,key:"popup-pointer",role:"presentation"},(0,b.K)("div",{class:this.classes(si.pointerDirection,si.shadow)}))}_renderMainContainer(){const{dockEnabled:e}=this,t={[si.shadow]:e};return(0,b.K)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(si.main,z.D.widget,t)},this._featuresWidget.render())}async _shouldFocus(e){(null===e||void 0===e?void 0:e.shouldFocus)&&(await(0,r.C_)((()=>{var e;return!0===(null===(e=this.viewModel)||void 0===e?void 0:e.active)})),this.focus())}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:o,side:n,view:s}=e;if(isNaN(i)||isNaN(t)||!s||!o)return!1;const r=s.padding;return"right"===n&&o.x+i/2>s.width-r.right||"left"===n&&o.x-i/2<r.left||"top"===n&&o.y-t<r.top||"bottom"===n&&o.y+t>s.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:o,viewModel:n}=this,{screenLocation:s,view:r}=n;if(null==s||!r||!i)return"top-center";function l(e){return parseInt(e.replaceAll(/[^-\d.]/g,""),10)}const a=o?window.getComputedStyle(o,null):null,d=a?l(a.getPropertyValue("max-height")):0,c=a?l(a.getPropertyValue("height")):0,{height:u,width:h}=i.getBoundingClientRect(),p=h+t,v=Math.max(u,d,c)+t,g=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:s,side:"right",view:r}),_=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:s,side:"left",view:r}),f=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:s,side:"top",view:r}),m=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:s,side:"bottom",view:r});return _?f?"bottom-right":"top-right":g?f?"bottom-left":"top-left":f?m?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,M.V8)(this.container)&&t.reverse(),null===e||void 0===e?void 0:e.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null===(e=this.dockOptions)||void 0===e?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null===(t=this.viewModel)||void 0===t?void 0:t.view,o=(0,M.V8)(this.container)?"top-left":"top-right";if(!i)return o;const n=i.padding||{left:0,right:0,top:0,bottom:0},s=i.width-n.left-n.right,{breakpoints:r}=i;return r&&s<=r.xsmall?"bottom-center":o}_getDockIcon(){const e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var e,t;this._dockAction.title=this.dockEnabled?null===(e=this.messages)||void 0===e?void 0:e.undock:null===(t=this.messages)||void 0===t?void 0:t.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),o=this._calculatePositionStyle(t,i);o&&Object.assign(this._containerNode.style,o)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,o){const{currentAlignment:n,_pointerOffsetInPx:s}=this;if(!i)return;const{padding:r}=i,l=o/2,a=i.height-t,d=i.width-e;return"bottom-center"===n?{top:t+s-r.top,left:e-l-r.left}:"top-left"===n?{bottom:a+s-r.bottom,right:d+s-r.right}:"bottom-left"===n?{top:t+s-r.top,right:d+s-r.right}:"top-right"===n?{bottom:a+s-r.bottom,left:e+s-r.left}:"bottom-right"===n?{top:t+s-r.top,left:e+s-r.left}:"top-center"===n?{bottom:a+s-r.bottom,left:e-l-r.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:o}=this;if(!o)return;if(i)return{left:"",top:"",right:"",bottom:""};if(null==e||!t)return;const n=this._calculateFullWidth(t),s=this._calculateAlignmentPosition(e.x,e.y,o,n);return s?{top:void 0!==s.top?"".concat(s.top,"px"):"auto",left:void 0!==s.left?"".concat(s.left,"px"):"auto",bottom:void 0!==s.bottom?"".concat(s.bottom,"px"):"auto",right:void 0!==s.right?"".concat(s.right,"px"):"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[o,n]=e,[s,r]=t,{width:l=0,height:a=0}=null!==i&&void 0!==i?i:{};return o<=l&&s>l||o>l&&s<=l||n<=a&&r>a||n>a&&r<=a}_updateDockEnabledForViewSize(e,t){var i;if(!e||!t)return;const o=(null===(i=this.viewModel)||void 0===i||null===(i=i.view)||void 0===i?void 0:i.padding)||{left:0,right:0,top:0,bottom:0},n=o.left+o.right,s=o.top+o.bottom,r=[],l=[];r[0]=e[0]-n,r[1]=e[1]-s,l[0]=t[0]-n,l[1]=t[1]-s;const{dockOptions:a}=this,d=a.breakpoint;this._dockingThresholdCrossed(r,l,d)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i,o;const n=e.breakpoint,s=null===(t=this.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.ui;if(!s)return!1;const{width:r,height:l}=s;if(isNaN(r)||isNaN(l))return!1;if(!n)return!1;const a=n.hasOwnProperty("width")&&r<=(null!==(i=n.width)&&void 0!==i?i:0),d=n.hasOwnProperty("height")&&l<=(null!==(o=n.height)&&void 0!==o?o:0);return a||d}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"_featureNavigationTop",null),(0,o._)([(0,l.MZ)()],ui.prototype,"actions",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"active",null),(0,o._)([(0,l.MZ)()],ui.prototype,"alignment",void 0),(0,o._)([(0,l.MZ)()],ui.prototype,"autoCloseEnabled",null),(0,o._)([(0,l.MZ)()],ui.prototype,"defaultPopupTemplateEnabled",null),(0,o._)([(0,l.MZ)()],ui.prototype,"content",null),(0,o._)([(0,l.MZ)()],ui.prototype,"collapsed",null),(0,o._)([(0,l.MZ)()],ui.prototype,"collapseEnabled",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"currentAlignment",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"currentDockPosition",null),(0,o._)([(0,l.MZ)()],ui.prototype,"dockOptions",null),(0,o._)([(0,l.MZ)()],ui.prototype,"dockEnabled",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"featureCount",null),(0,o._)([(0,l.MZ)()],ui.prototype,"featureMenuOpen",null),(0,o._)([(0,l.MZ)()],ui.prototype,"features",null),(0,o._)([(0,l.MZ)()],ui.prototype,"goToOverride",null),(0,o._)([(0,l.MZ)()],ui.prototype,"headingLevel",void 0),(0,o._)([(0,l.MZ)()],ui.prototype,"highlightEnabled",null),(0,o._)([(0,l.MZ)()],ui.prototype,"icon",null),(0,o._)([(0,l.MZ)()],ui.prototype,"location",null),(0,o._)([(0,l.MZ)()],ui.prototype,"label",null),(0,o._)([(0,l.MZ)(),(0,j.G)("esri/widgets/Popup/t9n/Popup")],ui.prototype,"messages",void 0),(0,o._)([(0,l.MZ)()],ui.prototype,"promises",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"selectedFeature",null),(0,o._)([(0,l.MZ)()],ui.prototype,"selectedFeatureIndex",null),(0,o._)([(0,l.MZ)({readOnly:!0})],ui.prototype,"selectedFeatureWidget",null),(0,o._)([(0,l.MZ)()],ui.prototype,"spinnerEnabled",null),(0,o._)([(0,l.MZ)()],ui.prototype,"title",null),(0,o._)([(0,l.MZ)()],ui.prototype,"updateLocationEnabled",null),(0,o._)([(0,l.MZ)()],ui.prototype,"view",null),(0,o._)([(0,l.MZ)({type:li}),(0,Xt.U)(["triggerAction","trigger-action"])],ui.prototype,"viewModel",void 0),(0,o._)([(0,l.MZ)()],ui.prototype,"visible",null),(0,o._)([(0,l.MZ)({type:di,nonNullable:!0})],ui.prototype,"visibleElements",void 0),ui=(0,o._)([(0,a.$)("esri.widgets.Popup")],ui);const hi=ui}}]);
//# sourceMappingURL=5434.f756dc30.chunk.js.map