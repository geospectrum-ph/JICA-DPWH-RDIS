"use strict";(self.webpackChunkRDIS_Web_Application=self.webpackChunkRDIS_Web_Application||[]).push([[7447,8992],{5109:(t,e,n)=>{n.d(e,{k:()=>r});var i=n(35143),a=n(68134),s=(n(76460),n(81806),n(47249),n(50076),n(85842)),o=n(46975);let r=class extends o.g{constructor(t){super(t)}initialize(){this.addHandles((0,a.wB)((()=>this.analysisViewData.visible),(t=>this.visible=t),a.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};r=(0,i._)([(0,s.$)("esri.views.interactive.AnalysisToolBase")],r)},10260:(t,e,n)=>{n.d(e,{Hd:()=>l,JY:()=>r,aS:()=>c});var i=n(98773),a=n(30726),s=n(50346),o=n(68134);function r(t,e){t.interactive=!0;const{tool:n,view:r}=t;r.activeTool=n;let l=(0,s.u7)(e,(()=>{r.activeTool===n&&(r.activeTool=null)}));return(0,i.UT)((async t=>{await(0,o.C_)((()=>null==n||!n.active),t),l=(0,a.xt)(l)}),e)}function l(t,e){return(0,o.wB)((()=>t.interactive),(()=>function(t,e){t.interactive?function(t,e){c(t);const{view:n,analysis:i}=t,a=new e({view:n,analysis:i,analysisViewData:t});t.tool=a,n.tools.add(a)}(t,e):c(t)}(t,e)),o.pc)}function c(t){const{view:e,tool:n}=t;null!=n&&(e.tools.remove(n),t.tool=null)}},13284:(t,e,n)=>{n.d(e,{e:()=>i});class i{constructor(t){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},14318:(t,e,n)=>{n.d(e,{O:()=>u});var i=n(35143),a=n(91967),s=n(30726),o=n(50346),r=n(46053),l=(n(81806),n(76460),n(47249),n(85842)),c=n(59752);let u=class extends a.A{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)((async(t,e,n,i)=>{const a=this._frameTask;if(null==a)return;const s=await a.schedule((()=>e.snap({...t,context:n,signal:i})),i);s.valid&&await a.schedule((()=>{this.stagedPoint=s.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(c.W6.SNAPPING):c.nu}destroy(){this._abortController=(0,s.DC)(this._abortController),this._frameTask=(0,s.xt)(this._frameTask)}update(t,e,n){this._snapPoints=t;const{point:i,scenePoint:a}=t,s=e.update({point:i,scenePoint:a,context:n});return this.stagedPoint=s,s}async snap(t,e,n){const{point:i,scenePoint:a}=t;return this.stagedPoint=e.update({point:i,scenePoint:a,context:n}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=(0,s.DC)(this._abortController),this._snapPoints=null}};(0,i._)([(0,r.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,i._)([(0,r.MZ)()],u.prototype,"stagedPoint",null),(0,i._)([(0,r.MZ)()],u.prototype,"constrainResult",void 0),(0,i._)([(0,r.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,i._)([(0,l.$)("esri.views.interactive.snapping.SnappingOperation")],u)},14727:(t,e,n)=>{n.d(e,{b:()=>c});var i=n(54901),a=n(30484),s=n(23543),o=n(20578),r=n(23241),l=n(56572);class c{draw(t,e){const n=function(t){const e=[];for(const n of t){let t=!0;for(const i of e)if(n.equals(i)){t=!1;break}t&&e.push(n)}return e}(t),c=this.sortUniqueHints(n),u=[];for(const i of c)i instanceof a.v&&u.push(this.visualizeIntersectionPoint(i,e)),i instanceof s.c&&u.push(this.visualizeLine(i,e)),i instanceof o.r&&u.push(this.visualizeParallelSign(i,e)),i instanceof l.l&&u.push(this.visualizeRightAngleQuad(i,e)),i instanceof r._&&u.push(this.visualizePoint(i,e));return(0,i.vE)(u)}sortUniqueHints(t){return t}}},23218:(t,e,n)=>{n.r(e),n.d(e,{default:()=>We});var i,a=n(35143),s=n(91967),o=n(54901),r=(n(81806),n(76460)),l=n(30726),c=n(68134),u=n(46053),d=(n(47249),n(85842)),p=n(2522),h=n(23458),m=n(31633),g=n(19747),f=n(15941),v=n(24648),_=n(34761),y=n(13191),M=n(20664),S=n(9392),w=n(5568),P=n(75762),C=n(18117),b=n(32535),A=n(25191),D=n(68655),T=n(29772),O=n(90659);function x(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:a,orientation:s}}=t;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:n,offset:i,measureType:a,orientation:s}}function z(t,e){let{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,offset:a,measureType:s,orientation:o}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==n||null==i)return null;const l=L(r?.directSegment??new A.C,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i},e),c=r?.primaryOffsetAxis??(0,S.vt)();E(c,{measureType:s,elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,orientation:o,renderCoordsHelper:e});const u=r?.dimensionSegment??new A.C;return N({elevationAlignedStartPoint:n,elevationAlignedEndPoint:i})&&s===h.L.Vertical?((0,M.c)(u.startRenderSpace,l.startRenderSpace),(0,M.c)(u.endRenderSpace,l.endRenderSpace)):V(u,{offsetAxis:c,offset:a,relativeToSegment:l,renderCoordsHelper:e}),{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,dimensionSegment:u,primaryOffsetAxis:c,spatialReference:e.spatialReference}}function I(t,e,n,a){return e===i.Start?((0,M.c)(t.startRenderSpace,n.startRenderSpace),(0,M.c)(t.endRenderSpace,a.startRenderSpace)):((0,M.c)(t.startRenderSpace,n.endRenderSpace),(0,M.c)(t.endRenderSpace,a.endRenderSpace)),t}function H(t,e,n,i){switch(e){case h.L.Direct:return L(t,n,i);case h.L.Horizontal:case h.L.Vertical:{const{elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,dimension:o,geometry:r}=n;let l;o.measureType===h.L.Direct?(l=function(t,e){const n=t.directSegment.eval(.5,P.rq.get()),i=e.worldUpAtPosition(n,P.rq.get()),a=t.dimensionSegment.eval(.5,P.rq.get()),s=(0,M.z)(P.rq.get(),a,n);return!(0,M.G)(s,S.uY)&&(0,M.m)(s,i)>0}(r,i)===a.z>s.z,e===h.L.Horizontal&&(l=!l)):l=!function(t){const{startRenderSpace:e,endRenderSpace:n}=t.dimensionSegment,{startRenderSpace:i,endRenderSpace:a}=t.directSegment;return(0,M.w)(i,e)<(0,M.w)(a,n)}(r);const[c,u]=l?[a,s]:[s,a],d=(0,b.EL)(u,R);return e===h.L.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),i.toRenderCoords(c,t.startRenderSpace),i.toRenderCoords(d,t.endRenderSpace),t}}}function L(t,e,n){return n.toRenderCoords(e.elevationAlignedStartPoint,t.startRenderSpace),n.toRenderCoords(e.elevationAlignedEndPoint,t.endRenderSpace),t}!function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(i||(i={}));const R=(0,C.T)(0,0,0,null);const Z=new A.C;function E(t,e){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:a,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:r,renderCoordsHelper:l}=e,c=r.eval(.5,P.rq.get()),u=l.worldUpAtPosition(c,P.rq.get()),d=l.worldBasisAtPosition(c,w._.Y,P.rq.get());switch(n){case h.L.Horizontal:(0,M.c)(t,u);break;case h.L.Vertical:(0,M.m)(s,u)<(0,M.m)(o,u)?(0,M.z)(t,o,s):(0,M.z)(t,s,o),(0,M.b)(t,t,u),(0,M.b)(t,t,u);break;case h.L.Direct:{const n=e.orientation??0;if(N({elevationAlignedStartPoint:i,elevationAlignedEndPoint:a}))(0,_.$0)(k,-(0,f.kU)(n),u),(0,M.h)(t,d,k);else{const e=(0,M.z)(P.rq.get(),o,s),i=(0,M.b)(P.rq.get(),e,u);(0,M.b)(i,i,e),(0,_.$0)(k,(0,f.kU)(n),e),(0,M.h)(t,i,k)}break}}return(0,M.G)(t,S.uY)?(0,M.c)(t,d):(0,M.n)(t,t)}const k=(0,y.vt)();function N(t){let{elevationAlignedStartPoint:e,elevationAlignedEndPoint:n}=t;return null!=e&&null!=n&&e.x===n.x&&e.y===n.y}function V(t,e){const{offsetAxis:n,offset:i,relativeToSegment:{startRenderSpace:a,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:r}=e,l=i/r.unitInMeters,[c,u]=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=(0,M.m)(e,n),s=(0,M.m)(t,n),o=Math.abs(a-s)+i;return a>s?[o,i]:[i,o]}(a,s,n,l);return(0,M.r)(t.startRenderSpace,o.startRenderSpace,n,c),(0,M.r)(t.endRenderSpace,o.endRenderSpace,n,u),t}function G(t,e,n){const i=e.directSegment.eval(.5,P.rq.get());return n.worldUpAtPosition(i,t)}function j(t,e){const{startRenderSpace:n,endRenderSpace:i}=e.directSegment;return(0,M.z)(t,i,n)}function B(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:i,endRenderSpace:a}=e.dimensionSegment;return n.invert?(0,M.z)(t,i,a):(0,M.z)(t,a,i)}function U(t,e){const n=t.directSegment.eval(.5,P.rq.get());return e.headingAtPosition(n,t.primaryOffsetAxis)}const W=(0,S.vt)();function q(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:n}=t;if(null==e||null==n)return!1;const i=(0,T.Ce)(e,n);return null!=i&&(0,v.kM)(i,"meters").value>O.U7}function $(t){return null!=t.geometry}let F=class extends s.A{constructor(t){super(t)}initialize(){const t=(0,c.LF)((()=>this.analysisViewData.computations),(t=>{let{computation:e}=t;return this._watchComputation(e)}));this.addHandles((0,o.DQ)(t))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.c)(this.view)}_watchComputation(t){return(0,c.wB)((()=>x(t)),(e=>{const{measureType:n}=e;if(q(e)&&n!==h.L.Direct){const e=Math.round((0,m.oU)(O.U7,"meters","kilometers"));return r.A.getLogger(this).warnOnce(`A ${n} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${e} km. Update the measureType of the affected dimension to "direct" to display it.`),void(t.geometry=null)}const i=z(e,this.view.renderCoordsHelper,t.geometry);t.geometry=i,t.result.length=function(t,e,n){if(null==t)return null;let i;if(e===h.L.Horizontal)i=(0,D.Kt)(t.elevationAlignedStartPoint,t.elevationAlignedEndPoint);else{const{startRenderSpace:e,endRenderSpace:n}=t.dimensionSegment;i=(0,T.vp)(e,n,t.spatialReference)}if(null==i)return null;const a=e===h.L.Vertical?(0,m.jE)(i.value,i.unit,n):(0,m.Vs)(i.value,i.unit,n);return(0,v.kM)(i,a)}(i,n,this._defaultUnit)}),c.pc)}};(0,a._)([(0,u.MZ)({constructOnly:!0})],F.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],F.prototype,"view",void 0),(0,a._)([(0,u.MZ)()],F.prototype,"analysis",null),(0,a._)([(0,u.MZ)()],F.prototype,"_defaultUnit",null),F=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionController")],F);n(35238);var Y=n(50176),X=n(69539),Q=n(73582),J=n(76931),K=n(55855),tt=n(13927),et=n(59784);function nt(t){return(0,et._L)(t.accentColor,.5)}const it=new X.A([127,127,127,.5]),at=6,st=5;var ot=n(56121),rt=n(38317),lt=n(91175),ct=n(7947),ut=n(99443),dt=n(50468),pt=n(51799),ht=n(62577),mt=n(45463),gt=n(66470),ft=n(77447),vt=n(425),_t=n(17046),yt=n(76336),Mt=n(19247);class St{constructor(t){this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}manipulatorName(t){return Object.keys(this).find((e=>this.hasOwnProperty(e)&&t===this[e]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(t){for(const e of h.h)t(this.manipulatorForMeasureType(e),e)}manipulatorForMeasureType(t){switch(t){case h.L.Direct:return this.direct;case h.L.Horizontal:return this.horizontal;case h.L.Vertical:return this.vertical}}}class wt extends ot.q{constructor(t,e){const n=(0,rt.UM)(X.A.toUnitRGBA(nt(t.effectiveTheme))),i=[new lt.M((0,ht.CM)(n,1,32,32),Nt)];super({view:t,renderObjects:i,metadata:e.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.wB)((()=>({color:X.A.toUnitRGBA(nt(t.effectiveTheme))})),(t=>n.setParameters(t)))}destroy(){this._themeHandle.remove(),super.destroy()}}class Pt extends ot.q{constructor(t,e){let{lineSizePt:n,material:i,metadata:a}=e;super({view:t,autoScaleRenderObjects:!1,collisionPriority:1,metadata:a}),this._options={calloutColor:(0,K.vt)(),lineSizePt:n,material:i},this._themeHandle=(0,c.wB)((()=>X.A.toUnitRGBA(nt(t.effectiveTheme))),(t=>{this._options.calloutColor=t,kt(this,Ct({...this._options,metadata:this.metadata}))}),c.Vh)}update(t){let{lineSizePt:e,material:n}=t;this._options.lineSizePt=e,this._options.material=n,kt(this,Ct({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Ct(t){let{calloutColor:e,lineSizePt:n,material:i,metadata:a}=t;return{calloutLength:.25*ut.PV*.8*(0,J.Lz)(n)+18,calloutColor:e,calloutWidth:2,customStateMask:Nt,discScale:.3,focusMultiplier:2,material:i,metadata:a}}function bt(t,e){let{computation:n,view:i}=e;return[(0,_t.Xt)(t,((t,e,a)=>{At({cancel:a,computation:n,settingHeading:!1,steps:e,view:i})})),t.events.on("immediate-click",(t=>{!function(t,e,n){const{dimension:i,geometry:a}=e;if(90===i.orientation||270===i.orientation)return i.orientation=0,void t.stopPropagation();if(null==a)return;const{renderCoordsHelper:s}=n,o=z({...x(e),orientation:90},s),r=z({...x(e),orientation:270},s);if(null==o||null==r)return;const l=U(o,s),c=U(r,s),u=Ot(a,n),d=Q.ie.shortestSignedDiff(u,l),p=Q.ie.shortestSignedDiff(u,c);i.orientation=Math.abs(d)<Math.abs(p)?90:270,t.stopPropagation()}(t,n,i)}))]}function At(t){const{cancel:e,computation:n,settingHeading:i,steps:a,view:s}=t;if(!$(n))return;const{renderCoordsHelper:o}=s,{dimension:r,geometry:l}=n,c=(0,S.vt)(),u=Ht((0,S.vt)(),l,l.directSegment,o),d=Lt(P.rq.get(),{forHeading:i,geometry:l,renderCoordsHelper:o}),p=(0,tt.O_)(u,d,(0,tt.vt)()),h=i?r.orientation??U(l,s.renderCoordsHelper):r.orientation??0;a.next((0,ct.AA)(s,p)).next((t=>{"start"===t.action&&(0,M.c)(c,t.renderStart);const e=(0,tt.Qj)(p),n=(0,rt.FY)(c,t.renderEnd,u,e);let a=h-(0,f.KJ)(n);i||(a=function(t){const e=Q.ie.normalize(t)%90;return e<st?t-e:90-e<st?t+(90-e):t}(a)),r.orientation=a})),e.next((0,_t.VG)(r,["orientation"]))}function Dt(t,e){let{computation:n,manipulatorMeasureType:i,view:a}=e,s=h.L.Direct,o=0,r=0;return[t.events.on("grab-changed",(e=>{if("start"!==e.action||!$(n))return;const{dimension:l,geometry:c}=n;s=l.measureType,o=l.offset,r=l.orientation;const u=(0,M.c)(P.rq.get(),t.renderLocation);l.measureType=i,l.offset=function(t,e,n,i){const{directSegment:a}=n,s=E(P.rq.get(),{measureType:e,directSegment:a,renderCoordsHelper:i}),o=V(Z,{offsetAxis:s,offset:0,relativeToSegment:a,renderCoordsHelper:i}).eval(.5,P.rq.get()),r=(0,M.z)(P.rq.get(),t,o);return(0,M.m)(r,s)*i.unitInMeters}(u,i,c,a.renderCoordsHelper),l.orientation=0})),(0,_t.Xt)(t,((t,e,l)=>{if(!$(n))return;const{geometry:c,dimension:u}=n,{renderCoordsHelper:d}=a,p=H(Bt,i,n,d),h=E(P.rq.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:d}),m=(0,ct.z7)(t);e.next(m).next(Tt(a,u,p,h)),l.next(m).next((t=>(u.measureType=s,u.offset=o,u.orientation=r,t)))}))]}function Tt(t,e,n,i){const a=(0,M.f)(P.rq.get(),n.endRenderSpace,n.startRenderSpace);(0,M.b)(a,a,i);const s=(0,tt.O_)(n.startRenderSpace,a,(0,tt.vt)()),o=(0,tt.O_)(n.startRenderSpace,i,(0,tt.vt)()),r=e.offset;let l,c=0;const u=new _t.rh;return u.next((0,ct.AA)(t,s)).next((n=>{"start"===n.action&&(c=(0,tt.mN)(o,n.renderStart));const i=((0,tt.mN)(o,n.renderEnd)-c)*t.renderCoordsHelper.unitInMeters;e.offset=r+i,l=n})),t=>(u.execute(t),l)}function Ot(t,e){const{directSegment:n}=t,{renderCoordsHelper:i}=e,a=G(P.rq.get(),t,i),s=j(P.rq.get(),t),o=(0,M.b)(P.rq.get(),s,a),{viewForward:r}=e.state.camera;(0,M.m)(o,r)>0&&(0,M.j)(o,o,-1);const l=n.eval(.5,P.rq.get());return i.headingAtPosition(l,o)}function xt(t,e,n,i){let{forHeading:a}=i;const{dimension:s,geometry:o}=e,{primaryOffsetAxis:r}=o,l=(0,M.j)(zt,r,s.offset>=0?1:-1),c=Lt(It,{forHeading:a,geometry:o,renderCoordsHelper:n});(0,M.b)(c,c,l);const u=(0,rt.wQ)(l,c,S.uY,jt);t.modelTransform=u,t.renderLocation=Ht(Vt,o,o.dimensionSegment,n)}const zt=(0,S.vt)(),It=(0,S.vt)();function Ht(t,e,n,i){const{startRenderSpace:a,endRenderSpace:s}=n,o=function(t,e){const n=j(Rt,t),i=G(Zt,t,e);return(0,M.m)(n,i)>0}(e,i)?a:s;return(0,M.c)(t,o)}function Lt(t,e){let{forHeading:n,geometry:i,renderCoordsHelper:a}=e;return n?G(t,i,a):B(t,i,{invert:!0})}const Rt=(0,S.vt)(),Zt=(0,S.vt)();function Et(t){return(0,J.Lz)(t)+at}function kt(t,e){const n=e.material??new ft.r({transparent:!0,writeDepth:!1,textureId:e.texture?.id,renderOccluded:mt.m$.Opaque,isDecoration:!0}),i=e.focusMultiplier??rt.eO.focusMultiplier,a=e.calloutLength??rt.eO.calloutLength,s=rt.eO.discRadius*(e.discScale??1),o=s*i,r=(t,e)=>{const n=[0,1,2,2,3,0];return new pt.V(e,[[gt.r.POSITION,new dt.n([a-t,-t,0,a+t,-t,0,a+t,t,0,a-t,t,0],n,3,!0)],[gt.r.UV0,new dt.n([0,0,1,0,1,1,0,1],n,2,!0)]])},l=e.calloutWidth??rt.eO.calloutWidth,c=new vt.W({width:l,color:e.calloutColor,renderOccluded:mt.m$.OccludeAndTransparent,isDecoration:!0}),u=(0,ht.Z8)(c,[[0,0,0],[a-s,0,0]]),d=(0,ht.Z8)(c,[[0,0,0],[a-o,0,0]]),p=e.customStateMask??yt.SJ.None;t.collisionType={type:"disc",direction:[0,0,1],offset:[a,0,0]},t.focusMultiplier=i,t.metadata=e.metadata,t.radius=s,t.renderObjects=[new lt.M(r(s,n),yt.p7.Unfocused|p),new lt.M(u,yt.p7.Unfocused|p),new lt.M(r(o,n),yt.p7.Focused|p),new lt.M(d,yt.p7.Focused|p)]}const Nt=yt.SJ.Custom1,Vt=(0,S.vt)(),Gt=(0,S.vt)(),jt=(0,y.vt)(),Bt=new A.C;var Ut,Wt=n(56567),qt=n(88321),$t=n(53084),Ft=n(56002),Yt=n(50346),Xt=n(19451);function Qt(t,e,n){const{constraint:i,elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:r}=n,{dimension:l,previousConstraint:c,preConstraintProperties:u}=t;if(null==a||null==s)return;const d=()=>{"startPoint"in e?l.startPoint=e.startPoint:"endPoint"in e&&(l.endPoint=e.endPoint)};if(null==i)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=h.L.Direct,i){case Ut.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in e){const t=e.startPoint;null!=t&&(t.z=s.z),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.z=a.z),l.endPoint=t}break;case Ut.Vertical:if(i!==c&&(l.orientation=Ot(o,r)),"startPoint"in e){const t=e.startPoint;null!=t&&(t.x=s.x,t.y=s.y),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.x=a.x,t.y=a.y),l.endPoint=t}break;case Ut.Direct:i!==c&&null!=u&&(l.orientation=u.orientation),d()}t.previousConstraint=i,t.unconstrainedGeometry=o}!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct"}(Ut||(Ut={}));var Jt=n(59962),Kt=n(70836),te=n(7256),ee=n(85937),ne=n(35925),ie=n(89238),ae=n(974),se=n(59833),oe=n(13284),re=n(61237),le=n(82887),ce=n(14318),ue=n(70330);let de=class extends s.A{constructor(t){super(t),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new qt.A,this._orientationManipulatorTexture=null,this._updatingHandles=new Xt.U,this._getSnappingContext=(0,Ft.B)((t=>new oe.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new se.p(new ae.ZE("point",(0,ie.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Kt.s})));const{view:e}=t;this._snappingManagerResult=(0,le.X)(e),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,ne.wk)(2)}),this._constraintSnappingIndicator=new te.t({view:e,attached:!0,width:1,renderOccluded:mt.m$.OccludeAndTransparent,stipplePattern:(0,ne.wk)(5),isDecoration:!0});const n=X.A.toUnitRGBA(it);this._stagedStartIndicator=new ee.I({view:e,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:mt.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){const{view:t}=this;this._snappingOperation=new ce.O({view:t});const e=!t._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._orientationManipulatorMaterial=new ft.r({transparent:!0,writeDepth:!1,renderOccluded:mt.m$.Opaque,isDecoration:!0}),this.addHandles((0,c.wB)((()=>{return{accentColor:nt(t.effectiveTheme),contrastColor:(e=t.effectiveTheme,(0,et.bJ)(e.accentColor))};var e}),(n=>{let{accentColor:i,contrastColor:a}=n;const s=this._orientationManipulatorTexture,o=(0,Jt.t)(t.textures,{accentColor:i,contrastColor:a,preMultiplyAlpha:e});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,s?.release();const r=X.A.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:r}),this._focusedOffsetManipulatorMaterial.setParameters({color:r}),this._thinOffsetManipulatorMaterial.setParameters({color:r}),this._constraintSnappingIndicator.color=r}),c.Vh));const n=(0,c.LF)((()=>this.analysisViewData.computations),(t=>{let{computation:e}=t;return this._createManipulators(e)}));this.addHandles((0,o.DQ)(n)),this.addHandles([(0,c.wB)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(t=>{let{stagedPoint:e,stagedComputation:n}=t;if(null==n||null==e)return;const i=(0,b.EL)(e,new Mt.A);this._applyPointUpdate(n,{endPoint:i})}),c.OH),(0,c.wB)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((t,e)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:a}=t;if(n===e?.stagedDimension&&a===e?.firstGrabbedManipulator){for(const s of[i,e?.selectedComputation])if(null!=s){const e=this._computationManipulators.get(s);null!=e&&this._updateManipulators(s,e,t)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,t)}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(t=>{this._updateManipulatorStyle(t)}),c.Vh),(0,c.wB)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.wB)((()=>{const t=this._stagedComputation;if(!t)return null;const e=t.elevationAlignedStartPoint,n=(0,S.vt)();return null!=e&&this.view.renderCoordsHelper.toRenderCoords(e,n)?n:null}),(t=>{null!=t?(this._stagedStartIndicator.vertices=[t],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ue.BY)(this,(()=>{const t=this._activeComputation,e=this._stagedComputation;if(null==t||null!=e){const t=this.view.inputManager.latestPointerType??"mouse",e=this._getSnappingContext(t);this._updatingHandles.addPromise((0,Yt.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,e)))}if(null!=t){const{start:e,end:n}=this._computationManipulators.get(t);if(e.grabbing||n.grabbing){!function(t,e,n){let{constraint:i,view:a}=n;const{unconstrainedGeometry:s}=t;if(null==s)return;const{renderCoordsHelper:o,spatialReference:r}=a,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,u=o.fromRenderCoords(l,new Mt.A({spatialReference:r})),d=o.fromRenderCoords(c,new Mt.A({spatialReference:r}));let p;p="start"===e?{startPoint:u}:{endPoint:d},Qt(t,p,{constraint:i,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,unconstrainedGeometry:s,view:a})}(t,e.grabbing?"start":"end",{constraint:this._computeConstraint(t),view:this.view})}}}))}destroy(){this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorTexture?.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=t?t:null}get _stagedComputation(){const t=this._stagedDimension,e=this.analysisViewData.computations.at(-1)?.computation;return null==t||null==e||e.dimension!==t?null:e}get _constraintHandles(){return[(0,c.z7)((()=>this.analysisViewData.selectedComputation),(t=>{t.previousConstraint=this._computeConstraint(t)}),{...c.pc,equals:$t.aI}),(0,c.wB)((()=>{const t=this._activeComputation;if(null==t)return null;const{measureType:e,orientation:n}=t.dimension;return{measureType:e,orientation:n,computation:t}}),((t,e)=>{if(null!=t&&null==e){const{measureType:e,orientation:n,computation:i}=t;switch(i.previousConstraint){case Ut.Horizontal:i.preConstraintProperties={measureType:h.L.Horizontal,orientation:0};break;case Ut.Vertical:i.preConstraintProperties={measureType:h.L.Vertical,orientation:0};break;case Ut.Direct:i.preConstraintProperties={measureType:h.L.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:e,orientation:n}}}null==t&&null!=e&&(e.computation.preConstraintProperties=null)}),c.OH)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return[(0,c.wB)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(e=>{let{stagedComputation:n,activeComputation:i}=e;const a=this._constraintSnappingIndicator;if(this.removeHandles(t),null!=i)if(i===n)a.attached=!0;else{const{start:e,end:n}=this._computationManipulators.get(i),s=()=>{a.attached=e.grabbing||n.grabbing};s(),this.addHandles([e.events.on("grab-changed",s),n.events.on("grab-changed",s)],t)}else a.attached=!1})),(0,c.wB)((()=>{const t=this._activeComputation;return null!=t?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(t=>{let{geometry:e,constraint:n}=t;const i=this._constraintSnappingIndicator;null!=e&&null!=n&&n!==Ut.Direct?(i.visible=!0,i.setGeometryFromSegment(e.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(t){const{_stagedDimension:e}=this;if(null==e){const e=this._onUnstagedClick(t);return this.analysis.dimensions.add(e),null}return this._onStagedClick(t),e}onPointerMove(t){let{mapPoint:e,pointerType:n}=t;if("touch"===n)return;const i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,Yt.QZ)(this._snappingOperation.snap({point:e},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(t){let{mapPoint:e,pointerType:n}=t,i=e;if("mouse"===n){const t=this._getSnappingContext(n);i=this._snappingManager.update({point:e,context:t})}const a=new Wt.A({startPoint:(0,b.EL)(i,new Mt.A),endPoint:null,measureType:h.L.Horizontal});return this._stagedDimension=a,this._resetSnappingState(),a}_onStagedClick(t){let{mapPoint:e,pointerType:n}=t;const i=this._stagedComputation;if(null==i)return;let a=e;if("mouse"===n){const t=this._getSnappingContext(n);a=this._snappingManager.update({point:e,context:t})}const s=(0,b.EL)(a,new Mt.A);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(t){const e=this._setupPointManipulator(t,{isStart:!0}),n=this._setupPointManipulator(t,{isStart:!1}),i=this._setupOffsetManipulator(t),a=this._setupHeadingManipulator(t),s=this._setupRotationManipulator(t),o=this._setupMeasureTypeManipulator(t,h.L.Direct),r=this._setupMeasureTypeManipulator(t,h.L.Horizontal),l=this._setupMeasureTypeManipulator(t,h.L.Vertical),c=new St({start:e,end:n,offset:i,heading:a,rotation:s,direct:o,horizontal:r,vertical:l});return this._setupComputationToManipulatorsSync(t,c),this._computationManipulators.set(t,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of c.values())this.manipulators.remove(t)}}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([(0,c.wB)((()=>t.geometry),(()=>this._updateManipulators(t,e)),{...c.pc,equals:$t.aI})],t)}_setupPointManipulator(t,e){const{view:n}=this,{dimension:i}=t,a=new wt(n,{metadata:i}),s=function(t,e){let{isStart:n,createSnappingPipelineStep:i,dimension:a,onUpdate:s,view:o}=e;const r=n?"startPoint":"endPoint",l=(0,_t.Xt)(t,((t,e,n,l)=>{const c=(0,ct.z7)(t),{snappingStep:u,cancelSnapping:d}=i(l);n=n.next(c).next((0,_t.VG)(a,[r,"measureType","orientation"])).next(d),e.next(c).next((0,ct.xk)(o)).next(...u).next((t=>{const e=(0,b.EL)(t.mapEnd,new Mt.A);s("startPoint"===r?{startPoint:e}:{endPoint:e})}))}));return[l]}(a,{isStart:e.isStart,createSnappingPipelineStep:t=>(0,re.L)({snappingContext:this._getSnappingContext(t),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:e=>this._applyPointUpdate(t,e),view:n});return this._computationHandles.add(s,t),a}_setupOffsetManipulator(t){const{view:e}=this,n=function(t,e){const n=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],i=(0,ht.Z8)(e.unfocusedMaterial,n.map((t=>(0,M.j)((0,S.vt)(),t,.5)))),a=i.instantiate({material:e.focusedMaterial});return new ot.q({view:t,renderObjects:[new lt.M(i,yt.p7.Unfocused|yt.p7.Selected|Nt),new lt.M(a,yt.p7.Focused|Nt)],collisionType:{type:"line",paths:[n]},radius:Et(e.lineSizePt)/2,metadata:e.metadata,available:!1,...rt.MO})}(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),i=function(t,e){let{computation:n,view:i}=e;return[(0,_t.Xt)(t,((t,e,a)=>{if(!$(n)||!t.selected)return;const{geometry:s,dimension:o}=n,r=(0,ct.z7)(t);e.next(r).next(Tt(i,o,s.dimensionSegment,s.primaryOffsetAxis)),a.next(r).next((0,_t.VG)(o,["offset"]))}))]}(n,{computation:t,view:e});return this._computationHandles.add(i,t),n}_setupHeadingManipulator(t){const{view:e}=this,n=new Pt(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),i=function(t,e){let{computation:n,view:i}=e;return[(0,_t.Xt)(t,((t,e,a)=>{At({cancel:a,computation:n,settingHeading:!0,steps:e,view:i})}))]}(n,{computation:t,view:e});return this._computationHandles.add(i,t),n}_setupRotationManipulator(t){const{view:e}=this,n=new Pt(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),i=bt(n,{computation:t,view:e});return this._computationHandles.add(i,t),n}_setupMeasureTypeManipulator(t,e){const{view:n}=this,i=function(t,e){const n=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],i=(0,ht.Z8)(e.thinOffsetManipulatorMaterial,n),a=(0,ht.Z8)(e.unfocusedMaterial,n.map((t=>(0,M.j)((0,S.vt)(),t,.5)))),s=a.instantiate({material:e.focusedMaterial});return new ot.q({view:t,renderObjects:[new lt.M(a,yt.p7.Unfocused|Nt),new lt.M(s,yt.p7.Focused|Nt),new lt.M(i,Nt)],collisionType:{type:"line",paths:[n]},radius:Et(e.lineSizePt)/2,available:!1,metadata:e.metadata,...rt.MO})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),a=Dt(i,{computation:t,manipulatorMeasureType:e,view:n});return this._computationHandles.add(a,t),i}_updateManipulators(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:i,selectedComputation:a,firstGrabbedManipulator:s}=n,{start:o,end:r,offset:l,heading:c,rotation:u}=e,d=a===t,p=$(t),{dimension:m}=t;for(const h of e.values()){const t=p&&null==i&&(null==s||h===s);h===l?(h.available=t,h.selected=d):h.available=t&&d}if(!p)return;null!=this._computeConstraint(t)?e.forEachMeasureTypeManipulator((t=>t.available=!1)):e.manipulatorForMeasureType(m.measureType).available=!1;for(const v of[c,u])m.measureType===h.L.Direct&&0!==m.offset||(v.available=!1);N(t)?u.available=!1:c.available=!1;const{geometry:g}=t;o.renderLocation=g.directSegment.startRenderSpace,r.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:f}=this.view;(function(t,e,n){const{dimensionSegment:i,primaryOffsetAxis:a}=e,s=B(Vt,e),o=(0,M.e)(s,S.uY)?(0,_.D_)(jt):(0,rt.wQ)(s,a,S.uY,jt),r=Math.max((0,M.l)(s),.1/n.unitInMeters);(0,_.hs)(o,o,(0,M.s)(Vt,r,r,r)),t.modelTransform=o,t.renderLocation=i.eval(.5,Vt)})(l,g,f),c.available&&function(t,e,n){xt(t,e,n,{forHeading:!0})}(c,t,f),u.available&&function(t,e,n){xt(t,e,n,{forHeading:!1})}(u,t,f),e.forEachMeasureTypeManipulator(((e,n)=>{e.available&&function(t,e,n,i){const{geometry:a}=e,s=H(Bt,n,e,i),o=E(Vt,{measureType:n,directSegment:a.directSegment,renderCoordsHelper:i}),r=(0,M.z)(Gt,s.endRenderSpace,s.startRenderSpace),l=(0,rt.wQ)(r,o,S.uY,jt),c=(0,M.l)(r);(0,_.hs)(l,l,(0,M.s)(Gt,c,c,c)),t.modelTransform=l,t.renderLocation=s.eval(.5,Gt)}(e,t,n,f)}))}_updateManipulatorStyle(t){const e=function(t){return(0,J.Lz)(t)+4}(t),n=Et(t),i={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:a,heading:s,rotation:o}of this._computationManipulators.values())a.radius=n/2,s.update(i),o.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(t,e){const{view:n}=this,i=x(t);"startPoint"in e&&(i.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(i.elevationAlignedEndPoint=e.endPoint);const a=z(i,n.renderCoordsHelper);if(null==a)return;const s=this._computeConstraint({...i,geometry:a});Qt(t,e,{...i,constraint:s,unconstrainedGeometry:a,view:n}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t)}_updateStagedDimensionOffset(t){if(null==t.geometry)return;t.geometry.directSegment.eval(.5,pe);const e=this.view.state.camera.computeScreenPixelSizeAt(pe);t.dimension.offset=50*e}_computeConstraint(t){return function(t,e){if(q(t))return Ut.Direct;if(!t.enabled)return null;const{geometry:n}=t;if(null==n||(0,M.e)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=e.state,a=G(P.rq.get(),n,e.renderCoordsHelper),s=j(P.rq.get(),n),o=(0,M.j)(P.rq.get(),a,(0,M.m)(s,a)),r=(0,M.f)(P.rq.get(),s,o),l=(0,M.q)(r),c=(0,M.q)(o),{startRenderSpace:u,endRenderSpace:d}=n.directSegment,p=Math.max(10*i.computeScreenPixelSizeAt(u),10*i.computeScreenPixelSizeAt(d))**2;return l<p?Ut.Vertical:c<p?Ut.Horizontal:null}(function(t,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,geometry:t.geometry}}(t,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new vt.W({width:1,renderOccluded:mt.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){}};(0,a._)([(0,u.MZ)({constructOnly:!0})],de.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],de.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],de.prototype,"manipulators",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],de.prototype,"parentTool",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],de.prototype,"view",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],de.prototype,"updating",null),(0,a._)([(0,u.MZ)()],de.prototype,"firstGrabbedManipulator",null),(0,a._)([(0,u.MZ)()],de.prototype,"hasGrabbedManipulators",null),(0,a._)([(0,u.MZ)()],de.prototype,"snappingOptions",null),(0,a._)([(0,u.MZ)()],de.prototype,"_stagedDimension",void 0),(0,a._)([(0,u.MZ)()],de.prototype,"_activeComputation",null),(0,a._)([(0,u.MZ)()],de.prototype,"_stagedComputation",null),de=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],de);const pe=(0,S.vt)();var he,me=n(5109),ge=n(82307),fe=n(46576),ve=n(11500);!function(t){t.Ready="ready",t.Creating="creating",t.Created="created"}(he||(he={}));let _e=class extends me.k{constructor(t){super(t),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,fe.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new de({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.DQ)(this._lengthDimensionSubTool),(0,o.hA)((()=>this._clearPointerMoveTimeout())),(0,c.wB)((()=>this.state),(t=>{t===he.Created&&this.finishToolCreation()}),c.pc),(0,c.z7)((()=>this.firstGrabbedManipulator),(t=>{this.selectedDimension=t.metadata}),c.pc),(0,c.wB)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.pc)])}get state(){return this.analysis.dimensions.some((t=>"length"===t.type))?null!=this._activeSubTool?he.Creating:he.Created:he.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(t){this.analysisViewData.selectedDimension=t}onInputEvent(t){switch(t.type){case"immediate-click":this._clickHandler(t);break;case"immediate-double-click":this._doubleClickHandler(t);break;case"pointer-move":this._pointerMoveHandler(t);break;case"key-down":if(ge.NE.cancel===t.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void t.stopPropagation();this.active||(this.selectedDimension=null)}else ge.NE.delete.includes(t.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(t){if(this.hasFocusedManipulators)return void t.stopPropagation();if(null==this._activeSubTool)return;const e=this._intersectScreen(t);null!=e&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:t.pointerType}),t.stopPropagation())}_doubleClickHandler(t){this.active&&(this.view.activeTool=null,t.stopPropagation())}_pointerMoveHandler(t){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const e=this._intersectScreen(t);null!=e&&this._activeSubTool.onPointerMove({mapPoint:e,pointerType:t.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(t){const e=(0,ve.sC)(t);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const n=this._intersector.results.min,i=P.rq.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new Mt.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((t=>t.manipulator.state|=Nt)),this._prevPointerMoveTimeout=Y.p.setTimeout((()=>{this.manipulators.forEach((t=>t.manipulator.state&=~Nt))}),this._pointerMoveTimerMs)}get testInfo(){}};(0,a._)([(0,u.MZ)({constructOnly:!0})],_e.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],_e.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],_e.prototype,"state",null),(0,a._)([(0,u.MZ)({readOnly:!0})],_e.prototype,"updating",null),(0,a._)([(0,u.MZ)({readOnly:!0})],_e.prototype,"cursor",null),(0,a._)([(0,u.MZ)({constructOnly:!0})],_e.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)()],_e.prototype,"selectedDimension",null),(0,a._)([(0,u.MZ)()],_e.prototype,"automaticManipulatorSelection",void 0),(0,a._)([(0,u.MZ)()],_e.prototype,"_activeSubTool",void 0),(0,a._)([(0,u.MZ)()],_e.prototype,"_lengthDimensionSubTool",void 0),_e=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionTool")],_e);n(11265);var ye=n(11113),Me=n(66747),Se=n(28608),we=n(32314),Pe=n(70667),Ce=n(60561);class be extends we.X{constructor(t,e){super(t),this._hasExternalMaterial=!1,this._renderOccluded=mt.m$.OccludeAndTransparent,this._width=1,this._color=(0,Se.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=e,this._hasExternalMaterial=null!=e,this.applyProperties(t)}setGeometryFromSegment(t,e){const n=t.endRenderSpace;this.transform=(0,_.kN)(Ae,n),this._normal=e;const{points:i}=t.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(t){this._renderOccluded=t,null!=this._material&&this._material.setParameters({renderOccluded:t})}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get normal(){return this._normal}set normal(t){this._normal=t,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(t){this._width=t,null!=this._material&&this._material.setParameters({width:t})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(t){this._color=(0,Se.o8)(t),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(t){this._placement=t,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(t){this._markerPrimitive=t,null!=this._material&&this._material.setParameters({markerPrimitive:t})}createExternalResources(){this._hasExternalMaterial||(this._material=new Ce.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(t){for(const e of(0,Pe.z)(this.geometry,this.normal)){const n=(0,Pe.t)(this._material,e);t.addGeometry(n)}}forEachExternalMaterial(t){this._hasExternalMaterial||t(this._material)}}const Ae=(0,y.vt)();class De{set visible(t){for(const e of this._visualElements.values())e.attached=t}constructor(t){this.destroyed=!1,this._handles=new qt.A,this._messages=null,this._labelSegment=new A.C;const{analysis:e,computation:n,view:i,messages:a,isDecoration:s}=t;this.analysis=e,this.computation=n,this.view=i,this._messages=a;const o=t.visible,r={view:i,attached:o,isDecoration:s},{fontSize:l,textColor:u,textBackgroundColor:d}=e.style;this._visualElements=new ze({marker:new be(r,t.markerMaterial),dimension:new te.t(r,t.dimensionLineMaterial),startOffset:new te.t(r,t.offsetLineMaterial),endOffset:new te.t(r,t.offsetLineMaterial),dimensionSmall:new te.t(r,t.smallDimensionLineMaterial),startOffsetSmall:new te.t(r,t.smallOffsetLineMaterial),endOffsetSmall:new te.t(r,t.smallOffsetLineMaterial),label:new Me.N({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,J.Lz)(l),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:s})}),this._handles.add([(0,c.wB)((()=>n.geometry),(t=>{this.updateCameraDependentElements(i.state.camera,t,e.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...c.Vh,equals:$t.aI}),(0,c.wB)((()=>n.length),(t=>this._updateLabelContent(t)),c.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const t of this._visualElements.values())t.destroy()}get testInfo(){}_updateLines(t){const e=I(Te,i.Start,t.directSegment,t.dimensionSegment),n=I(Oe,i.End,t.directSegment,t.dimensionSegment),a=this._visualElements;a.marker.setGeometryFromSegment(t.dimensionSegment,t.primaryOffsetAxis),a.dimension.setGeometryFromSegment(t.dimensionSegment),a.startOffset.setGeometryFromSegment(e),a.endOffset.setGeometryFromSegment(n),a.dimensionSmall.setGeometryFromSegment(t.dimensionSegment),a.startOffsetSmall.setGeometryFromSegment(e),a.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(t,e,n){const i=this._visualElements;if(null==e){for(const t of i.values())t.visible=!1;return}const a=t.computeScreenPixelSizeAt(e.dimensionSegment.eval(.5,xe)),s=function(t,e){return(0,M.q)(B(W,t))/e**2}(e,a),o=s<(2*(0,J.Lz)(n.lineSize))**2,r=!o;i.marker.visible=r,i.dimension.visible=r,i.startOffset.visible=r,i.endOffset.visible=r,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,J.Lz)(n.fontSize),{label:c}=i;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=e,{offset:p}=this.computation.dimension,h=(Math.sign(p)>=0?1:-1)*function(t){return 1.5*(0,J.Lz)(t.fontSize)+20+(0,J.Lz)(t.lineSize/2)}(n)*a;(function(t,e,n,i){(0,M.r)(t.startRenderSpace,e.startRenderSpace,n,i),(0,M.r)(t.endRenderSpace,e.endRenderSpace,n,i)})(this._labelSegment,u,d,h),c.updateLabelPosition()}updateLabelStyle(t){const{label:e}=this._visualElements;e.fontSize=(0,J.Lz)(t.fontSize),e.textColor=t.textColor,e.backgroundColor=t.textBackgroundColor}updateUnitsMessages(t){this._messages=t;const{length:e}=this.computation;this._updateLabelContent(e)}_updateLabelContent(t){const{label:e}=this._visualElements;null!=t&&null!=this._messages?e.text=(0,ye.zJ)(this._messages,t,t.unit):e.text=""}}const Te=new A.C,Oe=new A.C,xe=(0,S.vt)();class ze{constructor(t){this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Ie=n(50125),He=n(38042),Le=n(63860);let Re=class extends s.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(t){super(t),this.loadingMessages=!1,this._messages=null}initialize(){const t=this.isDecoration;this._markerMaterial=new Ce.i({width:1,anchor:Ie.kJ.Tip,color:K.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:mt.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:t}),this._dimensionLineMaterial=new vt.W({width:1,color:K.uY,renderOccluded:mt.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:t}),this._offsetLineMaterial=new vt.W({width:1,color:K.uY,renderOccluded:mt.m$.OccludeAndTransparent,stipplePattern:(0,ne.wk)(5),isDecoration:t}),this._smallDimensionLineMaterial=new vt.W({width:1,color:K.uY,renderOccluded:mt.m$.OccludeAndTransparent,isDecoration:t}),this._smallOffsetLineMaterial=new vt.W({width:1,color:K.uY,renderOccluded:mt.m$.OccludeAndTransparent,stipplePattern:(0,ne.wk)(5),isDecoration:t});for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles((0,o.hA)((()=>{this.view._stage?.remove(n)})));const e=(0,c.LF)((()=>this.analysisViewData.computations),(t=>{let{computation:e}=t;return this._createVisualization(e)}));this._dimensionVisualizations=e,this.addHandles([(0,o.DQ)(e),(0,c.wB)((()=>X.A.toUnitRGBA(this.analysis.style.color)),(t=>{for(const e of this._lineMaterials())e.setParameters({color:t})}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(t=>{const e=(0,J.Lz)(t);this._markerMaterial.setParameters({width:.8*e}),this._dimensionLineMaterial.setParameters({width:e,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*e,1);this._offsetLineMaterial.setParameters({width:n})}),c.pc),(0,c.wB)((()=>({camera:this.view.state.camera,style:Ze(this.analysis)})),(t=>{let{camera:e,style:n}=t;for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(e,i.computation.geometry,n),i.updateLabelStyle(n)})),(0,c.wB)((()=>this.visible),(t=>{for(const{visualization:e}of this._dimensionVisualizations)e.visible=t}))]),this.addHandles([(0,He.oQ)((()=>this._updateMessageBundle())),(0,c.z7)((()=>!this.loadingMessages),(()=>{for(const{visualization:t}of this._dimensionVisualizations)t.updateUnitsMessages(this._messages)}),c.OH)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(t){const e=new De({analysis:this.analysis,computation:t,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:e,remove:()=>e.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Le.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Ze(t){const{fontSize:e,lineSize:n,textColor:i,textBackgroundColor:a}=t.style;return{fontSize:e,lineSize:n,textBackgroundColor:a.clone(),textColor:i.clone()}}(0,a._)([(0,u.MZ)({constructOnly:!0})],Re.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Re.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],Re.prototype,"isDecoration",void 0),(0,a._)([(0,u.MZ)()],Re.prototype,"analysis",null),(0,a._)([(0,u.MZ)()],Re.prototype,"visible",null),(0,a._)([(0,u.MZ)()],Re.prototype,"loadingMessages",void 0),Re=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Re);let Ee=class extends s.A{constructor(t){super(t),this.dimension=null,this.length=null}};(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Ee.prototype,"dimension",void 0),(0,a._)([(0,u.MZ)()],Ee.prototype,"length",void 0),Ee=(0,a._)([(0,d.$)("esri.views.analysis.LengthDimensionResult")],Ee);const ke=Ee;let Ne=class extends s.A{constructor(t){super(t),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(t){const{dimension:e,...n}=t;return{result:new ke({dimension:e}),...n}}initialize(){this.addHandles([(0,c.wB)((()=>this.dimension.startPoint),(t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t)),c.pc),(0,c.wB)((()=>this.dimension.endPoint),(t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t)),c.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Ne.prototype,"result",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Ne.prototype,"projectAndAlignPoint",void 0),(0,a._)([(0,u.MZ)()],Ne.prototype,"dimension",null),(0,a._)([(0,u.MZ)()],Ne.prototype,"length",null),(0,a._)([(0,u.MZ)()],Ne.prototype,"geometry",void 0),(0,a._)([(0,u.MZ)()],Ne.prototype,"unconstrainedGeometry",void 0),(0,a._)([(0,u.MZ)()],Ne.prototype,"elevationAlignedStartPoint",void 0),(0,a._)([(0,u.MZ)()],Ne.prototype,"elevationAlignedEndPoint",void 0),(0,a._)([(0,u.MZ)()],Ne.prototype,"preConstraintProperties",void 0),(0,a._)([(0,u.MZ)()],Ne.prototype,"previousConstraint",void 0),Ne=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Ne);var Ve=n(17430),Ge=n(10260),je=n(19276);const Be=t=>{let e=class extends t{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new je.A}createLengthDimensions(t){throw new Error("Method not implemented.")}};return(0,a._)([(0,u.MZ)({constructOnly:!0})],e.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],e.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)()],e.prototype,"tool",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],e.prototype,"results",null),(0,a._)([(0,u.MZ)()],e.prototype,"selectedDimension",void 0),(0,a._)([(0,u.MZ)()],e.prototype,"interactive",void 0),(0,a._)([(0,u.MZ)()],e.prototype,"visible",void 0),e=(0,a._)([(0,d.$)("esri.views.analysis.DimensionAnalysisView")],e),e};let Ue=class extends(Be((0,p.P)(s.A))){constructor(t){super(t),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=t=>{if(null==t)return null;const{spatialReference:e,elevationProvider:n}=this.view,i=(0,Ve.B)(t,e,n);return null==i&&(0,Ve.V)(this.analysis,t.spatialReference,r.A.getLogger(this)),i};const t=(0,c.LF)((()=>this.analysis.dimensions),(t=>this._createComputation(t)));this.computations=t,this.addHandles([(0,Ge.Hd)(this,_e),(0,o.DQ)(t)]),this._analysisVisualization=new Re({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new F({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.DC)(this._placementTask),this._analysisVisualization=(0,l.pR)(this._analysisVisualization),(0,Ge.aS)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((t=>this._dimensionsToComputations.get(t).result))}get selectedComputation(){const{selectedDimension:t}=this;return null==t?null:this._dimensionsToComputations.get(t)}get testInfo(){}async createLengthDimensions(t){return this.selectedDimension=null,this._placementTask=(0,l.DC)(this._placementTask),this._placementTask=(0,Ge.JY)(this,t),this._placementTask.promise}_createComputation(t){const{_dimensionsToComputations:e}=this,n=new Ne({dimension:t,projectAndAlignPoint:this._projectAndAlignPoint});return e.set(t,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(t){const{dimension:e}=t;e===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(e),t.destroy()}};(0,a._)([(0,u.MZ)({readOnly:!0})],Ue.prototype,"type",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"tool",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"updating",null),(0,a._)([(0,u.MZ)({readOnly:!0})],Ue.prototype,"results",null),(0,a._)([(0,u.MZ)()],Ue.prototype,"computations",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"selectedDimension",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"selectedComputation",null),(0,a._)([(0,u.MZ)()],Ue.prototype,"_analysisVisualization",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"_analysisController",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"_dimensionsToComputations",void 0),(0,a._)([(0,u.MZ)()],Ue.prototype,"_placementTask",void 0),Ue=(0,a._)([(0,d.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],Ue);const We=Ue},23241:(t,e,n)=>{n.d(e,{_:()=>s});var i=n(20664),a=n(64753);class s extends a.m{constructor(t,e,n){super(e,n),this.point=t}equals(t){return t instanceof s&&(0,i.e)(this.point,t.point)}}},23458:(t,e,n)=>{var i;n.d(e,{L:()=>i,h:()=>a}),function(t){t.Horizontal="horizontal",t.Vertical="vertical",t.Direct="direct"}(i||(i={}));const a=[i.Horizontal,i.Vertical,i.Direct]},29201:(t,e,n)=>{n.d(e,{I:()=>v,b:()=>f});var i=n(34981),a=n(26917),s=n(59395),o=n(81993),r=n(90235),l=n(80883),c=n(3799),u=n(21390),d=n(64839),p=n(32307),h=n(70367),m=n(10773),g=n(66470);function f(t){const e=new p.N5,{vertex:n,fragment:f}=e;return(0,c.NB)(n,t),e.include(s.d,t),e.attributes.add(g.r.POSITION,"vec3"),e.attributes.add(g.r.UV0,"vec2"),t.perspectiveInterpolation&&e.attributes.add(g.r.PERSPECTIVEDIVIDE,"float"),e.varyings.add("vpos","vec3"),t.multipassEnabled&&e.varyings.add("depth","float"),n.code.add(d.H`
    void main(void) {
      vpos = position;
      ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${t.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),e.include(a.HQ,t),e.include(o.Q,t),f.uniforms.add(new h.N("tex",(t=>t.texture)),new u.m("opacity",(t=>t.opacity))),e.varyings.add("vTexCoord","vec2"),t.transparencyPassType===m.y.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),f.include(l.a),f.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${t.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${d.H.float(r.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${t.transparencyPassType===m.y.ColorAlpha?d.H`
              fragColor = premultiplyAlpha(fragColor);
              fragAlpha = fragColor.a;`:""}
      ${t.output===i.V.ObjectAndLayerIdColor?d.H`
              fragColor = vec4(0,0,0,1);`:""}
    }
    `),e}const v=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},46576:(t,e,n)=>{n.d(e,{T:()=>s});var i=n(29808),a=n(3112);function s(t){const e=(0,i.hz)(t);return e.options.store=a.oH.MIN,e.options.hud=!1,e}},56002:(t,e,n)=>{function i(t){let e,n,i=[],a=!1;return function(){for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return a&&e===this&&function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(o,i)||(n=t.apply(this,o),e=this,i=o,a=!0),n}}n.d(e,{B:()=>i})},56567:(t,e,n)=>{n.d(e,{A:()=>m});var i=n(35143),a=(n(35238),n(23458)),s=n(69098),o=n(73582),r=n(42553),l=n(46053),c=n(21403),u=(n(47249),n(81806),n(85842)),d=n(40565),p=n(19247);let h=class extends((0,r.Te)(s.P)){constructor(t){super(t),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=a.L.Direct,this.offset=0,this.orientation=0}};(0,i._)([(0,l.MZ)({type:["length"],json:{write:{isRequired:!0}}})],h.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:p.A,json:{write:!0}})],h.prototype,"startPoint",void 0),(0,i._)([(0,l.MZ)({type:p.A,json:{write:!0}})],h.prototype,"endPoint",void 0),(0,i._)([(0,l.MZ)({type:a.h,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"measureType",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"offset",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.w)((t=>o.ie.normalize((0,d.GB)(t),0,!0)))],h.prototype,"orientation",void 0),h=(0,i._)([(0,u.$)("esri.analysis.LengthDimension")],h);const m=h},59962:(t,e,n)=>{n.d(e,{t:()=>u,k:()=>d});const i="theme-style";function a(t,e){return function(t,e){const n=new Image(e,e);return n.src=t,n}(function(t){const e=(new XMLSerializer).serializeToString(t);return`data:image/svg+xml;base64,${btoa(e)}`}(s(function(t){const e=t.split(",")[1],n=atob(e);return(new DOMParser).parseFromString(n,"image/svg+xml")}(t),e)),e.size)}function s(t,e){let{accentColor:n,contrastColor:a}=e;const s=n.toHex(),o=n.a,r=a.toHex(),l=a.a,c=t.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(i);return c&&(c.innerHTML=`\n      .contrast-fill { fill: ${r}; fill-opacity: ${l}; }\n      .contrast-stroke { stroke: ${r}; stroke-opacity: ${l};  }\n      .accent-fill { fill: ${s}; fill-opacity: ${o}; }\n      .accent-stroke { stroke: ${s}; stroke-opacity:  ${o}; }`),t}const o="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",r="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+";var l=n(96897);const c=64;function u(t,e){const{accentColor:n,contrastColor:i,preMultiplyAlpha:s}=e;return t.fromData(`heading-rotate:[accent:${n},contrast:${i},size:${c}]`,(()=>new l.g(a(o,{accentColor:n,contrastColor:i,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:s})))}function d(t,e){const{accentColor:n,contrastColor:i,preMultiplyAlpha:s}=e;return t.fromData(`tilt-rotate:[accent:${n},contrast:${i},size:${c}]`,(()=>new l.g(a(r,{accentColor:n,contrastColor:i,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:s})))}},61237:(t,e,n)=>{n.d(e,{L:()=>p});var i=n(30726),a=n(50346),s=n(68134),o=n(74e3),r=n(32535),l=n(12482),c=n(17046),u=n(13284),d=n(59752);function p(t){let{predicate:e=(()=>!0),snappingManager:n,snappingContext:r,updatingHandles:p,useZ:v=!0}=t;const _=new c.rh;if(null==n)return{snappingStep:[f,_],cancelSnapping:f};let y,M=null,S=null,w=null;const P=()=>{M=(0,i.DC)(M),n.doneSnapping(),S?.frameTask.remove(),S=null,y=(0,i.xt)(y),w=null},C=(b=n,A=v,D=_,(0,a.sg)((async(t,e)=>{let{frameTask:n,point:i,scenePoint:a,context:s,event:r,delta:l,getLastState:c}=t;const u=await n.schedule((()=>b.snap({point:i,scenePoint:a,context:s,signal:e})),e);if(u.valid){let t=await n.schedule((()=>u.apply()),e);const a=c();null!=a.point&&i!==a.point&&(t=b.update({point:a.point,scenePoint:a.scenePoint,context:s})),null!=a.updatePoint&&(0,o.CI)(t,a.updatePoint)||(g(r.mapEnd,t,l,A),D.execute(r))}})));var b,A,D;let T=null,O=null,x=null;return{snappingStep:[t=>{if(!e(t))return t;const{action:i}=t;if("start"===i){const{info:e}=t,i=function(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(d.W6.SNAPPING):d.nu}(n.view);if(S=function(t,e,n){return{context:new u.e({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:null!=e.info?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:null!=e.snapOrigin?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:null!=e.scenePoints?e.scenePoints.sceneStart:null,frameTask:n}}(r,t,i),S.context.selfSnappingZ=null,!v&&null!=e){const t=function(t,e){if(!t.hasZ())return null;const n=e.vertices;let i=null;for(const a of n){const e=t.getZ(a.pos);if(null!=i&&null!=e&&Math.abs(e-i)>1e-6)return null;null==i&&(i=e)}return i}(r.coordinateHelper,e.handle.component);null!=t&&(S.context.selfSnappingZ={value:t,elevationInfo:r.elevationInfo??l.qt})}}if(null!=S){const{context:e,originalScenePos:o,originalPos:r}=S,{mapEnd:l,mapStart:c,scenePoints:u}=t,d=h(r,m(l,c)),f=m(c,r),_={...t,action:"update"},P=S.context,b=function(t,e){return null==t||null==e?null:h(t,m(e.sceneEnd,e.sceneStart))}(o,u),A=n.update({point:d,scenePoint:b,context:e});if(x=A,g(l,A,f,v),T=d,O=b,"end"!==i){const{frameTask:t}=S;null==M&&(M=new AbortController),w=e=>{p.addPromise((0,a.QZ)(C({frameTask:t,event:_,context:P,point:d,scenePoint:b,delta:f,getLastState:()=>({point:T,scenePoint:O,updatePoint:e.forceUpdate?null:x})},M.signal)))},w({forceUpdate:!1}),null==y&&(y=(0,s.wB)((()=>n.options.effectiveEnabled),(()=>w?.({forceUpdate:!0}))))}}return"end"===i&&P(),t},_],cancelSnapping:t=>(P(),t)}}function h(t,e){let[n,i,a]=e;const s=(0,r.EL)(t);return s.x+=n,s.y+=i,s.hasZ&&(s.z+=a),s}function m(t,e){const n=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,n]}function g(t,e,n,i){let[a,s,o]=n;t.x=e.x+a,t.y=e.y+s,i&&t.hasZ&&e.hasZ&&(t.z=e.z+o)}function f(t){return t}},68655:(t,e,n)=>{n.d(e,{Do:()=>l,Kt:()=>r,ob:()=>o});var i=n(9392),a=n(29772),s=n(23739);function o(t){return(0,s.mh)(t)??(0,a.Xg)(t)}function r(t,e){return(0,s.Og)(t,e)??(0,a.ll)(t,e)}function l(t,e,n){return c[0]=t[0],c[1]=t[1],c[2]=3===t.length?t[2]:0,u[0]=e[0],u[1]=e[1],u[2]=3===e.length?e[2]:0,(0,s.n3)(c,u,n)??(0,a.sT)(c,u,n)}const c=(0,i.vt)(),u=(0,i.vt)()},77447:(t,e,n)=>{n.d(e,{r:()=>z});var i=n(88105),a=n(34981),s=n(83490),o=n(75803),r=n(45463),l=n(60322),c=n(77730),u=n(86994),d=n(66470),p=n(82809),h=n(86401),m=n(63928),g=n(52757),f=n(35143),v=(n(64839),n(16506)),_=n(42693),y=n(99415),M=n(28584),S=n(96643),w=n(10773),P=n(92656),C=n(29201),b=n(93345),A=n(57162);class D extends _.w{initializeProgram(t){return new M.B(t.rctx,D.shader.get().build(this.configuration),x)}_setPipelineState(t,e){const n=this.configuration,i=t===w.y.NONE,s=t===w.y.FrontFace;return(0,A.Ey)({blending:n.output===a.V.Color&&n.transparent?i?T:(0,l.ez)(t):null,culling:(0,A.Xt)(n.cullFace),depthTest:{func:(0,l.K_)(t)},depthWrite:i?n.writeDepth?A.kn:null:(0,l.XO)(t),drawBuffers:(0,l.cl)(t),colorWrite:A.wE,stencilWrite:n.hasOccludees?S.v0:null,stencilTest:n.hasOccludees?e?S.a9:S.qh:null,polygonOffset:i||s?null:(0,l.aB)(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}D.shader=new v.$(C.I,(()=>n.e(8391).then(n.bind(n,48391))));const T=(0,A.ox)(b.dn.ONE,b.dn.ONE_MINUS_SRC_ALPHA);class O extends P.E{constructor(){super(...arguments),this.output=a.V.Color,this.cullFace=s.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=w.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,f._)([(0,y.W)({count:a.V.COUNT})],O.prototype,"output",void 0),(0,f._)([(0,y.W)({count:s.s2.COUNT})],O.prototype,"cullFace",void 0),(0,f._)([(0,y.W)()],O.prototype,"hasSlicePlane",void 0),(0,f._)([(0,y.W)()],O.prototype,"transparent",void 0),(0,f._)([(0,y.W)()],O.prototype,"enableOffset",void 0),(0,f._)([(0,y.W)()],O.prototype,"writeDepth",void 0),(0,f._)([(0,y.W)()],O.prototype,"hasOccludees",void 0),(0,f._)([(0,y.W)({count:w.y.COUNT})],O.prototype,"transparencyPassType",void 0),(0,f._)([(0,y.W)()],O.prototype,"multipassEnabled",void 0),(0,f._)([(0,y.W)()],O.prototype,"cullAboveGround",void 0),(0,f._)([(0,y.W)()],O.prototype,"perspectiveInterpolation",void 0),(0,f._)([(0,y.W)({constValue:!1})],O.prototype,"occlusionPass",void 0);const x=new Map([[d.r.POSITION,0],[d.r.UV0,2],[d.r.PERSPECTIVEDIVIDE,3]]);class z extends m.W{constructor(t){super(t,new L),this.supportsEdges=!0,this.produces=new Map([[c.N.OPAQUE_MATERIAL,t=>(0,a.u5)(t)||(0,a._o)(t)&&!this.parameters.transparent],[c.N.TRANSPARENT_MATERIAL,t=>(0,a._o)(t)&&this.parameters.transparent&&this.parameters.writeDepth],[c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,t=>(0,a._o)(t)&&this.parameters.transparent&&!this.parameters.writeDepth],[c.N.DRAPED_MATERIAL,t=>(0,a._o)(t)||(0,a.u5)(t)]]),this._vertexAttributeLocations=x,this._configuration=new O}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<l.xt,this._configuration.multipassEnabled=e.multipassEnabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(t){return new I(t)}createBufferWriter(){const t=h.zK.clone();return this.parameters.perspectiveInterpolation&&t.f32(d.r.PERSPECTIVEDIVIDE),new H(t)}}class I extends o.m{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(D,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output===a.V.Color&&this._updateOccludeeState(t),this._updateParameters(t)}}class H extends p.Z{write(t,e,n,a,s){for(const o of this.vertexBufferLayout.fields.keys()){const r=n.attributes.get(o);if(r)if(o===d.r.PERSPECTIVEDIVIDE){(0,u.vA)(1===r.size);const t=a.getField(o,i.Y$);t&&(0,g.uO)(r,t,s)}else(0,g.zC)(o,r,t,e,a,s)}}}class L extends r.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},82887:(t,e,n)=>{n.d(e,{X:()=>h});var i=n(54901),a=n(77944),s=n(19276),o=n(68134),r=n(3589),l=n(63078),c=n(83973);var u=n(12843),d=n(43184);const p=new Map;function h(t){if(!p.has(t)){const e=function(t,e){const n=new c.A({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:e?.distance??l.N.distance,touchSensitivityMultiplier:e?.touchSensitivityMultiplier??l.N.touchSensitivityMultiplier});return{...(0,o.wB)((()=>t.map?.allLayers?.toArray()??[]),(t=>{n.featureSources=new s.A(t.map((t=>new r.A({layer:t}))))}),o.Vh),options:n}}(t,{distance:10}),n=function(t,e){return new d.g({view:t,options:e,snappingEnginesFactory:(e,n)=>[new u.f({view:t,spatialReference:t.spatialReference,options:n})]})}(t,e.options);p.set(t,{referenceCount:0,snappingManager:n,remove:()=>{e.remove(),n.destroy()}})}const e=p.get(t);e.referenceCount++;const n=(0,i.hA)((()=>function(t,e){e.referenceCount--,e.referenceCount>0||(0,a.d)((()=>{0===e.referenceCount&&(e.remove(),p.delete(t))}))}(t,e)));return{snappingManager:e.snappingManager,...n}}}}]);
//# sourceMappingURL=8992.ed4bfeec.chunk.js.map