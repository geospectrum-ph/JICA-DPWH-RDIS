"use strict";(self.webpackChunkRDIS_Web_Application=self.webpackChunkRDIS_Web_Application||[]).push([[5434],{14009:(e,t,i)=>{i.d(t,{e:()=>l,s:()=>a});var n=i(54994),s=i(36643),o=i(77725),r=i(68295);async function a(e,t,i){const n=await l(e,t,i);return o.A.fromJSON(n)}async function l(e,t,i){const o=(0,n.Dl)(e),a={...i},l=r.A.from(t),{data:d}=await(0,s.eW)(o,l,l.sourceSpatialReference,a);return d}},36643:(e,t,i)=>{i.d(t,{GB:()=>w,IJ:()=>f,Jf:()=>v,Pk:()=>m,eW:()=>p,gW:()=>_,kS:()=>g});var n=i(3825),s=i(90534),o=i(19902),r=i(1438),a=i(80963),l=i(78238),d=i(89122),c=i(57831);const u="Layer does not support extent calculation.";function h(e,t){const i=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const s=n;let r,l,d;if(null!=i&&(l=i.spatialReference,d=(0,a.YX)(l),s.geometryType=(0,o.$B)(i),s.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}(i,e.compactGeometryEnabled),s.inSR=d),n.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(s.objectIds=n.objectIds.join(",")),n.orderByFields&&(s.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:n.outFields.includes("*")?s.outFields="*":s.outFields=n.outFields.join(","),n.outSR?(s.outSR=(0,a.YX)(n.outSR),r=e.outSpatialReference):i&&(n.returnGeometry||n.returnCentroid)&&(s.outSR=s.inSR,r=l),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(s.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(s.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(s.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(s.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(s.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(s.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:i}=e;null==t&&null==i||(s.time=t===i?t:`${t??"null"},${i??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=r&&l.equals(r)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function p(e,t,i,n){const s=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await w(e,t,"json",n);return(0,c.q)(t,i,s.data),s}async function f(e,t,i,n){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await g(e,t,n),o=s;return o.data=(0,d.m)(s.data,i),o}function g(e,t,i){return w(e,t,"pbf",i)}function m(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):w(e,t,"json",i,{returnIdsOnly:!0})}function _(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):w(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}async function v(e,t,i){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const n=await w(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}),s=n.data;if(s.hasOwnProperty("extent"))return n;if(s.features)throw new Error(u);if(s.hasOwnProperty("count"))throw new Error(u);return n}async function w(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const d="string"==typeof e?(0,s.An)(e):e,c=t.geometry?[t.geometry]:[],u=await(0,r.el)(c,null,{signal:o.signal}),p=u?.[0];null!=p&&((t=t.clone()).geometry=p);const f=(0,l.z)({...d.query,f:i,...a,...h(t,a)});return(0,n.A)((0,s.fj)(d.path,(g=a,null==t.formatOf3DObjects||g.returnCountOnly||g.returnExtentOnly||g.returnIdsOnly?"query":"query3d")),{...o,responseType:"pbf"===i?"array-buffer":"json",query:{...f,...o.query}});var g}},78238:(e,t,i)=>{function n(e){const t={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){t[i]=[];for(let e=0;e<s.length;e++)t[i][e]=n(s[e])}else"object"==typeof s?s.toJSON&&(t[i]=JSON.stringify(s)):t[i]=s}return t}i.d(t,{z:()=>n})},95434:(e,t,i)=>{i.r(t),i.d(t,{default:()=>hi});var n=i(35143),s=i(63241),o=i(76460),r=i(68134),a=i(46053),l=(i(81806),i(47249),i(85842)),d=i(16700),c=(i(11265),i(19276));function u(e,t,i,n){let s=null,o=1e3;"number"==typeof t?(o=t,n=i):(s=t??null,o=i);let r,a=0;const l=()=>{a=0,e.apply(n,r)},d=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s&&s.apply(n,t),r=t,o?a||(a=setTimeout(l,o)):l()};return d.remove=()=>{a&&(clearTimeout(a),a=0)},d.forceUpdate=()=>{a&&(clearTimeout(a),l())},d.hasPendingUpdates=()=>!!a,d}var h=i(86100),p=i(38623),f=i(21403),g=i(25329),m=i(81594),_=i(78583);let v=class extends _.A{constructor(e){super(e),this.description=null,this.title=null}};(0,n._)([(0,a.MZ)()],v.prototype,"description",void 0),(0,n._)([(0,a.MZ)()],v.prototype,"title",void 0),v=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],v);const w=v;var y=i(87540),M=i(76099),b=i(54761);const F="esri-feature-element-info",I={base:F,title:`${F}__title`,description:`${F}__description`};let A=class extends g.A{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,b.K)("div",{class:I.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?(0,b.K)(y.D,{class:I.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?(0,b.K)("div",{class:I.description,innerHTML:e,key:"description"}):null}};(0,n._)([(0,a.MZ)()],A.prototype,"description",void 0),(0,n._)([(0,a.MZ)()],A.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)()],A.prototype,"title",void 0),A=(0,n._)([(0,l.$)("esri.widgets.Feature.support.FeatureElementInfo")],A);const C=A,x="esri-feature-attachments";let E=class extends g.A{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new m.A,this.headingLevel=2,this.viewModel=new w}initialize(){this._featureElementInfo=new C,this.addHandles([(0,r.wB)((()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),r.Vh),(0,r.wB)((()=>this.viewModel),(e=>this.attachmentsWidget.viewModel=e),r.Vh)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){const{attachmentsWidget:e}=this;return(0,b.K)("div",{class:x},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};(0,n._)([(0,a.MZ)({readOnly:!0})],E.prototype,"attachmentsWidget",void 0),(0,n._)([(0,a.MZ)()],E.prototype,"description",null),(0,n._)([(0,a.MZ)()],E.prototype,"displayType",null),(0,n._)([(0,a.MZ)()],E.prototype,"graphic",null),(0,n._)([(0,a.MZ)()],E.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)()],E.prototype,"title",null),(0,n._)([(0,a.MZ)({type:w})],E.prototype,"viewModel",void 0),E=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureAttachments")],E);const T=E;var Z=i(39356),R=i(91967),k=i(9912);let P=class extends R.A{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,r.wB)((()=>this.creator),(e=>{this._destroyContent(),this._createContent(e)}),r.Vh))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&t&&((0,k.AB)({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const i=(0,k.AB)({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");const n=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",n))}};(0,n._)([(0,a.MZ)({readOnly:!0})],P.prototype,"created",void 0),(0,n._)([(0,a.MZ)()],P.prototype,"creator",void 0),(0,n._)([(0,a.MZ)()],P.prototype,"destroyer",void 0),(0,n._)([(0,a.MZ)({type:Z.A})],P.prototype,"graphic",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],P.prototype,"state",null),P=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],P);const L=P;var O=i(95752);const V="esri-feature-content",N={base:V,loaderContainer:`${V}__loader-container`,loader:`${V}__loader`};let $=class extends g.A{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{(0,k.kX)(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){const e=this.viewModel?.state;return(0,b.K)("div",{class:N.base},"loading"===e?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,b.K)("div",{class:N.loaderContainer,key:"loader"},(0,b.K)("div",{class:N.loader}))}_renderCreated(){const e=this.viewModel?.created;return e?e instanceof HTMLElement?(0,b.K)("div",{afterCreate:this._attachToNode,bind:e,key:e}):(0,O.p4)(e)?(0,b.K)("div",{key:e},!e.destroyed&&e.render()):(0,b.K)("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){e.appendChild(this)}};(0,n._)([(0,a.MZ)()],$.prototype,"creator",null),(0,n._)([(0,a.MZ)()],$.prototype,"graphic",null),(0,n._)([(0,a.MZ)({type:L})],$.prototype,"viewModel",void 0),$=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureContent")],$);const S=$;var B=i(81779),K=i(40585);let W=class extends R.A{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const n=t.clone();n.label=(0,k.bV)(n,e),i.push(n)})),i}};(0,n._)([(0,a.MZ)()],W.prototype,"attributes",void 0),(0,n._)([(0,a.MZ)({type:[B.A]})],W.prototype,"expressionInfos",void 0),(0,n._)([(0,a.MZ)()],W.prototype,"description",void 0),(0,n._)([(0,a.MZ)({type:[K.A]})],W.prototype,"fieldInfos",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],W.prototype,"formattedFieldInfos",null),(0,n._)([(0,a.MZ)()],W.prototype,"title",void 0),W=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],W);const D=W;var z=i(98108),H=i(88685);const j=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];var U=i(63582);const q="esri-feature-fields",G={base:q,fieldHeader:`${q}__field-header`,fieldData:`${q}__field-data`,fieldDataDate:`${q}__field-data--date`};let X=class extends g.A{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new D,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new C,this.addHandles((0,r.wB)((()=>[this.viewModel?.description,this.viewModel?.title]),(()=>this._setupFeatureElementInfo()),r.Vh))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return(0,b.K)("div",{class:G.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){const{attributes:i}=this.viewModel,n=e.fieldName||"",s=e.label||n,o=i?null==i[n]?"":i[n]:"",r=!!e.format?.dateFormat,a="number"!=typeof o||r?function(e,t){if("string"!=typeof t||!t)return t;const i=j.find((e=>e.pattern.test(t)));if(!i)return t;const n=t.match(i.pattern),s=n?.[2],o=(0,H.HC)((0,H.HC)(i.label,{messages:e,hierPart:s}),{appName:i.appName}),r=i.target?` target="${i.target}"`:"",a="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${r} href="$1"${a}>${o}</a>`)}(this.messagesURIUtils,o):this._forceLTR(o),l={[G.fieldDataDate]:r};return(0,b.K)("tr",{key:`fields-element-info-row-${n}-${t}`},(0,b.K)("th",{class:G.fieldHeader,innerHTML:s,key:`fields-element-info-row-header-${n}-${t}`}),(0,b.K)("td",{class:this.classes(G.fieldData,l),innerHTML:a,key:`fields-element-info-row-data-${n}-${t}`}))}_renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e?.length?(0,b.K)("table",{class:z.D.table,summary:this.messages.fieldsSummary},(0,b.K)("tbody",null,e.map(((e,t)=>this._renderFieldInfo(e,t))))):null}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};(0,n._)([(0,a.MZ)()],X.prototype,"attributes",null),(0,n._)([(0,a.MZ)()],X.prototype,"description",null),(0,n._)([(0,a.MZ)()],X.prototype,"expressionInfos",null),(0,n._)([(0,a.MZ)()],X.prototype,"fieldInfos",null),(0,n._)([(0,a.MZ)()],X.prototype,"title",null),(0,n._)([(0,a.MZ)({type:D,nonNullable:!0})],X.prototype,"viewModel",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Feature/t9n/Feature")],X.prototype,"messages",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/support/t9n/uriUtils")],X.prototype,"messagesURIUtils",void 0),X=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureFields")],X);const J=X;var Y=i(17555),Q=i(23994),ee=i(18690),te=i(22431),ie=i(3825),ne=i(50076),se=i(50346),oe=i(53430),re=(i(89551),i(14009)),ae=(i(86560),i(55171),i(90534),i(31633),i(34111),i(80963),i(42294),i(15941),i(76797),i(89189),i(66388),i(19247)),le=(i(65215),i(23701),i(73548),i(13312),i(14556),i(35238),i(29234),i(77725),i(68295)),de=(i(88084),i(9708),i(58289)),ce=(i(58672),i(21820));const ue=()=>o.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),he=new Map;function pe(e){if(!(0,k.s$)(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function fe(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:n}=t;return n.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}async function ge(e,t,i,n){const s=i.layerId.toString(),{layerInfo:o,relation:r,relatedFields:a,outStatistics:l,url:d,sourceSpatialReference:c}=t,u=function(e){return e?(0,ee.Am)(e):void 0}(a),h=function(e){return e?(0,ee.Am)(e,((e,t)=>JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON()))):void 0}(l);if(!o||!r)return null;const p=function(e){let{originRelationship:t,relationships:i,layerId:n}=e;return i.find((e=>{let{relatedTableId:i,id:s}=e;return`${i}`===n&&s===t?.id}))??null}({originRelationship:r,relationships:o.relationships,layerId:s});if(p?.relationshipTableId&&p.keyFieldInRelationshipTable){const t=(await function(e,t,i,n){const s=new de.default;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],s.gdbVersion=i.gdbVersion??null,s.historicMoment=i.historicMoment??null,i.queryRelatedFeatures?.(s,n)??Promise.resolve({})}(e,p,i,n))[e.attributes[i.objectIdField]];if(!t)return null;const s=t.features.map((e=>e.attributes[o.objectIdField]));if(h?.length&&o.supportsStatistics){const e=new le.A;e.where=function(e,t,i){let n=0;const s=[];for(;n<t.length;)s.push(`${e} IN (${t.slice(n,i+n)})`),n+=i;return s.join(" OR ")}(o.objectIdField,s,1e3),e.outFields=u,e.outStatistics=h,e.sourceSpatialReference=c;const i={features:Promise.resolve(t),statsFeatures:(0,re.s)(d,e)};return(0,se.Lx)(i)}}const f=p?.keyField;if(f){const t=(0,oe.WA)(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(o.fields,f)),s=function(e,t){const i=t.toLowerCase();for(const n in e)if(n.toLowerCase()===i)return e[n];return null}(e.attributes,r.keyField),a=t?`${f}=${s}`:`${f}='${s}'`,l=i.historicMoment,p=i.gdbVersion,g=(0,re.s)(d,new le.A({where:a,outFields:u,sourceSpatialReference:c,historicMoment:l,gdbVersion:p}),n),m=h?.length&&o.supportsStatistics?(0,re.s)(d,new le.A({where:a,outFields:u,outStatistics:h,sourceSpatialReference:c}),n):null,_={features:g};return m&&(_.statsFeatures=m),(0,se.Lx)(_)}return null}function me(e,t){let{relatedInfos:i,layer:n}=e;const s={};return i.forEach(((e,t)=>{const{relation:i}=e;if(!i){const e=new ne.A("relation-required","A relation is required on a layer to retrieve related records.");throw ue().error(e),e}const{relatedTableId:o}=i;if("number"!=typeof o){const e=new ne.A("A related table ID is required on a layer to retrieve related records.");throw ue().error(e),e}const r=`${n.url}/${o}`,a=he.get(r),l=a??function(e,t){return(0,ie.A)(e,{query:{f:"json"},signal:t?.signal})}(r);a||he.set(r,l),s[t]=l})),(0,se.qr)((0,se.Lx)(s),t)}const _e={chartAnimation:!0};let ve=class extends R.A{constructor(e){super(e),this.abilities={..._e},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{..._e,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{mediaInfos:e,layer:t}=this,i=this.attributes??{},n=this.formattedAttributes??{},s=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return e?.map((e=>{const r=e?.clone();if(!r)return null;if(r.title=(0,k.u2)({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:t,text:r.title}),r.caption=(0,k.u2)({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:t,text:r.caption}),r.altText=(0,k.u2)({attributes:i,fieldInfoMap:o,globalAttributes:n,expressionAttributes:s,layer:t,text:r.altText}),"image"===r.type){if(!r.value)return;return this._setImageValue({value:r.value,formattedAttributes:n,layer:t}),r.value.sourceURL?r:void 0}if("pie-chart"===r.type||"line-chart"===r.type||"column-chart"===r.type||"bar-chart"===r.type){if(!r.value)return;return this._setChartValue({value:r.value,chartType:r.type,attributes:i,formattedAttributes:n,layer:t,expressionAttributes:s}),r}return null})).filter(ee.Ru)??[]}_setImageValue(e){const t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:n,layer:s}=e,{linkURL:o,sourceURL:r}=i;if(r){const e=(0,k.MK)(r,s);i.sourceURL=(0,k.gd)({formattedAttributes:n,template:e,fieldInfoMap:t})}if(o){const e=(0,k.MK)(o,s);i.linkURL=(0,k.gd)({formattedAttributes:n,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:n,chartType:s,layer:o,expressionAttributes:r}=e,{popupTemplate:a,relatedInfos:l}=this,{fields:d,normalizeField:c}=t,u=o;if(t.fields=(0,k.xL)(d,u),c&&(t.normalizeField=(0,k.A4)(c,u)),!d.some((e=>!!(null!=n[e]||(0,k.s$)(e)&&l?.size))))return;const h=a?.fieldInfos??[];d.forEach(((e,o)=>{const a=t.colors?.[o];if((0,k.s$)(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:e,formattedAttributes:n,chartType:s,value:t,color:a})]);const l=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:n,expressionAttributes:r,fieldName:e,fieldInfos:h,color:a});t.series.push(l)}))}_getRelatedChartInfos(e){const{fieldInfos:t,fieldName:i,formattedAttributes:n,chartType:s,value:o,color:r}=e,a=[],l=pe(i),d=l&&this.relatedInfos?.get(l.layerId.toString());if(!d)return a;const{relatedFeatures:c,relation:u}=d;if(!u||!c)return a;const{cardinality:h}=u;return c.forEach((e=>{const{attributes:d}=e;d&&Object.keys(d).forEach((e=>{e===l.fieldName&&a.push(this._getChartOption({value:o,attributes:d,formattedAttributes:n,fieldName:i,chartType:s,relatedFieldName:e,hasMultipleRelatedFeatures:c?.length>1,fieldInfos:t,color:r}))}))})),"one-to-many"===h||"many-to-many"===h?a:[a[0]]}_getTooltip(e){let{label:t,value:i,chartType:n}=e;return"pie-chart"===n?`${t}`:`${t}: ${i}`}_getChartOption(e){const{value:t,attributes:i,formattedAttributes:n,expressionAttributes:s,fieldName:o,relatedFieldName:r,fieldInfos:a,chartType:l,hasMultipleRelatedFeatures:d,color:c}=e,u=this.layer,h=this.fieldInfoMap??new Map,{normalizeField:p,tooltipField:f}=t,g=p?(0,k.s$)(p)?i[pe(p).fieldName]:i[p]:null,m=(0,k.Tt)(o)&&s&&void 0!==s[o]?s[o]:r&&void 0!==i[r]?i[r]:void 0!==i[o]?i[o]:n[o],_=new te.A({fieldName:o,color:c,value:void 0===m?null:m&&g?m/g:m});if((0,k.s$)(o)){const e=h.get(o.toLowerCase()),t=f&&h.get(f.toLowerCase()),s=e?.fieldName??o,a=d&&f?pe(f).fieldName:t?.fieldName??f,c=d&&a?i[a]:n[a]??e?.label??e?.fieldName??r,u=d&&r?i[r]:n[s];return _.tooltip=this._getTooltip({label:c,value:u,chartType:l}),_}const v=(0,k.lm)(a,o),w=(0,k.A4)(o,u),y=f&&void 0!==n[f]?n[f]:(0,k.bV)(v||new K.A({fieldName:w}),this.popupTemplate?.expressionInfos),M=n[w];return _.tooltip=this._getTooltip({label:y,value:M,chartType:l}),_}};(0,n._)([(0,a.MZ)()],ve.prototype,"abilities",void 0),(0,n._)([(0,f.w)("abilities")],ve.prototype,"castAbilities",null),(0,n._)([(0,a.MZ)()],ve.prototype,"activeMediaInfoIndex",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],ve.prototype,"activeMediaInfo",null),(0,n._)([(0,a.MZ)()],ve.prototype,"attributes",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"description",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"fieldInfoMap",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"formattedAttributes",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"expressionAttributes",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],ve.prototype,"formattedMediaInfos",null),(0,n._)([(0,a.MZ)()],ve.prototype,"isAggregate",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"layer",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],ve.prototype,"formattedMediaInfoCount",null),(0,n._)([(0,a.MZ)()],ve.prototype,"mediaInfos",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"popupTemplate",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"relatedInfos",void 0),(0,n._)([(0,a.MZ)()],ve.prototype,"title",void 0),ve=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ve);const we=ve;var ye=i(77666),Me=i(91896),be=i(39348);const Fe="esri-feature-media",Ie={base:Fe,mediaContainer:`${Fe}__container`,mediaItemContainer:`${Fe}__item-container`,mediaItem:`${Fe}__item`,mediaItemText:`${Fe}__item-text`,mediaItemTitle:`${Fe}__item-title`,mediaItemCaption:`${Fe}__item-caption`,mediaNavigation:`${Fe}__item-navigation`,mediaPagination:`${Fe}__pagination`,mediaPaginationText:`${Fe}__pagination-text`,mediaPrevious:`${Fe}__previous`,mediaPreviousIconLTR:`${Fe}__previous-icon`,mediaPreviousIconRTL:`${Fe}__previous-icon--rtl`,mediaNext:`${Fe}__next`,mediaNextIconLTR:`${Fe}__next-icon`,mediaNextIconRTL:`${Fe}__next-icon--rtl`,mediaChart:`${Fe}__chart`,mediaPaginationButton:`${Fe}__pagination-button`,mediaPaginationIcon:`${Fe}__pagination-icon`,mediaChartRendered:`${Fe}__chart--rendered`},Ae="category",Ce="value";let xe=class extends g.A{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new we,this.messages=null,this._disposeChart=e=>{this._chartRootMap.get(e)?.dispose(),this._chartRootMap.delete(e)},this._createChart=async e=>{const{destroyed:t,viewModel:n}=this;if(t||!n||!e)return;const{createRoot:s}=await Promise.all([i.e(3318),i.e(6083)]).then(i.bind(i,56083)),o=await s(e);this._chartRootMap.set(e,o),this._renderChart({mediaInfo:n.activeMediaInfo,root:o})}}initialize(){this._featureElementInfo=new C,this.addHandles([(0,r.wB)((()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex]),(()=>this._setupMediaRefreshTimer()),r.Vh),(0,r.wB)((()=>[this.viewModel?.description,this.viewModel?.title]),(()=>this._setupFeatureElementInfo()),r.Vh)])}loadDependencies(){return(0,ye.W)({icon:()=>Promise.all([i.e(9879),i.e(5012)]).then(i.bind(i,95012))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return(0,b.K)("div",{bind:this,class:Ie.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?(0,b.K)("div",{class:Ie.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,b.K)("div",{class:Ie.mediaNavigation},i,e>1?(0,b.K)("div",{class:Ie.mediaPagination},this._renderMediaPageButton("previous"),(0,b.K)("span",{class:Ie.mediaPaginationText},(0,be.V)(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e&&e.title?(0,b.K)("div",{class:Ie.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?(0,b.K)("div",{class:Ie.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?(0,b.K)("div",{class:Ie.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:o,altText:r,title:a,type:l}=e,{sourceURL:d,linkURL:c}=s,u=(0,k.kX)(c??void 0)?"_blank":"_self",h="_blank"===u?"noreferrer":"",p=o?t:null,f=p?p.timestamp:0,g=p?p.sourceURL:d,m=(0,b.K)("img",{alt:r||a,key:`media-${l}-${i}-${n}-${f}`,src:g??void 0});return(c?(0,b.K)("a",{href:c,rel:h,target:u,title:a},m):null)??m}_renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return(0,b.K)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Ie.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?(0,b.K)("div",{class:Ie.mediaItemContainer,key:"media-container"},(0,b.K)("div",{class:Ie.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,n=t?"chevron-left":"chevron-right",s=t?"media-previous":"media-next",o=t?this._previous:this._next;return(0,b.K)("button",{"aria-label":i,bind:this,class:Ie.mediaPaginationButton,key:s,onclick:o,tabIndex:0,title:i,type:"button"},(0,b.K)("calcite-icon",{class:Ie.mediaPaginationIcon,icon:n,scale:"s"}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}async _getSeriesColors(e){const{colorAm5:t}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),n=new Map;return e.forEach((e=>{e.color&&n.set(e,t(e.color.toCss(!0)))})),n}async _getRendererColors(){const{colorAm5:e}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),t=new Map,n=this._getRenderer();if(!n)return t;const s=await(0,Q.iA)(n);return s.delete("default"),Array.from(s.values()).every((e=>1===e?.length))?(Array.from(s.keys()).forEach((i=>{const n=s.get(i)?.[0]?.toCss(!0);n&&t.set(i,e(n))})),t):t}_handleMediaKeyup(e){const{key:t}=e;"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!(0,Y.O)()}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}async _renderChart(e){const{root:t,mediaInfo:n}=e,{value:s,type:o}=n,{ResponsiveThemeAm5:r,DarkThemeAm5:a,AnimatedThemeAm5:l,ColorSetAm5:d,ThemeAm5:c,esriChartColorSet:u}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),h=c.new(t);h.rule("ColorSet").set("colors",u),h.rule("ColorSet").set("reuse",!0);const p=[r.new(t),h];(0,Me.g4)()&&p.push(a.new(t)),this._canAnimateChart()&&p.push(l.new(t)),t.setThemes(p);const f=await this._getRendererColors(),g=await this._getSeriesColors(s.series),m=d.new(t,{}),_=g.get(s.series[0]),v=_?{lineSettings:{stroke:_}}:void 0,w=s.series.map(((e,t)=>{const i=g.get(e)||f.get(e.fieldName)||m.getIndex(t);return{[Ae]:e.tooltip,[Ce]:e.value,columnSettings:{fill:i,stroke:i},...v}})).filter((e=>"pie-chart"!==o||null!=e.value&&e.value>0));"pie-chart"===o?this._createPieChart(e,w):this._createXYChart(e,w)}_getDirection(){return(0,M.V8)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,M.V8)(this.container)}async _customizeChartTooltip(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal";const{colorAm5:n}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855));e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:n("rgba(50, 50, 50, 1)")}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200})}async _createPieChart(e,t){const{TooltipAm5:n}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{PieChartAm5:s,PieSeriesAm5:o}=await Promise.all([i.e(3318),i.e(2225),i.e(2818)]).then(i.bind(i,82818)),{mediaInfo:r,root:a}=e,{title:l}=r,d=r?.altText||r?.title||"",c=a.container.children.push(s.new(a,{ariaLabel:d,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),u="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",h=n.new(a,{labelText:u}),p=c.series.push(o.new(a,{name:l,valueField:Ce,categoryField:Ae,tooltip:h}));p.ticks.template.set("forceHidden",!0),p.labels.template.set("forceHidden",!0),p.slices.template.states.create("active",{shiftRadius:5}),this._customizeChartTooltip(h),p.slices.template.setAll({ariaLabel:u,focusable:!0,templateField:"columnSettings"}),p.data.setAll(t),p.appear(this._getChartSeriesAnimationMS()),c.appear(this._getChartAnimationMS()),c.root.dom.classList.toggle(Ie.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}async _createColumnChart(e,t,n){const{TooltipAm5:s,ScrollbarAm5:o}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{CategoryAxisAm5:r,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:d,ColumnSeriesAm5:c}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{mediaInfo:u,root:h}=t,{value:p,title:f}=u;e.setAll({wheelX:"panX",wheelY:"zoomX"});const g=e.xAxes.push(r.new(h,{renderer:a.new(h,{inversed:this._isInversed()}),categoryField:Ae}));g.get("renderer").labels.template.setAll({forceHidden:!0});const m=e.yAxes.push(l.new(h,{renderer:d.new(h,{inside:!1}),min:this._getMinSeriesValue(p.series)}));m.get("renderer").labels.template.setAll({direction:this._getDirection()});const _="{categoryX}",v=s.new(h,{labelText:_}),w=e.series.push(c.new(h,{name:f,xAxis:g,yAxis:m,valueYField:Ce,categoryXField:Ae,tooltip:v}));this._customizeChartTooltip(v),w.columns.template.setAll({ariaLabel:_,focusable:!0,templateField:"columnSettings"}),p.series.length>15&&e.set("scrollbarX",o.new(h,{orientation:"horizontal"})),g.data.setAll(n),w.data.setAll(n),w.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,n){const{TooltipAm5:s,ScrollbarAm5:o}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{CategoryAxisAm5:r,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:d,ColumnSeriesAm5:c}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{mediaInfo:u,root:h}=t,{value:p,title:f}=u;e.setAll({wheelX:"panY",wheelY:"zoomY"});const g=e.yAxes.push(r.new(h,{renderer:d.new(h,{inversed:!0}),categoryField:Ae}));g.get("renderer").labels.template.setAll({forceHidden:!0});const m=e.xAxes.push(l.new(h,{renderer:a.new(h,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(p.series)}));m.get("renderer").labels.template.setAll({direction:this._getDirection()});const _="{categoryY}",v=s.new(h,{labelText:_}),w=e.series.push(c.new(h,{name:f,xAxis:m,yAxis:g,valueXField:Ce,categoryYField:Ae,tooltip:v}));this._customizeChartTooltip(v,"vertical"),w.columns.template.setAll({ariaLabel:_,focusable:!0,templateField:"columnSettings"}),p.series.length>15&&e.set("scrollbarY",o.new(h,{orientation:"vertical"})),g.data.setAll(n),w.data.setAll(n),w.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,n){const{TooltipAm5:s,ScrollbarAm5:o}=await Promise.all([i.e(3318),i.e(7855)]).then(i.bind(i,17855)),{CategoryAxisAm5:r,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:d,LineSeriesAm5:c}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{root:u,mediaInfo:h}=t,{value:p,title:f}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});const g=e.xAxes.push(r.new(u,{renderer:a.new(u,{inversed:this._isInversed()}),categoryField:Ae}));g.get("renderer").labels.template.setAll({forceHidden:!0});const m=e.yAxes.push(l.new(u,{renderer:d.new(u,{inside:!1}),min:this._getMinSeriesValue(p.series)}));m.get("renderer").labels.template.setAll({direction:this._getDirection()});const _=n[0]?.lineSettings?.stroke,v=s.new(u,{getFillFromSprite:!_,labelText:"{categoryX}"});_&&v.get("background")?.setAll({fill:_});const w=e.series.push(c.new(u,{name:f,xAxis:g,yAxis:m,valueYField:Ce,categoryXField:Ae,tooltip:v}));w.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(v,"vertical"),p.series.length>15&&e.set("scrollbarX",o.new(u,{orientation:"horizontal"})),g.data.setAll(n),w.data.setAll(n),w.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){const{XYChartAm5:n,XYCursorAm5:s}=await Promise.all([i.e(3318),i.e(2225),i.e(8108)]).then(i.bind(i,48108)),{root:o,mediaInfo:r}=e,{type:a}=r,l=r?.altText||r?.title||"",d=o.container.children.push(n.new(o,{ariaLabel:l,focusable:!0,panX:!0,panY:!0}));d.set("cursor",s.new(o,{})),"column-chart"===a&&await this._createColumnChart(d,e,t),"bar-chart"===a&&await this._createBarChart(d,e,t),"line-chart"===a&&await this._createLineChart(d,e,t),d.root.dom.classList.toggle(Ie.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;"image"===e?.type&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e,n=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),n);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[n,s=""]=e.split("#");return`${n}${i}timestamp=${t}${s?"#":""}${s}`}};(0,n._)([(0,a.MZ)()],xe.prototype,"_refreshIntervalInfo",void 0),(0,n._)([(0,a.MZ)()],xe.prototype,"attributes",null),(0,n._)([(0,a.MZ)()],xe.prototype,"activeMediaInfoIndex",null),(0,n._)([(0,a.MZ)()],xe.prototype,"description",null),(0,n._)([(0,a.MZ)()],xe.prototype,"fieldInfoMap",null),(0,n._)([(0,a.MZ)()],xe.prototype,"layer",null),(0,n._)([(0,a.MZ)()],xe.prototype,"mediaInfos",null),(0,n._)([(0,a.MZ)()],xe.prototype,"popupTemplate",null),(0,n._)([(0,a.MZ)()],xe.prototype,"relatedInfos",null),(0,n._)([(0,a.MZ)()],xe.prototype,"title",null),(0,n._)([(0,a.MZ)({type:we})],xe.prototype,"viewModel",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Feature/t9n/Feature")],xe.prototype,"messages",void 0),xe=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureMedia")],xe);const Ee=xe;i(75900),i(56362),i(87015),i(81940);var Te=i(6929),Ze=i(7198),Re=(i(93616),i(53539)),ke=i(66267),Pe=i(38451);const Le=()=>o.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Oe(e){return"string"==typeof e?(0,k.Uu)((0,k.bG)(e)):Array.isArray(e)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?(0,k.Uu)((0,k.bG)(e)):e}</li>`)).join("")}</ul>`}(e):"esri.arcade.Dictionary"===e?.declaredClass?function(e){const t=e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?(0,k.Uu)((0,k.bG)(i)):i}</td></tr>`})).join("");return`<table class="${z.D.table}">${t}</table>`}(e):e}function Ve(){return Promise.resolve().then(i.bind(i,30550))}async function Ne(e){let{graphic:t,view:i,options:n}=e;const{isAggregate:s,layer:o}=t;if(!s||!o||"2d"!==i?.type)return[];const r=await i.whenLayerView(o);if(!function(e){return"createQuery"in e&&"queryFeatures"in e}(r))return[];const a=r.createQuery(),l=t.getObjectId();a.aggregateIds=null!=l?[l]:[];const{features:d}=await r.queryFeatures(a,n);return d}async function $e(e){let{expressionInfo:t,arcade:i,interceptor:n,spatialReference:s,map:o,graphic:r,location:a,view:l,options:d}=e;if(!t?.expression)return null;const{isAggregate:c}=r,u=(r.sourceLayer||r.layer)??void 0,h=c?"feature-reduction-popup":"popup",p=i.createArcadeProfile(h),f=i.createArcadeExecutor(t.expression,p).catch((e=>Le().error("arcade-executor-error",{error:e,expressionInfo:t}))),[g,m]=await Promise.all([Ne({graphic:r,view:l,options:d}),f]);if(!m)return null;const _="feature-reduction-popup"===h?function(e){let{layer:t,aggregatedFeatures:i,interceptor:n}=e;const{fields:s,objectIdField:o,geometryType:r,spatialReference:a,displayField:l}=t;return new Pe.default({fields:s,objectIdField:o,geometryType:r,spatialReference:a,displayField:l,interceptor:n,..."feature"===t.type?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:i})}({layer:u,aggregatedFeatures:g,interceptor:n}):void 0,v={..."feature-reduction-popup"===h?{$aggregatedFeatures:_}:{$datastore:u?.url,$layer:"feature"===u?.type||"subtype-sublayer"===u?.type||"catalog-footprint"===u?.type||"oriented-imagery"===u?.type?u:"scene"===u?.type&&null!=u.associatedLayer?u.associatedLayer:void 0,$map:o,$userInput:a,$graph:"knowledge-graph-sublayer"===u?.type?u?.parentCompositeLayer?.knowledgeGraph:void 0},$feature:r},w={abortSignal:d?.signal??void 0,interceptor:n??void 0,rawOutput:!0,spatialReference:s??void 0,timeZone:l?.timeZone};return await m.executeAsync(v,w).catch((e=>Le().error("arcade-execution-error",{error:e,graphic:r,expressionInfo:t}))).finally((()=>_?.destroy()))}async function Se(e){let{expressionInfos:t,spatialReference:i,graphic:n,interceptor:s,map:o,view:r,location:a,options:l}=e;if(!t?.length)return{};const d=await Ve(),c={};for(const p of t)c[`expression/${p.name}`]=$e({expressionInfo:p,arcade:d,interceptor:s,spatialReference:i,map:o,graphic:n,location:a,view:r,options:l});const u=await(0,se.Lx)(c),h={};for(const p in u)h[p]=Oe(u[p].value);return h}let Be=class extends R.A{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:e}=this;e&&e.abort(),this._abortController=null},this._createVM=()=>{const e=this.contentElement?.type;this.contentElementViewModel?.destroy();const t="fields"===e?new D:"media"===e?new we:"text"===e?new L:null;this._set("contentElementViewModel",t)},this._compile=async()=>{this._cancelQuery();const e=new AbortController;this._abortController=e,await this._compileExpression(),this._abortController===e&&(this._abortController=null)},this._compileThrottled=u(this._compile,1,this),this._compileExpression=async()=>{const{expressionInfo:e,graphic:t,interceptor:i,spatialReference:n,map:s,location:o,view:r,_abortController:a}=this;if(!e||!t)return void this._set("contentElement",null);const l=await Ve();if(a!==this._abortController)return;const d=await $e({arcade:l,expressionInfo:e,graphic:t,location:o,interceptor:i,map:s,spatialReference:n,view:r});if(!d||"esri.arcade.Dictionary"!==d.declaredClass)return void this._set("contentElement",null);const c=await d.castAsJsonAsync(a?.signal),u=c?.type,h="media"===u?Ze.A.fromJSON(c):"text"===u?Re.A.fromJSON(c):"fields"===u?Te.A.fromJSON(c):null;this._set("contentElement",h)},this.addHandles([(0,r.wB)((()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view]),(()=>this._compileThrottled()),r.Vh),(0,r.wB)((()=>[this.contentElement]),(()=>this._createVM()),r.Vh)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}};(0,n._)([(0,a.MZ)()],Be.prototype,"_abortController",void 0),(0,n._)([(0,a.MZ)({type:ke.A})],Be.prototype,"expressionInfo",void 0),(0,n._)([(0,a.MZ)({type:Z.A})],Be.prototype,"graphic",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],Be.prototype,"contentElement",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],Be.prototype,"contentElementViewModel",void 0),(0,n._)([(0,a.MZ)()],Be.prototype,"interceptor",void 0),(0,n._)([(0,a.MZ)({type:ae.A})],Be.prototype,"location",void 0),(0,n._)([(0,a.MZ)()],Be.prototype,"spatialReference",null),(0,n._)([(0,a.MZ)({readOnly:!0})],Be.prototype,"state",null),(0,n._)([(0,a.MZ)()],Be.prototype,"map",null),(0,n._)([(0,a.MZ)()],Be.prototype,"view",void 0),Be=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Be);const Ke=Be,We="esri-feature",De={base:`${We}-expression`,loadingSpinnerContainer:`${We}__loading-container`};let ze=class extends g.A{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new Ke}initialize(){this.addHandles((0,r.wB)((()=>this.viewModel?.contentElementViewModel),(()=>this._setupExpressionWidget()),r.Vh))}loadDependencies(){return(0,ye.W)({loader:()=>i.e(6454).then(i.bind(i,76454))})}destroy(){this._destroyContentWidget()}render(){const{state:e}=this.viewModel;return(0,b.K)("div",{class:De.base},"loading"===e?this._renderLoading():"disabled"===e?null:this._contentWidget?.render())}_renderLoading(){return(0,b.K)("div",{class:De.loadingSpinnerContainer,key:"loading-container"},(0,b.K)("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();const n=e?"fields"===i?new J({viewModel:e}):"media"===i?new Ee({viewModel:e}):"text"===i?new S({viewModel:e}):null:null;this._contentWidget=n,this.scheduleRender()}};(0,n._)([(0,a.MZ)({type:Ke})],ze.prototype,"viewModel",void 0),ze=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureExpression")],ze);const He=ze;var je=i(30726),Ue=i(87404);const qe="esri-feature",Ge=`${qe}-relationship`,Xe={base:Ge,listContainer:`${Ge}__list`,listItem:`${Ge}__list-item`,listItemHidden:`${Ge}__list-item--hidden`,listContainerQuerying:`${Ge}__list--querying`,featureObserver:`${qe}__feature-observer`,stickySpinnerContainer:`${qe}__sticky-loading-container`,loadingSpinnerContainer:`${qe}__loading-container`},Je={title:!0,description:!0};let Ye=class extends g.A{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver((e=>{let[t]=e;t?.isIntersecting&&this._increaseFeaturePage()}),{root:window.document}),this.headingLevel=2,this.viewModel=new Ue.A,this.messages=null,this.messagesCommon=null,this.visibleElements={...Je},this._increaseFeaturePage=()=>{const{state:e,showAllEnabled:t,relatedFeatures:i,featuresPerPage:n,featurePage:s}=this.viewModel;"ready"===e&&t&&i.length>=n*s&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new C,this.addHandles([(0,r.wB)((()=>[this.viewModel.description,this.viewModel.title,this.headingLevel]),(()=>this._setupFeatureElementInfo()),r.Vh),(0,r.wB)((()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode]),(()=>this._handleRelatedFeatureObserverChange())),(0,r.on)((()=>this.viewModel.relatedFeatureViewModels),"change",(()=>this._setupRelatedFeatureViewModels()))])}loadDependencies(){return(0,ye.W)({icon:()=>Promise.all([i.e(9879),i.e(5012)]).then(i.bind(i,95012)),list:()=>Promise.all([i.e(9879),i.e(6988),i.e(2085),i.e(8010),i.e(9545),i.e(8838)]).then(i.bind(i,58838)),"list-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(3732)]).then(i.bind(i,84661)),loader:()=>i.e(6454).then(i.bind(i,76454)),notice:()=>Promise.all([i.e(9879),i.e(6988),i.e(1985)]).then(i.bind(i,81985))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,je.pR)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:i,state:n}=this.viewModel;return!e&&!!t&&"ready"===n&&(t>i||0===i)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return(0,be.V)(e?.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...Je,...e}}render(){const{state:e}=this.viewModel;return(0,b.K)("div",{class:this.classes(Xe.base,z.D.widget)},this._featureElementInfo?.render(),"loading"===e?this._renderLoading():"disabled"===e?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,b.K)("div",{class:Xe.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,b.K)("calcite-loader",{inline:!0,label:""})}_renderLoading(){return(0,b.K)("div",{class:Xe.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,b.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=(0,M.V8)(this.container)?"chevron-left":"chevron-right";return(0,b.K)("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){const{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];const n="loading"===e.state;return(0,b.K)("calcite-list-item",{class:this.classes(Xe.listItem,{[Xe.listItemHidden]:n}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,b.K)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,b.K)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,b.K)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,b.K)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Xe.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return(0,b.K)("calcite-list",null,e.toArray().map((e=>this._renderRelatedFeature(e))),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return(0,b.K)("div",{class:this.classes(Xe.listContainer,{[Xe.listContainerQuerying]:"querying"===t}),key:"list-container"},e?this._renderList():"ready"===t?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,b.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,b.K)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach((e=>{this.addHandles((0,r.wB)((()=>[e.title,e.state]),(()=>this.scheduleRender()),r.Vh),t)})),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,n=t.title&&this.title;this._featureElementInfo?.set({description:i,title:n,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await(0,se.Pl)(0),this._relatedFeatureIntersectionObserverNode&&"ready"===e&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,n._)([(0,a.MZ)()],Ye.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],Ye.prototype,"displayShowAllButton",null),(0,n._)([(0,a.MZ)({readOnly:!0})],Ye.prototype,"displayListItems",null),(0,n._)([(0,a.MZ)()],Ye.prototype,"description",null),(0,n._)([(0,a.MZ)({readOnly:!0})],Ye.prototype,"featureCountDescription",null),(0,n._)([(0,a.MZ)()],Ye.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)()],Ye.prototype,"title",null),(0,n._)([(0,a.MZ)({type:Ue.A})],Ye.prototype,"viewModel",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Feature/t9n/Feature")],Ye.prototype,"messages",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/t9n/common")],Ye.prototype,"messagesCommon",void 0),(0,n._)([(0,a.MZ)()],Ye.prototype,"visibleElements",void 0),(0,n._)([(0,f.w)("visibleElements")],Ye.prototype,"castVisibleElements",null),Ye=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureRelationship")],Ye);const Qe=Ye;var et,tt=i(5632),it=i(67478);const nt="content-view-models",st="relationship-view-models",ot={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let rt=et=class extends((0,tt.sA)(R.A)){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=u(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...ot},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:t}=this;return"attachments"===e.type&&!!t.attachmentsContent||"custom"===e.type&&!!t.customContent||"fields"===e.type&&!!t.fieldsContent||"media"===e.type&&!!t.mediaContent||"text"===e.type&&!!t.textContent||"expression"===e.type&&!!t.expressionContent||"relationship"===e.type&&!!t.relationshipContent},this.addHandles((0,r.wB)((()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone]),(()=>this._graphicChangedThrottled()),r.Vh))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return(0,k.n_)((0,k.ld)(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return(0,k.JF)(this.graphic)}castAbilities(e){return{...ot,...e}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??it.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof we&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof we&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof we&&t.previous()}async updateGeometry(){const{graphic:e,spatialReference:t,_sourceLayer:i}=this;await(i?.load());const n=i?.objectIdField;if(!n||!e||!i)return;const s=e?.attributes?.[n];if(null==s)return;const o=[s];if(!e.geometry){const n=await(0,k.DU)({layer:i,graphic:e,outFields:[],objectIds:o,returnGeometry:!0,spatialReference:t}),s=n?.geometry;s&&(e.geometry=s)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){(0,se.zf)(i)||(this._error=i,o.A.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):"relationship"===e.type?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map(((e,t)=>this._compileContentElement(e,t))).filter(ee.Ru):"string"==typeof e?this._compileText(new Re.A({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(st),this.removeHandles(nt),this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_matchesFeature(e,t){const i=e?.graphic?.getObjectId(),n=t?.getObjectId();return null!=i&&null!=n&&i===n}_setRelatedFeaturesViewModels(e){let{relatedFeatureViewModels:t,relatedFeatures:i,map:n}=e;const{view:s,spatialReference:o,timeZone:r}=this;i?.filter(Boolean).forEach((e=>{t.some((t=>this._matchesFeature(t,e)))||t.add(new et({abilities:{relationshipContent:!1},map:n,view:s,spatialReference:o,timeZone:r,graphic:e}))})),t.forEach((e=>{const n=i?.find((t=>this._matchesFeature(e,t)));n||t.remove(e)}))}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:n,contentElementViewModel:s}=e,o=n?.type;s&&o&&("fields"===o&&(this._createFieldsFormattedAttributes({contentElement:n,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(n,t))),"media"===o&&(this._createMediaFormattedAttributes({contentElement:n,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(n,t))),"text"===o&&s.set(this._createTextVMParams(n)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:n,relationshipId:s,title:o,description:a}=e,{_sourceLayer:l,graphic:d,map:c}=this;if(!(0,k.sS)(l))return;const u=new Ue.A({displayCount:i,graphic:d,orderByFields:n,relationshipId:s,layer:l,map:c,...this._compileTitleAndDesc({title:o,description:a})});return this.contentViewModels[t]=u,this.addHandles((0,r.on)((()=>u.relatedFeatures),"change",(()=>this._setRelatedFeaturesViewModels(u))),st),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:n,map:s,spatialReference:o,view:a,location:l}=this,d=new Ke({expressionInfo:i,graphic:n,interceptor:et.interceptor,map:s,spatialReference:o,view:a,location:l});return this.contentViewModels[t]=d,this.addHandles((0,r.wB)((()=>d.contentElementViewModel),(()=>this._setExpressionContentVM(d,t)),r.Vh),nt),e}_compileAttachments(e,t){const{graphic:i}=this,{description:n,title:s}=e;return this.contentViewModels[t]=new w({graphic:i,...this._compileTitleAndDesc({title:s,description:n})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:n,destroyer:s}=e;return this.contentViewModels[t]=new L({graphic:i,creator:n,destroyer:s}),e}_compileTitleAndDesc(e){let{title:t,description:i}=e;const{_fieldInfoMap:n,_sourceLayer:s,graphic:o,formattedAttributes:r}=this,a=o?.attributes,l=this._expressionAttributes,d=r.global;return{title:(0,k.u2)({attributes:a,fieldInfoMap:n,globalAttributes:d,expressionAttributes:l,layer:s,text:t}),description:(0,k.u2)({attributes:a,fieldInfoMap:n,globalAttributes:d,expressionAttributes:l,layer:s,text:i})}}_createFieldsVMParams(e,t){const i=this._effectivePopupTemplate,n=this.formattedAttributes,s={...n?.global,...n?.content[t]},o=e?.fieldInfos||i?.fieldInfos,r=o?.filter((e=>{let{fieldName:t}=e;return!!t&&((0,k.Tt)(t)||(0,k.s$)(t)||s.hasOwnProperty(t))})),a=i?.expressionInfos,{description:l,title:d}=e;return{attributes:s,expressionInfos:a,fieldInfos:r,...this._compileTitleAndDesc({title:d,description:l})}}_compileFields(e,t){const i=e.clone(),n=new D(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=n,i.fieldInfos=n.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:n,_fieldInfoMap:s,_effectivePopupTemplate:o,relatedInfos:r,_sourceLayer:a,_expressionAttributes:l}=this,d=this.formattedAttributes,c=n?.attributes??{},{description:u,mediaInfos:h,title:p}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:c,isAggregate:n?.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...d?.global,...d?.content[t]},expressionAttributes:l,mediaInfos:h,popupTemplate:o,relatedInfos:r,...this._compileTitleAndDesc({title:p,description:u})}}_compileMedia(e,t){const i=e.clone(),n=new we(this._createMediaVMParams(e,t));return i.mediaInfos=n.formattedMediaInfos.slice(0),this.contentViewModels[t]=n,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:n,_expressionAttributes:s}=this;if(e&&e.text){const o=t?.attributes??{},r=this.formattedAttributes?.global??{};e.text=(0,k.u2)({attributes:o,fieldInfoMap:i,globalAttributes:r,expressionAttributes:s,layer:n,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new L(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:n}=this;if(!e)return;const{lastEditInfoEnabled:s}=e,o=t?.editFieldsInfo;return s&&o?(0,k.a$)(o,i?.attributes,n,t):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:n,_expressionAttributes:s}=this,o=n?.attributes??{},r=this.formattedAttributes?.global??{};return(0,k.u2)({attributes:o,fieldInfoMap:t,globalAttributes:r,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,k.AB)({type:"title",value:e?.title,event:{graphic:t}}):null}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return t?(0,k.AB)({type:"content",value:e?.content,event:{graphic:t}}):null}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:n,_effectivePopupTemplate:s}=this,o=this.map,r=this.view,a=this.spatialReference,l=this.location;if(t!==this._featureAbortController||!n)return;await(0,k.c3)({graphic:n,popupTemplate:s,layer:i,spatialReference:a},e);const{content:{value:d},title:{value:c}}=await(0,se.Lx)({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:u}}=await(0,se.Lx)({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Se({expressionInfos:s?.expressionInfos,spatialReference:a,graphic:n,map:o,interceptor:et.interceptor,view:r,options:e,location:l})});t===this._featureAbortController&&n&&(this._expressionAttributes=u,this._graphicExpressionAttributes={...n.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(d)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(d)||null))}_createMediaFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:n}=e;const{_effectivePopupTemplate:s,graphic:o,relatedInfos:r,_sourceLayer:a,_fieldInfoMap:l,_graphicExpressionAttributes:d,timeZone:c}=this;n.content[i]=(0,k.x1)({fieldInfos:s?.fieldInfos,graphic:o,attributes:{...d,...t.attributes},layer:a,fieldInfoMap:l,relatedInfos:r,timeZone:c})}_createFieldsFormattedAttributes(e){let{contentElement:t,contentElementIndex:i,formattedAttributes:n}=e;if(t.fieldInfos){const{graphic:e,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:r,_graphicExpressionAttributes:a,timeZone:l}=this;n.content[i]=(0,k.x1)({fieldInfos:t.fieldInfos,graphic:e,attributes:{...a,...t.attributes},layer:o,fieldInfoMap:r,relatedInfos:s,timeZone:l})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:o,_graphicExpressionAttributes:r,timeZone:a}=this,l=t?.fieldInfos,d={global:(0,k.x1)({fieldInfos:l,graphic:i,attributes:r,layer:s,fieldInfoMap:o,relatedInfos:n,timeZone:a}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:d}),"media"===e.type&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:d})})),d}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,(0,k.ld)(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:n,_sourceLayer:s}=this;n.clear();const o=null!=s?.associatedLayer?await(s?.associatedLayer.load(i)):s;if(!o||!e)return;const r=t.filter((e=>!!e.fieldName&&(0,k.s$)(e.fieldName)));if(!r?.length)return;t.forEach((e=>this._configureRelatedInfo(e,o)));const a=await me({relatedInfos:n,layer:o},i);Object.keys(a).forEach((e=>{const t=n.get(e.toString()),i=a[e]?.value;t&&i&&(t.layerInfo=i.data)}));const l=await function(e,t){let{graphic:i,relatedInfos:n,layer:s}=e;const o={};return n.forEach(((e,n)=>{e.layerInfo&&(o[n]=ge(i,e,s,t))})),(0,se.Lx)(o)}({graphic:e,relatedInfos:n,layer:o},i);Object.keys(l).forEach((e=>{!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:n}=e,s=i?.value;t.relatedFeatures=s?s.features:[];const o=n?.value;t.relatedStatsFeatures=o?o.features:[]}(l[e]?.value,n.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,n=pe(e.fieldName||"");if(!n)return;const{layerId:s,fieldName:o}=n;if(!s)return;const r=i.get(s.toString())||fe(s,t);r&&(function(e){let{relatedInfo:t,fieldName:i,fieldInfo:n}=e;if(t.relatedFields?.push(i),n.statisticType){const e=new ce.A({statisticType:n.statisticType,onStatisticField:i,outStatisticFieldName:i});t.outStatistics?.push(e)}}({relatedInfo:r,fieldName:o,fieldInfo:e}),this.relatedInfos.set(s,r))}};rt.interceptor=new class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||(this.preLayerQueryCallback=e=>{}),this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}}(k.Ao,k.q6),(0,n._)([(0,a.MZ)()],rt.prototype,"_error",void 0),(0,n._)([(0,a.MZ)()],rt.prototype,"_featureAbortController",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"_effectivePopupTemplate",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"_fieldInfoMap",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"_sourceLayer",null),(0,n._)([(0,a.MZ)()],rt.prototype,"abilities",void 0),(0,n._)([(0,f.w)("abilities")],rt.prototype,"castAbilities",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"content",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"contentViewModels",void 0),(0,n._)([(0,a.MZ)()],rt.prototype,"description",void 0),(0,n._)([(0,a.MZ)({type:Boolean})],rt.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"isTable",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"state",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"formattedAttributes",void 0),(0,n._)([(0,a.MZ)({type:Z.A,value:null})],rt.prototype,"graphic",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"lastEditInfo",void 0),(0,n._)([(0,a.MZ)({type:ae.A})],rt.prototype,"location",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"relatedInfos",void 0),(0,n._)([(0,a.MZ)()],rt.prototype,"spatialReference",null),(0,n._)([(0,a.MZ)()],rt.prototype,"timeZone",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"title",void 0),(0,n._)([(0,a.MZ)()],rt.prototype,"map",null),(0,n._)([(0,a.MZ)({readOnly:!0})],rt.prototype,"waitingForContent",null),(0,n._)([(0,a.MZ)()],rt.prototype,"view",void 0),rt=et=(0,n._)([(0,l.$)("esri.widgets.Feature.FeatureViewModel")],rt);const at=rt,lt="esri-feature",dt={base:lt,container:`${lt}__size-container`,title:`${lt}__title`,main:`${lt}__main-container`,btn:`${lt}__button`,icon:`${lt}__icon`,content:`${lt}__content`,contentNode:`${lt}__content-node`,contentNodeText:`${lt}__content-node--text`,contentElement:`${lt}__content-element`,text:`${lt}__text`,lastEditedInfo:`${lt}__last-edited-info`,fields:`${lt}__fields`,fieldHeader:`${lt}__field-header`,fieldData:`${lt}__field-data`,fieldDataDate:`${lt}__field-data--date`,loadingSpinnerContainer:`${lt}__loading-container`},ct=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>(0,O.p4)(e)&&!e.destroyed?(0,b.K)("div",{class:dt.contentNode,key:e},e.render()):e instanceof HTMLElement?(0,b.K)("div",{afterCreate:this._attachToNode,bind:e,class:dt.contentNode,key:e}):(0,O.xk)(e)?(0,b.K)("div",{afterCreate:this._attachToNode,bind:e.domNode,class:dt.contentNode,key:e}):null}_attachToNode(e){e.appendChild(this)}};return t=(0,n._)([(0,l.$)("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var ut;const ht={title:!0,content:!0,lastEditedInfo:!0},pt="relationship-handles";let ft=ut=class extends(ct(g.A)){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...ht},this.viewModel=new at}initialize(){this.addHandles((0,r.wB)((()=>this.viewModel?.contentViewModels),(()=>this._setupContentWidgets()),r.Vh))}loadDependencies(){return(0,ye.W)({notice:()=>Promise.all([i.e(9879),i.e(6988),i.e(1985)]).then(i.bind(i,81985)),loader:()=>i.e(6454).then(i.bind(i,76454))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...ht,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){const{state:e}=this.viewModel,t=(0,b.K)("div",{class:dt.container,key:"container"},this._renderTitle(),"error"===e?this._renderError():"loading"===e?this._renderLoading():this._renderContentContainer());return(0,b.K)("div",{class:this.classes(dt.base,z.D.widget)},t)}_renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return(0,b.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?(0,b.K)("div",{key:"error-title",slot:"title"},e.errorMessage):null,(0,b.K)("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return(0,b.K)("div",{class:dt.loadingSpinnerContainer,key:"loading-container"},(0,b.K)("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:e}=this;return e.content?(0,b.K)("div",{class:dt.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:e,title:t}=this;return e.title?(0,b.K)(y.D,{class:dt.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,b.K)("div",{class:dt.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:(0,b.K)("div",{class:this.classes(dt.contentNode,dt.contentNodeText),key:`${t}-content`},e.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:n}=t.viewModel;return"loading"===i||n.length>0?(0,b.K)("div",{class:this.classes(dt.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){const{creator:i}=e,n=this._contentWidgets[t];return!n||n.destroyed?null:i?(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("custom-element",t)},n.render()):null}_renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.K)("div",{class:dt.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:n,user:s}=i,o="edit"===i.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,r=(0,be.V)(o,{date:n,user:s});return(0,b.K)("div",{class:this.classes(dt.lastEditedInfo,dt.contentElement),key:"edit-info-element"},r)}_renderText(e,t){const i=e.text,n=this._contentWidgets[t];return!n||n.destroyed?null:i?(0,b.K)("div",{class:this.classes(dt.contentElement,dt.text),key:this._buildKey("text-element",t)},n.render()):null}_buildKey(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return`${e}__${this.viewModel?.graphic?.uid||"0"}-${i.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(pt),this._contentWidgets.forEach((e=>this._destroyContentWidget(e))),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){const{flowItems:t,visibleElements:i}=this;this.addHandles([(0,r.on)((()=>e),"select-record",(e=>{let{featureViewModel:n}=e;t&&(n.abilities={relationshipContent:!0},t.push(new ut({flowItems:t,viewModel:n,visibleElements:i})))})),(0,r.on)((()=>e),"show-all-records",(()=>{if(!t)return;const{viewModel:i}=e;i.showAllEnabled=!0;const n=new Qe({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(n),t.push(n)}))],pt)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.viewModel?.content,{contentViewModels:n}=this.viewModel;if(Array.isArray(i))i.forEach(((i,s)=>{if("attachments"===i.type&&(this._contentWidgets[s]=new T({displayType:i.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:n[s]})),"fields"===i.type&&(this._contentWidgets[s]=new J({viewModel:n[s]})),"media"===i.type&&(this._contentWidgets[s]=new Ee({viewModel:n[s]})),"text"===i.type&&(this._contentWidgets[s]=new S({viewModel:n[s]})),"custom"===i.type&&(this._contentWidgets[s]=new S({viewModel:n[s]})),"expression"===i.type&&(this._contentWidgets[s]=new He({viewModel:n[s]})),"relationship"===i.type){const e=new Qe({viewModel:n[s]});this._addFeatureRelationshipHandles(e),this._contentWidgets[s]=e}}),this);else{const e=n[0];e&&!e.destroyed&&(this._contentWidgets[0]=new S({viewModel:e}))}this.scheduleRender()}};(0,n._)([(0,a.MZ)()],ft.prototype,"graphic",null),(0,n._)([(0,a.MZ)()],ft.prototype,"defaultPopupTemplateEnabled",null),(0,n._)([(0,a.MZ)()],ft.prototype,"flowItems",void 0),(0,n._)([(0,a.MZ)()],ft.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],ft.prototype,"isTable",null),(0,n._)([(0,a.MZ)()],ft.prototype,"icon",null),(0,n._)([(0,a.MZ)()],ft.prototype,"label",null),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Feature/t9n/Feature")],ft.prototype,"messages",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/t9n/common")],ft.prototype,"messagesCommon",void 0),(0,n._)([(0,a.MZ)()],ft.prototype,"spatialReference",null),(0,n._)([(0,a.MZ)()],ft.prototype,"timeZone",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ft.prototype,"title",null),(0,n._)([(0,a.MZ)()],ft.prototype,"visibleElements",void 0),(0,n._)([(0,f.w)("visibleElements")],ft.prototype,"castVisibleElements",null),(0,n._)([(0,a.MZ)()],ft.prototype,"map",null),(0,n._)([(0,a.MZ)()],ft.prototype,"view",null),(0,n._)([(0,a.MZ)({type:at})],ft.prototype,"viewModel",void 0),ft=ut=(0,n._)([(0,l.$)("esri.widgets.Feature")],ft);const gt=ft;var mt=i(55191);const _t="esri-features",vt={icon:`${_t}__icon`,actionImage:`${_t}__action-image`,base:_t,container:`${_t}__container`,contentContainer:`${_t}__content-container`,contentFeature:`${_t}__content-feature`,flowItemCollapsed:`${_t}__flow-item--collapsed`,header:`${_t}__header`,footer:`${_t}__footer`,featureMenuObserver:`${_t}__feature-menu-observer`,actionExit:`${_t}__action--exit`,loader:`${_t}__loader`,featuresHeading:`${_t}__heading`,paginationActionBar:`${_t}__pagination-action-bar`,paginationPrevious:`${_t}__pagination-previous`,paginationNext:`${_t}__pagination-next`};let wt=class extends g.A{constructor(e,t){super(e,t),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=e=>{this.emit("open-related-feature",{feature:e})}}loadDependencies(){return(0,ye.W)({action:()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(4068)]).then(i.bind(i,92111)),"flow-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(6269),i.e(661)]).then(i.bind(i,40661))})}render(){const{flowItems:e}=this,t=e?.toArray();return(0,b.K)(b.w,null,t?.map((e=>this._renderRelatedRecordsFlowItem(e))))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const e=this.flowItems?.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){const{messages:t,closable:i,closed:n}=this,s="graphic"in e&&!e.isTable&&e.graphic?.geometry,o=t.exitRelatedRecords,r=t.selectFeature;return(0,b.K)("calcite-flow-item",{bind:this,closable:i,closed:n,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,b.K)("calcite-action",{appearance:"transparent",bind:this,class:vt.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:o,title:o}),s?(0,b.K)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:r,title:r}):null,(0,b.K)("div",{class:vt.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};(0,n._)([(0,a.MZ)()],wt.prototype,"flowItems",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Features/t9n/Features")],wt.prototype,"messages",void 0),(0,n._)([(0,a.MZ)()],wt.prototype,"closed",void 0),(0,n._)([(0,a.MZ)()],wt.prototype,"closable",void 0),wt=(0,n._)([(0,l.$)("esri.widgets.Features.FeaturesRelatedRecords")],wt);const yt=wt;i(95444);var Mt=i(60767),bt=i(9624),Ft=i(45417),It=i(25515),At=i(3569),Ct=i(8503),xt=i(90992),Et=i(50037),Tt=i(76192),Zt=i(15062);const Rt=c.A.ofType({key:"type",defaultKeyValue:"button",base:Et.A,typeMap:{button:d.A,toggle:Tt.A}}),kt=new d.A({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Zt.T.zoomInMagnifyingGlass}),Pt=new d.A({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Zt.T.trash}),Lt=new d.A({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Zt.T.zoomInMagnifyingGlass}),Ot=new Tt.A({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Zt.T.table,value:!1}),Vt=()=>o.A.getLogger("esri.widgets.Popup.PopupViewModel"),Nt=e=>{const{event:t,view:i,viewModel:n}=e,{action:s}=t;if(!s)return Promise.reject(new ne.A("trigger-action:missing-arguments","Event has no action"));const{disabled:o,id:r}=s;if(!r)return Promise.reject(new ne.A("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new ne.A("trigger-action:invalid-action","Action is disabled"));if(r===kt.id)return async function(e){const{location:t,selectedFeature:i,view:n,zoomFactor:s}=e,o=$t(e);if(!n||!o){const e=new ne.A("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:o,view:n});throw Vt().error(e),e}const r=n.scale/s,a=e.selectedFeature?.geometry,l=a??t,d=null!=l&&"point"===l.type&&await async function(e,t){if("3d"!==t?.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=null;try{t=await i.whenGraphicBounds(e,{useViewElevation:!0})}catch(si){}return!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]}return!0}(i,n);kt.active=!0,kt.disabled=!0;try{await e.zoomTo({target:{target:o,scale:d?r:void 0}})}catch(c){const e=new ne.A("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});Vt().error(e)}finally{kt.active=!1,kt.disabled=!1,e.zoomToLocation=null,d&&(e.location=l)}}(n).catch(se.jH);if(r===Lt.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==i?.type){const e=new ne.A("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Vt().error(e),e}if(!t||!St(t)){const e=new ne.A("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw Vt().error(e),e}const[n,s]=await Bt(i,t);Lt.active=!0,Lt.disabled=!0;const{extent:o}=await n.queryExtent(s);o&&await e.zoomTo({target:o}),Lt.active=!1,Lt.disabled=!1}(n);if(r===Ot.id)return n.browseClusterEnabled=!n.browseClusterEnabled,n.featureMenuOpen=n.browseClusterEnabled,Promise.resolve();if(r===Pt.id){n.visible=!1;const{selectedFeature:e}=n;if(!e)return Promise.reject(new ne.A(`trigger-action:${Pt.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i?.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function $t(e){const{selectedFeature:t,location:i,view:n}=e;return n?t??i??null:null}function St(e){return!!e&&e.isAggregate&&"cluster"===e.sourceLayer?.featureReduction?.type}async function Bt(e,t){const i=await e.whenLayerView(t.sourceLayer),n=i.createQuery(),s=t.getObjectId();return n.aggregateIds=null!=s?[s]:[],[i,n]}var Kt=i(68999),Wt=i(79535),Dt=i(86875);const zt="location-scale-handle";let Ht=null;let jt=class extends((0,Wt.R)(Kt.A)){constructor(e){super(e),this._pendingPromises=new Mt.A,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new Rt,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Z.A({symbol:new Dt.default({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,se.sg)((async e=>{const{spatialReference:t}=this,n=this.selectedFeature?.geometry?.type,s=this.location??e;if(n&&"mesh"!==n&&t&&s&&this.selectedFeature)if("point"!==n)try{const e=this.selectedFeature;let n=e.geometry;const o=this._getHighlightLayer(e),r=e.getObjectId();if(!o||!this.view)return;if(r){const e=this.view?.allLayerViews.find((e=>e.layer.uid===o.uid));if(!e||!("queryFeatures"in e))return;const i=e.createQuery();i.outSpatialReference=t,i.objectIds=[r],i.returnGeometry=!0;const{features:s}=await e.queryFeatures(i);n=s[0]?.geometry}if(!n||"mesh"===n.type)return;if(n=(0,bt.project)(n,t),Ht||(Ht=await i.e(6203).then(i.bind(i,56203))),!await Ht.intersects(n,s)){const t=(await Ht.nearestCoordinate(n,s)).coordinate??s;this.selectedFeature===e&&(this.location=t)}}catch(si){(0,se.zf)(si)||o.A.getLogger(this).error(si)}else this.location=(0,h.z8)(this.selectedFeature.geometry)??s}))}initialize(){this.addHandles([this.on("view-change",(()=>this._autoClose())),(0,r.wB)((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),(0,r.wB)((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),(0,r.wB)((()=>this.view?.animation?.state),(e=>this._animationStateChange(e))),(0,r.wB)((()=>this.location),(e=>this._locationChange(e))),(0,r.wB)((()=>this.selectedFeature),(e=>this._selectedFeatureChange(e))),(0,r.wB)((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),(0,r.wB)((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),(0,r.wB)((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>Nt({event:e,viewModel:this,view:this.view}))),(0,r.z7)((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),r.OH),(0,r.wB)((()=>[this.features,this.map,this.spatialReference,this.timeZone]),(()=>this._updateFeatureVMs())),(0,r.wB)((()=>this.view?.scale),(()=>this._viewScaleChange())),(0,r.z7)((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),(0,r.wB)((()=>this.browseClusterEnabled),(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new Rt;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:o}=this,r=s?i.concat(t):t,a=o&&("function"==typeof o.getEffectivePopupTemplate&&o.getEffectivePopupTemplate(n)||o.popupTemplate),l=a?.actions,d=a?.overwriteActions?l:l?.concat(r)??r;return d?.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){const e=this._get("defaultActions")||new Rt;return e.removeAll(),e.addMany(St(this.selectedFeature)?[Lt.clone(),Ot.clone()]:[kt.clone()]),e}get featureCount(){return this.features.length}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&t.length;o&&i&&-1===s?this.selectedFeatureIndex=0:o&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}set location(e){let t=e;const i=this.spatialReference?.isWebMercator,n=e?.spatialReference?.isWGS84;n&&i&&(t=(0,Ft.Gh)(e)),this._set("location",t)}get map(){return this.view?.map??null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach((e=>this._pendingPromises.add(e))),e.reduce(((e,t)=>e.finally((()=>t.then((e=>{this._pendingPromises.has(t)&&this._updateFeatures(e)})).finally((()=>this._pendingPromises.delete(t))).catch((()=>{}))))),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){return this.view?.timeZone??it.qU}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some((e=>e.waitingForContent))}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:e}=this,t=$t(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new ne.A("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e)throw new ne.A("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{pointerType:t?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t?.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const n=["actionsMenuOpen","collapsed"];for(const s of n)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function(e){Ot.value=!1;const t=e.features.filter((e=>St(e)));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;"2d"===e?.type?St(t)?(await async function(e){const{view:t,selectedFeature:i}=e;if(!t||!i)return;const[n,s]=await Bt(t,i),{extent:o}=await n.queryExtent(s);e.selectedClusterBoundaryFeature.geometry=o,t.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e;if(!i||!t)return;const[n,s]=await Bt(i,t);Ot.active=!0,Ot.disabled=!0;const{features:o}=await n.queryFeatures(s);Ot.active=!1,Ot.disabled=!1,Ot.value=!0,e?.open({features:[t].concat(o),featureMenuOpen:!0})}(this)):o.A.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):o.A.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(kt.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){const e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(ee.Ru);this.view?.graphics?.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(St(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i,view:n}=this;n&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:n,featureViewModels:s}=this;if(null===i)return;const o=((i-1)*n+t)%t,r=o+n;s.slice(o,r).forEach(((t,i)=>{t&&(t.graphic??=e[o+i])}))}async _selectedFeatureChange(e){const{location:t,updateLocationEnabled:i,view:n}=this;if(!e||!n)return;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),St(e))return;return e.symbol=await(0,Ct.Kf)(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}const s=e.sourceLayer?.type;if("map-image"!==s&&"imagery"!==s&&"imagery-tile"!==s||(e.symbol=await(0,Ct.Kf)(e)),!i&&t||!e.geometry){if(i&&!e.geometry){await this.centerAtLocation();const e=n.center?.clone();e&&(this.location=e)}}else this.location=(0,h.z8)(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(e){const{pendingFeatures:t}=await this._fetchFeaturesWithController({mapPoint:e});this.promises=t}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i,view:n,spatialReference:s,map:o,timeZone:r,location:a}=this;if(St(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t?.length)return;const l=i.slice(0),d=[];t.forEach(((t,i)=>{if(!t)return;let c=null;if(l.some(((e,i)=>(e&&e.graphic===t&&(c=e,l.splice(i,1)),!!c))),c)d[i]=c;else{const l=new at({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:s,graphic:t===e?t:null,location:a,map:o,view:n,timeZone:r});d[i]=l}})),l.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",d)}async _getScreenPoint(e,t){const{spatialReference:i,view:n}=this;if(!n)return null;await(n?.when());const s=e?.spatialReference;return s&&i?(await(0,bt.initializeProjection)(s,i,null,t),n.toScreen(e)):null}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures(e){let{mapPoint:t,screenPoint:i,event:n,signal:s}=e;return this.fetchFeatures(i??await this._getScreenPoint(t??this.location,{signal:s}),{signal:s,event:n})}_fetchFeaturesWithController(e){let{mapPoint:t,screenPoint:i,event:n}=e;this._cancelFetchingFeatures();const s=new AbortController,{signal:o}=s;this._fetchFeaturesController=s;const r=this._projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:i,signal:o,event:n});return r.catch((()=>{})).then((()=>{this._fetchFeaturesController=null})),r}async _fetchFeaturesAndOpen(e){const{mapPoint:t,screenPoint:i}=e,{view:n}=this;this.removeHandles(zt),this.addHandles([(0,r.wB)((()=>this.view?.scale),(()=>this._debouncedLocationUpdate(t).catch((e=>{(0,se.zf)(e)||o.A.getLogger(this).error(e)})))),(0,r.z7)((()=>!this.visible),(()=>{this.removeHandles(zt)}),{once:!0})],zt);const{pendingFeatures:s}=await this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});n?.popup&&"open"in n.popup&&n.popup.open({location:t??void 0,promises:s})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:"map-notes"===i?.type||"subtype-group"===i?.type?i:t}_getHighlightTarget(e,t,i){if(function(e,t){return"building-scene"===e||"2d"===t&&("map-image"===e||"tile"===e||"imagery"===e||"imagery-tile"===e)}(t.type,i))return e;const n=e.getObjectId();if(null!=n)return n;const s="imagery"===t.type?void 0:"objectIdField"in t?t.objectIdField||At.r:null,o=e.attributes;return o&&s&&o[s]||e}_mapIncludesLayer(e){return!!this.map?.allLayers?.includes(e)}async _highlightActiveFeature(){const e="highlight-active-feature";this.removeHandles(e);const{highlightEnabled:t,view:i,activeFeature:n,visible:s}=this;if(!(n&&i&&t&&s))return;const o=this._getHighlightLayer(n);if(!(o&&o instanceof It.A&&this._mapIncludesLayer(o)))return;const r=this._getLayerView(i,o);this._highlightActiveFeaturePromise=r;const a=await r;if(!(a&&(0,xt.Of)(a)&&this._highlightActiveFeaturePromise===r&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(n,o,i.type));this.addHandles(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this.removeHandles(e);const{selectedFeature:t,highlightEnabled:i,view:n,visible:s}=this;if(!(t&&n&&i&&s))return;const o=this._getHighlightLayer(t);if(!(o&&o instanceof It.A&&this._mapIncludesLayer(o)))return;const r=this._getLayerView(n,o);this._highlightSelectedFeaturePromise=r;const a=await r;if(!(a&&(0,xt.Of)(a)&&this._highlightSelectedFeaturePromise===r&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,o,n.type));this.addHandles(l,e)}_updateFeatures(e){const{features:t}=this,i=e.filter((e=>!t.includes(e)));i?.length&&(this.features=t.concat(i))}};(0,n._)([(0,a.MZ)()],jt.prototype,"_fetchFeaturesController",void 0),(0,n._)([(0,a.MZ)({type:Rt})],jt.prototype,"actions",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"active",null),(0,n._)([(0,a.MZ)()],jt.prototype,"activeFeature",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"allActions",null),(0,n._)([(0,a.MZ)()],jt.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"browseClusterEnabled",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"content",void 0),(0,n._)([(0,a.MZ)({type:Rt,readOnly:!0})],jt.prototype,"defaultActions",null),(0,n._)([(0,a.MZ)({type:Boolean})],jt.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"featureCount",null),(0,n._)([(0,a.MZ)()],jt.prototype,"featurePage",void 0),(0,n._)([(0,a.MZ)({value:[]})],jt.prototype,"features",null),(0,n._)([(0,a.MZ)()],jt.prototype,"featuresPerPage",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"featureMenuOpen",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"featureViewModelAbilities",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"featureViewModels",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"highlightEnabled",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"includeDefaultActions",void 0),(0,n._)([(0,a.MZ)({type:ae.A})],jt.prototype,"location",null),(0,n._)([(0,a.MZ)()],jt.prototype,"map",null),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"pendingPromisesCount",null),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"promiseCount",null),(0,n._)([(0,a.MZ)()],jt.prototype,"promises",null),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"selectedClusterBoundaryFeature",void 0),(0,n._)([(0,a.MZ)({value:null,readOnly:!0})],jt.prototype,"selectedFeature",null),(0,n._)([(0,a.MZ)({value:-1})],jt.prototype,"selectedFeatureIndex",null),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"selectedFeatureViewModel",null),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"state",null),(0,n._)([(0,a.MZ)()],jt.prototype,"timeZone",null),(0,n._)([(0,a.MZ)()],jt.prototype,"title",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"view",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"visible",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"waitingForContents",null),(0,n._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"waitingForResult",null),(0,n._)([(0,a.MZ)()],jt.prototype,"zoomFactor",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"zoomToLocation",void 0),(0,n._)([(0,a.MZ)()],jt.prototype,"centerAtLocation",null),jt=(0,n._)([(0,l.$)("esri.widgets.Features.FeaturesViewModel")],jt);const Ut=jt;let qt=class extends R.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"actionBar",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"closeButton",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"collapseButton",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"featureNavigation",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"featureListLayerTitle",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"flow",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"heading",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],qt.prototype,"spinner",void 0),qt=(0,n._)([(0,l.$)("esri.widgets.Features.FeaturesVisibleElements")],qt);const Gt=qt;var Xt=i(12254),Jt=i(50265);const Yt="selected-index",Qt="features-spinner";function ei(e){return e?.declaredClass.startsWith("esri.layers.")??!1}let ti=class extends(ct(g.A)){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=e=>{let[t]=e;t?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new c.A,this._relatedRecordsWidget=new yt({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new Rt,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Ut,this.visibleElements=new Gt,this._renderAction=(e,t)=>{const i=this._getActionTitle(e),{type:n,active:s,uid:o,disabled:r,indicator:a}=e;return e.visible?(0,b.K)("calcite-action",{active:"toggle"===n&&e.value,appearance:"solid",bind:this,"data-action-uid":o,disabled:r,icon:this._getActionIcon(e),indicator:a,key:`action-${t}`,loading:s,onclick:this._triggerAction,scale:"s",text:i,title:this._hideActionText?i:void 0},this._getFallbackIcon(e)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=e=>{this._focusOn===e&&requestAnimationFrame((async()=>{switch(e){case"menu-flow-item":await(this._featureMenuViewportNode?.setFocus());break;case"root-flow-item":await(this._rootFlowItemNode?.setFocus())}this._focusOn=null}))},this._focusFlowItemNodeThrottled=u(this._focusFlowItemNode,50),this._displaySpinnerThrottled=u((()=>this._displaySpinner()),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,r.wB)((()=>this.viewModel?.active),(()=>this._toggleScreenLocationEnabled())),(0,r.wB)((()=>this.viewModel?.active),(e=>this._relatedRecordsWidget.closed=!e)),(0,r.wB)((()=>this.visibleElements?.closeButton),(e=>this._relatedRecordsWidget.closable=e)),(0,r.wB)((()=>this.visibleElements?.spinner),(e=>this._spinnerEnabledChange(e))),(0,r.wB)((()=>this.viewModel?.view),((e,t)=>this._viewChange(e,t))),(0,r.wB)((()=>this.viewModel?.view?.ready),((e,t)=>this._viewReadyChange(e??!1,t??!1))),(0,r.wB)((()=>[this.viewModel?.waitingForResult,this.viewModel?.location]),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,r.wB)((()=>this.viewModel?.screenLocation),(()=>this._closeOpenActionMenu())),(0,r.wB)((()=>this.selectedFeatureWidget),(()=>this._destroyRelatedRecordsFlowItemWidgets())),(0,r.wB)((()=>{const e=this.selectedFeatureWidget?.viewModel;return[e?.title,e?.state]}),(()=>this._setTitleFromFeatureWidget())),(0,r.wB)((()=>{const e=this.selectedFeatureWidget?.viewModel;return[e?.content,e?.state]}),(()=>this._setContentFromFeatureWidget())),(0,r.wB)((()=>this.viewModel?.featureViewModels),(()=>this._featureMenuViewportScrollTop())),this._relatedRecordsWidget.on("close",(()=>this.close())),this._relatedRecordsWidget.on("exit",(()=>this._destroyRelatedRecordsFlowItemWidgets())),this._relatedRecordsWidget.on("open-related-feature",(e=>{let{feature:t}=e;return this._openRelatedFeature(t)}))])}loadDependencies(){return(0,ye.W)({action:()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(4068)]).then(i.bind(i,92111)),"action-bar":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(8723)]).then(i.bind(i,48723)),"action-group":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(7689)]).then(i.bind(i,67689)),button:()=>Promise.all([i.e(9879),i.e(6988),i.e(2085),i.e(2602)]).then(i.bind(i,52602)),flow:()=>i.e(4961).then(i.bind(i,14961)),"flow-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8347),i.e(373),i.e(8897),i.e(3794),i.e(4706),i.e(6269),i.e(661)]).then(i.bind(i,40661)),list:()=>Promise.all([i.e(9879),i.e(6988),i.e(2085),i.e(8010),i.e(9545),i.e(8838)]).then(i.bind(i,58838)),"list-item":()=>Promise.all([i.e(9879),i.e(6988),i.e(8897),i.e(3732)]).then(i.bind(i,84661)),"list-item-group":()=>i.e(4795).then(i.bind(i,24795)),loader:()=>i.e(6454).then(i.bind(i,76454))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const e=this.view?.widthBreakpoint;return"xsmall"===e||"small"===e||"medium"===e}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:t,_relatedRecordsFlowItems:i,timeZone:n,spatialReference:s,map:o}=this,{selectedFeatureViewModel:r}=this.viewModel,a={title:!1};return r?(e?(e.viewModel=r,e.visibleElements=a):this._feature=new gt({flowItems:i,headingLevel:t+1,timeZone:n,spatialReference:s,map:o,viewModel:r,visibleElements:a}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e?this._rootFlowItemNode?.blur():o.A.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e?this._setFocusOn():o.A.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(Yt);const t={collapsed:e?.collapsed??!1};this.set(t),this.viewModel.open(e),this.addHandles((0,r.z7)((()=>!this.viewModel.waitingForResult),(()=>this._addSelectedFeatureIndexHandle()),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return(0,b.K)("div",{bind:this,class:this.classes(vt.base,z.D.widget,z.D.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,b.K)("div",{class:vt.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,b.K)("div",{class:vt.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:n,pendingPromisesCount:s}=t;return(0,b.K)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:s>0,onclick:this._openFeatureMenu,scale:"s",text:(0,be.V)(e.pageText,{index:(0,Jt.ZV)(n+1),total:(0,Jt.ZV)(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:t}=this.messagesCommon.pagination;return(0,b.K)("calcite-action-bar",{class:vt.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,b.K)("calcite-action-group",{scale:"s"},(0,b.K)("calcite-action",{appearance:"solid",class:vt.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),(0,b.K)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){const{selectedFeatureViewModel:t,featureViewModels:i}=this.viewModel,n=e===t,s=i.indexOf(e);return(0,b.K)("calcite-list-item",{bind:this,"data-feature-index":s,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:n,onCalciteListItemSelect:this._selectFeature},(0,b.K)("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach((e=>{const i=e?.graphic;if(!i)return;const{layer:n,sourceLayer:s}=i,o=(ei(n)?n:null)||(ei(s)?s:null),r=t.get(o)??[];t.set(o,[...r,e])})),t}_renderFeatureMenu(){const{featureViewModels:e}=this.viewModel,t=this._groupResultsByLayer();return e.length?(0,b.K)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(t.keys(),(e=>{const i=t.get(e)?.map((e=>this._renderFeatureMenuItem(e))),n=e?e.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&null!==n?(0,b.K)("calcite-list-item-group",{heading:n,key:e?.uid||"map-graphics"},i):i}))):null}_renderHeaderAction(e,t){const i=e.title||"";return e.visible?(0,b.K)("calcite-action",{active:"toggle"===e.type&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map(((e,t)=>this._renderHeaderAction(e,t))).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:n,featureNavigationTop:s}=this,{title:o,active:r}=this.viewModel,a=t.heading&&o?o:"";return(0,b.K)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[vt.contentFeature]:!0,[vt.flowItemCollapsed]:i}),closable:t.closeButton,closed:!r,collapsed:i,collapseDirection:s?"down":"up",collapsible:n,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},a?(0,b.K)(y.D,{class:this.classes(vt.featuresHeading,z.D.heading),innerHTML:a,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:(0,b.K)("div",{class:this.classes(vt.container,vt.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,featureMenuOpen:t,messages:i,messagesCommon:n}=this,{active:s,featureViewModels:o,pendingPromisesCount:r}=e;return t?(0,b.K)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!s,description:(0,be.V)(i.total,{total:o.length}),heading:i.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleFeatureMenuBack()}},r>0?(0,b.K)("calcite-loader",{class:vt.loader,inline:!0,key:"feature-menu-loader",label:n.loading,slot:"header-actions-end"}):null,(0,b.K)("div",{class:vt.container},this._renderFeatureMenu()),(0,b.K)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:vt.featureMenuObserver}),(0,b.K)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},n.back)):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,b.K)("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:t,icon:i}=e;if(i)return null;const n=(0,p.CA)({action:e,feature:this.selectedFeature}),s={[vt.icon]:!!t,[vt.actionImage]:!!n};return t&&(s[t]=!0),n||t?(0,b.K)("span",{"aria-hidden":"true",class:this.classes(vt.icon,s),key:"icon",styles:(0,p.p5)(n)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,b.K)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,b.K)("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const e=this.viewModel?.content;return e?"string"==typeof e?(0,b.K)("div",{class:dt.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this.renderNow(),requestAnimationFrame((()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"}))}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=t?.geometry;if(null==i||null==t)return;this._destroyRelatedRecordsFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const n=(0,h.z8)(i);this.open({features:[t],location:null!=n?n:void 0})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features?.[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,o=i?.attributes,r=e.title??"",a="zoom-to-feature"===s?(0,be.V)(r,{messages:t}):"remove-selected-feature"===s?(0,be.V)(r,{messages:n}):"zoom-to-clustered-features"===s||"browse-clustered-features"===s?(0,be.V)(r,{messages:t}):e.title;return a&&o?(0,be.V)(a,o):a??""}_onMainKeydown(e){const{key:t}=e;"ArrowLeft"===t&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title="error"===i?.state?t?.errorMessage:i?.title||"")}_addSelectedFeatureIndexHandle(){const e=(0,r.wB)((()=>this.viewModel?.selectedFeatureIndex),((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this.addHandles(e,Yt)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this.viewModel;i&&e!==t&&-1!==e&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,n=this.headerActions.find((e=>{let{uid:t}=e;return t===i}));n&&!n.disabled&&("toggle"===n?.type&&(n.value=!n.value),this.emit("trigger-header-action",{action:n}))}_triggerAction(e){const t=e.currentTarget;if(t.disabled)return;const i=t.dataset.actionUid,{allActions:n}=this.viewModel,s=n.findIndex((e=>e.uid===i)),o=n.at(s);o&&"toggle"===o.type&&(o.value=!o.value),this.viewModel.triggerAction(s)}_createSpinner(e){e&&(this._spinner=new mt.A({view:e}),e.ui.add(this._spinner,{key:Qt,position:"manual",internal:!0}))}_wireUpView(e){this._destroySpinner(),e&&this.visibleElements?.spinner&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain((e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()}))}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t?.ui?.remove(e,Qt),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){this._destroySpinner(),e&&this._createSpinner(this.viewModel?.view)}};(0,n._)([(0,a.MZ)()],ti.prototype,"_focusOn",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"_relatedRecordsFlowItems",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"_hideActionText",null),(0,n._)([(0,a.MZ)()],ti.prototype,"_featureNavigationVisible",null),(0,n._)([(0,a.MZ)()],ti.prototype,"_isCollapsed",null),(0,n._)([(0,a.MZ)()],ti.prototype,"_collapseEnabled",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ti.prototype,"active",null),(0,n._)([(0,a.MZ)()],ti.prototype,"collapsed",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"content",null),(0,n._)([(0,a.MZ)()],ti.prototype,"icon",null),(0,n._)([(0,a.MZ)()],ti.prototype,"featureMenuOpen",null),(0,n._)([(0,a.MZ)()],ti.prototype,"featureNavigationTop",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"features",null),(0,n._)([(0,a.MZ)()],ti.prototype,"goToOverride",null),(0,n._)([(0,a.MZ)({type:Rt})],ti.prototype,"headerActions",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"location",null),(0,n._)([(0,a.MZ)()],ti.prototype,"label",null),(0,n._)([(0,a.MZ)()],ti.prototype,"map",null),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Features/t9n/Features")],ti.prototype,"messages",void 0),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/t9n/common")],ti.prototype,"messagesCommon",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"promises",null),(0,n._)([(0,a.MZ)()],ti.prototype,"responsiveActionsEnabled",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],ti.prototype,"selectedFeature",null),(0,n._)([(0,a.MZ)()],ti.prototype,"selectedFeatureIndex",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ti.prototype,"selectedFeatureWidget",null),(0,n._)([(0,a.MZ)()],ti.prototype,"spatialReference",null),(0,n._)([(0,a.MZ)()],ti.prototype,"title",null),(0,n._)([(0,a.MZ)()],ti.prototype,"timeZone",null),(0,n._)([(0,a.MZ)()],ti.prototype,"updateLocationEnabled",null),(0,n._)([(0,a.MZ)()],ti.prototype,"view",null),(0,n._)([(0,a.MZ)({type:Ut}),(0,Xt.U)(["triggerAction","trigger-action"])],ti.prototype,"viewModel",void 0),(0,n._)([(0,a.MZ)({type:Gt,nonNullable:!0})],ti.prototype,"visibleElements",void 0),(0,n._)([(0,a.MZ)()],ti.prototype,"visible",null),ti=(0,n._)([(0,l.$)("esri.widgets.Features")],ti);const ii=ti,ni="esri-popup",si=`${ni}--is-docked`,oi={base:ni,baseHidden:`${ni}--hidden`,main:`${ni}__main-container`,shadow:`${ni}--shadow`,isDocked:si,isDockedTopLeft:`${si}-top-left`,isDockedTopCenter:`${si}-top-center`,isDockedTopRight:`${si}-top-right`,isDockedBottomLeft:`${si}-bottom-left`,isDockedBottomCenter:`${si}-bottom-center`,isDockedBottomRight:`${si}-bottom-right`,alignTopCenter:`${ni}--aligned-top-center`,alignBottomCenter:`${ni}--aligned-bottom-center`,alignTopLeft:`${ni}--aligned-top-left`,alignBottomLeft:`${ni}--aligned-bottom-left`,alignTopRight:`${ni}--aligned-top-right`,alignBottomRight:`${ni}--aligned-bottom-right`,pointer:`${ni}__pointer`,pointerDirection:`${ni}__pointer-direction`};let ri=class extends Ut{constructor(e){super(e)}};ri=(0,n._)([(0,l.$)("esri.widgets.Popup.PopupViewModel")],ri);const ai=ri;let li=class extends R.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"actionBar",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"closeButton",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"collapseButton",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"featureNavigation",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"featureListLayerTitle",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"heading",void 0),(0,n._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],li.prototype,"spinner",void 0),li=(0,n._)([(0,l.$)("esri.widgets.Popup.PopupVisibleElements")],li);const di=li,ci={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let ui=class extends g.A{constructor(e,t){super(e,t),this._dockAction=new d.A({id:"popup-dock-action"}),this._featuresWidget=new ii({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new ai,this.visibleElements=new di}initialize(){this.addHandles([(0,r.wB)((()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled]),(()=>this._handleDockIcon()),r.Vh),(0,r.wB)((()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock]),(()=>this._handleDockEnabled()),r.Vh),(0,r.wB)((()=>this.dockOptions),(e=>{const{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)}),r.Vh),(0,r.wB)((()=>this.viewModel?.screenLocation),(()=>this._positionContainer())),(0,r.wB)((()=>[this.viewModel?.active,this.dockEnabled]),(()=>this._toggleScreenLocationEnabled())),(0,r.wB)((()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment]),(()=>this.reposition())),(0,r.wB)((()=>this.viewModel?.view?.size),((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,r.wB)((()=>this.viewModel?.view),((e,t)=>this._viewChange(e,t))),(0,r.wB)((()=>this.viewModel?.view?.ready),((e,t)=>this._viewReadyChange(e??!1,t??!1))),(0,r.wB)((()=>this.viewModel),(()=>this._featuresWidget.viewModel=this.viewModel),r.Vh),(0,r.wB)((()=>this._featureNavigationTop),(e=>this._featuresWidget.featureNavigationTop=e),r.Vh),(0,r.wB)((()=>this.headingLevel),(e=>this._featuresWidget.headingLevel=e),r.Vh),(0,r.wB)((()=>this.visibleElements.actionBar),(e=>this._featuresWidget.visibleElements.actionBar=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.closeButton),(e=>this._featuresWidget.visibleElements.closeButton=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.collapseButton),(e=>this._featuresWidget.visibleElements.collapseButton=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.heading),(e=>this._featuresWidget.visibleElements.heading=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.spinner),(e=>this._featuresWidget.visibleElements.spinner=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.featureNavigation),(e=>this._featuresWidget.visibleElements.featureNavigation=!!e),r.Vh),(0,r.wB)((()=>this.visibleElements.featureListLayerTitle),(e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e),r.Vh),(0,r.on)((()=>this._featuresWidget),"trigger-header-action",(e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)}))])}normalizeCtorArgs(e){const t={...e};return null!=e?.visibleElements&&(t.visibleElements=new di(e.visibleElements),null!=e.collapseEnabled&&(t.visibleElements.collapseButton=e.collapseEnabled),null!=e.spinnerEnabled&&(t.visibleElements.spinner=e.spinnerEnabled)),t}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:e,currentDockPosition:t}=this;return"bottom-left"===e||"bottom-center"===e||"bottom-right"===e||"top-left"===t||"top-center"===t||"top-right"===t}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get collapseEnabled(){return(0,s.Lx)(o.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(e){(0,s.Lx)(o.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ci}set dockOptions(e){const t={...ci},i=this.viewModel?.view?.breakpoints,n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...t,...e},o={...t.breakpoint,...n},{breakpoint:r}=s;"object"==typeof r?s.breakpoint={...o,...r}:r&&(s.breakpoint=o),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,s.Lx)(o.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(e){(0,s.Lx)(o.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){const{active:e}=this.viewModel;e||o.A.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||o.A.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame((()=>{this._featuresWidget.focus()}))}next(){return this.viewModel.next()}open(e){const t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),this._shouldFocus(e)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:n,screenLocation:s}=this.viewModel,o=n&&e,r=n&&!e,a=this.selectedFeature?.layer?.title,l=this.selectedFeature?.layer?.id,d={[oi.alignTopCenter]:"top-center"===t,[oi.alignBottomCenter]:"bottom-center"===t,[oi.alignTopLeft]:"top-left"===t,[oi.alignBottomLeft]:"bottom-left"===t,[oi.alignTopRight]:"top-right"===t,[oi.alignBottomRight]:"bottom-right"===t,[oi.isDocked]:o,[oi.shadow]:r,[oi.isDockedTopLeft]:"top-left"===i,[oi.isDockedTopCenter]:"top-center"===i,[oi.isDockedTopRight]:"top-right"===i,[oi.isDockedBottomLeft]:"bottom-left"===i,[oi.isDockedBottomCenter]:"bottom-center"===i,[oi.isDockedBottomRight]:"bottom-right"===i};return(0,b.K)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(oi.base,d,{[oi.baseHidden]:!s&&!e}),"data-layer-id":l,"data-layer-title":a,role:"presentation"},n?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,b.K)("div",{class:oi.pointer,key:"popup-pointer",role:"presentation"},(0,b.K)("div",{class:this.classes(oi.pointerDirection,oi.shadow)}))}_renderMainContainer(){const{dockEnabled:e}=this,t={[oi.shadow]:e};return(0,b.K)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(oi.main,z.D.widget,t)},this._featuresWidget.render())}async _shouldFocus(e){e?.shouldFocus&&(await(0,r.C_)((()=>!0===this.viewModel?.active)),this.focus())}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!n)return!1;const r=o.padding;return"right"===s&&n.x+i/2>o.width-r.right||"left"===s&&n.x-i/2<r.left||"top"===s&&n.y-t<r.top||"bottom"===s&&n.y+t>o.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:r}=s;if(null==o||!r||!i)return"top-center";function a(e){return parseInt(e.replaceAll(/[^-\d.]/g,""),10)}const l=n?window.getComputedStyle(n,null):null,d=l?a(l.getPropertyValue("max-height")):0,c=l?a(l.getPropertyValue("height")):0,{height:u,width:h}=i.getBoundingClientRect(),p=h+t,f=Math.max(u,d,c)+t,g=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:o,side:"right",view:r}),m=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:o,side:"left",view:r}),_=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:o,side:"top",view:r}),v=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:o,side:"bottom",view:r});return m?_?"bottom-right":"top-right":g?_?"bottom-left":"top-left":_?v?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,M.V8)(this.container)&&t.reverse(),e?.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){if("auto"!==e)return e;const t=this.viewModel?.view,i=(0,M.V8)(this.container)?"top-left":"top-right";if(!t)return i;const n=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-n.left-n.right,{breakpoints:o}=t;return o&&s<=o.xsmall?"bottom-center":i}_getDockIcon(){const e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),n=this._calculatePositionStyle(t,i);n&&Object.assign(this._containerNode.style,n)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:r}=i,a=n/2,l=i.height-t,d=i.width-e;return"bottom-center"===s?{top:t+o-r.top,left:e-a-r.left}:"top-left"===s?{bottom:l+o-r.bottom,right:d+o-r.right}:"bottom-left"===s?{top:t+o-r.top,right:d+o-r.right}:"top-right"===s?{bottom:l+o-r.bottom,left:e+o-r.left}:"bottom-right"===s?{top:t+o-r.top,left:e+o-r.left}:"top-center"===s?{bottom:l+o-r.bottom,left:e-a-r.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(null==e||!t)return;const s=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:void 0!==o.top?`${o.top}px`:"auto",left:void 0!==o.left?`${o.left}px`:"auto",bottom:void 0!==o.bottom?`${o.bottom}px`:"auto",right:void 0!==o.right?`${o.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[n,s]=e,[o,r]=t,{width:a=0,height:l=0}=i??{};return n<=a&&o>a||n>a&&o<=a||s<=l&&r>l||s>l&&r<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],r=[];o[0]=e[0]-n,o[1]=e[1]-s,r[0]=t[0]-n,r[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(o,r,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){const t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;const{width:n,height:s}=i;if(isNaN(n)||isNaN(s))return!1;if(!t)return!1;const o=t.hasOwnProperty("width")&&n<=(t.width??0),r=t.hasOwnProperty("height")&&s<=(t.height??0);return o||r}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"_featureNavigationTop",null),(0,n._)([(0,a.MZ)()],ui.prototype,"actions",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"active",null),(0,n._)([(0,a.MZ)()],ui.prototype,"alignment",void 0),(0,n._)([(0,a.MZ)()],ui.prototype,"autoCloseEnabled",null),(0,n._)([(0,a.MZ)()],ui.prototype,"defaultPopupTemplateEnabled",null),(0,n._)([(0,a.MZ)()],ui.prototype,"content",null),(0,n._)([(0,a.MZ)()],ui.prototype,"collapsed",null),(0,n._)([(0,a.MZ)()],ui.prototype,"collapseEnabled",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"currentAlignment",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"currentDockPosition",null),(0,n._)([(0,a.MZ)()],ui.prototype,"dockOptions",null),(0,n._)([(0,a.MZ)()],ui.prototype,"dockEnabled",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"featureCount",null),(0,n._)([(0,a.MZ)()],ui.prototype,"featureMenuOpen",null),(0,n._)([(0,a.MZ)()],ui.prototype,"features",null),(0,n._)([(0,a.MZ)()],ui.prototype,"goToOverride",null),(0,n._)([(0,a.MZ)()],ui.prototype,"headingLevel",void 0),(0,n._)([(0,a.MZ)()],ui.prototype,"highlightEnabled",null),(0,n._)([(0,a.MZ)()],ui.prototype,"icon",null),(0,n._)([(0,a.MZ)()],ui.prototype,"location",null),(0,n._)([(0,a.MZ)()],ui.prototype,"label",null),(0,n._)([(0,a.MZ)(),(0,U.G)("esri/widgets/Popup/t9n/Popup")],ui.prototype,"messages",void 0),(0,n._)([(0,a.MZ)()],ui.prototype,"promises",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"selectedFeature",null),(0,n._)([(0,a.MZ)()],ui.prototype,"selectedFeatureIndex",null),(0,n._)([(0,a.MZ)({readOnly:!0})],ui.prototype,"selectedFeatureWidget",null),(0,n._)([(0,a.MZ)()],ui.prototype,"spinnerEnabled",null),(0,n._)([(0,a.MZ)()],ui.prototype,"title",null),(0,n._)([(0,a.MZ)()],ui.prototype,"updateLocationEnabled",null),(0,n._)([(0,a.MZ)()],ui.prototype,"view",null),(0,n._)([(0,a.MZ)({type:ai}),(0,Xt.U)(["triggerAction","trigger-action"])],ui.prototype,"viewModel",void 0),(0,n._)([(0,a.MZ)()],ui.prototype,"visible",null),(0,n._)([(0,a.MZ)({type:di,nonNullable:!0})],ui.prototype,"visibleElements",void 0),ui=(0,n._)([(0,l.$)("esri.widgets.Popup")],ui);const hi=ui}}]);
//# sourceMappingURL=5434.6a11c8ce.chunk.js.map