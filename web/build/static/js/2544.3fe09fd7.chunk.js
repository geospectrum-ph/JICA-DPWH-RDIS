"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[2544],{62544:(e,r,a)=>{a.r(r),a.d(r,{fromUrl:()=>d});var t=a(50076),n=a(90534),l=a(13096),o=a(39323),s=a(11668),i=a(31933),u=a(62487),c=a(67061);const y={FeatureLayer:!0,SceneLayer:!0};async function d(e){const{properties:r,url:t}=e,n={...r,url:t},l=await p(t,null===r||void 0===r?void 0:r.customParameters),{Constructor:o,layerId:s,sourceJSON:i,parsedUrl:u,layers:c,tables:y}=l;if(c.length+y.length===0)return null!=s&&(n.layerId=s),null!=i&&(n.sourceJSON=i),new o(n);const d=new(0,(await Promise.resolve().then(a.bind(a,16095))).default)({title:u.title});return await async function(e,r,a){const t=r.sublayerConstructorProvider;for(const{id:l,serverUrl:o}of r.layers){var n;const s=v(r.sublayerInfos,l),i=f(o,l,s,null!==(n=s&&(null===t||void 0===t?void 0:t(s)))&&void 0!==n?n:r.Constructor,a);e.add(i)}if(r.tables.length){const t=await m("FeatureLayer");r.tables.forEach((n=>{let{id:l,serverUrl:o}=n;const s=f(o,l,v(r.tableInfos,l),t,a);e.tables.add(s)}))}}(d,l,n),d}function v(e,r){return e?e.find((e=>{let{id:a}=e;return a===r})):null}function f(e,r,a,t,n){const l={...n,layerId:r};return null!=e&&(l.url=e),null!=a&&(l.sourceJSON=a),"sublayerTitleMode"in t.prototype&&(l.sublayerTitleMode="service-name"),new t(l)}async function p(e,r){let a=(0,l.qg)(e);if(null==a&&(a=await async function(e,r){var a,t;const o=await(0,c.V)(e,{customParameters:r});let s=null,i=null;const u=o.type;if("Feature Layer"===u||"Table"===u?(s="FeatureServer",i=null!==(a=o.id)&&void 0!==a?a:null):"indexedVector"===u?s="VectorTileServer":o.hasOwnProperty("mapName")?s="MapServer":o.hasOwnProperty("bandCount")&&o.hasOwnProperty("pixelSizeX")?s="ImageServer":o.hasOwnProperty("maxRecordCount")&&o.hasOwnProperty("allowGeometryUpdates")?s="FeatureServer":o.hasOwnProperty("streamUrls")?s="StreamServer":w(o)?(s="SceneServer",i=o.id):o.hasOwnProperty("layers")&&w(null===(t=o.layers)||void 0===t?void 0:t[0])&&(s="SceneServer"),!s)return null;const y=null!=i?(0,l.iz)(e):null;return{title:null!=y&&o.name||(0,n.e7)(e),serverType:s,sublayer:i,url:{path:null!=y?y.serviceUrl:(0,n.An)(e).path}}}(e,r)),null==a)throw new t.A("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:u,sublayer:d}=a;let v;const f={FeatureServer:"FeatureLayer",KnowledgeGraphServer:"KnowledgeGraphLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer",VideoServer:"VideoLayer"},p="FeatureServer"===u,h="SceneServer"===u,S={parsedUrl:a,Constructor:null,layerId:(p||h)&&null!==d&&void 0!==d?d:void 0,layers:[],tables:[]};switch(u){case"MapServer":if(null!=d){const{type:a}=await(0,c.V)(e,{customParameters:r});switch(v="FeatureLayer",a){case"Catalog Layer":v="CatalogLayer";break;case"Catalog Dynamic Group Layer":throw new t.A("arcgis-layers:unsupported",'fromUrl() not supported for "'.concat(a,'" layers'))}}else v=await async function(e,r){return(await(0,c.V)(e,{customParameters:r})).tileInfo}(e,r)?"TileLayer":"MapImageLayer";break;case"ImageServer":{var b;const a=await(0,c.V)(e,{customParameters:r}),{tileInfo:t,cacheType:n}=a;v=t?"LERC"!==(null===t||void 0===t||null===(b=t.format)||void 0===b?void 0:b.toUpperCase())||n&&"elevation"!==n.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer";break}case"SceneServer":{const e=await(0,c.V)(a.url.path,{customParameters:r});if(v="SceneLayer",e){const r=null===e||void 0===e?void 0:e.layers;if("Voxel"===(null===e||void 0===e?void 0:e.layerType))v="VoxelLayer";else if(null!==r&&void 0!==r&&r.length){var g;const e=null===(g=r[0])||void 0===g?void 0:g.layerType;null!=e&&null!=i.XX[e]&&(v=i.XX[e])}}break}case"3DTilesServer":throw new t.A("arcgis-layers:unsupported","fromUrl() not supported for 3DTiles layers");case"FeatureServer":if(v="FeatureLayer",null!=d){const a=await(0,c.V)(e,{customParameters:r});S.sourceJSON=a,v=(0,s.K)(a.type)}break;default:v=f[u]}if(y[v]&&null==d){var I;const a=await async function(e,r,a){var t,n;let l,i,u=!1;switch(r){case"FeatureServer":{const r=await(0,s.Q)(e,{customParameters:a});u=!!r.layersJSON,l=r.layersJSON||r.serviceJSON;break}case"SceneServer":{const r=await async function(e,r){var a;const t=await(0,c.V)(e,{customParameters:r}),n=null===(a=t.layers)||void 0===a?void 0:a[0];if(!n)return{serviceInfo:t};try{const{serverUrl:a}=await(0,o.L)(e),n=await(0,c.V)(a,{customParameters:r}).catch((()=>null));return n&&(t.tables=n.tables),{serviceInfo:t,tableServerUrl:a}}catch{return{serviceInfo:t}}}(e,a);l=r.serviceInfo,i=r.tableServerUrl;break}default:l=await(0,c.V)(e,{customParameters:a})}const y=null===(t=l)||void 0===t?void 0:t.layers,d=null===(n=l)||void 0===n?void 0:n.tables;return{layers:(null===y||void 0===y?void 0:y.map((e=>({id:e.id}))).reverse())||[],tables:(null===d||void 0===d?void 0:d.map((e=>({serverUrl:i,id:e.id}))).reverse())||[],layerInfos:u?y:[],tableInfos:u?d:[]}}(e,u,r);if(p&&(S.sublayerInfos=a.layerInfos,S.tableInfos=a.tableInfos),1!==a.layers.length+a.tables.length)S.layers=a.layers,S.tables=a.tables,p&&(null===(I=a.layerInfos)||void 0===I?void 0:I.length)&&(S.sublayerConstructorProvider=await async function(e){if(!e.length)return;const r=new Set,a=[];for(const{type:l}of e)r.has(l)||(r.add(l),a.push(m((0,s.K)(l))));const t=await Promise.all(a),n=new Map;return Array.from(r).forEach(((e,r)=>{n.set(e,t[r])})),e=>n.get(e.type)}(a.layerInfos));else if(p||h){var L,P,U,T,O,C;const e=null!==(L=null===(P=a.layerInfos)||void 0===P?void 0:P[0])&&void 0!==L?L:null===(U=a.tableInfos)||void 0===U?void 0:U[0];if(S.layerId=null!==(T=null===(O=a.layers[0])||void 0===O?void 0:O.id)&&void 0!==T?T:null===(C=a.tables[0])||void 0===C?void 0:C.id,S.sourceJSON=e,p){const r=null===e||void 0===e?void 0:e.type;v=(0,s.K)(r)}}}return S.Constructor=await m(v),S}function w(e){return null!=e&&e.hasOwnProperty("store")&&e.hasOwnProperty("id")&&"number"==typeof e.id}async function m(e){return(0,u.S[e])()}},39323:(e,r,a)=>{a.d(r,{L:()=>c});var t=a(55171),n=a(3825),l=a(50076),o=a(50346),s=a(13096),i=a(65308),u=a(70652);async function c(e,r){var a,c;const v=(0,s.qg)(e);if(!v)throw new l.A("invalid-url","Invalid scene service url");const f={...r,sceneServerUrl:v.url.path,layerId:null!==(a=v.sublayer)&&void 0!==a?a:void 0};if(null!==(c=f.sceneLayerItem)&&void 0!==c||(f.sceneLayerItem=await async function(e){const r=(await y(e)).serviceItemId;if(!r)return null;const a=new u.default({id:r,apiKey:e.apiKey}),l=await async function(e){const r=null===t.id||void 0===t.id?void 0:t.id.findServerInfo(e.sceneServerUrl);if(null!==r&&void 0!==r&&r.owningSystemUrl)return r.owningSystemUrl;const a=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await(0,n.A)(a,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(r)return r}catch(p){(0,o.QP)(p)}return null}(e);null!=l&&(a.portal=new i.A({url:l}));try{return a.load({signal:e.signal})}catch(w){return(0,o.QP)(w),null}}(f)),null==f.sceneLayerItem)return d(f.sceneServerUrl.replace("/SceneServer","/FeatureServer"),f);const p=await async function(e){let{sceneLayerItem:r,signal:a}=e;if(!r)return null;try{const e=(await r.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:a})).find((e=>"Feature Service"===e.type))||null;if(!e)return null;const t=new u.default({portal:e.portal,id:e.id});return await t.load(),t}catch(t){return(0,o.QP)(t),null}}(f);if(null===p||void 0===p||!p.url)throw new l.A("related-service-not-found","Could not find feature service through portal item relationship");f.featureServiceItem=p;const w=await d(p.url,f);return w.portalItem=p,w}async function y(e){if(e.rootDocument)return e.rootDocument;const r={query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:e.signal};try{const a=await(0,n.A)(e.sceneServerUrl,r);e.rootDocument=a.data}catch{e.rootDocument={}}return e.rootDocument}async function d(e,r){var a,t,o;const i=(0,s.qg)(e);if(!i)throw new l.A("invalid-feature-service-url","Invalid feature service url");const u=i.url.path,c=r.layerId;if(null==c)return{serverUrl:u};const d=y(r),v=r.featureServiceItem?await r.featureServiceItem.fetchData("json"):null,f=null===(a=(null===v||void 0===v||null===(t=v.layers)||void 0===t?void 0:t[0])||(null===v||void 0===v||null===(o=v.tables)||void 0===o?void 0:o[0]))||void 0===a?void 0:a.customParameters,p=e=>{const a={query:{f:"json",...f},responseType:"json",authMode:e,signal:r.signal};return(0,n.A)(u,a)},w=p("anonymous").catch((()=>p("no-prompt"))),[m,h]=await Promise.all([w,d]),S=null===h||void 0===h?void 0:h.layers,b=m.data&&m.data.layers;if(!Array.isArray(b))throw new Error("expected layers array");if(Array.isArray(S)){for(let n=0;n<Math.min(S.length,b.length);n++)if(S[n].id===c)return{serverUrl:u,layerId:b[n].id}}else if(null!=c&&c<b.length)return{serverUrl:u,layerId:b[c].id};throw new Error("could not find matching associated sublayer")}},11668:(e,r,a)=>{a.d(r,{K:()=>d,Q:()=>l});var t=a(67061);const n=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function l(e,r){var a;const{loadContext:n,...l}=r||{},o=n?await n.fetchServiceMetadata(e,l):await(0,t.V)(e,l);y(o),i(o);const s={serviceJSON:o};if((null!==(a=o.currentVersion)&&void 0!==a?a:0)<10.5)return s;const u="".concat(e,"/layers"),c=n?await n.fetchServiceMetadata(u,l):await(0,t.V)(u,l);return y(c),i(c),s.layersJSON={layers:c.layers,tables:c.tables},s}function o(e){const{type:r}=e;return!!r&&n.has(r)}function s(e){return"Table"===e.type}function i(e){var r,a;e.layers=null===(r=e.layers)||void 0===r?void 0:r.filter(o),e.tables=null===(a=e.tables)||void 0===a?void 0:a.filter(s)}function u(e){e.type||(e.type="Feature Layer")}function c(e){e.type||(e.type="Table")}function y(e){var r,a;null!==(r=e.layers)&&void 0!==r&&r.forEach(u),null===(a=e.tables)||void 0===a||a.forEach(c)}function d(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},67061:(e,r,a)=>{a.d(r,{V:()=>n});var t=a(3825);async function n(e,r){const{data:a}=await(0,t.A)(e,{responseType:"json",query:{f:"json",...null===r||void 0===r?void 0:r.customParameters,token:null===r||void 0===r?void 0:r.apiKey}});return a}}}]);
//# sourceMappingURL=2544.3fe09fd7.chunk.js.map