{"version":3,"file":"static/js/490.afa612cc.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","../node_modules/@arcgis/core/views/2d/engine/BitmapTile.js","../node_modules/@arcgis/core/views/2d/engine/BitmapTileContainer.js","../node_modules/@arcgis/core/views/2d/layers/BitmapTileLayerView2D.js","../node_modules/@arcgis/core/views/2d/layers/support/imageUtils.js","../node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js","../node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/reactiveUtils.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import\"../../core/Error.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let a=class extends i{initialize(){this.addHandles(o((()=>this.layer),\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this).error(r)}))})),\"RefreshableLayerView\")}};return a=r([t(\"esri.views.layers.RefreshableLayerView\")],a),a};export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{Bitmap as t}from\"./Bitmap.js\";import{TiledDisplayObject as s}from\"./webgl/TiledDisplayObject.js\";class r extends s{constructor(e,s,r,i,a,n,o=null){super(e,s,r,i,a,n),this.bitmap=new t(o),this.bitmap.coordScale=[a,n],this.bitmap.once(\"isReady\",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(e){this.bitmap.beforeRender(e),super.beforeRender(e)}afterRender(e){this.bitmap.afterRender(e),super.afterRender(e)}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:e(),tileMat3:e()}}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}export{r as BitmapTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../geometry/support/aaBoundingRect.js\";import{BitmapTile as i}from\"./BitmapTile.js\";import{brushes as r}from\"./brushes.js\";import{WGLDrawPhase as t}from\"./webgl/enums.js\";import s from\"./webgl/TileContainer.js\";class n extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.bitmap.blendFunction))}createTile(r){const t=this._tileInfoView.getTileBounds(e(),r),s=this._tileInfoView.getTileResolution(r.level),[n,o]=this._tileInfoView.tileInfo.size;return new i(r,s,t[0],t[3],n,o)}prepareRenderPasses(e){const i=e.registerRenderPass({name:\"bitmap (tile)\",brushes:[r.bitmap],target:()=>this.children.map((e=>e.bitmap)),drawPhase:t.MAP});return[...super.prepareRenderPasses(e),i]}doRender(e){this.visible&&e.drawPhase===t.MAP&&super.doRender(e)}}export{n as BitmapTileContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as i}from\"../../../chunks/tslib.es6.js\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{subclass as e}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapTileContainer as t}from\"../engine/BitmapTileContainer.js\";const r=r=>{let s=class extends r{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`),this._bitmapView=new t(this._tileInfoView),this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView),this._bitmapView?.removeAllChildren(),this._bitmapView=null}};return s=i([e(\"esri.views.2d.layers.BitmapTileLayerView2D\")],s),s};export{r as BitmapTileLayerView2D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nfunction e(e){return e instanceof HTMLImageElement?e.naturalWidth:e.width}function t(e){return e instanceof HTMLImageElement?e.naturalHeight:e.height}function n(n,l,r,u){if(r.level===u.level)return l;const i=n.tileInfo.size,a=n.getTileResolution(r.level),c=n.getTileResolution(u.level);let g=n.getLODInfoAt(u.level);const h=g.getXForColumn(u.col),d=g.getYForRow(u.row);g=n.getLODInfoAt(r.level);const f=g.getXForColumn(r.col),s=g.getYForRow(r.row),m=e(l)/i[0],v=t(l)/i[1],w=Math.round(m*((h-f)/a)),I=Math.round(v*(-(d-s)/a)),M=Math.round(m*i[0]*(c/a)),F=Math.round(v*i[1]*(c/a)),L=o(i);return L.getContext(\"2d\").drawImage(l,w,I,M,F,0,0,i[0],i[1]),L}function o(e){const t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}export{o as createBlankImage,n as resampleImage};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import{equals as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{BitmapTileLayerView2D as l}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import{resampleImage as h}from\"./support/imageUtils.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileKey.js\";import u from\"../tiling/TileQueue.js\";import f from\"../tiling/TileStrategy.js\";import p from\"../../layers/LayerView.js\";import d from\"../../layers/RefreshableLayerView.js\";const m=new Set([102113,102100,3857,3785,900913]),y=[0,0];let _=class extends(d(l(o(p)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new n(e),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:16,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new f({cachePolicy:\"keep\",resampling:!0,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add((()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet]),(()=>this.doRefresh()))),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some((t=>a(t.tileInfo?.spatialReference,e)))??!1}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updatingHandles.addPromise(this._enqueueTileFetch(e))))}}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(y,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,t={}){const s=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,{signal:r,resamplingLevel:a=0}=t;if(!s)return this._fetchImage(e,r);const l=new c(0,0,0,0);let o;try{await s.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:r}),o=await this._fetchImage(l,r)}catch(n){if(i(n))throw n;if(a<3){const i=this._tileInfoView.getTileParentId(e.id);if(i){const s=new c(i),r=await this.fetchTile(s,{...t,resamplingLevel:a+1});return h(this._tileInfoView,r,s,e)}}throw n}return h(this._tileInfoView,o,l,e)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(s){i(s)||t.getLogger(this).error(s)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:t})}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>a(e.tileInfo?.spatialReference,t)));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>m.has(e.tileInfo?.spatialReference.wkid??-1)))),i}};e([s({readOnly:!0})],_.prototype,\"tileMatrixSet\",null),_=e([r(\"esri.views.2d.layers.WMTSLayerView2D\")],_);const w=_;export{w as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{WGLDrawPhase as e}from\"./enums.js\";import r from\"./WGLContainer.js\";import s from\"./brushes/WGLBrushStencil.js\";import t from\"./brushes/WGLBrushTileDebugInfo.js\";const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends r{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(r){const n=super.prepareRenderPasses(r);return n.push(r.registerRenderPass({name:\"stencil\",brushes:[s],drawPhase:e.DEBUG|e.MAP|e.HIGHLIGHT|e.LABEL,target:()=>this.getStencilTarget()})),has(\"esri-tiles-debug\")&&n.push(r.registerRenderPass({name:\"tileInfo\",brushes:[t],drawPhase:e.DEBUG,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(e){let r=1;for(const s of this.children)s.stencilRef=r++}}export{i as default};\n"],"names":["i","a","initialize","this","addHandles","o","layer","r","doRefresh","dataChanged","catch","s","e","getLogger","error","t","constructor","n","arguments","length","undefined","super","bitmap","coordScale","once","ready","destroy","beforeRender","afterRender","stencilRef","_createTransforms","displayViewScreenMat3","tileMat3","setTransform","transforms","onAttach","stage","onDetach","requiresDedicatedFBO","children","some","blendFunction","createTile","_tileInfoView","getTileBounds","getTileResolution","level","tileInfo","size","prepareRenderPasses","registerRenderPass","name","brushes","target","map","drawPhase","MAP","doRender","visible","attach","view","timeline","record","title","_bitmapView","container","addChild","detach","removeChild","removeAllChildren","l","u","c","g","getLODInfoAt","h","getXForColumn","col","d","getYForRow","row","f","m","HTMLImageElement","naturalWidth","width","v","naturalHeight","height","w","Math","round","I","M","F","L","getContext","drawImage","document","createElement","Set","y","_","p","_tileStrategy","_fetchQueue","tileMatrixSet","_getTileMatrixSetBySpatialReference","activeLayer","id","tileMatrixSetId","update","pause","state","resume","tileInfoView","concurrency","process","fetchTile","cachePolicy","resampling","acquireTile","releaseTile","addAttachHandles","_updatingHandles","add","styleId","viewChange","requestUpdate","moveEnd","supportsSpatialReference","tileMatrixSets","spatialReference","attached","suspended","clear","reset","refresh","addPromise","_enqueueTileFetch","x","getTileCoords","key","resolution","abort","tilemapCache","signal","resamplingLevel","_fetchImage","fetchAvailabilityUpsample","getTileParentId","canResume","has","push","source","fetchImageBitmapTile","find","isWebMercator","wkid","readOnly","prototype","renderChildren","sortChildren","setStencilReference","createRenderParams","requiredLevel","getClosestInfoForScale","scale","displayLevel","scaleToZoom","DEBUG","HIGHLIGHT","LABEL","getStencilTarget"],"sourceRoot":""}